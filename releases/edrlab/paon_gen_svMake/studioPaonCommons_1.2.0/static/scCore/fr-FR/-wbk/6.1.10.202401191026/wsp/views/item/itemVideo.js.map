{"version":3,"sources":["/@back@/wsp/views/item/itemVideo.tsx"],"names":["BaseElement","BASIS","installSrcViewFileDrop","REG","JSX","DOMSH","WSP","ImgSize","SRC","ItemVideo","[object Object]","init","this","reg","findReg","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","env","video","createElement","src","getStreamUrl","transform","controls","size","appendChild","î","newInit","place","eventsMgr","on","msg","srcRef","longDesc","getStreamStampedUrl","wsp","itemType","getMainStreamSrcUri","srcDt","registerSkin","customElements","define"],"mappings":"OAAQA,YAAaC,UAAqB;OACtBC,2BAAuB;OAC7BC,QAAI;OAEVC,QAAI;OACJC,UAAM;OACYC,QAAI;OACtBC,YAAwB;OACxBC,QAAI;OAmBN,MAAOC,kBAAkBT,YAG9BU,YAAYC,MACXC,KAAKC,IAAMD,KAAKE,QAAQH;AACxB,MAAMI,GAAKH,KAAKI,aAAaX,MAAMY;AACnCL,KAAKM,oBAAoBN,KAAKO,UAAWR;AACzCT,uBAAuBU,KAAKC,IAAKD;AACjC,MAAMQ,IAAEA,KAAQR,KAAKC;AACrB,MAAMQ,MAAQjB,IAAAkB,cAAA,QAAA,CAAOC,IAAKX,KAAKY,aAAaZ,KAAKC,IAAIO,IAAKT,KAAKc,WAAYC,SAAS;AACpF,GAAIf,KAAKgB,KAAMZ,GAAGa,YAAYxB,IAAAkB,cAACf,QAAO,CAAAsB,IAAI5B,MAAM6B,QAAQnB,KAAKgB,KAAMf,KAAKC,MAAOQ;KAC1EN,GAAGa,YAAYP;AAGpBD,IAAIW,MAAMC,UAAUC,GAAG,eAAiBC,MACvC,GAAI1B,IAAI2B,OAAOf,IAAIgB,YAAc5B,IAAI2B,OAAOD,KAAM,CACjDb,MAAME,IAAMX,KAAKY,aAAaZ,KAAKC,IAAIO,IAAKT,KAAKc,cAKpDf,aAAaU,IAAiBK,WAC7B,OAAOnB,IAAI+B,oBAAoBjB,IAAIkB,IAAKlB,IAAImB,SAASC,oBAAoBpB,IAAIgB,UAAWhB,IAAIgB,SAASK,MAAOhB,YAI9GtB,IAAIU,IAAI6B,aAAa,iBAAkB,EAAsB;AAyB7DC,eAAeC,OAAO,iBAAkBnC","sourcesContent":["import {BaseElement, BASIS, OSkinableInit} from \"back/commons/basis\";\nimport {IItemUiEnv, installSrcViewFileDrop} from \"back/wsp/views/itemMain\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IView} from \"lib/commons/views\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {JWspUriChangeMsg, WSP} from \"lib/wsp/wsp\";\nimport {ImgSize, OImgSizeConfig} from \"back/wsp/widgets/imgSize\";\nimport {SRC} from \"lib/wsp/src\";\n\n/**\n * View d'un item sous forme d'une video.\n *\n * TODO scSize...\n *\n * Config attributes:\n */\nexport interface OItemVideoInit extends OSkinableInit {\n\treg?: IReg<IItemUiEnv>\n\ttransform?: string,\n\tsize?: OImgSizeConfig\n}\n\nexport interface ItemVideo extends BaseElement {\n\tinitialize(init: OItemVideoInit): this;\n}\n\nexport class ItemVideo extends BaseElement implements IView {\n\treg: IReg<IItemUiEnv>;\n\n\t_initialize(init: OItemVideoInit) {\n\t\tthis.reg = this.findReg(init);\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tinstallSrcViewFileDrop(this.reg, this);\n\t\tconst { env } = this.reg;\n\t\tconst video = <video src={this.getStreamUrl(this.reg.env, init.transform)} controls=\"controls\"/>;\n\t\tif (init.size) sr.appendChild(<ImgSize î={BASIS.newInit(init.size, this.reg)}>{video}</ImgSize>);\n\t\telse sr.appendChild(video);\n\n\t\t// Listener sur les changements de la ressource\n\t\tenv.place.eventsMgr.on(\"wspUriChange\", (msg: JWspUriChangeMsg) => {\n\t\t\tif (SRC.srcRef(env.longDesc) === SRC.srcRef(msg)) {\n\t\t\t\tvideo.src = this.getStreamUrl(this.reg.env, init.transform);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetStreamUrl(env: IItemUiEnv, transform: string) {\n\t\treturn WSP.getStreamStampedUrl(env.wsp, env.itemType.getMainStreamSrcUri(env.longDesc), env.longDesc.srcDt, transform)\n\t}\n}\n\nREG.reg.registerSkin(\"wsp-item-video\", 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex: 1;\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\tpadding: 1px;\n\t}\n\n\t:host > video {\n\t\twidth: -webkit-fill-available;\n\t\theight: -webkit-fill-available;\n\t\tmax-width: fit-content;\n\t\tmax-height: fit-content;\n\t\talign-self: center;\n\t}\n\n\twsp-imgsize {\n\t\tflex: 1;\n\t}\n`);\n\n\ncustomElements.define(\"wsp-item-video\", ItemVideo);\n"]}