{"version":3,"sources":["/@back@/wsp/views/generators.tsx"],"names":["Button","CellBuilderIconLabel","GridSmall","GridColTreeDef","GridDataHolderJsonTree","SrcPointerDblClick","SrcPointerFastSelect","SrcPointerInline","FORMS","MxFormElement","REG","SEC","render","xhtml","BaseAreaView","DOM","JSX","DOMSH","InfoCurrentItem","InfoReqCurrentItem","ITEM","SRC","EventMgr","CID","ECidSessionState","POPUP","BaseElement","DynGen","AREAS","UiThemeDeskFeat","GeneratorTabs","[object Object]","init","super","_initialize","this","wsp","reg","env","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","pubNodeMatchFilter","genTabs","appendChild","createElement","id","onkeydown","ev","code","genView","findHost","tab","currentTab","previousElementSibling","genTab","itemPtr","focus","nextElementSibling","stopPropagation","preventDefault","ondragover","stopImmediatePropagation","me","shortDescs","getShortDescsTransferFromDragSession","dataTransfer","targetSrcType","dropEffect","srcRefs","length","wspCd","ondrop","isImport","setCurrentTab","GeneratorTab","srcRef","gens","Generators","initialize","onCodePubChange","add","codePub","infoBroker","addConsumer","place","eventsMgr","on","refreshStates","liveTab","onclick","onAddTab","tabindex-custom","icon","ui-context","title","lastDatas","tabs","i","s","t","setAsCurrentTab","setSrc","parentLastDatas","lastDatasKey","getAttribute","findFirstChild","isGeneratorTabPointer","findNextSibling","ld","push","codeGen","waitForAvailable","fetchSrc","SINGLETON","execute","closeTab","info","hidden","setSrcRef","srcUri","shortDesc","onViewShown","refreshLiveTab","visitor","options","registerSkin","customElements","define","atFirst","insertBefore","class","firstChild","defaultAction","getSvc","sgnPattern","wspMetaUi","getGenOrCidSgnPattern","showStatus","draggable","dropable","dispatchHighlight","setPinState","classList","tabIndex","addEventListener","parentElement","onSrcRefChange","drawer","src","srcSt","pinned","btn","_newCloseButton","onPin","current","toggle","tabIndexCustom","req","dispatchInfo","_a","findPreviousSibling","remove","onClose","spanTab","parentNode","toString","readOnly","n","datas","setDefaultOpenState","defaultOpenStates","pubActions","actionContext","installSkin","layoutV","area","layout","customDestPath","pubTree","î","columnDefs","setFlex","setMinWidth","setChildrenIndent","setCellBuilder","CellBuilderGen","hideHeaders","autoSelOnFocus","skinScroll","emptyBody","style","c-resizable","dataHolder","onGridSelect","c-orient","body","genRoot","genTop","genTopMain","genRefreshBtn","uiContext","refreshGenRootUi","genIllus","topInfos","genInfos","genSkins","onSkinChange","genProps","cidRoot","cidManifestHead","cidDetails","pubNode","genInfo","skins","rootProps","reportValidity","props","formToJson","disableFullOverlay","codeGenToSelect","ctx","setDatas","itemType","getItemType","itModel","itemReg","createSubReg","securityCtx","createSub","srcRoles","srcRi","tree","buildPubTree","newGen","getPub","openFolder","offset","getOffset","setSelectedRows","pub","genNodeType","generators","newPubNode","getDataByOffset","getSelectedRow","codeGenStack","emit","setPubNode","setGenIllus","target","value","setHidden","initViewCid","initViewGen","initViewEmpty","cidInfo","genNode","idx","lastIndexOf","cdGen","substring","genInfoSvc","fetchGenInfo","call","needExtraProps","showRefreshBtn","status","sort","skinA","skinB","localeCompare","sensitivity","skinsTpl","skin","infos","infosTpl","propsLists","genNature","propsListsAreas","mergeLists","tpl","hasChildNodes","areaCtx","Object","create","buildControlLabel","applyLayout","Promise","all","jsonToForm","storedProps","setAttrBool","setTimeout","actionsLists","actionListsCode","actions","e","console","error","cidNode","allHosts","getCidHostsForOutput","cidHosts","cidHostIs","Array","from","filterIsOr","cidManifestUrlInput","cidSeletHost","lastManifest","fetchManifest","cidOnManifestKnown","textContent","group","host","onCidSelectHost","href","label","buildInputManifest","parent","type","oninput","onManifestInput","onchange","onManifestChange","disabled","cidUseManifest","cidManifest","noShadow","input","msg","shadowRoot","getElementById","validity","valid","setCustomMsg","getCidManifest","log","getCidManifestLabel","_cidMnInputWaiter","clearTimeout","manifest","parseInt","cidProcessSelector","cidProcesses","cidProcessIs","getProcesses","indexOf","cidRefreshOnSessionChange","refreshContent","cidSession","state","authenticating","inStep","uiProcessSel","notStarted","uiAuth","failed","ended","aborted","skinCode","find","hasIllus","getGenSkinIllusUrl","illusUrl","prevIllusSrc","closed","removeListener","_onConnectionRenewed","universe","wsFrames","ws","msgListeners","_onMsgWspGen","m","dt","deploy","lastGen","lastGenDate","DTFormatter","format","genTitle","reason","map","session","step","frame","isIn","desk","injectTheme","dialog","showDialog","titleBar","initHeight","initWidth","onNextClose","then","r","onCidFrameMessage","cidAuth","res","initFrame","close","iframe","config","cidPassOptionalInteraction","def","barLabel","cidProcess","getStr","resizer","cidInteraction","choices","values","next","Intl","DateTimeFormat","year","month","day","hour","minute","second","d","iconKey","iconFilter","row","root","redrawCell","span","firstElementChild","rowDatas","display","iconUrl","fontWeight","DynGenParam","_lastProps","viewGenPropsMgr","view","genFrame","contentWindow","_genPropsMgr","findReg","assign","w","autoResize","_refreshUi","_attach","_initializeForm","forceDisabled","refresh","_refreshValidity","resolve","undefined","get","load","checkValidity","setValidity","badInput"],"mappings":"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","sourcesContent":["import {BarActions, OBarActionsInit} from \"back/commons/widgets/bars\";\nimport {Button, OButtonInit} from \"back/commons/widgets/buttons\";\nimport {CellBuilderIconLabel} from \"back/commons/widgets/grid-libs\";\nimport {GridSmall, OGridSmallInit} from \"back/commons/widgets/grid-tags\";\nimport {GridColTreeDef, GridDataHolderJsonTree, GridDataRowJsonTree} from \"back/commons/widgets/tree\";\nimport {SrcDrawer, SrcPointerDblClick, SrcPointerFastSelect, SrcPointerInline} from \"back/wsp/widgets/srcDrawer\";\nimport {FORMS, IFormJsonisable, MxFormElement, OFormElementInit} from \"lib/commons/forms\";\nimport {IInfo, IInfoConsumer} from \"lib/commons/infos\";\nimport {ILastDatasBuilder, JLastDatas} from \"lib/commons/lastDatas\";\nimport {IReg, IRegPointer, REG} from 'lib/commons/registry';\nimport {SEC} from \"lib/commons/security\";\nimport {render, TemplateResult, xhtml} from \"lib/commons/utils/htmlLit\";\nimport {BaseAreaView, IView, IViewApi, IViewContainer, IViewsContainer, OBaseAreaViewInit, OViewVisitOptions} from \"lib/commons/views\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {InfoCurrentItem, InfoReqCurrentItem, ITEM, JGenInfo, JGenSkin} from \"lib/wsp/item\";\nimport {JSrcFields, SRC, srcRef} from \"lib/wsp/src\";\nimport {IWspUiEnv, JWspWorkingInitStates, Wsp, wspUri} from \"lib/wsp/wsp\";\nimport {IDatasItemCidNode, IItemPubNode, IPubCtx} from \"lib/wsp/wspMetaUi\";\nimport {EventMgr} from \"lib/commons/events\";\nimport {CID, CidManifest, CidProcess, CidSession, CidStep, CidWebAuthStep, ECidSessionState, ICidManifestPointer, ICidStepResult, ICidUiHandler} from \"lib/core/cid\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {BaseElement, MsgLabel} from \"back/commons/basis\";\nimport {JWspGenMsg} from \"back/wsp/views/gen/genActions\";\nimport {DynGen, IWindowDynGen, ODynGenInit} from \"back/wsp/views/dynGen\";\nimport {AREAS, IArea, IControlAreaContext} from \"lib/commons/areas\";\nimport {UiThemeDeskFeat} from \"back/core/plugins/optionsPlg\";\nimport {IAction} from \"lib/commons/actions\";\nimport {IWbToolLocatedArea} from \"back/core/widgets/workbench\";\n\n\n/**\n */\nexport interface GeneratorTabs extends BaseAreaView<IRegPointer<IWspUiEnv>> {\n\tinitialize(init: OGeneratorsInit): this\n}\n\n\nexport interface OGeneratorTabsInit extends OGeneratorsInit {\n\tlastDatas?: JLDGeneratorTabs,\n}\n\nexport class GeneratorTabs extends BaseAreaView<IRegPointer<IWspUiEnv>> implements IInfoConsumer, ILastDatasBuilder, IViewsContainer {\n\treg: IReg<IWspUiEnv>;\n\twsp: Wsp;\n\n\t/** Tab non figé, qui suit l'item courant via l'infoBroker. */\n\tliveTab: GeneratorTab;\n\n\t/** Tab actuellement actif. */\n\tcurrentTab: GeneratorTab;\n\n\tgenTabs: HTMLElement;\n\tgens: Generators;\n\n\t/** Uri de destinatiob libre. Usage : styler */\n\tcustomDestPath?: wspUri;\n\n\tprotected pubNodeMatchFilter?: (pubNode: IItemPubNode) => boolean;\n\n\tprotected _initialize(init: OGeneratorsInit) {\n\t\tsuper._initialize(init); //init this.reg, this.area, this.areaContext\n\t\tthis.wsp = this.reg.env.wsp;\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\t//this.setAttribute(\"layout\", (init.area as IWbToolLocatedArea)?.layout || 'h');\n\t\tthis.pubNodeMatchFilter = init.pubNodeMatchFilter;\n\n\t\tthis.genTabs = sr.appendChild(<c-arrow-scroll-box id=\"tabs\"/>);\n\t\tthis.genTabs.onkeydown = function (this: HTMLElement, ev: KeyboardEvent) {\n\t\t\tswitch (ev.code) {\n\t\t\tcase 'ArrowLeft' : {\n\t\t\t\tconst genView = DOMSH.findHost<GeneratorTabs>(this);\n\t\t\t\tconst tab = genView.currentTab.tab.previousElementSibling as IGeneratorTabPointer; //TODO RTL\n\t\t\t\tif (tab) tab.genTab.tab.genTab.itemPtr.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'ArrowRight' : {\n\t\t\t\tconst genView = DOMSH.findHost<GeneratorTabs>(this);\n\t\t\t\tconst tab = genView.currentTab.tab.nextElementSibling as IGeneratorTabPointer;\n\t\t\t\tif (tab) tab.genTab.tab.genTab.itemPtr.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tev.stopPropagation();\n\t\t\tev.preventDefault();\n\t\t};\n\n\t\tthis.genTabs.ondragover = function (this: HTMLSpanElement, ev: DragEvent) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopImmediatePropagation();\n\t\t\tconst me = DOMSH.findHost<GeneratorTabs>(this);\n\t\t\tconst shortDescs = ITEM.getShortDescsTransferFromDragSession(me.reg, ev.dataTransfer, {targetSrcType: \"item\"}, this);\n\t\t\t//on autorise le drop si item local\n\t\t\tev.dataTransfer.dropEffect = !shortDescs || shortDescs.srcRefs.length < 1 || shortDescs.wspCd !== me.reg.env.wsp.code ? \"none\" : \"link\";\n\t\t};\n\t\tthis.genTabs.ondrop = function (this: HTMLSpanElement, ev: DragEvent) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopImmediatePropagation();\n\t\t\tconst me = DOMSH.findHost<GeneratorTabs>(this);\n\t\t\tconst shortDescs = ITEM.getShortDescsTransferFromDragSession(me.reg, ev.dataTransfer, {targetSrcType: \"item\"}, this);\n\t\t\tif (!shortDescs || shortDescs.isImport || shortDescs.srcRefs.length < 1 || shortDescs.wspCd !== me.reg.env.wsp.code) return;\n\t\t\tme.setCurrentTab(new GeneratorTab(me, false, {srcRef: shortDescs.srcRefs[0]}));\n\t\t};\n\n\t\tthis.gens = sr.appendChild(new Generators().initialize(init)) as Generators;\n\t\tthis.gens.onCodePubChange.add(function (gens: Generators) {\n\t\t\tconst me = DOMSH.findHost<GeneratorTabs>(gens);\n\t\t\tif (me.currentTab) me.currentTab.codePub = me.gens.codePub;\n\t\t});\n\n\t\tif (this.reg.env.infoBroker) this.reg.env.infoBroker.addConsumer(this);\n\t\tthis.reg.env.place.eventsMgr.on(\"onConnectionRenewed\", () => {this.refreshStates()}); //on ne gère pas le désabonnement, considérant que la view est stable avec la place courante.\n\t\tthis.liveTab = new GeneratorTab(this, true);\n\t\tthis.genTabs.appendChild(<Button id=\"addTab\" onclick={this.onAddTab} tabindex-custom=\"-1\" icon=\"/@skin@/wsp/views/generators/addtab.svg\" ui-context=\"bar\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t title=\"Ajoute un onglet pour un accès stable aux publications d'un item\"/>);\n\t\tif (init.lastDatas && init.lastDatas.tabs) {\n\t\t\tfor (let i = 0, s = init.lastDatas.tabs.length; i < s; i++) {\n\t\t\t\tconst t = new GeneratorTab(this, false, init.lastDatas.tabs[i]);\n\t\t\t\tif (init.lastDatas.currentTab === i) this.setCurrentTab(t);\n\t\t\t}\n\t\t}\n\t\tif (!this.currentTab) this.setCurrentTab(this.liveTab);\n\t}\n\n\tsetCurrentTab(genTab: GeneratorTab) {\n\t\tif (this.currentTab) this.currentTab.setAsCurrentTab(false);\n\t\tthis.currentTab = genTab;\n\t\tthis.currentTab.setAsCurrentTab(true);\n\t\tthis.gens.setSrc(genTab.itemPtr.shortDescs[0], genTab.codePub);\n\t}\n\n\tbuildLastDatas?(parentLastDatas: JLastDatas): void {\n\t\tconst lastDatasKey = this.getAttribute('last-datas');\n\t\tif (lastDatasKey) {\n\t\t\tlet tab = DOM.findFirstChild(this.genTabs, isGeneratorTabPointer);\n\t\t\tif (this.liveTab === tab.genTab) tab = DOM.findNextSibling(tab, isGeneratorTabPointer);\n\t\t\tif (tab) {\n\t\t\t\tconst ld = parentLastDatas[lastDatasKey] = {} as JLDGeneratorTabs;\n\t\t\t\tld.tabs = [];\n\t\t\t\tdo {\n\t\t\t\t\tconst srcRef = tab.genTab.itemPtr.srcRef;\n\t\t\t\t\tif (srcRef) {\n\t\t\t\t\t\tif (this.currentTab === tab.genTab) ld.currentTab = ld.tabs.length;\n\t\t\t\t\t\tld.tabs.push({\n\t\t\t\t\t\t\tsrcRef: srcRef,\n\t\t\t\t\t\t\tcodeGen: tab.genTab.codePub\n\t\t\t\t\t\t} as JLDGeneratorTab);\n\t\t\t\t\t}\n\t\t\t\t} while ((tab = DOM.findNextSibling(tab, isGeneratorTabPointer)));\n\t\t\t}\n\t\t}\n\t}\n\n\tasync refreshStates() {\n\t\tawait this.wsp.waitForAvailable(this);\n\t\tlet tab = DOM.findFirstChild(this.genTabs, isGeneratorTabPointer);\n\t\twhile (tab) {\n\t\t\ttab.genTab.itemPtr.fetchSrc();\n\t\t\ttab = DOM.findNextSibling(this.genTabs, isGeneratorTabPointer);\n\t\t}\n\t}\n\n\tasync onAddTab(this: Button, ev: MouseEvent) {\n\t\tconst me = DOMSH.findHost<GeneratorTabs>(this);\n\t\tconst genTab = new GeneratorTab(me, false, {srcRef: null});\n\t\tgenTab.genView.setCurrentTab(genTab);\n\t\tawait SrcPointerFastSelect.SINGLETON.execute(genTab.itemPtr, ev);\n\t\tif (!genTab.itemPtr.srcRef) genTab.closeTab();\n\t}\n\n\tonInfo(info: IInfo): void {\n\t\tif (this.hidden) return;\n\t\tif (info instanceof InfoCurrentItem) this.liveTab.itemPtr.setSrcRef(info.srcUri, info.shortDesc);\n\t}\n\n\tonViewShown() {\n\t\tthis.gens.onViewShown();\n\t\tthis.liveTab.refreshLiveTab();\n\t}\n\n\tvisitViews(visitor: (view: IViewApi) => any, options?: OViewVisitOptions): any {\n\t\treturn visitor(this.gens);\n\t}\n\n\tvisitViewsAsync(visitor: (view: IViewApi) => Promise<any>, options?: OViewVisitOptions): Promise<any> {\n\t\treturn visitor(this.gens);\n\t}\n}\n\nREG.reg.registerSkin(\"wsp-generator-tabs\", 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t}\n\n\t#tabs {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\talign-items: center;\n\t\tmargin-bottom: -1px;\n\t}\n\n\t#headTi {\n\t\tpadding: 0 .3em;\n\t\tfont-size: 80%;\n\t\twhite-space: nowrap;\n\t\tcolor: var(--fade-color);\n\t}\n\n\t.genTab {\n\t\tdisplay: flex;\n\t\tpadding: 2px 4px;\n\t\tborder-bottom: solid 2px transparent;\n\t}\n\n\t.genTab:first-of-type > wsp-src-pointer-inline.empty {\n\t\tdisplay: none;\n\t}\n\n\t.genTab:first-of-type > wsp-src-pointer-inline.empty + .dupTab {\n\t\tdisplay: none;\n\t}\n\n\t#addTab {\n\t\tborder-inline: 1px solid var(--border-color);\n\t\tmin-height: calc(6px + var(--icon-size))\n\t}\n\n\t.genTab.currentTab {\n\t\tborder-color: var(--tabl-select-color);\n\t}\n\n\t.genTab:hover {\n\t\tbackground: var(--pressed-bgcolor);\n\t}\n\n\twsp-generators {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tborder-top: 1px solid var(--border-color);\n\t}\n`);\n\ncustomElements.define(\"wsp-generator-tabs\", GeneratorTabs);\n\n\nclass GeneratorTab {\n\ttab: IGeneratorTabPointer;\n\titemPtr: SrcPointerInline;\n\tbtn: Button;\n\tcodePub: string;\n\tpinned: boolean;\n\n\tconstructor(public genView: GeneratorTabs, atFirst: boolean, lastDatas?: JLDGeneratorTab) {\n\t\tthis.tab = genView.genTabs.insertBefore(<span class=\"genTab\"/>, atFirst ? genView.genTabs.firstChild : null) as IGeneratorTabPointer;\n\t\tthis.tab.genTab = this;\n\t\tthis.itemPtr = this.tab.appendChild(new SrcPointerInline().initialize({\n\t\t\treg: genView.reg,\n\t\t\tdefaultAction: genView.reg.getSvc(\"ptrItemDblClick\", SrcPointerDblClick.SINGLETON),\n\t\t\tsgnPattern: genView.reg.env.wsp.wspMetaUi.getGenOrCidSgnPattern(),\n\t\t\tshowStatus: true,\n\t\t\tdraggable: true,\n\t\t\tdropable: true,\n\t\t\tdispatchHighlight: true\n\t\t}));\n\t\tthis.setPinState(lastDatas != null);\n\t\tthis.itemPtr.classList.add(\"fixedIconSize\");\n\t\tthis.itemPtr.tabIndex = -1;\n\t\tthis.itemPtr.addEventListener('focus', function (this: SrcPointerInline, ev: FocusEvent) {\n\t\t\tconst genTab = (this.parentElement as IGeneratorTabPointer).genTab;\n\t\t\tgenTab.genView.setCurrentTab(genTab);\n\t\t});\n\t\tthis.itemPtr.onSrcRefChange.add(function (drawer: SrcDrawer) {\n\t\t\tconst genTab = (drawer.parentElement as IGeneratorTabPointer).genTab;\n\t\t\tconst src = drawer.shortDescs[0];\n\t\t\tif (!src || src.srcSt < 0) {\n\t\t\t\tif (genTab.pinned) genTab.closeTab();\n\t\t\t\telse drawer.setSrcRef(null); //item supprimé, on efface le lien.\n\t\t\t}\n\t\t\tif (genTab.genView.currentTab === genTab) genTab.genView.gens.setSrc(src, genTab.codePub);\n\t\t});\n\t\tif (this.pinned) {\n\t\t\tthis.codePub = lastDatas.codeGen;\n\t\t\tthis.itemPtr.setSrcRef(lastDatas.srcRef);\n\t\t\tthis.btn = this.tab.appendChild(this._newCloseButton(\"-1\"));\n\t\t} else {\n\t\t\tthis.btn = this.tab.appendChild(<Button class=\"dupTab\" onclick={this.onPin} tabindex-custom=\"-1\" icon=\"/@skin@/wsp/views/generators/duptab.svg\" ui-context=\"bar\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Duplique cet onglet pour un accès stable aux publications de l'item\"/>) as Button;\n\t\t\tthis.refreshLiveTab();\n\t\t}\n\t}\n\n\tsetAsCurrentTab(current: boolean) {\n\t\tthis.tab.classList.toggle('currentTab', current);\n\t\tthis.itemPtr.tabIndex = current ? 0 : -1;\n\t\tthis.btn.tabIndexCustom = current ? 0 : -1;\n\t}\n\n\trefreshLiveTab() {\n\t\t//on affecte l'item courant\n\t\tconst req = new InfoReqCurrentItem();\n\t\tthis.genView.reg.env.infoBroker.dispatchInfo(req, this);\n\t\tif (req.srcUri) this.itemPtr.setSrcRef(req.srcUri, req.shortDesc);\n\t\telse this.itemPtr.setSrcRef(null);\n\t}\n\n\tcloseTab() {\n\t\tif (!this.pinned) return;\n\t\tif (this.genView.currentTab === this) this.genView.setCurrentTab((DOM.findNextSibling(this.tab, isGeneratorTabPointer) || DOM.findPreviousSibling(this.tab, isGeneratorTabPointer))?.genTab);\n\t\tthis.tab.remove();\n\t}\n\n\tprotected _newCloseButton(tabIndex: string): Button {\n\t\treturn <Button onclick={this.onClose} tabindex-custom={tabIndex} icon=\"/@skin@/commons/icons/close.svg\" ui-context=\"bar\" title=\"Ferme la vue des publications de cet item\"/> as Button;\n\t}\n\n\tprotected onClose(this: Button) {\n\t\t(this.parentElement as IGeneratorTabPointer).genTab.closeTab();\n\t}\n\n\tprotected onPin(this: Button, ev: MouseEvent) {\n\t\tconst spanTab = this.parentElement as IGeneratorTabPointer;\n\t\tconst genTab = spanTab.genTab;\n\t\tgenTab.genView.liveTab = new GeneratorTab(genTab.genView, true);\n\t\tgenTab.setPinState(true);\n\t\t//Remplace le bouton Pin par le bouton Close\n\t\tthis.parentNode.insertBefore(genTab._newCloseButton(this.tabIndexCustom.toString()), this);\n\t\tthis.remove();\n\t\t//on se replace après le bouton addTab\n\t\tspanTab.parentNode.insertBefore(spanTab, DOM.findNextSibling(spanTab, isGeneratorTabPointer));\n\t\tgenTab.genView.setCurrentTab(genTab);\n\t\t//if (genTab.itemPtr.srcRef == null) SrcPointerFastSelect.SINGLETON.execute(genTab.itemPtr, ev);\n\t}\n\n\tprotected setPinState(pinned: boolean) {\n\t\tif (pinned) {\n\t\t\tthis.pinned = true;\n\t\t\tthis.itemPtr.readOnly = false;\n\t\t\tthis.itemPtr.title = \"\";\n\t\t} else {\n\t\t\tthis.pinned = false;\n\t\t\tthis.itemPtr.readOnly = true;\n\t\t\tthis.itemPtr.title = \"Publications de l'item actif\";\n\t\t}\n\t}\n}\n\ninterface IGeneratorTabPointer extends HTMLElement {\n\tgenTab: GeneratorTab\n}\n\nfunction isGeneratorTabPointer(n: any): n is IGeneratorTabPointer {return n?.genTab instanceof GeneratorTab}\n\ninterface JLDGeneratorTabs {\n\ttabs: JLDGeneratorTab[]\n\tcurrentTab: number\n}\n\n/** */\ninterface JLDGeneratorTab {\n\tsrcRef: srcRef\n\tcodeGen?: string\n}\n\n\nexport interface Generators extends BaseAreaView<IRegPointer<IWspUiEnv>> {\n\tinitialize(init?: OGeneratorsInit): this\n}\n\nexport interface OGeneratorsInit extends OBaseAreaViewInit<IRegPointer<IWspUiEnv>> {\n\n\t/** Retourne true si le pubNode est conservé */\n\tpubNodeMatchFilter?: (pubNode: IItemPubNode) => boolean\n\n\t/** Uri de destination libre. Usage : styler */\n\tcustomDestPath?: wspUri\n}\n\nexport class Generators extends BaseAreaView<IRegPointer<IWspUiEnv>> implements ICidUiHandler {\n\treg: IReg<IWspUiEnv>;\n\twsp: Wsp;\n\n\tonCodePubChange = new EventMgr<(gen: Generators) => void>();\n\n\tcodePub: string;\n\n\tpubTree: GridSmall;\n\tpubActions: BarActions<IPubCtx>;\n\n\tgenRoot: HTMLElement;\n\tgenRefreshBtn: Button;\n\tgenIllus: HTMLImageElement;\n\tgenInfos: HTMLElement;\n\tgenSkins: HTMLFormElement;\n\tgenProps: HTMLFormElement;\n\n\tcidRoot: HTMLElement;\n\tcidManifestHead: HTMLElement;\n\tcidDetails: HTMLElement; //select manifest, select process, userWait\n\n\tdatas: GridDataHolderJsonTree<IItemPubNode> = new GridDataHolderJsonTree<IItemPubNode>('ch').setDefaultOpenState(defaultOpenStates);\n\n\tprotected pubNodeMatchFilter?: (pubNode: IItemPubNode) => boolean;\n\n\t/** Uri de destination libre. Usage : styler */\n\tcustomDestPath?: wspUri;\n\n\tget shortDesc(): JSrcFields {return this.pubActions.actionContext.shortDesc}\n\n\tprotected _initialize(init: OGeneratorsInit) {\n\t\tsuper._initialize(init); //init this.reg, this.area, this.areaContext\n\t\tthis.wsp = this.reg.env.wsp;\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis.reg.installSkin(\"scroll/small\", sr);\n\t\tthis.reg.installSkin(\"form-control-areas\", sr);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tconst layoutV = (init.area as IWbToolLocatedArea)?.layout === 'v';\n\t\tthis.reg.installSkin(layoutV ? \"wsp-generators/v\" : \"wsp-generators/h\", sr);\n\n\t\tthis.pubNodeMatchFilter = init.pubNodeMatchFilter;\n\t\tthis.customDestPath = init.customDestPath;\n\n\t\tthis.pubTree = sr.appendChild(<GridSmall id=\"tree\" î={{\n\t\t\treg: this.reg,\n\t\t\tcolumnDefs: [new GridColTreeDef('genTree')\n\t\t\t\t.setFlex('1rem', 1, 1).setMinWidth('55px').setChildrenIndent(1.5)\n\t\t\t\t.setCellBuilder(new CellBuilderGen())],\n\t\t\thideHeaders: true,\n\t\t\tautoSelOnFocus: 'first',\n\t\t\tskinScroll: 'scroll/small',\n\t\t\temptyBody: <div style=\"font-style:italic;\">Aucune fonction de publication disponible</div>\n\t\t} as OGridSmallInit} c-resizable=\"\"/>) as GridSmall;\n\t\tthis.pubTree.dataHolder = this.datas;\n\t\tthis.pubTree.addEventListener(\"grid-select\", this.onGridSelect);\n\t\tsr.appendChild(<c-resizer c-orient={layoutV ? 'column' : 'row'}/>);\n\t\tconst body = sr.appendChild(<section id=\"body\" c-resizable=\"\"/>);\n\n\t\t//GEN\n\t\tthis.genRoot = body.appendChild(<div id=\"genRoot\" hidden=\"true\"/>);\n\t\tconst genTop = this.genRoot.appendChild(<div id=\"genTop\"/>);\n\t\tconst genTopMain = genTop.appendChild(<div id=\"genTopMain\"/>);\n\t\tthis.genRefreshBtn = genTop.appendChild(<Button id=\"refresh\" î={{\n\t\t\ticon: \"/@skin@/commons/icons/refresh.svg\",\n\t\t\tuiContext: 'bar',\n\t\t} as OButtonInit} onclick={this.refreshGenRootUi} title=\"Rafraichir\"/>) as Button;\n\t\tthis.genIllus = genTopMain.appendChild(<div id=\"illusCtn\"><img id=\"illus\"/></div>).firstChild as HTMLImageElement;\n\t\tconst topInfos = genTopMain.appendChild(<div id=\"topInfos\"/>);\n\t\tthis.genInfos = topInfos.appendChild(<div id=\"infos\"/>);\n\t\tthis.genSkins = topInfos.appendChild(<form id=\"skins\"/>) as HTMLFormElement;\n\t\tthis.genSkins.addEventListener(\"change\", this.onSkinChange);\n\t\tthis.genProps = this.genRoot.appendChild(<form id=\"props\"/>) as HTMLFormElement;\n\n\t\t//CID\n\t\tthis.cidRoot = body.appendChild(<div id=\"cidRoot\" hidden=\"true\"/>);\n\t\tthis.cidManifestHead = this.cidRoot.appendChild(<div id=\"cidManifest\"/>);\n\t\tthis.cidDetails = this.cidRoot.appendChild(<div id=\"cidDetails\"/>);\n\n\t\tthis.pubActions = body.appendChild(<c-bar-actions î={{\n\t\t\treg: this.reg,\n\t\t\tactionContext: {\n\t\t\t\treg: null, // this.reg non dynamique, propre à chaque itemType\n\t\t\t\tuiContext: this,\n\t\t\t\twsp: this.wsp,\n\t\t\t\tshortDesc: null,\n\t\t\t\tpubNode: null,\n\t\t\t\tgenInfo: null,\n\t\t\t\tasync genProps(): Promise<Jsonisable> {\n\t\t\t\t\tif ((this.uiContext as Generators).genRoot.hidden) return null;\n\t\t\t\t\tconst skins = (this.uiContext as Generators).genSkins;\n\t\t\t\t\tconst rootProps = (this.uiContext as Generators).genProps;\n\t\t\t\t\tif (skins.hidden && rootProps.hidden) return null;\n\t\t\t\t\tif (!rootProps.reportValidity()) return false;\n\t\t\t\t\tconst props = {};\n\t\t\t\t\tif (!skins.hidden) FORMS.formToJson(skins, props);\n\t\t\t\t\tif (!rootProps.hidden) FORMS.formToJson(rootProps, props);\n\t\t\t\t\treturn props;\n\t\t\t\t},\n\t\t\t\tcustomDestPath: this.customDestPath,\n\t\t\t} as IPubCtx,\n\t\t\tuiContext: \"dialog\",\n\t\t\tdisableFullOverlay: true\n\t\t} as OBarActionsInit<IPubCtx>} id=\"actions\" hidden=\"true\"/>) as BarActions<IPubCtx>;\n\n\t}\n\n\tsetSrc(shortDesc: JSrcFields, codeGenToSelect?: string) {\n\t\tconst ctx = this.pubActions.actionContext;\n\t\tif (ctx.shortDesc === shortDesc) return; //évite refreshs successifs à l'init (set currentTab, set ptrItem, msg init mainView).\n\t\tctx.shortDesc = shortDesc;\n\t\tif (!shortDesc || shortDesc.srcSt < 0) {\n\t\t\tthis.datas.setDatas([]);\n\t\t} else {\n\t\t\tconst itemType = this.wsp.wspMetaUi.getItemType(shortDesc.itModel);\n\t\t\tconst itemReg = ctx.reg = REG.createSubReg(this.reg, itemType);\n\t\t\titemReg.env.securityCtx = SEC.createSub(this.reg.env.securityCtx, shortDesc.srcRoles, shortDesc.srcRi);\n\t\t\tconst tree = itemType.buildPubTree(itemReg.env.securityCtx, this.pubNodeMatchFilter);\n\t\t\tthis.datas.setDatas(tree);\n\t\t\tif (codeGenToSelect) {\n\t\t\t\tconst newGen = itemType.getPub(codeGenToSelect, tree);\n\t\t\t\tif (newGen) {\n\t\t\t\t\tthis.datas.openFolder(newGen); //Fore l'ouverture de la hiérerachie\n\t\t\t\t\tconst offset = this.datas.getOffset(newGen);\n\t\t\t\t\tif (offset >= 0) this.pubTree.setSelectedRows(offset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst pub = tree[0];\n\t\t\t\tif (pub && (pub.genNodeType === \"gen\" || pub.genNodeType === \"cid\")) {\n\t\t\t\t\t//Si 1ère ligne n'est pas un dossier mais un gen, on le sélectionne par défaut\n\t\t\t\t\tthis.pubTree.setSelectedRows(0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onGridSelect(this: GridSmall, ev: CustomEvent) {\n\t\tconst generators = DOMSH.findHost<Generators>(this);\n\t\tconst newPubNode = generators.datas.getDataByOffset(this.getSelectedRow());\n\t\tif (newPubNode) {\n\t\t\tgenerators.codePub = newPubNode.codeGenStack;\n\t\t\tgenerators.onCodePubChange.emit(generators);\n\t\t}\n\t\tif (newPubNode !== generators.pubActions.actionContext.pubNode) generators.setPubNode(newPubNode);\n\t}\n\n\tprotected onSkinChange(this: HTMLFormElement, ev: CustomEvent) {\n\t\t//console.log(\"onSkinChange::::\", ev);\n\t\tconst generators = DOMSH.findHost<Generators>(this);\n\t\tgenerators.setGenIllus((ev.target as HTMLInputElement).value);\n\t}\n\n\tprotected async setPubNode(pubNode: IItemPubNode | null) {\n\t\tif (pubNode) {\n\t\t\tif (pubNode.genNodeType === 'cid') {\n\t\t\t\tDOM.setHidden(this.cidRoot, false);\n\t\t\t\tDOM.setHidden(this.genRoot, true);\n\t\t\t\treturn this.initViewCid(pubNode);\n\t\t\t} else if (pubNode.genNodeType !== 'dir') {\n\t\t\t\tDOM.setHidden(this.genRoot, false);\n\t\t\t\tDOM.setHidden(this.cidRoot, true);\n\t\t\t\treturn this.initViewGen(pubNode);\n\t\t\t}\n\t\t}\n\t\t//Rien à afficher...\n\t\tthis.initViewEmpty();\n\t}\n\n\tprotected initViewEmpty() {\n\t\tthis.pubActions.actionContext.pubNode = null;\n\t\tthis.pubActions.actionContext.genInfo = null;\n\t\tthis.pubActions.actionContext.cidInfo = null;\n\t\tDOM.setHidden(this.genRoot, true);\n\t\tDOM.setHidden(this.cidRoot, true);\n\t\tDOM.setHidden(this.pubActions, true);\n\t}\n\n\tprotected refreshGenRootUi(this: Button) {\n\t\tconst generators = DOMSH.findHost<Generators>(this);\n\t\tgenerators.initViewGen(generators.pubActions.actionContext.pubNode);\n\t}\n\n\tprotected async initViewGen(genNode: IItemPubNode) {\n\t\ttry {\n\t\t\tconst ctx = this.pubActions.actionContext;\n\t\t\tconst idx = genNode.codeGenStack.lastIndexOf('_');\n\t\t\tconst cdGen = idx < 0 ? genNode.codeGenStack : genNode.codeGenStack.substring(idx + 1);\n\t\t\tctx.pubNode = genNode;\n\t\t\tconst genInfoSvc: (wsp: Wsp, uiContext: HTMLElement, srcRef: srcRef, codeGenStack: string, addExtraInfos?: boolean, customFullUriDest?: string) => Promise<JGenInfo> = ctx.reg.getSvc(\"gen.action.genInfo\") || ITEM.fetchGenInfo;\n\t\t\tconst genInfo: JGenInfo = await genInfoSvc.call(this, this.wsp, this, SRC.srcRef(ctx.shortDesc), genNode.codeGenStack, genNode.needExtraProps, this.customDestPath);\n\t\t\tif (ctx.pubNode !== genNode) return; //race cond\n\t\t\tDOM.setHidden(this.genRoot, false);\n\t\t\tDOM.setHidden(this.genRefreshBtn, !genNode.showRefreshBtn || genInfo.status === \"working\");\n\t\t\tctx.genInfo = genInfo;\n\t\t\tctx.cidInfo = null;\n\t\t\tif (genInfo.skins && genInfo.skins.length > 1) {\n\t\t\t\t// Tri des skins par ordre alphabétique\n\t\t\t\tgenInfo.skins.sort((skinA, skinB) => skinA.title.localeCompare(skinB.title, \"en\", {sensitivity: \"base\"}));\n\t\t\t\tDOM.setHidden(this.genSkins, false);\n\t\t\t\t//Skins\n\t\t\t\trender(this.skinsTpl(ctx), this.genSkins);\n\t\t\t\tthis.genSkins[\"skin\"].value = genInfo.skin || 'default'; //affectation du skin courant\n\t\t\t} else {\n\t\t\t\tDOM.setHidden(this.genSkins, true);\n\t\t\t}\n\t\t\t//Illus\n\t\t\tthis.setGenIllus(genInfo.skin);\n\t\t\t//Infos\n\t\t\trender(await (genNode.infos || this.infosTpl)(ctx), this.genInfos);\n\t\t\t//Props\n\t\t\tconst propsLists: string[] = [];\n\t\t\tpropsLists.push(`params:gen:${cdGen}`);\n\t\t\tif (genNode.codeGenStack != cdGen) propsLists.push(`params:gen:${genNode.codeGenStack}`);\n\t\t\tpropsLists.push(`params:genNature:${genNode.genNature}`);\n\t\t\tpropsLists.push(\"params:gen\");\n\t\t\tconst propsListsAreas = ctx.reg.mergeLists<IArea<IPubCtx & IControlAreaContext> | Promise<IArea<IPubCtx & IControlAreaContext>>>(...propsLists);\n\t\t\tif (genNode.props || propsListsAreas) {\n\t\t\t\tDOM.setHidden(this.genProps, false);\n\n\t\t\t\tlet tpl = genNode.props ? await genNode.props(ctx) : xhtml`<fieldset>\n\t\t\t\t\t<div class=\"fields\" area-ids=\"*\"/>\n\t\t\t\t</fieldset>`;\n\n\t\t\t\t// Réinitialisation nécessaire des components dont la structure HTML est constante,\n\t\t\t\t// tout en exploitant le contexte à l'initialisation (reg, ...) : lit ne sait pas gérer ces cas\n\t\t\t\t// exemple : évolution du contexte de 'DynGenParam' faux sans ça lorsqu'on change d'item\n\t\t\t\tif (this.genProps.hasChildNodes()) render(null, this.genProps);\n\t\t\t\trender(tpl, this.genProps, {});\n\n\t\t\t\tlet areaCtx: IPubCtx & IControlAreaContext = Object.create(ctx);\n\t\t\t\tareaCtx.buildControlLabel = true;\n\t\t\t\tif (propsListsAreas) await AREAS.applyLayout(this.genProps, await Promise.all(propsListsAreas), areaCtx, true);\n\n\t\t\t\tFORMS.jsonToForm(ctx.genInfo.storedProps || {}, this.genProps, false, false);//forceClear=false pour préserver les valeurs par défaut\n\t\t\t\tDOM.setAttrBool(this.genProps, \"disabled\", genInfo.status === \"working\");\n\t\t\t} else {\n\t\t\t\tDOM.setHidden(this.genProps, true);\n\t\t\t}\n\t\t\t//Actions\n\t\t\tif (genInfo.status === 'working') {\n\t\t\t\tDOM.setHidden(this.pubActions, true);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (ctx.pubNode === genNode) this.initViewGen(genNode);\n\t\t\t\t}, 10000); //sécurise un refresh toutes les 10s en plus de websocket\n\t\t\t} else {\n\t\t\t\tDOM.setHidden(this.pubActions, false);\n\t\t\t\tconst actionsLists: string[] = [];\n\t\t\t\tactionsLists.push(`actions:gen:${cdGen}`);\n\t\t\t\tif (genNode.codeGenStack != cdGen) actionsLists.push(`actions:gen:${genNode.codeGenStack}`);\n\t\t\t\tactionsLists.push(`actions:genNature:${genNode.genNature}`);\n\t\t\t\tactionsLists.push(\"actions:gen\");\n\t\t\t\tif (genNode.actionListsCode) actionsLists.push(...genNode.actionListsCode);\n\t\t\t\tthis.pubActions.actions = await Promise.all(ctx.reg.mergeLists(...actionsLists)) as IAction<IPubCtx>[];\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tthis.initViewEmpty();\n\t\t}\n\t}\n\n\tprotected async initViewCid(cidNode: IItemPubNode) {\n\t\ttry {\n\t\t\tconst ctx = this.pubActions.actionContext;\n\t\t\tctx.pubNode = cidNode;\n\t\t\tconst allHosts = await CID.getCidHostsForOutput(this.reg);\n\t\t\tctx.genInfo = null;\n\t\t\tctx.cidInfo = {\n\t\t\t\tcidHosts: cidNode.cidHostIs === null ? [] : (cidNode.cidHostIs ? Array.from(CID.filterIsOr(allHosts, cidNode.cidHostIs)) : allHosts)\n\t\t\t};\n\t\t\t//TODO fetch le lastCidEndPoint pour ce src et ce cidNode.codeGenStack\n\t\t\t// pour afficher ces infos, dans la meme logique que\n\t\t\t// \t\trender(await (genNode.infos || this.infosTpl)(ctx), this.genInfos);\n\n\t\t\tif (ctx.pubNode !== cidNode) return; //race cond\n\t\t\tDOM.setHidden(this.cidRoot, false);\n\t\t\t//Fixation des données connues\n\t\t\tif (cidNode.cidManifestUrlInput || ctx.cidInfo.cidHosts.length !== 1) {\n\t\t\t\t//Interface de sélection du serveur\n\t\t\t\tthis.cidSeletHost();\n\t\t\t} else {\n\t\t\t\t// 1 seul serveur connu\n\t\t\t\tctx.cidInfo.lastManifest = await ctx.cidInfo.cidHosts[0].fetchManifest();\n\t\t\t\tif (ctx.pubNode !== cidNode) return; //race cond\n\t\t\t\tthis.cidOnManifestKnown();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tthis.initViewEmpty();\n\t\t}\n\t}\n\n\t/** Affiche l'interface de sélection d'un server Cid. */\n\tprotected cidSeletHost() {\n\t\tconst ctx = this.pubActions.actionContext;\n\t\tDOM.setHidden(this.pubActions, true);\n\t\tthis.pubActions.actions = null;\n\t\tthis.cidDetails.textContent = null;\n\t\tif (ctx.cidInfo.cidHosts.length > 0) {\n\t\t\tthis.cidManifestHead.textContent = \"Sélection du serveur cible\";\n\t\t\tconst group = this.cidDetails.appendChild(<ul/>);\n\t\t\tfor (let i = 0, s = ctx.cidInfo.cidHosts.length; i < s; i++) {\n\t\t\t\tconst host = ctx.cidInfo.cidHosts[i];\n\t\t\t\tgroup.appendChild(<li><a onclick={this.onCidSelectHost} href={i}>{host.label}</a></li>);\n\t\t\t}\n\t\t\tif (ctx.pubNode.cidManifestUrlInput) this.buildInputManifest(group.appendChild(<li/>), \"Autre\");\n\t\t} else {\n\t\t\tthis.cidManifestHead.textContent = \"Définition du serveur cible\";\n\t\t\tthis.buildInputManifest(this.cidDetails.appendChild(<div id=\"manifestAlone\"/>), \"URL du serveur\");\n\t\t}\n\t}\n\n\tbuildInputManifest(parent: HTMLElement, label: string) {\n\t\tparent.appendChild(<div class=\"manifestLabel\">{label}</div>);\n\t\tparent.appendChild(<div id=\"manifestEdit\">\n\t\t\t<input id=\"manifestInput\" type=\"url\" oninput={this.onManifestInput} onchange={function (this: HTMLInputElement) {DOMSH.findHost<Generators>(this).onManifestChange(this)}}/>\n\t\t\t<c-button id=\"manifestValid\" î={{reg: this.reg, label: \"Valider\", disabled: true}} onclick={function (this: HTMLInputElement & ICidManifestPointer) {DOMSH.findHost<Generators>(this).cidUseManifest(this.cidManifest)}}/>\n\t\t</div>);\n\t\tparent.appendChild(<c-msg id=\"manifestInputResult\" î={{noShadow: true}}/>);\n\t}\n\n\tasync onManifestChange(input: HTMLInputElement) {\n\t\tconst msg = this.shadowRoot.getElementById(\"manifestInputResult\") as MsgLabel;\n\t\tconst btn = this.shadowRoot.getElementById(\"manifestValid\") as Button & ICidManifestPointer;\n\t\tbtn.cidManifest = null;\n\t\tif (!input.validity.valid) {\n\t\t\tmsg.setCustomMsg(\"Saisissez une URL valide permettant d'obtenir les caractéristiques du serveur (manifeste CID)\", \"info\");\n\t\t\tbtn.cidManifest = null;\n\t\t\tbtn.disabled = true;\n\t\t} else {\n\t\t\tconst ctx = this.pubActions.actionContext;\n\t\t\tconst pubNode = ctx.pubNode;\n\t\t\ttry {\n\t\t\t\tbtn.cidManifest = await CID.getCidManifest(input.value);\n\t\t\t\tif (pubNode !== ctx.pubNode) return; //race cond\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\tif (btn.cidManifest) {\n\t\t\t\tmsg.setCustomMsg(\"Serveur reconnu : \" + CID.getCidManifestLabel(this.pubActions.actionContext.cidInfo.cidHosts, btn.cidManifest), \"info\");\n\t\t\t\tbtn.disabled = false;\n\t\t\t} else {\n\t\t\t\tmsg.setCustomMsg(\"Aucun serveur reconnu à cette URL (manifeste CID non trouvé), ou politique de sécurité du serveur incompatible\", \"error\");\n\t\t\t\tbtn.disabled = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tonManifestInput(this: HTMLInputElement, ev: Event) {\n\t\tconst me = DOMSH.findHost<Generators>(this);\n\t\tif (me._cidMnInputWaiter) clearTimeout(me._cidMnInputWaiter);\n\t\tme._cidMnInputWaiter = setTimeout(() => me.onManifestChange(this), 800) as any;\n\t}\n\n\tprotected _cidMnInputWaiter: number;\n\n\tcidUseManifest(manifest: CidManifest) {\n\t\tif (!manifest) return;\n\t\tconst ctx = this.pubActions.actionContext;\n\t\tctx.cidInfo.lastManifest = manifest;\n\t\tthis.cidOnManifestKnown();\n\t}\n\n\t/** */\n\tprotected async onCidSelectHost(this: HTMLAnchorElement, ev: MouseEvent) {\n\t\tev.preventDefault();\n\t\tconst me = DOMSH.findHost<Generators>(this);\n\t\tconst ctx = me.pubActions.actionContext;\n\t\tconst cidNode = ctx.pubNode;\n\t\tctx.cidInfo.lastManifest = await ctx.cidInfo.cidHosts[parseInt(this.getAttribute('href'))].fetchManifest();\n\t\tif (ctx.pubNode !== cidNode) return; //race cond\n\t\tme.cidOnManifestKnown();\n\t}\n\n\t/** ctx.cidInfo.lastManifest renseigné */\n\tprotected async cidOnManifestKnown() {\n\t\tconst ctx = this.pubActions.actionContext;\n\t\tconst cidNode: IDatasItemCidNode = ctx.pubNode;\n\t\tconst manifest = ctx.cidInfo.lastManifest;\n\t\tif (!manifest) return this.cidSeletHost();\n\t\tthis.cidManifestHead.textContent = \"Serveur : \" + CID.getCidManifestLabel(this.pubActions.actionContext.cidInfo.cidHosts, manifest);\n\t\tif (ctx.pubNode.cidManifestUrlInput || ctx.cidInfo.cidHosts.length !== 1) {\n\t\t\t//Possibilité de changer\n\t\t\tthis.cidManifestHead.appendChild(<c-button class=\"changeBtn\" icon=\"/@skin@/wsp/views/generators/change.svg\" title=\"Changer de serveur\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t onclick={function (this: Button, ev: MouseEvent) {return DOMSH.findHost<Generators>(this).cidSeletHost()}}/>);\n\t\t}\n\t\tif (cidNode.cidProcessSelector) {\n\t\t\tctx.cidInfo.cidProcesses = await cidNode.cidProcessSelector(ctx);\n\t\t\tif (cidNode !== ctx.pubNode) return; //race cond\n\t\t} else if (cidNode.cidProcessIs) {\n\t\t\tctx.cidInfo.cidProcesses = manifest.getProcesses(...cidNode.cidProcessIs);\n\t\t}\n\t\tDOM.setHidden(this.pubActions, false);\n\t\tthis.pubActions.actions = await Promise.all(ctx.reg.mergeLists(...(cidNode.actionListsCode || []), `actions:cid:${ctx.pubNode.codeGenStack}`, ctx.pubNode.codeGenStack.indexOf('_') > 0 ? \"actions:cidGen\" : \"actions:cidScar\")) as IAction<IPubCtx>[];\n\t\tthis.cidRefreshOnSessionChange();\n\t}\n\n\tcidRefreshOnSessionChange() {\n\t\tconst ctx = this.pubActions.actionContext;\n\t\tif (!ctx.cidInfo) return;\n\t\tthis.pubActions.refreshContent();\n\t\tif (ctx.cidInfo.cidSession) {\n\t\t\t//console.log(\"cidRefreshOnSessionChange::::\", ctx.cidInfo.cidSession);\n\t\t\tswitch (ctx.cidInfo.cidSession.state) {\n\t\t\tcase ECidSessionState.authenticating:\n\t\t\t\tthis.cidDetails.textContent = null;\n\t\t\t\tthis.cidDetails.appendChild(<div class=\"cidUploading\"><span>Authentification en cours...</span></div>);\n\t\t\t\treturn;\n\t\t\tcase ECidSessionState.inStep:\n\t\t\tcase ECidSessionState.uiProcessSel: //en principe impossible\n\t\t\tcase ECidSessionState.notStarted: //en principe impossible\n\t\t\t\tthis.cidDetails.textContent = null;\n\t\t\t\tthis.cidDetails.appendChild(<div class=\"cidUploading\"><span>Déploiement en cours...</span></div>);\n\t\t\t\treturn;\n\t\t\tcase ECidSessionState.uiAuth:\n\t\t\t\t// uiWait en cours\n\t\t\t\treturn;\n\t\t\tcase ECidSessionState.failed:\n\t\t\tcase ECidSessionState.ended:\n\t\t\tcase ECidSessionState.aborted:\n\t\t\t\t//on réaffiche l'état de la dernière diffusion réussie.\n\t\t\t}\n\t\t}\n\t\tthis.cidDetails.textContent = null;\n\t\t//TODO info de la mémoire dernière diffusion\n\t}\n\n\n\tprotected setGenIllus(skinCode: string) {\n\t\tconst genInfo = this.pubActions.actionContext.genInfo;\n\t\tconst genNode = this.pubActions.actionContext.pubNode;\n\t\tconst skin = skinCode && genInfo && genInfo.skins ? genInfo.skins.find((s) => s.code === skinCode) : null;\n\t\tconst src = skin && skin.hasIllus ? ITEM.getGenSkinIllusUrl(this.wsp, genNode, skin) : genNode.illusUrl;\n\t\tif (src !== this.prevIllusSrc) this.genIllus.src = this.prevIllusSrc = src;\n\t}\n\n\tprotected prevIllusSrc: string;\n\n\tonViewHidden(closed?: boolean): void {\n\t\tif (closed) {\n\t\t\tthis.reg.env.place.eventsMgr.removeListener(\"onConnectionRenewed\", this._onConnectionRenewed);\n\t\t\tthis.reg.env.universe.wsFrames.ws.msgListeners.removeListener(\"wspGen\", this._onMsgWspGen);\n\t\t\tthis._onMsgWspGen = null;\n\t\t\tthis._onConnectionRenewed = null;\n\t\t}\n\t}\n\n\tonViewShown() {\n\t\tif (!this._onMsgWspGen) {\n\t\t\t//console.log(\"Generators: Init Ws listening..............\");\n\t\t\tthis._onMsgWspGen = (m: JWspGenMsg) => {\n\t\t\t\tconst ctx = this.pubActions.actionContext;\n\t\t\t\tif (!ctx.pubNode || ctx.shortDesc.srcUri !== m.srcUri || m.wsp !== ctx.wsp.code || m.customDestPath !== this.customDestPath) return;\n\t\t\t\tthis.setPubNode(ctx.pubNode);\n\t\t\t};\n\t\t\tthis._onConnectionRenewed = () => {\n\t\t\t\tconst ctx = this.pubActions.actionContext;\n\t\t\t\tif (ctx.pubNode) this.setPubNode(ctx.pubNode);\n\t\t\t}\n\t\t\tthis.reg.env.place.eventsMgr.on(\"onConnectionRenewed\", this._onConnectionRenewed);\n\t\t\tthis.reg.env.universe.wsFrames.ws.msgListeners.on(\"wspGen\", this._onMsgWspGen);\n\t\t}\n\t}\n\n\tprotected _onConnectionRenewed: (states: JWspWorkingInitStates) => void;\n\n\tprotected _onMsgWspGen: (m: JWspGenMsg) => void;\n\n\tinfosTpl(ctx: IPubCtx): TemplateResult {\n\t\tlet dt: string;\n\t\tconst deploy = ctx.pubNode.genNature === 'deploy';\n\t\tif (ctx.genInfo.status === 'working') {\n\t\t\tdt = deploy ? \"Transfert en cours...\" : \"Génération en cours...\";\n\t\t} else if (ctx.genInfo.lastGen) {\n\t\t\tconst lastGenDate = DTFormatter.format(ctx.genInfo.lastGen);\n\t\t\tif (ctx.genInfo.status === 'failed') dt = deploy ? `Transfert en erreur le ${lastGenDate}` : `Généré en erreur le ${lastGenDate}`;\n\t\t\telse if (ctx.genInfo.status === 'warning') dt = deploy ? `Transféré avec anomalies le ${lastGenDate}` : `Généré avec anomalies le ${lastGenDate}`;\n\t\t\telse dt = deploy ? `Transféré le ${lastGenDate}` : `Généré le ${lastGenDate}`;\n\t\t} else if (ctx.genInfo.status === \"failed\") {\n\t\t\tdt = deploy ? \"Dernier transfert en erreur\" : \"Dernière génération en erreur\";\n\t\t} else {\n\t\t\tdt = deploy ? \"Non transféré\" : \"Non généré\";\n\t\t}\n\t\treturn xhtml`<div class=\"genTi ${ctx.genInfo.status}\">${ctx.pubNode.genTitle || ctx.genInfo.title}</div>\n<div class=\"reason ${ctx.genInfo.reason ? '' : 'hidden'}\">Un fichier de la génération est verrouillé. FERMEZ les applications tierces et recommencez.</div>\n<div class=\"dt ${ctx.genInfo.status}\">${dt}</div>`;\n\t}\n\n\tskinsTpl(ctx: IPubCtx): TemplateResult {\n\t\treturn xhtml`${ctx.genInfo.skins.map((skin: JGenSkin) => {\n\t\t\treturn xhtml`<span class=\"skin\"><input type=\"radio\" name=\"skin\" value=\"${skin.code}\" id=\"sk_${skin.code}\"/><label for=\"sk_${skin.code}\">${skin.title}</label></span>`\n\t\t})}`\n\t}\n\n\t//*** ICidUiHandler ***\n\n\tasync webAuth(session: CidSession, step: CidWebAuthStep): Promise<ICidStepResult> {\n\t\tconst frame = <iframe style=\"flex:1; border: none;\"/> as HTMLIFrameElement;\n\t\tif (UiThemeDeskFeat.isIn(desk)) (frame as any).injectTheme = UiThemeDeskFeat.injectTheme;\n\t\tconst dialog = POPUP.showDialog<'ok' | null>(frame, this, {titleBar: \"Authentification\", initHeight: \"min(60vh,40em)\", initWidth: \"60vw\"});\n\t\tdialog.onNextClose().then((r) => {if (!r) session.onCidFrameMessage({cidAuth: \"failed\"})});\n\t\tconst res = await step.initFrame(frame, session);\n\t\tdialog.close('ok');\n\t\treturn res;\n\t}\n\n\tasync uiWait(session: CidSession, step: CidStep): Promise<ICidStepResult | null> {\n\t\tthis.cidDetails.textContent = null;\n\t\tconst iframe = this.cidDetails.appendChild(<iframe class=\"cidWaiting\"/>) as HTMLIFrameElement;\n\t\tif (UiThemeDeskFeat.isIn(desk)) (iframe as any).injectTheme = UiThemeDeskFeat.injectTheme;\n\t\treturn step.initFrame(iframe, session);\n\t}\n\n\tasync interact(session: CidSession, step: CidStep): Promise<ICidStepResult> {\n\t\t/** Ignorer les steps d'interaction optionnelles **/\n\t\tconst ctx = this.pubActions.actionContext;\n\t\tif (session.config.cidPassOptionalInteraction && step.def.getAttribute(\"required\") === \"false\") return {};\n\t\tconst frame = <iframe style=\"flex:1; border: none;\"/> as HTMLIFrameElement;\n\t\tif (UiThemeDeskFeat.isIn(desk)) (frame as any).injectTheme = UiThemeDeskFeat.injectTheme;\n\t\tconst dialog = POPUP.showDialog<'ok' | null>(frame, this, {initHeight: \"min(90vh,50em)\", initWidth: \"min(90vw,80em)\", titleBar: {barLabel: {label: session.cidProcess.label.getStr(\"fr\")}}, resizer: {}});\n\t\tdialog.onNextClose().then((r) => {if (!r) session.onCidFrameMessage({cidInteraction: \"aborted\"})});\n\t\tconst res = await step.initFrame(frame, session);\n\t\tdialog.close('ok');\n\t\treturn res;\n\t}\n\n\tasync selectProcess(session: CidSession, choices: Set<CidProcess>): Promise<CidProcess | null> {\n\t\t//console.trace(\"TODO select Process UI\");\n\t\treturn choices.values().next().value;\n\t}\n}\n\nREG.reg.registerSkin(\"wsp-generators\", 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t}\n\n\t:focus-visible {\n\t\toutline: var(--focus-outline);\n\t}\n\n\t[hidden] {\n\t\tdisplay: none !important;\n\t}\n\n\tinput,\n\tselect,\n\ttextarea {\n\t\tbackground-color: var(--form-bgcolor);\n\t\tcolor: var(--form-color);\n\t\tborder: 1px solid var(--border-color);\n\t\tfont-size: inherit;\n\t}\n\n\tinput:invalid,\n\tselect:invalid,\n\ttextarea:invalid {\n\t\tborder: 1px solid var(--error-color);\n\t}\n\n\t#tree {\n\t\tflex: 1 1 30%;\n\t\tborder: none;\n\t\tbackground-color: var(--row-bgcolor);\n\t}\n\n\t#body {\n\t\tflex: 3 1 70%;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t}\n\n\t#genRoot {\n\t\tflex: 1;\n\t\toverflow: auto;\n\t}\n\n\t#genTop {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\talign-items: start;\n\t}\n\n\t#genTopMain {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tjustify-content: center;\n\t}\n\n\t#topInfos {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\ttext-align: center;\n\t\tjustify-content: center;\n\t}\n\n\t#illusCtn {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tuser-select: none;\n\t}\n\n\t#illus {\n\t\tmargin: .5em;\n\t\tmin-width: calc(var(--icon-size) * 2);\n\t\tmin-height: calc(var(--icon-size) * 2);\n\t}\n\n\t#cidRoot,\n\t#cidDetails {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t}\n\n\t#cidRoot {\n\t\toverflow: auto;\n\t}\n\n\t#cidManifest {\n\t\tmargin: .2em;\n\t\tfont-weight: bold;\n\t\tfont-size: 1.2em;\n\t\ttext-align: center;\n\t\tuser-select: none;\n\t}\n\n\t#actions {\n\t\tborder-top: 1px solid var(--border-color);\n\t}\n\n\t.manifestLabel {\n\t\tuser-select: none;\n\t}\n\n\t#manifestInput {\n\t\tflex: 1;\n\t}\n\n\t#manifestAlone {\n\t\tmargin: 2em;\n\t}\n\n\t#manifestEdit {\n\t\tdisplay: flex;\n\t}\n\n\t#manifestInput:focus {\n\t\toutline: var(--focus-outline);\n\t}\n\n\t#manifestInputResult {\n\t\tfont-style: italic;\n\t\tcolor: var(--fade-color);\n\t}\n\n\t.genTi {\n\t\tmargin: .2em;\n\t\tfont-weight: bold;\n\t\tfont-size: 1.2em;\n\t\tuser-select: none;\n\t}\n\n\t.ok {\n\t\tcolor: var(--valid-color);\n\t}\n\n\t.warning {\n\t\tcolor: var(--warning-color);\n\t}\n\n\t.failed {\n\t\tcolor: var(--error-color);\n\t}\n\n\t.null {\n\t\tcolor: var(--fade-color);\n\t}\n\n\t.working {\n\t\tcolor: var(--fade-color);\n\t}\n\n\t.dt {\n\t\tfont-style: italic;\n\t}\n\n\t.dt.working {\n\t\tbackground: left no-repeat url(/@skin@/wsp/views/generators/generating.webp);\n\t\tpadding-left: 30px;\n\t\tmin-height: 30px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t.reason {\n\t\tfont-weight: bold;\n\t\tcolor: var(--error-color);\n\t\tmargin: .1em;\n\t\tpadding: .1em;\n\t}\n\n\t.reason.hidden {\n\t\tdisplay: none;\n\t}\n\n\t.skin {\n\t\tdisplay: inline-block;\n\t\tmargin: .2em;\n\t\tuser-select: none;\n\t}\n\n\t#props {\n\t\tmargin-block-start: .5em;\n\t}\n\n\t#props[disabled] {\n\t\tdisplay: none;\n\t}\n\n\tfieldset {\n\t\tborder: none;\n\t\tpadding: 0;\n\t\tmargin: 0;\n\t\tmin-width: 0;\n\t}\n\n\t/* control en dehors d'un ctrlLbl => s'étend sur les deux colonnes */\n\t.fields > .ctrl {\n\t\tgrid-column-start: span 2;\n\t}\n\n\t/** Contrôle sans */\n\t.ctrlFull {\n\t\tgrid-column-start: span 2;\n\t}\n\n\tinput, textarea, select,\n\t.formElt {\n\t\tmargin-inline-end: .5em;\n\t}\n\n\t.lbl, input, textarea, select,\n\t.formElt, .ctrl {\n\t\tmargin-block-start: .5em;\n\t}\n\n\t/** Pour compat asc pack. A supprimer en 5.1 */\n\t.fieldLabel {\n\t\tcolor: var(--alt1-color);\n\t\tdisplay: inline-block;\n\t\tuser-select: none;\n\t\tmargin-inline-end: .5rem;\n\t\tmargin-inline-start: .3rem;\n\t}\n\n\t/** Pour compat asc pack. A supprimer en 5.1 */\n\t.fieldValue {\n\t\tmargin-inline-start: 0.5em;\n\t\tgrid-column: 2;\n\t}\n\n\t/** Pour compat asc pack. A supprimer en 5.1 */\n\tinput.fieldValue {\n\t\twidth: fit-content;\n\t}\n\n\n\t.changeBtn {\n\t\tdisplay: inline-flex;\n\t}\n\n\t.cidWaiting {\n\t\tflex: 1;\n\t\tborder: none;\n\t\tborder-top: 1px solid var(--border-color);\n\t}\n\n\t.cidUploading {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tfont-style: italic;\n\t\tmargin: 0 2em;\n\t}\n`);\n\nREG.reg.registerSkin(\"wsp-generators/h\", 1, /* language=CSS */ `\n\tc-resizer {\n\t\twidth: 1px;\n\t}\n\n\t#props > div,\n\t.fields /* deprecated ? */\n\t{\n\t\tflex: 1;\n\t\tdisplay: grid;\n\t\tmin-width: 10em;\n\t\tgrid-template-columns: auto 1fr;\n\t\tgrid-row-gap: .5rem;\n\t\tgrid-auto-rows: max-content;\n\t}\n\n\t.fields > .ctrlLbl,\n\t.field {\n\t\tdisplay: contents;\n\t}\n\n\t.lbl {\n\t\tmargin-inline-start: .5em;\n\t}\n`);\n\nREG.reg.registerSkin(\"wsp-generators/v\", 1, /* language=CSS */ `\n\t:host {\n\t\tflex-direction: column;\n\t}\n\n\tc-resizer {\n\t\theight: 1px;\n\t}\n\n\t.ctrlLbl {\n\t\tdisplay: block;\n\t\tmargin-inline-start: .5em;\n\t}\n`);\n\ncustomElements.define(\"wsp-generators\", Generators);\n\nconst DTFormatter = new Intl.DateTimeFormat(\"fr\", {year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric'});\n\n\nfunction defaultOpenStates(d: IItemPubNode): boolean {\n\t//On clos les gens avec des subGens, mais laisse ouvert les dossiers de gen.\n\treturn d.genNodeType === 'dir';\n}\n\n/** */\nclass CellBuilderGen extends CellBuilderIconLabel {\n\n\tconstructor() {\n\t\tsuper(\"label\");\n\t\tthis.iconKey = \"iconUrl\";\n\t\tthis.iconFilter = \"var(--filter)\";\n\t}\n\n\tredrawCell(row: GridDataRowJsonTree<IItemPubNode>, root: HTMLElement): void {\n\t\tsuper.redrawCell(row, root);\n\t\tconst span = root.firstElementChild as HTMLElement;\n\t\tif (row.rowDatas.genNodeType === 'dir') {\n\t\t\tspan.style.display = row.rowDatas.iconUrl ? '' : 'none';\n\t\t\troot.style.fontWeight = 'bold';\n\t\t} else {\n\t\t\tspan.style.display = '';\n\t\t\troot.style.fontWeight = 'normal';\n\t\t}\n\t}\n}\n\n/** */\n\n/** API à implémenter par les pages fournies par le dynGenParam */\ninterface IWindowDynGenParam {\n\t_genPropsMgr: IWindowDynGenParamMgr\n}\n\ninterface IWindowDynGenParamMgr {\n\t/**\n\t * Initialise ou rafraichit le contexte du genBox\n\t *\tATTENTION : cette méthode peut être ré-appelée aprés première exploitation des props (ex : aprés une génération). Elle ne doit\n\t * donc pas nécessairement reseter la page web (contexte dépendant)\n\t * @param propsObj : propriétés ENREGISTREES uniquement\n\t */\n\trefresh(propsObj: Jsonisable, isReadOnly: boolean, forceRefresh: boolean): void,\n\n\t/** compute l'objet des propriétés du générateur */\n\tget(): Jsonisable,\n\n\t/** contrôle la validité du composant */\n\tcheckValidity(): boolean,\n}\n\n\nexport interface ODynGenParamInit extends ODynGenInit, OFormElementInit {\n\treg?: IReg<IWspUiEnv>\n\t/**  */\n\tdynGenInit: ODynGenInit\n}\n\nexport class DynGenParam extends MxFormElement(BaseElement) implements IViewContainer, IFormJsonisable {\n\n\tprotected config: ODynGenParamInit;\n\n\treg: IReg<IWspUiEnv>;\n\n\tview: DynGen;\n\n\tget viewGenPropsMgr(): IWindowDynGenParamMgr | null {\n\t\tif (this.view && this.view.genFrame && this.view.genFrame.contentWindow)\n\t\t\treturn (this.view.genFrame.contentWindow as IWindowDynGen & IWindowDynGenParam)._genPropsMgr;\n\t\treturn null;\n\t}\n\n\t_initialize(init: ODynGenParamInit) {\n\t\tthis.config = init;\n\t\tthis.reg = this.findReg(init);\n\n\t\tthis.view = new DynGen().initialize(Object.assign({\n\t\t\treg: this.reg,\n\t\t\tw: this.reg.env.wsp.code,\n\t\t\tautoResize: true,\n\t\t} as ODynGenInit, this.config));\n\n\t\tthis.view.tabIndex = -1;\n\n\t\tthis.view.genFrame.addEventListener(\"load\", () => {\n\t\t\tthis._refreshUi();\n\t\t});\n\n\t\tthis._attach(this.localName, init, this.view);\n\t\tthis._initializeForm(init);\n\t\t//this.refresh();\n\t}\n\n\tprotected _refreshUi(forceDisabled?: boolean) {\n\t\tif (this.viewGenPropsMgr)\n\t\t\tthis.viewGenPropsMgr.refresh(this._lastProps, forceDisabled ? true : this.disabled, false);\n\t\tthis._refreshValidity()\n\t}\n\n\n\tvisitViews(visitor: (view: IView) => any): any {\n\t\tif (this.view) return visitor(this.view);\n\t}\n\n\tvisitViewsAsync(visitor: (view: IView) => Promise<any>, options?: OViewVisitOptions): Promise<any> {\n\t\treturn this.view ? visitor(this.view) : Promise.resolve(undefined);\n\t}\n\n\tfillJson(parent: any, root: any): void {\n\t\tObject.assign(parent, this.viewGenPropsMgr?.get() || {});\n\t}\n\n\tprotected _lastProps: Dict<any> = null\n\n\textractJson(parent: Dict<any>): boolean {\n\t\tthis._lastProps = parent;\n\t\tthis.view?.load();\n\t\treturn true;\n\t}\n\n\t/** Form */\n\tformDisabledCallback(disabled: boolean) {\n\t\tthis._refreshUi(disabled);\n\t}\n\n\tprotected _refreshValidity() {\n\t\tlet validity = this.viewGenPropsMgr?.checkValidity();\n\t\tthis.setValidity({badInput: !validity}, validity ? \"\" : \"Valeur incorrecte\", this.view);\n\t}\n\n}\n\nREG.reg.registerSkin(\"wsp-generator-params-dyngen\", 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex: 1;\n\t\tflex-direction: column;\n\t}\n\n\twsp-dyngen {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\n\n\twsp-dyngen:focus {\n\t\toutline: var(--focus-outline);\n\t}\n`);\n\ncustomElements.define(\"wsp-generator-params-dyngen\", DynGenParam);"]}