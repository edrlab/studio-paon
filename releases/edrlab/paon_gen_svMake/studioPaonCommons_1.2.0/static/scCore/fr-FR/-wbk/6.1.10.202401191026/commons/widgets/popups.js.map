{"version":3,"sources":["/@back@/commons/widgets/popups.tsx"],"names":["ActionableList","ACTIONABLES","IS_ActionableEnabled","BaseElement","ActionBtn","ACTION","Action","REG","isRefreshHook","DOM","JSX","DOMSH","DEBUG_TOOLTIP","EPopupType","findPopupableParentImp","IS_Popupable","MxPopupable","GridSmall","GridColDef","GridDataHolderJsonArray","PopupMenu","menu","[object Object]","init","super","_initialize","this","restoreFocus","anchor","uiContainer","logicalParent","_restoreFocus","show","reg","registerSkin","customElements","define","PopupActions","headTitle","getAttribute","setAttribute","headBuilder","addEventListener","ev","actionable","detail","action","isMenu","actionContext","close","target","parentNode","focus","subPopup","_subPopupSlot","assignedNodes","window","openTimeout","setTimeout","click","clearTimeout","once","isAnyControlPressed","next","key","findFirstChild","findNextSibling","findLastChild","findPreviousSibling","parentPopup","preventDefault","stopImmediatePropagation","actionBtn","_actionContext","onRefreshCycle","_buildMenu","onViewHidden","textContent","appendChild","createElement","needCheckSpace","count","_actions","i","length","isVisible","menuItem","buildButton","isToggle","prev","firstElementChild","nextElementSibling","cleanupDoubleSep","PopupDialog","dialog","closeOnCtrlEnter","isAccelPressed","tryClose","PopupFloating","floating","closeOnBlur","onFocusout","tabIndex","relatedTarget","Node","isFlatAncestor","onViewShown","PopupProgress","progressCallback","onProgress","bind","done","total","prg","max","value","removeAttribute","document","shadowRoot","getElementById","PopupNotif","level","kind","k","setAttr","autoHide","undefined","contentRoot","insertBefore","id","firstChild","classes","noCloseBtn","btn","title","tabindex-custom","onclick","findHost","tabIndexCustom","ct","_contentNode","remove","class","_autoHide","opened","planifHide","viewPortX","viewPortY","viewPortPadding","setStyle","_timeout","PopupNotifActions","skin","actionsBar","name","actions","button","isTooltipPointer","n","popupTooltip","PopupTooltip","tooltip","hoverAllowed","hasAttribute","tooltipOf","removeEventListener","_lstn","getFlatParentElt","detachTooltip","_timer","type","isConnected","POPUP","TOOLTIP_retarder","currentTarget","x","clientX","y","clientY","r","getBoundingClientRect","Math","floor","left","ceil","right","top","bottom","parent","parentElement","popupType","shown","_checkOwner","_checkOwnerFct","setInterval","returnValue","clearInterval","call","PopupAutoComplete","_data","entries","getDatas","val","setDatas","_grid","initialize","selType","columnDefs","setFlex","setCellBuilder","cellBuilder","dataHolder","hideHeaders","skinOver","defaultAction","setExecute","self","selection","getSelectedDatas","defaultActionCtx","defaultActionOn","skinScroll","createOpts","popupInit","Promise","resolve","input","popup","create","find","newSession","finder","findAutoComplete","then","elem","autoCompleteAnchor","autoSelOnShow","setSelectedRows","onInput","prevent","stopPropagation","onKeyDown","altKey","grid","selected","getSelectedRow","ensureRowVisible","doOnEvent","execute","PopupConfirm","findReg","installSkin","okButton","ui-context","label","okLbl","cancelLbl","onOK","cancelButton","onCancel","onkeypress","onKeyPress","_bodySlot","PopupPrompt","_inputRequired","inputRequired","required","querySelector","reportValidity","async","confirm","msg","from","options","setContent","onNextClose","confirmCheck","checkLbl","checkSt","checked","slot","result","showPopupActions","popupMenu","prompt","showPopupActionsFromEvent","fromContext","MouseEvent","pageX","pageY","initX","initY","Event","showDialog","content","usedOnce","fixSize","showNotif","notif","showNotifInfo","showNotifWarning","showNotifError","showNotifForbidden","showFloating","HTMLElement","showProgress","titleBar","barLabel","initWidth","initHeight","showFloatingFromEvent","initSize","showMenu","closeButton","showMenuFromEvent","attachTooltip","owner","promiseTooltip","contentBd","mouseOverRetarderCaller","Object","overElt","doOnce","cb","timer","executor","lstn","closeAllPopup","logicalRoot","child","Array","body","children","isLogicalFlatAncestor","findPopupableParent"],"mappings":"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","sourcesContent":["import {ActionableList, ACTIONABLES, IActionable, IS_ActionableEnabled, OActionableListInit} from \"back/commons/actionables\";\nimport {BaseElement, OSkinableInit, PickInit} from \"back/commons/basis\";\nimport {ActionBtn, Button} from \"back/commons/widgets/buttons\";\nimport {ACTION, Action} from \"lib/commons/actions\";\nimport {IDomLogical, REG} from 'lib/commons/registry';\nimport {isRefreshHook} from \"lib/commons/utils/signboard\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {\n\tDEBUG_TOOLTIP,\n\tEPopupType,\n\tfindPopupableParent as findPopupableParentImp,\n\tIPopupable,\n\tIPopupCloseEvent,\n\tIS_Popupable,\n\tMxPopupable,\n\tOAroundPosition,\n\tOFixedPosition,\n\tOInitSize,\n\tOPopupAnchor, OResizeObserverInit,\n\tOResizerPointer,\n\tOTitleBarPointer,\n\tOViewPortPosition\n} from \"back/commons/widgets/popupable\";\nimport {IView} from \"lib/commons/views\";\nimport {GridSmall} from \"back/commons/widgets/grid-tags\";\nimport {GridColDef, ICellBuilder} from \"back/commons/widgets/grid-core\";\nimport {GridDataHolderJsonArray} from \"back/commons/widgets/grid-libs\";\n\n\n/**\n * Popup de type menu, générique avec contenu libre.\n */\nexport interface IPopupMenu {\n\tinitialize(init?: OPopupMenuInit): this;\n}\n\nexport interface OPopupMenuInit extends OTitleBarPointer, OResizeObserverInit, OResizerPointer, OSkinableInit {\n\trestoreFocus?: HTMLElement;\n}\n\nexport interface PopupMenu {\n\tinitialize(init?: OPopupMenuInit): this;\n}\n\nexport class PopupMenu extends MxPopupable(BaseElement, EPopupType.menu) implements IPopupable, IDomLogical {\n\t/**\n\t * A la fermeture du popup focus cet élement\n\t * (réalisé avant l'execution de l'action qui peut réaffecter librement le focus).\n\t */\n\trestoreFocus?: HTMLElement;\n\n\tprotected _initialize(init: OPopupMenuInit) {\n\t\tsuper._initialize(init);\n\t\tif ('restoreFocus' in init) this.restoreFocus = init.restoreFocus;\n\t}\n\n\t/** Surcharge de MxPopupable.show()*/\n\tshow(anchor?: OPopupAnchor, uiContainer?: Node, logicalParent?: Element): boolean {\n\t\tthis._restoreFocus = this.restoreFocus;\n\t\treturn super.show(anchor, uiContainer, logicalParent);\n\t}\n}\n\nREG.reg.registerSkin('c-popup-menu', 1, /* language=CSS */ `\n\t:host([opened]) {\n\t\tpointer-events: auto;\n\t}\n\n\t::slotted([role=menu][slot=subPopup]) {\n\t\tpointer-events: none;\n\t}\n\n\t#content {\n\t\tbackground-color: var(--row-bgcolor);\n\t\tborder: solid 1px var(--border-color);\n\t\tborder-radius: 4px;\n\t\tbox-shadow: 1px 1px 5px var(--fade-color);\n\t}\n`);\n\ncustomElements.define('c-popup-menu', PopupMenu);\n\n/**\n * c-popup : popup générique\n * c-popup-actions : popup affichant un menu d'actions.\n */\n\n\n/**\n * Popup de type menu affichant une liste d'actions.\n * Classes:\n *  - hideIcons masque la colonne des icones pour toutes les actions de ce menu.\n */\nexport interface PopupActions<C> {\n\tinitialize(init?: OPopupActionsInit<C>): this;\n}\n\nexport interface OPopupActionsInit<C> extends OPopupMenuInit, OActionableListInit<C>, PickInit<PopupActions<C>, 'headTitle' | 'headBuilder'> {\n}\n\nexport class PopupActions<C> extends MxPopupable(ActionableList, EPopupType.menu)<C> implements IPopupable, IDomLogical {\n\n\t/** Titre commun aux actions. */\n\tget headTitle(): string {return this.getAttribute(\"head-title\")}\n\n\theadBuilder?: (root: HTMLElement) => void;\n\n\tprotected _initialize(init: OPopupActionsInit<C>) {\n\t\tsuper._initialize(init);\n\t\tif ('headTitle' in init) this.setAttribute(\"head-title\", init.headTitle);\n\t\tif ('restoreFocus' in init) this.restoreFocus = init.restoreFocus;\n\t\tif ('headBuilder' in init) this.headBuilder = init.headBuilder;\n\t\tthis.addEventListener('c-actioned', function (this: PopupActions<C>, ev: CustomEvent) {\n\t\t\tconst actionable = ev.detail.actionable as IActionable<C>;\n\t\t\tif (!actionable.action.isMenu(actionable.actionContext)) {\n\t\t\t\tthis.close(actionable.action);\n\t\t\t}\n\t\t});\n\t\tthis.addEventListener('pointerover', function (this: PopupActions<C>, ev: MouseEvent) {\n\t\t\tconst target = ev.target as HTMLElement;\n\t\t\tif (IS_ActionableEnabled(target) && target.parentNode == this) {\n\t\t\t\ttarget.focus();\n\t\t\t\tfor (const subPopup of this._subPopupSlot.assignedNodes() as IPopupable[]) { subPopup.close(); }\n\t\t\t\t// Ouverture du sous-menu au survol de l'item après un timeoutet au moins un mouvement de souris\n\t\t\t\twindow.addEventListener('pointermove', () => {\n\t\t\t\t\tif (target.action.isMenu(target.actionContext)) {\n\t\t\t\t\t\tconst openTimeout = setTimeout(() => target.click(), 300);\n\t\t\t\t\t\tthis.addEventListener('pointerout', () => clearTimeout(openTimeout), {once: true});\n\t\t\t\t\t}\n\t\t\t\t}, {once: true})\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected onKeyDown(ev: KeyboardEvent): boolean {\n\t\t//console.log(\"onKeyDown:::\", ev.key, ev.target, ev);\n\t\tif (ACTION.isAnyControlPressed(ev)) return false;\n\t\tlet next: HTMLElement;\n\t\tswitch (ev.key) {\n\t\tcase 'ArrowDown':\n\t\t\tif (ev.target === this) {\n\t\t\t\tnext = DOM.findFirstChild(ev.target as Element, IS_ActionableEnabled);\n\t\t\t} else {\n\t\t\t\tnext = DOM.findNextSibling(ev.target as Element, IS_ActionableEnabled);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'ArrowUp':\n\t\t\tif (ev.target === this) {\n\t\t\t\tnext = DOM.findLastChild(ev.target as Element, IS_ActionableEnabled);\n\t\t\t} else {\n\t\t\t\tnext = DOM.findPreviousSibling(ev.target as Element, IS_ActionableEnabled);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'ArrowLeft':\n\t\t\tif (this.parentPopup) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t// (ev.target as Element).setAttribute(\"xxxxx\", Math.random().toString());\n\t\t\t\t// console.log(\"ArrowLeft----CLOSE::::\", ev.composedPath(), ev.target);\n\t\t\t\tthis.close();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'ArrowRight':\n\t\t\tconst actionBtn = ev.target;\n\t\t\tif (IS_ActionableEnabled(actionBtn) && actionBtn.action.isMenu(actionBtn.actionContext)) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\tactionBtn.click();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tif (next) {\n\t\t\tnext.focus();\n\t\t\tev.preventDefault();\n\t\t\tev.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/** Surcharge de MxPopupable.show()*/\n\tshow(anchor?: OPopupAnchor, uiContainer?: Node, logicalParent?: Element): boolean {\n\t\tif (isRefreshHook(this._actionContext) && this._actionContext.onRefreshCycle(true) === 'stop') return;\n\t\ttry {\n\t\t\tif (this._buildMenu() === 0) return false;\n\t\t\treturn super.show(anchor, uiContainer, logicalParent);\n\t\t} finally {\n\t\t\tif (isRefreshHook(this._actionContext)) this._actionContext.onRefreshCycle(false);\n\t\t}\n\t}\n\n\tonViewHidden(): void {\n\t\tsuper.onViewHidden();\n\t\tthis.textContent = null; //cleanup\n\t}\n\n\t/** Optimisation : on tue la construction des menuitems au refresh.*/\n\tprotected _refresh() {}\n\n\tprotected _buildMenu(): number {\n\t\t//Construction du menu avec\n\t\t// - séparateur de groupes\n\t\t// - gestion de l'espacement homogène des colonnes si au moins un item est de type toggle.\n\t\tthis.textContent = null;\n\n\t\tif (this.headBuilder) this.headBuilder(this.appendChild(<h5/>));\n\t\telse if (this.headTitle) this.appendChild(<h5>{this.headTitle}</h5>);\n\n\t\tlet needCheckSpace = false;\n\t\tlet count = 0;\n\t\tif (this._actions) for (let i = 0; i < this._actions.length; i++) {\n\t\t\tconst action = this._actions[i];\n\t\t\tif (!action.isVisible(this._actionContext)) continue; //le menu étant reconstruit à chaque show, on peut évaluer la visibilité de suite.\n\t\t\tconst menuItem = ActionBtn.buildButton(action, this._actionContext, 'menu', this);\n\t\t\tif (menuItem) {\n\t\t\t\tif (needCheckSpace) {\n\t\t\t\t\tif (!action.isToggle(this._actionContext)) menuItem.setAttribute('check-space', '');\n\t\t\t\t} else if (action.isToggle(this._actionContext)) {\n\t\t\t\t\tneedCheckSpace = true;\n\t\t\t\t\tfor (let prev = this.firstElementChild; prev; prev = prev.nextElementSibling) {\n\t\t\t\t\t\tprev.setAttribute('check-space', '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.appendChild(menuItem);\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\tACTIONABLES.cleanupDoubleSep(this);\n\t\treturn count;\n\t}\n\n}\n\nREG.reg.registerSkin('c-popup-actions', 1, /* language=CSS */ `\n\t:host([opened]) {\n\t\tpointer-events: auto;\n\t}\n\n\t::slotted([role=menu][slot=subPopup]) {\n\t\tpointer-events: none;\n\t}\n\n\t:host(.hideIcons) {\n\t\t--icon-size: 0;\n\t}\n\n\t#content {\n\t\tbackground-color: var(--row-bgcolor);\n\t\tborder: solid 1px var(--border-color);\n\t\tborder-radius: 4px;\n\t\tbox-shadow: 1px 1px 5px var(--fade-color);\n\t\toverflow: scroll;\n\t\t/* Firefox */\n\t\tscrollbar-width: none;\n\t}\n\n\t#content::-webkit-scrollbar {\n\t\tdisplay: none;\n\t}\n\n\t::slotted(hr) {\n\t\tborder: none;\n\t\tborder-top: 1px solid var(--border-color);\n\t\twidth: 100%;\n\t\tmargin: .3em 0 !important;\n\t\theight: 1px; /* sinon border-top parfois non dessiné - chrome79 */\n\t}\n\n\t::slotted(h5) {\n\t\tmargin: 0;\n\t\tpadding: .3em .1em;\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t}\n`);\n\ncustomElements.define('c-popup-actions', PopupActions);\n\n/**\n * Popup de type dialogue modal.\n */\nexport interface OPopupDialogInit extends OSkinableInit, OTitleBarPointer, OResizeObserverInit, OResizerPointer, OViewPortPosition {\n\n\t/**\n\t * En plus de la touche Escape, capte ctrl+Entrée pour clore le dialogue.\n\t * A activer dans le contexte d'un dialogue avec changements d'états mais sans action explicite de validation (ie bouton Valider/Créer/Enregistrer).\n\t * Usages : dialogue d'édition wed (metas), écran d'options ou préférences avec activation instantannée...\n\t */\n\tcloseOnCtrlEnter?: boolean;\n}\n\n\nexport interface PopupDialog {\n\tinitialize(init: OPopupDialogInit): this;\n}\n\nexport class PopupDialog extends MxPopupable(BaseElement, EPopupType.dialog) implements IPopupable, IDomLogical {\n\tcloseOnCtrlEnter: boolean;\n\n\tprotected _initialize(init: OPopupDialogInit) {\n\t\tsuper._initialize(init);\n\t\tthis.closeOnCtrlEnter = init.closeOnCtrlEnter;\n\t}\n\n\tonKeyDown(ev: KeyboardEvent): boolean {\n\t\tif (this.closeOnCtrlEnter && ev.key === 'Enter' && ACTION.isAccelPressed(ev)) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopImmediatePropagation();\n\t\t\tthis.tryClose();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nREG.reg.registerSkin('c-popup-dialog', 1, /* language=CSS */ `\n\t:host([opened]) {\n\t\tpointer-events: auto;\n\t\tbackground-color: rgba(128, 128, 128, .4);\n\t}\n\n\t#content {\n\t\tborder: 2px solid var(--dialog-bgcolor);\n\t\tborder-radius: 5px;\n\t\tbox-shadow: 1px 1px 4px var(--fade-color);\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t\tmin-height: 6em;\n\t\tmin-width: 12em;\n\t}\n\n\t:focus-visible {\n\t\toutline: var(--focus-outline);\n\t}\n\n\t#body {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\toverflow: auto;\n\t\tflex: 1;\n\t}\n`);\n\ncustomElements.define('c-popup-dialog', PopupDialog);\n\n\n/**\n * Popup de type fenêtre flottante.\n */\nexport interface PopupFloating {\n\tinitialize(init?: OPopupFloatingInit): this;\n}\n\nexport interface OPopupFloatingInit extends OSkinableInit, OResizeObserverInit, OTitleBarPointer, OResizerPointer {\n\t/** Autoclose à la perte du focus. */\n\tcloseOnBlur?: boolean\n}\n\nexport class PopupFloating extends MxPopupable(BaseElement, EPopupType.floating) {\n\t// TODO pour updater le titre/icon. this.titleBar = WindowBar instancié\n\n\t/** Si true à l'init, peut être passé à false pour stabiliser cette fenêtre indépendamment du focus. */\n\tcloseOnBlur: boolean;\n\n\tprotected _initialize(init: OPopupFloatingInit) {\n\t\tif (init.closeOnBlur) {\n\t\t\tthis.closeOnBlur = true;\n\t\t\tthis.addEventListener(\"focusout\", this.onFocusout);\n\t\t\tthis.tabIndex = 0;\n\t\t}\n\t\tsuper._initialize(init);\n\t}\n\n\tonFocusout(ev: FocusEvent) {\n\t\t//Si focus en dehors.\n\t\tif (!ev.relatedTarget || !(ev.relatedTarget instanceof Node) || !DOMSH.isFlatAncestor(this, ev.relatedTarget)) this.close();\n\t}\n\n\tonViewShown() {\n\t\tthis.focus();\n\t\tsuper.onViewShown();\n\t}\n\n}\n\nREG.reg.registerSkin('c-popup-floating', 1, /* language=CSS */ `\n\t#body {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\toverflow: auto;\n\t}\n\n\t#content {\n\t\tbox-sizing: border-box;\n\t\tborder: solid 1px var(--border-color);\n\t\tborder-radius: 4px;\n\t\tbox-shadow: 1px 1px 5px var(--fade-color);\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t}\n`);\n\ncustomElements.define('c-popup-floating', PopupFloating);\n\n\nexport class PopupProgress extends PopupFloating {\n\n\tprg: HTMLProgressElement;\n\n\tget progressCallback(): (done: number, total: number | undefined) => void {return this.onProgress.bind(this)}\n\n\tonProgress(this: PopupProgress, done: number, total: number | undefined) {\n\t\tif (total > 0 && done < total) {\n\t\t\tthis.prg.max = total;// * 1.5; //on considère que l'upload prend 2/3 du temps avant le traitement coté serveur.\n\t\t\tthis.prg.value = done;\n\t\t} else {\n\t\t\t//taille upload inconnu OU upload achevé traitement en cours coté serveur.\n\t\t\tthis.prg.max = 1;\n\t\t\tthis.prg.removeAttribute(\"value\");\n\t\t}\n\t}\n\n\tprotected _initialize(init: OPopupFloatingInit) {\n\t\tsuper._initialize(init);\n\t\tthis.prg = document.createElement(\"progress\") as HTMLProgressElement;\n\t\tthis.shadowRoot.getElementById(\"content\").appendChild(this.prg);\n\t}\n}\n\nREG.reg.registerSkin('c-popup-progress', 1, /* language=CSS */ `\n\t#content {\n\t\tbox-sizing: border-box;\n\t\tborder: solid 1px var(--border-color);\n\t\tborder-radius: 4px;\n\t\tbox-shadow: 1px 1px 5px var(--fade-color);\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t}\n\n\tprogress {\n\t\tflex: 1;\n\t\twidth: auto;\n\t\tmargin: 0 .5em;\n\t}\n`);\n\ncustomElements.define('c-popup-progress', PopupProgress);\n\n/**\n * Popup de notification.\n */\nexport interface PopupNotif {\n\tinitialize(init?: OPopupNotifInit): this;\n}\n\nexport interface OPopupNotifInit extends OSkinableInit {\n\tkind?: 'info' | 'warning' | 'error' | 'forbidden'\n\tlevel?: 'minor' | 'medium' | 'major'\n\tautoHide?: number\n\tnoCloseBtn?: boolean\n\t/** classes pour stylage particulier :\n\t * hover : notif au dessus d'une zone pour un petit message éphémère de recherche en cours.\n\t */\n\tclasses?: string\n}\n\nexport class PopupNotif extends MxPopupable(BaseElement, EPopupType.floating) {\n\t//icon?: 'info' | 'warning' | 'alert' | IEndPoint\n\tautoHide?: 0 | number;\n\tprotected _autoHide?: 0 | number;\n\n\tget level(): 'minor' | 'medium' | 'major' {return this.getAttribute('level') as 'minor' | 'medium' | 'major'}\n\n\tget kind(): 'info' | 'warning' | 'error' | 'forbidden' {return this.getAttribute('kind') as any}\n\n\tset kind(k: 'info' | 'warning' | 'error' | 'forbidden') {\n\t\tDOM.setAttr(this, \"kind\", k);\n\t}\n\n\tprotected _contentNode: Element;\n\n\tprotected _initialize(init: OPopupNotifInit) {\n\t\tsuper._initialize(init);\n\t\t//this.icon = init.icon;\n\t\tif (init.level) this.setAttribute('level', init.level);\n\t\tif (init.kind) this.setAttribute('kind', init.kind);\n\t\tthis.autoHide = init.autoHide == undefined ? null : init.autoHide;\n\t\tthis.contentRoot.insertBefore(<span id=\"kind\"/>, this.contentRoot.firstChild);\n\t\tif (init.classes) this.setAttribute(\"class\", init.classes);\n\t\tif (!init.noCloseBtn) {\n\t\t\t// close btn hors tabIndex : pb si superposition de messages, stack à gérer...\n\t\t\tconst btn = this.contentRoot.appendChild(<c-button title=\"Fermer cette notification\" tabindex-custom=\"-1\"/>) as Button;\n\t\t\tbtn.onclick = function (ev: MouseEvent) {(DOMSH.findHost(ev.target as Node) as PopupNotif).tryClose()};\n\t\t\tbtn.tabIndexCustom = -1;\n\t\t}\n\t}\n\n\tsetContent(ct: string | Element): this {\n\t\tif (this._contentNode) this._contentNode.remove();\n\t\tif (typeof ct === 'string') {\n\t\t\tthis._contentNode = this.appendChild(<div class=\"msg\">{ct}</div>);\n\t\t\tthis._autoHide = this.autoHide == null ? 2000 + ct.length * 20 : this.autoHide;\n\t\t\tif (this.opened) this.planifHide();\n\t\t} else {\n\t\t\tthis._contentNode = this.appendChild(ct);\n\t\t\tthis._autoHide = this.autoHide == null ? 2000 + ct.textContent.length * 20 : this.autoHide;\n\t\t\tif (this.opened) this.planifHide();\n\t\t}\n\t\treturn this;\n\t}\n\n\tshow(anchor?: OPopupAnchor, uiContainer?: Node, logicalParent?: Element): boolean {\n\t\tif (super.show(anchor || {viewPortX: 'middle', viewPortY: 'bottom', viewPortPadding: 10}, logicalParent)) {\n\t\t\tthis.planifHide();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tclose(): boolean {\n\t\tif (super.close()) {\n\t\t\t//reset de la largeur max qui a pu être imposé au positionnement de la notif.\n\t\t\tDOM.setStyle(this, 'max-width', null);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected planifHide() {\n\t\tif (this._timeout) clearTimeout(this._timeout);\n\t\tif (this._autoHide > 0) this._timeout = setTimeout(this.close.bind(this), this._autoHide);\n\t}\n\n\tprotected _timeout: number;\n}\n\nREG.reg.registerSkin('c-popup-notif', 1, /* language=CSS */ `\n\t#content {\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tborder: solid 1px var(--border-color);\n\t\tborder-radius: 4px;\n\t\tbox-shadow: 1px 1px 5px var(--fade-color);\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t\tpadding: 1em;\n\t\tmargin-inline-end: .55em;\n\t\tz-index: 51;\n\t}\n\n\t:host(.hover) > #content {\n\t\tpadding: .2em;\n\t\topacity: .8;\n\t\tbox-shadow: none;\n\t}\n\n\t:host([level='medium']) #content {\n\t\tz-index: 52;\n\t}\n\n\t:host([level='major']) #content {\n\t\tz-index: 53;\n\t}\n\n\t:host([kind='info']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: no-repeat url(/@skin@/commons/widgets/popupable/info.svg);\n\t}\n\n\t:host([kind='warning']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: no-repeat url(/@skin@/commons/widgets/popupable/warning.svg);\n\t}\n\n\t:host([kind='error']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: no-repeat url(/@skin@/commons/widgets/popupable/error.svg);\n\t}\n\n\t:host([kind='forbidden']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: no-repeat url(/@skin@/commons/widgets/popupable/forbidden.svg);\n\t}\n\n\n\tc-button {\n\t\tposition: absolute;\n\t\ttop: -.5rem;\n\t\tright: -.5rem;\n\t\tborder: 1px solid var(--border-color);\n\t\tborder-radius: .3rem;\n\t\tbox-sizing: border-box;\n\t\twidth: 1.3rem;\n\t\theight: 1.3rem;\n\t\tbackground: center / .8rem no-repeat url(/@skin@/commons/icons/close.svg) var(--bgcolor);\n\t}\n\n\t::slotted(.msg) {\n\t\ttext-align: center;\n\t\tuser-select: none;\n\t\twhite-space: pre-wrap;\n\t}\n\n\t/* Pour c-popup-notif-actions. */\n\tslot[name=actions] > *:not([hidden]) {\n\t\tdisplay: block;\n\t\torder: 1;\n\t}\n`);\n\ncustomElements.define('c-popup-notif', PopupNotif);\n\n/**\n *\n */\nexport interface PopupNotifActions<C> {\n\tinitialize(init?: OPopupNotifActionsInit<C>): this;\n}\n\nexport interface OPopupNotifActionsInit<C> extends OPopupNotifInit {\n\tactions: Action[];\n\tactionContext: C;\n}\n\nexport class PopupNotifActions<C> extends PopupNotif {\n\t_initialize(init: OPopupNotifActionsInit<C>) {\n\t\tinit.skin = \"c-popup-notif\";\n\t\tsuper._initialize(init);\n\t\tconst actionsBar = this.contentRoot.appendChild(<slot name=\"actions\"/>);\n\t\tfor (const action of init.actions) {\n\t\t\tconst button = ActionBtn.buildButton(action, init.actionContext, 'dialog', actionsBar);\n\t\t\tactionsBar.appendChild(button);\n\t\t}\n\t\treturn this;\n\t}\n}\n\ncustomElements.define('c-popup-notif-actions', PopupNotifActions);\n\n/**\n * Popup de type tooltip.\n * Config attribute : hover-allowed\n */\nexport interface ITooltipPointer {\n\tpopupTooltip?: PopupTooltip;\n}\n\nexport function isTooltipPointer(n: any): n is ITooltipPointer {return n && (n as ITooltipPointer).popupTooltip != null}\n\n/**\n *\n */\nexport interface PopupTooltip {\n\tinitialize(init?: OPopupTooltipInit): this;\n}\n\nexport interface OPopupTooltipInit extends OSkinableInit, PickInit<PopupTooltip, 'tooltipOf' | 'anchor'> {\n\thoverAllowed?: boolean\n}\n\nexport class PopupTooltip extends MxPopupable(BaseElement, EPopupType.tooltip) implements IPopupable, IDomLogical {\n\t/** Elément auquel rattacher ce tooltip. Si null, c'est l'élément parent qui sera considéré. */\n\ttooltipOf: HTMLElement & ITooltipPointer;\n\n\t/** Positionnement du tooltip. Par défaut : en dessous de tooltipOf. */\n\tanchor?: OPopupAnchor;\n\n\t/** Autorise une interaction à la souris dans le tooltip. */\n\tget hoverAllowed(): boolean {return this.hasAttribute('hover-allowed')};\n\n\tprotected _lstn: (ev: MouseEvent) => void;\n\n\tprotected _timer: number;\n\tprotected _checkOwner: number | any /* bug typage TS2.9 incompréhensible... */;\n\tprotected _checkOwnerFct: () => void;\n\n\n\tdetachTooltip() {\n\t\tif (this.tooltipOf) {\n\t\t\tthis.tooltipOf.removeEventListener('pointerenter', this._lstn);\n\t\t\tthis.tooltipOf.removeEventListener('pointerleave', this._lstn);\n\t\t\tthis.tooltipOf.removeEventListener('pointercancel', this._lstn);\n\t\t\tthis.close();\n\t\t\tif (this.tooltipOf.popupTooltip === this) this.tooltipOf.popupTooltip = null; //helpGC\n\t\t\tthis.tooltipOf = null; //helpGC\n\t\t}\n\t}\n\n\tprotected _initialize(init: OPopupTooltipInit) {\n\t\tsuper._initialize(init);\n\t\tif (init.hoverAllowed) this.setAttribute('hover-allowed', \"\");\n\t\tif (init.anchor) this.anchor = init.anchor;\n\t\tthis.tooltipOf = (init.tooltipOf ? init.tooltipOf : DOMSH.getFlatParentElt(this)) as HTMLElement & ITooltipPointer;\n\t\tif (this.tooltipOf.popupTooltip) this.tooltipOf.popupTooltip.detachTooltip();\n\t\tthis.tooltipOf.popupTooltip = this;\n\t\tthis._lstn = (ev: MouseEvent) => {\n\t\t\tif (this._timer) {\n\t\t\t\twindow.clearTimeout(this._timer);\n\t\t\t\tthis._timer = 0;\n\t\t\t}\n\t\t\tif (ev.type === 'pointerenter') {\n\t\t\t\tthis._timer = window.setTimeout(() => {\n\t\t\t\t\tthis._timer = 0;\n\t\t\t\t\tif (this.tooltipOf && this.tooltipOf.isConnected) this.show(this.anchor || this.tooltipOf, this.tooltipOf);\n\t\t\t\t}, POPUP.TOOLTIP_retarder);\n\t\t\t} else {\n\t\t\t\tif (this.hoverAllowed) {\n\t\t\t\t\tif (ev.currentTarget === this.contentRoot) {\n\t\t\t\t\t\tconst x = ev.clientX, y = ev.clientY;\n\t\t\t\t\t\tconst r = this.tooltipOf.getBoundingClientRect();\n\t\t\t\t\t\tif (Math.floor(r.left) <= x + 1 && Math.ceil(r.right) >= x - 1 && Math.floor(r.top) <= y + 1 && Math.ceil(r.bottom) >= y - 1) return;\n\t\t\t\t\t}\n\t\t\t\t\t// Test de l'ensemble de la hiéarchie de tooltip sur le pointerleave\n\t\t\t\t\tlet tooltip = this as IPopupable;\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (DOMSH.isFlatAncestor(tooltip, ev.relatedTarget as Node)) break;\n\t\t\t\t\t\tconst parent = tooltip.parentElement;\n\t\t\t\t\t\ttooltip.close();\n\t\t\t\t\t\ttooltip = IS_Popupable(parent) && parent.popupType === EPopupType.tooltip && parent;\n\t\t\t\t\t} while (tooltip);\n\t\t\t\t} else {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.tooltipOf.addEventListener('pointerenter', this._lstn);\n\t\tif (!DEBUG_TOOLTIP) {\n\t\t\tthis.tooltipOf.addEventListener('pointerleave', this._lstn);\n\t\t\tthis.tooltipOf.addEventListener('pointercancel', this._lstn);\n\t\t\tif (this.hoverAllowed) {\n\t\t\t\tthis.contentRoot.addEventListener('pointerleave', this._lstn);\n\t\t\t\tthis.contentRoot.addEventListener('pointercancel', this._lstn);\n\t\t\t}\n\t\t}\n\t}\n\n\tshow(anchor?: OPopupAnchor, uiContainer?: Node, logicalParent?: Element): boolean {\n\t\tconst shown = super.show(anchor, uiContainer, logicalParent);\n\t\tif (shown && this.tooltipOf && !this._checkOwner) {\n\t\t\t//Controle que le owner du tooltip ne soit pas détaché (exemple double-click sur l'objet qui décharge le contexte courant et en ouvre un nouveau).\n\t\t\tif (!this._checkOwnerFct) {\n\t\t\t\tthis._checkOwnerFct = () => {\n\t\t\t\t\tif (!this.tooltipOf.isConnected) this.close();\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis._checkOwner = setInterval(this._checkOwnerFct, 250);\n\t\t}\n\t\treturn shown;\n\t}\n\n\tclose(returnValue?: any): boolean {\n\t\tif (this._checkOwner) {\n\t\t\tclearInterval(this._checkOwner);\n\t\t\tthis._checkOwner = 0;\n\t\t}\n\t\treturn super.close(returnValue);\n\t}\n\n\t/** Pour la création à la volée du tooltip au 1er event pointerenter. */\n\tforwardPointerEnter(ev: MouseEvent) {\n\t\tthis._lstn.call(this.tooltipOf, ev);\n\t}\n}\n\nREG.reg.registerSkin('c-popup-tooltip', 1, /* language=CSS */ `\n\t#content {\n\t\tdisplay: block;\n\t\tborder: solid 1px var(--tooltip-border-color, #fcffc8);\n\t\tborder-radius: 3px;\n\t\tbox-shadow: 1px 1px 2px var(--fade-color);\n\t\tbackground-color: var(--tooltip-bgcolor, #feffe5);\n\t\tz-index: 101;\n\t\tuser-select: none;\n\t}\n`);\n\ncustomElements.define('c-popup-tooltip', PopupTooltip);\n\n\n/**\n * Popup pour la gestion des entrées d'autocomplete, basé sur un grid, évitant\n * la prise de focus.\n *\n * Le type de données est quelconque : à la charge de l'appelant de fournir un\n * cellBuilder pour gérer l'affichage de la liste.\n *\n * La popup pouvant s'ouvrir et se fermer plusieurs fois, son résultat doit être\n * récupéré par l'évènement 'c-beforeclose'.\n */\nexport interface PopupAutoComplete<D> {\n\tinitialize(init?: OPopupAutoCompleteInit<D>): this;\n}\n\n/**\n * Option d'initialisatiode la popup d'autocomplete\n */\nexport interface OPopupAutoCompleteInit<D> extends OSkinableInit {\n\t/** ICellBuilder pour la construction de la liste des entrées */\n\tcellBuilder: ICellBuilder;\n\t/** Entrées à affecter dès l'initialiation */\n\tentries?: D[];\n}\n\n/**\n * Option de création à la demande de la popup d'autocomplete\n */\nexport interface OPopupAutoCompleteCreate<D> extends OSkinableInit {\n\t/** Input sur lequel écouter les évènements */\n\tinput: HTMLElement;\n\n\t/** Détermine si le premier élément doit-il être sélectionné automatiquement à\n\t * l'affichage de la popup */\n\tautoSelOnShow?: boolean;\n\n\t/** Finder à appeler pour récupérer les entrées d'autocomplete */\n\tfinder: IPopupAutoCompleteFinder<D>;\n}\n\n/** Interface entre la popup et le widget appelant */\nexport interface IPopupAutoCompleteFinder<D> {\n\t/**\n\t * Méthode appelée pour récupérer les entrées, évalué à chaque event input.\n\t * @return null si raceCond détectée (autre appel concurrent pendant la résolution de la Promise), [] si erreur/abandon appelant à ne pas afficher la popup.\n\t */\n\tfindAutoComplete: (newSession?: boolean, ev?: Event) => Promise<D[] | null>;\n\n\t/** Ancre sur laquelle positionner la popup, évaluée à chaque affichage.\n\t * Par défaut, il s'agit de l'input */\n\tautoCompleteAnchor?: HTMLElement | ClientRect;\n}\n\nexport class PopupAutoComplete<D> extends MxPopupable(BaseElement, EPopupType.tooltip) {\n\tprotected _grid: GridSmall;\n\tprotected _data = new GridDataHolderJsonArray<D>();\n\n\tget entries(): D[] {\n\t\treturn this._data.getDatas();\n\t}\n\n\tset entries(val) {\n\t\tthis._data.setDatas(val);\n\t}\n\n\tprotected _initialize(init: OPopupAutoCompleteInit<D>) {\n\t\tsuper._initialize(init);\n\n\t\tthis._grid = this.contentRoot.appendChild(new GridSmall().initialize({\n\t\t\tselType: 'monoOver',\n\t\t\tcolumnDefs: [new GridColDef('main')\n\t\t\t\t.setFlex('1rem', 1, 1)\n\t\t\t\t.setCellBuilder(init.cellBuilder)\n\t\t\t],\n\t\t\tdataHolder: this._data,\n\t\t\thideHeaders: true,\n\t\t\tskinOver: 'c-popup-autocomplete/grid',\n\t\t\tdefaultAction: new Action<PopupAutoComplete<D>>().setExecute((self) => {\n\t\t\t\tconst selection = self._data.getSelectedDatas();\n\t\t\t\tif (selection.length) this.close(selection[0]);\n\t\t\t}),\n\t\t\tdefaultActionCtx: this,\n\t\t\tdefaultActionOn: 'mousedown',\n\t\t\tskinScroll: 'scroll/small'\n\t\t}));\n\n\t\tthis._grid.removeAttribute('tabindex');\n\t\tthis.entries = init.entries || [];\n\t}\n\n\t/**\n\t * Création de la popup à la demande dès qu'un caractère est entrée ou sur les actions double clic ou Alt+Enter.\n\t *\n\t * À appeler sur l'event focusin de l'input, les listeners étant enlevés automatiquement sur le focusout.\n\t *\n\t * @return Promesse de création de la popup\n\t * */\n\tstatic createFromInputEvent<D>(createOpts: OPopupAutoCompleteCreate<D>, popupInit: OPopupAutoCompleteInit<D>): Promise<PopupAutoComplete<D>> {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst {input} = createOpts;\n\t\t\tlet popup: PopupAutoComplete<D>;\n\n\t\t\tfunction create(ev: Event) {\n\t\t\t\tif (popup) return;\n\t\t\t\tpopup = new PopupAutoComplete<D>().initialize(popupInit);\n\t\t\t\tresolve(popup);\n\t\t\t\tfind(true, ev);\n\t\t\t\treturn popup;\n\t\t\t}\n\n\t\t\tfunction find(newSession: boolean, ev: Event) {\n\t\t\t\tcreateOpts.finder.findAutoComplete(newSession, ev).then((entries) => {\n\t\t\t\t\tif (entries == null) return;\n\t\t\t\t\tif (entries.length) {\n\t\t\t\t\t\tpopup.entries = entries;\n\t\t\t\t\t\tpopup.show({elem: createOpts.finder.autoCompleteAnchor || input}, input);\n\t\t\t\t\t\tif (createOpts.autoSelOnShow) popup._grid.setSelectedRows(0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onInput(ev: Event) {\n\t\t\t\tif (!create(ev)) find(false, ev);\n\t\t\t}\n\n\t\t\tfunction prevent(ev: Event) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t}\n\n\t\t\tfunction onKeyDown(ev: KeyboardEvent) {\n\t\t\t\tif (ev.key === \"Enter\" && ev.altKey) {\n\t\t\t\t\tprevent(ev);\n\t\t\t\t\tif (!create(ev)) find(false, ev);\n\t\t\t\t} else if (popup?.opened) {\n\t\t\t\t\tconst {_grid: grid} = popup;\n\t\t\t\t\tlet selected = grid.getSelectedRow();\n\t\t\t\t\t/* Déplacement de la sélection sans prise de focus */\n\t\t\t\t\tif (ev.key === \"ArrowDown\") {\n\t\t\t\t\t\tprevent(ev);\n\t\t\t\t\t\tif (selected === undefined) selected = -1;\n\t\t\t\t\t\tif (++selected < popup.entries.length) {\n\t\t\t\t\t\t\tgrid.setSelectedRows(selected);\n\t\t\t\t\t\t\tgrid.ensureRowVisible(selected);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (ev.key === \"ArrowUp\") {\n\t\t\t\t\t\tprevent(ev);\n\t\t\t\t\t\tif (selected !== undefined) {\n\t\t\t\t\t\t\tif (--selected >= 0) {\n\t\t\t\t\t\t\t\tgrid.setSelectedRows(selected);\n\t\t\t\t\t\t\t\tgrid.ensureRowVisible(selected);\n\t\t\t\t\t\t\t} else grid.setSelectedRows(-1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (ev.key === \"Enter\") {\n\t\t\t\t\t\tif (selected !== undefined) ACTION.doOnEvent(grid.defaultAction.execute(grid.defaultActionCtx, ev), ev);\n\t\t\t\t\t} else if (ev.key === \"Escape\") {\n\t\t\t\t\t\tprevent(ev);\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tinput.addEventListener('input', onInput);\n\t\t\tdocument.addEventListener('selectionchange', onInput);\n\t\t\tinput.addEventListener('dblclick', create, {once: true});\n\t\t\tinput.addEventListener('keydown', onKeyDown);\n\n\t\t\tinput.addEventListener('focusout', () => {\n\t\t\t\tinput.removeEventListener('input', onInput);\n\t\t\t\tdocument.removeEventListener('selectionchange', onInput);\n\t\t\t\tinput.removeEventListener('dblclick', create);\n\t\t\t\tinput.removeEventListener('keydown', onKeyDown);\n\t\t\t}, {once: true})\n\t\t});\n\t}\n}\n\nREG.reg.registerSkin('c-popup-autocomplete', 1, /* language=CSS */ `\n\t#content {\n\t\tdisplay: block;\n\t\tborder: solid 1px var(--tooltip-border-color);\n\t\tborder-radius: 3px;\n\t\tbox-shadow: 1px 1px 2px var(--fade-color);\n\t\tz-index: 101;\n\t\tuser-select: none;\n\t\t--row-bgcolor: var(--tooltip-bgcolor);\n\t\t--row-inSel-unfocus-bgcolor: var(--row-inSel-bgcolor);\n\t}\n`);\n\nREG.reg.registerSkin('c-popup-autocomplete/grid', 1, /* language=CSS */ `\n\t:host {\n\t\tborder: none;\n\t\tmax-height: 16em;\n\t\tmax-width: 16em;\n\t}\n`);\n\ncustomElements.define('c-popup-autocomplete', PopupAutoComplete);\n\n/**\n * Popup de confirmation (message et boutons Annuler,Ok)\n *\n * Les labels des boutons sont configurables.\n * Un slot 'details' est disponible pour enrichir le contenu de la boîte de dialogue.\n */\n\nexport interface PopupConfirm {\n\tinitialize(init?: OPopupConfirmInit): this;\n}\n\n/**\n * Configuration d'une boîte de dialogue de confirmation.\n * Mettre null cancelLbl pour faire un simple dialogue d'alerte avec un seul bouton.\n */\nexport interface OPopupConfirmInit extends OSkinableInit, OTitleBarPointer, OResizeObserverInit, OResizerPointer {\n\tkind?: 'question' | 'info' | 'warning' | 'error' | 'forbidden' | null\n\t/** Label pour le bouton OK/Valider */\n\tokLbl?: string;\n\t/** Label pour le bouton d'annulation. Si null, le bouton n'est pas affiché (revient à un dialogue d'alerte) */\n\tcancelLbl?: string | null;\n}\n\nexport class PopupConfirm extends MxPopupable(BaseElement, EPopupType.dialog) implements IPopupable<boolean>, IDomLogical {\n\n\tget kind(): 'question' | 'info' | 'warning' | 'error' | 'forbidden' | null {return this.getAttribute('kind') as any}\n\n\tset kind(k: 'question' | 'info' | 'warning' | 'error' | 'forbidden' | null) {\n\t\tDOM.setAttr(this, \"kind\", k);\n\t}\n\n\tokButton: Button;\n\tcancelButton: Button | null;\n\n\tprotected _contentNode: Element;\n\n\tprotected _initialize(init: OPopupConfirmInit) {\n\t\tsuper._initialize(init);\n\t\tthis.findReg(init).installSkin('webzone:panel', this.shadowRoot);\n\t\tif (init.kind) this.setAttribute('kind', init.kind);\n\t\tthis.contentRoot.appendChild(<slot name=\"details\"/>);\n\t\tconst actionsBar = this.contentRoot.appendChild(<slot name=\"actions\"/>);\n\t\tthis.okButton = actionsBar.appendChild(<c-button ui-context=\"dialog\" label={init.okLbl || (init.cancelLbl !== null ? \"OK\" : \"Fermer\")} class=\"default\" onclick={this.onOK}/>) as Button;\n\t\tif (init.cancelLbl !== null) this.cancelButton = actionsBar.appendChild(<c-button ui-context=\"dialog\" label={init.cancelLbl || \"Annuler\"} onclick={this.onCancel}/>) as Button;\n\t\tthis.onkeypress = this.onKeyPress;\n\t}\n\n\tprotected _builBodySlot() {\n\t\tthis._bodySlot = <slot id=\"body\"/> as HTMLSlotElement;\n\t\tthis.contentRoot.appendChild(<div id=\"msgBox\">\n\t\t\t<span id=\"kind\"/>\n\t\t\t{this._bodySlot}\n\t\t</div>);\n\t}\n\n\n\t/** Défini le contenu principal de la boîte de dialogue */\n\tsetContent(ct: string | Element): this {\n\t\tif (this._contentNode) this._contentNode.remove();\n\t\tif (typeof ct === 'string') {\n\t\t\tthis._contentNode = this.appendChild(<div class=\"msg\">{ct}</div>);\n\t\t} else {\n\t\t\tthis._contentNode = this.appendChild(ct);\n\t\t}\n\t\treturn this;\n\t}\n\n\tonOK(this: Button) {\n\t\tDOMSH.findHost<PopupConfirm>(this).tryClose(true);\n\t}\n\n\tonCancel(this: Button) {\n\t\tDOMSH.findHost<PopupConfirm>(this).tryClose(false);\n\t}\n\n\tonKeyPress(ev: KeyboardEvent) {\n\t\tif (ev.key === \"Enter\") this.tryClose(true);\n\t\telse if (ev.key === \"Escape\") this.tryClose(false);\n\t}\n}\n\nREG.reg.registerSkin('c-popup-confirm', 1, /* language=CSS */ `\n\t:host([opened]) {\n\t\tpointer-events: auto;\n\t\tbackground-color: rgba(0, 0, 0, .5);\n\t\tz-index: 1011;\n\t}\n\n\t#content {\n\t\tborder: 2px solid var(--dialog-bgcolor);\n\t\tbox-shadow: 1px 1px 4px var(--fade-color);\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t\tborder-radius: 5px;\n\t}\n\n\t#msgBox {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t}\n\n\t#body {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\toverflow: auto;\n\t\tmargin: .5em;\n\t}\n\n\t:host([kind='question']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: center no-repeat url(/@skin@/commons/widgets/popupable/question.svg);\n\t}\n\n\t:host([kind='info']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: center no-repeat url(/@skin@/commons/widgets/popupable/info.svg);\n\t}\n\n\t:host([kind='warning']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: center no-repeat url(/@skin@/commons/widgets/popupable/warning.svg);\n\t}\n\n\t:host([kind='error']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: center no-repeat url(/@skin@/commons/widgets/popupable/error.svg);\n\t}\n\n\t:host([kind='forbidden']) #kind {\n\t\tmin-width: 1.5em;\n\t\tmin-height: 1.5em;\n\t\tmargin: .5em;\n\t\tbackground: center no-repeat url(/@skin@/commons/widgets/popupable/forbidden.svg);\n\t}\n\n\t::slotted([slot=details]) {\n\t\tdisplay: block;\n\t\tmargin: .5em 2em;\n\t}\n\n\tslot[name=actions] {\n\t\tdisplay: flex;\n\t\tmin-height: min-content;\n\t\tmin-width: 0;\n\t\tflex-direction: row;\n\t\tjustify-content: flex-end;\n\t}\n\n\tslot[name=actions] > c-button {\n\t\tmargin: 1em .5em;\n\t}\n`);\n\ncustomElements.define('c-popup-confirm', PopupConfirm);\n\n/**\n * Configuration d'une boîte de dialogue d'invite\n */\nexport interface OPopupPromptInit extends OSkinableInit, OTitleBarPointer, OResizeObserverInit, OResizerPointer {\n\t/** Label pour le bouton OK/Valider */\n\tokLbl?: string;\n\t/** Label pour le bouton d'annulation. Si null, le bouton n'est pas affiché (revient à un dialogue d'alerte) */\n\tcancelLbl?: string | null;\n\t/** La valeur de l'input est-elle requise */\n\tinputRequired?: boolean;\n}\n\nexport class PopupPrompt extends MxPopupable(BaseElement, EPopupType.dialog) implements IPopupable<boolean>, IDomLogical {\n\n\tokButton: Button;\n\tcancelButton: Button;\n\n\tprotected _contentNode: Element;\n\n\tprotected _inputRequired: boolean;\n\n\tprotected _initialize(init: OPopupPromptInit) {\n\t\tsuper._initialize(init);\n\t\tthis._inputRequired = init.inputRequired;\n\t\tthis.contentRoot.appendChild(<slot name=\"details\"/>);\n\t\tconst actionsBar = this.contentRoot.appendChild(<slot name=\"actions\"/>);\n\t\tthis.okButton = actionsBar.appendChild(<c-button ui-context=\"dialog\" label={init.okLbl || \"OK\"} class=\"default\" onclick={this.onOK}/>) as Button;\n\t\tthis.cancelButton = actionsBar.appendChild(<c-button ui-context=\"dialog\" label={init.cancelLbl || \"Annuler\"} onclick={this.onCancel}/>) as Button;\n\t\tthis.onkeypress = this.onKeyPress;\n\t}\n\n\t/** Défini le contenu principal de la boîte de dialogue */\n\tsetContent(ct: string | Element): this {\n\t\tif (this._contentNode) this._contentNode.remove();\n\t\tif (typeof ct === 'string') {\n\t\t\tthis._contentNode = this.appendChild(<div class=\"content\">\n\t\t\t\t\t<div class=\"msg\">{ct}</div>\n\t\t\t\t\t<input required={this._inputRequired ? \"\" : undefined}/>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\tthis._contentNode = this.appendChild(ct);\n\t\t}\n\t\treturn this;\n\t}\n\n\tonOK(this: Button) {\n\t\tconst self = DOMSH.findHost<PopupPrompt>(this);\n\t\tconst input = self.querySelector(\"input\");\n\t\tif (input.reportValidity()) {\n\t\t\tself.tryClose(input.value);\n\t\t}\n\t}\n\n\tonCancel(this: Button) {\n\t\tDOMSH.findHost<PopupPrompt>(this).tryClose();\n\t}\n\n\tonKeyPress(ev: KeyboardEvent) {\n\t\tif (ev.key === \"Enter\") this.onOK.call(this.okButton)\n\t\telse if (ev.key === \"Escape\") this.tryClose();\n\t}\n}\n\nREG.reg.registerSkin('c-popup-prompt', 1, /* language=CSS */ `\n\t:host([opened]) {\n\t\tpointer-events: auto;\n\t\tbackground-color: rgba(0, 0, 0, .5);\n\t}\n\n\t#content {\n\t\tborder: 2px solid var(--dialog-bgcolor);\n\t\tbox-shadow: 1px 1px 4px var(--fade-color);\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t\tborder-radius: 5px;\n\t\tmin-width: 5em;\n\t\tmin-height: 2em;\n\t}\n\n\t#body {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\toverflow: auto;\n\t\tmargin: .5em;\n\t}\n\n\t::slotted(.content) {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tmin-width: 0;\n\t\tmin-height: 5em;\n\t\tjustify-content: space-evenly;\n\t}\n\n\t::slotted(.content) > * {\n\t\tmargin: 0.5em 0;\n\t}\n\n\t::slotted([slot=details]) {\n\t\tdisplay: block;\n\t\tmargin: .5em 2em;\n\t}\n\n\tslot[name=actions] {\n\t\tdisplay: flex;\n\t\tmin-height: min-content;\n\t\tmin-width: 0;\n\t\tflex-direction: row;\n\t\tjustify-content: flex-end;\n\t}\n\n\tslot[name=actions] > c-button {\n\t\tmargin: 1em .5em;\n\t}\n`);\n\ncustomElements.define('c-popup-prompt', PopupPrompt);\n\nexport namespace POPUP {\n\n\t/**\n\t * Affiche une boîte de dialogue de confirmation ou d'alerte si le bouton d'annulation est masqué\n\t * via les options.\n\t *\n\t * @param msg message ou noeud à afficher en tant que contenu de la boîte de dialogue\n\t * @param options Voir {@link OPopupConfirmInit}\n\t * @return Une promesse renvoyant true si validé, false si annulé.\n\t */\n\texport async function confirm(msg: string | Element, from: Node, options?: OPopupConfirmInit): Promise<boolean> {\n\t\tif (!options) options = {};\n\t\tif (!('kind' in options)) options.kind = options.cancelLbl !== null ? 'question' : 'info';\n\t\tconst popup = new PopupConfirm().initialize(options);\n\t\tpopup.setContent(msg);\n\n\t\tpopup.show({\n\t\t\tviewPortX: 'middle',\n\t\t\tviewPortY: '1/3',\n\t\t}, from);\n\t\treturn popup.onNextClose();\n\t}\n\n\t/**\n\t * Affiche une boîte de dialogue de confirmation ou d'alerte avec input de choix (ex: 'Ne plus afficher ce message').\n\t *\n\t *\n\t * @param msg message ou noeud à afficher en tant que contenu de la boîte de dialogue\n\t * @param checkLbl Label de l'input de choix\n\t * @param checkSt État initial de l'input de choix\n\t * @param options Voir {@link OPopupConfirmInit}\n\t * @return Une promesse renvoyant si le statut du checkbox (checked|unchecked) si le dialogue ou validé,\n\t *      false si annulé. La promesse n'est jamais rejetée.\n\t */\n\texport async function confirmCheck(msg: string | Element, from: Node, checkLbl: string, checkSt?: boolean, options?: OPopupConfirmInit): Promise<false | 'checked' | 'unchecked'> {\n\t\tif (!options) options = {};\n\t\tif (!('kind' in options)) options.kind = options.cancelLbl !== null ? 'question' : 'info';\n\t\tconst popup = new PopupConfirm().initialize(options);\n\t\tpopup.setContent(msg);\n\n\t\tconst input = <input type=\"checkbox\" checked={checkSt}/> as HTMLInputElement;\n\t\tinput.checked = checkSt;\n\t\tpopup.appendChild(<label slot=\"details\">\n\t\t\t{input}\n\t\t\t<span>{checkLbl}</span>\n\t\t</label>);\n\n\t\tpopup.show({\n\t\t\tviewPortX: 'middle',\n\t\t\tviewPortY: '1/3',\n\t\t}, from);\n\n\t\tconst result = await popup.onNextClose();\n\t\tif (result) return input.checked ? 'checked' : 'unchecked';\n\t\telse return false;\n\t}\n\n\t/** Affiche un menu-contextuel. */\n\texport function showPopupActions<C>(init: OPopupActionsInit<C>, anchor: OPopupAnchor, from: Node): Promise<Action<C>> {\n\t\tif (!init.actions || init.actions.length === 0) return Promise.resolve(null);\n\t\tconst popupMenu = new PopupActions<C>().initialize(init);\n\t\tpopupMenu.show(anchor, from);\n\t\treturn new Promise((resolve) => {\n\t\t\tpopupMenu.addEventListener('c-close', (ev: IPopupCloseEvent) => {\n\t\t\t\tresolve(ev.detail.returnValue);\n\t\t\t})\n\t\t});\n\t}\n\n\t/**\n\t * Affiche une boîte de dialogue de confirmation ou d'alerte si le bouton d'annulation est masqué\n\t * via les options.\n\t *\n\t * @param msg message ou noeud à afficher en tant que contenu de la boîte de dialogue\n\t * @param options Voir {@link OPopupConfirmInit}\n\t * @return Une promesse renvoyant true si validé, false si annulé.\n\t */\n\texport async function prompt(msg: string | Element, from: Node, options?: OPopupPromptInit): Promise<string> {\n\t\tconst popup = new PopupPrompt().initialize(options);\n\t\tpopup.setContent(msg);\n\n\t\tpopup.show({\n\t\t\tviewPortX: 'middle',\n\t\t\tviewPortY: '1/3',\n\t\t}, from);\n\t\treturn popup.onNextClose();\n\t}\n\n\t/**\n\t * Affiche un menu-contextuel positionné à partir de la position\n\t * de la souris d'un event ou, à défaut, de la position du target de l'event.\n\t *\n\t * @param fromContext Nécessaire si ev.target est issu d'un menu déconnecté pour retrouver la stack des dialogues courants.\n\t */\n\texport function showPopupActionsFromEvent<C>(init: OPopupActionsInit<C>, ev: Event | HTMLElement, fromContext?: HTMLElement): Promise<Action<C>> {\n\t\tif (ev instanceof MouseEvent && ev.pageX > 0 && ev.pageY > 0) {\n\t\t\treturn showPopupActions(init, {initX: ev.pageX, initY: ev.pageY}, fromContext || ev.target as Node);\n\t\t} else if (ev instanceof Event) {\n\t\t\treturn showPopupActions(init, fromContext || ev.target as HTMLElement, fromContext || ev.target as Node);\n\t\t} else {\n\t\t\treturn showPopupActions(init, ev, fromContext || ev);\n\t\t}\n\t}\n\n\t/** Affiche une fenêtre de dialogue modale. */\n\texport function showDialog<R = {}>(content: Node, from: Node, init?: OPopupDialogInit): IPopupable<R> {\n\t\tif (!init) init = {};\n\t\tconst dialog = new PopupDialog().initialize(init);\n\t\tdialog.usedOnce = true;\n\t\tdialog.appendChild(content);\n\t\tif (!init.viewPortY) init.viewPortY = '1/3';\n\t\tif (!('fixSize' in init)) init.fixSize = true;\n\t\tdialog.show(init, from);\n\t\treturn dialog;\n\t}\n\n\t/** Affiche une notification, non modale. */\n\texport function showNotif(content: string | Element, from: Node, init?: OPopupNotifInit | OPopupNotifActionsInit<any>, anchor?: OPopupAnchor): PopupNotif {\n\t\tif (!init) init = {};\n\t\tconst notif = 'actions' in init ? new PopupNotifActions() : new PopupNotif();\n\t\tif ('actions' in init && !('autoHide' in init)) init.autoHide = 0; //pas de timer d'effacement si actions.\n\t\tnotif.initialize(init);\n\t\tnotif.usedOnce = true;\n\t\tnotif.setContent(content);\n\t\tnotif.show(anchor, from);\n\t\treturn notif;\n\t}\n\n\t/** Affiche une notification, non modale avec une icone de type \"info\". */\n\texport function showNotifInfo(content: string | Element, from: Node, init?: OPopupNotifInit | OPopupNotifActionsInit<any>, anchor?: OPopupAnchor): PopupNotif {\n\t\tif (init) init.kind = \"info\";\n\t\telse init = {kind: \"info\"};\n\t\treturn showNotif(content, from, init, anchor);\n\t}\n\n\t/** Affiche une notification, non modale avec une icone de type \"alerte\". */\n\texport function showNotifWarning(content: string | Element, from: Node, init?: OPopupNotifInit | OPopupNotifActionsInit<any>, anchor?: OPopupAnchor): PopupNotif {\n\t\tif (init) init.kind = \"warning\";\n\t\telse init = {kind: \"warning\"};\n\t\treturn showNotif(content, from, init, anchor);\n\t}\n\n\t/** Affiche une notification, non modale avec une icone de type \"erreur\". */\n\texport function showNotifError(content: string | Element, from: Node, init?: OPopupNotifInit | OPopupNotifActionsInit<any>, anchor?: OPopupAnchor): PopupNotif {\n\t\tif (init) init.kind = \"error\";\n\t\telse init = {kind: \"error\"};\n\t\treturn showNotif(content, from, init, anchor);\n\t}\n\n\t/** Affiche une notification, non modale avec une icone de type \"interdit\". */\n\texport function showNotifForbidden(content: string | Element, from: Node, init?: OPopupNotifInit | OPopupNotifActionsInit<any>, anchor?: OPopupAnchor): PopupNotif {\n\t\tif (init) init.kind = \"forbidden\";\n\t\telse init = {kind: \"forbidden\"};\n\t\treturn showNotif(content, from, init, anchor);\n\t}\n\n\t/** Affiche une fenêtre flottante, non modale. */\n\texport function showFloating<R = {}>(content: Node | ((popup: PopupFloating) => Node), anchor: OPopupAnchor, fromContext: Node, init?: OPopupFloatingInit): IPopupable<R> {\n\t\tconst popup = new PopupFloating().initialize(init || {});\n\t\tpopup.usedOnce = true;\n\t\tpopup.appendChild(typeof content === \"function\" ? content(popup) : content);\n\t\tif (!('fixSize' in anchor) && !(anchor instanceof HTMLElement)) anchor.fixSize = true;\n\t\tpopup.show(anchor, fromContext);\n\t\treturn popup;\n\t}\n\n\t/**\n\t * Affiche une fenêtre flottante de progression d'un upload et/ou download...\n\t * Attention : non rattaché à son contexte applicatif (pas de logicalParent)\n\t *\n\t */\n\texport function showProgress(fromContext: Node, title: string, anchor?: OPopupAnchor): PopupProgress {\n\t\tconst popup = new PopupProgress().initialize({titleBar: {barLabel: {label: title}}});\n\t\tpopup.usedOnce = true;\n\t\tif (!anchor) anchor = {viewPortX: \"end\", viewPortY: \"top\", initWidth: \"20em\", initHeight: \"4em\"};\n\t\tif (!('fixSize' in anchor) && !(anchor instanceof HTMLElement)) anchor.fixSize = true;\n\t\tpopup.show(anchor, fromContext, null);\n\t\treturn popup;\n\t}\n\n\n\t/**\n\t *\n\t * @param fromContext Nécessaire si ev.target est issu d'un menu déconnecté pour retrouver la stack des dialogues courants.\n\t */\n\texport function showFloatingFromEvent<R = {}>(content: Node, ev: Event | HTMLElement, fromContext?: HTMLElement, init?: OPopupFloatingInit, initSize?: OInitSize): IPopupable<R> {\n\t\tconst anchor: OPopupAnchor = initSize ? initSize : {};\n\t\tif (ev instanceof MouseEvent && ev.pageX > 0 && ev.pageY > 0) {\n\t\t\t(anchor as OFixedPosition).initX = ev.pageX;\n\t\t\t(anchor as OFixedPosition).initY = ev.pageY;\n\t\t\treturn showFloating(content, anchor, fromContext || ev.target as Node, init);\n\t\t} else if (ev instanceof Event) {\n\t\t\t(anchor as OAroundPosition).elem = fromContext || ev.target as HTMLElement;\n\t\t\treturn showFloating(content, anchor, fromContext || ev.target as Node, init);\n\t\t} else {\n\t\t\t(anchor as OAroundPosition).elem = ev;\n\t\t\treturn showFloating(content, anchor, fromContext || ev as Node, init);\n\t\t}\n\t}\n\n\t/** Affiche un menu \"libre\", . */\n\texport function showMenu<R = {}>(content: Node, anchor: OPopupAnchor, fromContext: Node, init?: OPopupMenuInit): IPopupable<R> {\n\t\tif (init && init.titleBar && typeof init.titleBar !== \"string\" && !('closeButton' in init.titleBar)) init.titleBar.closeButton = null; //Suppr btn close par défaut.\n\t\tconst dialog = new PopupMenu().initialize(init);\n\t\tdialog.usedOnce = true;\n\t\tdialog.appendChild(content);\n\t\tdialog.show(anchor, fromContext);\n\t\treturn dialog;\n\t}\n\n\t/**\n\t *\n\t * @param fromContext Nécessaire si ev.target est issu d'un menu déconnecté pour retrouver la stack des dialogues courants.\n\t */\n\texport function showMenuFromEvent<R = {}>(content: Node, ev: Event | HTMLElement, fromContext?: HTMLElement, init?: OPopupMenuInit, initSize?: OInitSize): IPopupable<R> {\n\t\tconst anchor: OPopupAnchor = initSize ? initSize : {};\n\t\tif (ev instanceof MouseEvent && ev.pageX > 0 && ev.pageY > 0) {\n\t\t\t(anchor as OFixedPosition).initX = ev.pageX;\n\t\t\t(anchor as OFixedPosition).initY = ev.pageY;\n\t\t\treturn showMenu(content, anchor, fromContext || ev.target as Node, init);\n\t\t} else if (ev instanceof Event) {\n\t\t\t(anchor as OAroundPosition).elem = fromContext || ev.target as HTMLElement;\n\t\t\treturn showMenu(content, anchor, fromContext || ev.target as Node, init);\n\t\t} else {\n\t\t\t(anchor as OAroundPosition).elem = ev;\n\t\t\treturn showMenu(content, anchor, fromContext || ev as Node, init);\n\t\t}\n\t}\n\n\t/**\n\t * Associe un tooltip riche à un élément (sans l'afficher).\n\t * Le déclenchement au mouseover est géré automatiquement.\n\t */\n\texport function attachTooltip(owner: HTMLElement, content?: Node): PopupTooltip {\n\t\tconst tooltip = new PopupTooltip().initialize({tooltipOf: owner});\n\t\tif (content) tooltip.appendChild(content);\n\t\treturn tooltip;\n\t}\n\n\t/**\n\t * Attache un tooltip à un élément owner en limitant au maximum l'overhead\n\t * en retardant sa création à son réel affichage.\n\t *\n\t * Retourne une fonction qui peut être appelée pour affficher le tooltip prématurément.\n\t */\n\texport function promiseTooltip(owner: HTMLElement, contentBd: (owner: HTMLElement, tooltip: PopupTooltip) => Promise<IView | null> | IView | null, init?: OPopupTooltipInit): () => Promise<undefined | PopupTooltip> {\n\t\treturn mouseOverRetarderCaller<Promise<undefined | PopupTooltip>>(owner, true, async () => {\n\t\t\tif (!owner.isConnected) return;\n\t\t\tif (!init) init = {tooltipOf: owner};\n\t\t\telse {\n\t\t\t\tinit = Object.create(init);\n\t\t\t\tinit.tooltipOf = owner;\n\t\t\t}\n\t\t\tconst tooltip = new PopupTooltip().initialize(init);\n\t\t\tconst ct = await contentBd(owner, tooltip);\n\t\t\tif (!ct || !owner.isConnected) return;\n\t\t\ttooltip.appendChild(ct);\n\t\t\ttooltip.show(init.anchor || owner, owner);\n\t\t\treturn tooltip;\n\t\t});\n\t}\n\n\n\t/**\n\t * Appelle une callback après POPUP.TOOLTIP_retarder ms où la souris est restée au dessus de l'objet overElt.\n\t *\n\t * Retourne une fonction qui peut etre appelée pour exécuter la callback prématurément.\n\t */\n\texport function mouseOverRetarderCaller<T>(overElt: HTMLElement, doOnce: boolean, cb: () => T): () => T {\n\t\tlet timer: number;\n\t\tconst executor = function () {\n\t\t\tif (timer) {\n\t\t\t\twindow.clearTimeout(timer);\n\t\t\t\ttimer = 0;\n\t\t\t}\n\t\t\tif (doOnce) {\n\t\t\t\toverElt.removeEventListener('pointerenter', lstn);\n\t\t\t\toverElt.removeEventListener('pointerleave', lstn);\n\t\t\t\toverElt.removeEventListener('pointercancel', lstn);\n\t\t\t}\n\t\t\treturn cb();\n\t\t};\n\t\tconst lstn = function (ev: MouseEvent) {\n\t\t\tif (timer) {\n\t\t\t\twindow.clearTimeout(timer);\n\t\t\t\ttimer = 0;\n\t\t\t}\n\t\t\tif (ev.type === 'pointerenter') timer = window.setTimeout(executor, POPUP.TOOLTIP_retarder);\n\t\t};\n\t\toverElt.addEventListener('pointerenter', lstn);\n\t\toverElt.addEventListener('pointerleave', lstn);\n\t\toverElt.addEventListener('pointercancel', lstn);\n\t\treturn executor;\n\t}\n\n\texport async function closeAllPopup(logicalRoot: Node): Promise<boolean> {\n\t\tfor (const child of Array.from(document.body.children)) {\n\t\t\tif (IS_Popupable(child) && DOMSH.isLogicalFlatAncestor(logicalRoot, child)) {\n\t\t\t\tif (!await child.tryClose()) return false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\texport let findPopupableParent = findPopupableParentImp;\n\n\t/** Délai avant affichage d'un tooltip. */\n\texport let TOOLTIP_retarder = 800;\n}\n"]}