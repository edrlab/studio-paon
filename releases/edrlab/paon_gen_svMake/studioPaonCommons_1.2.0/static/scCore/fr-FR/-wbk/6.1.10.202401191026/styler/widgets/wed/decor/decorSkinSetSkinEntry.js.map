{"version":3,"sources":["/@back@/styler/widgets/wed/decor/decorSkinSetSkinEntry.tsx"],"names":["WedletFork","ENodeType","JSX","REG","XA","DOMSH","SkinClassStlPreview","DecorPreviewSkinEntryInSkinset","HTMLElement","[object Object]","this","redrawPending","tpl","wedlet","DecorPreviewSkinEntryInSkinsetWedlet","reg","wedMgr","sr","attachShadow","SHADOWDOM_INIT","installSkin","localName","val","children","redraw","docHolder","shadowRoot","innerHTML","node","findDomLast","wedAnchor","getDocument","nodeType","element","skinRefUri","getAttribute","longDesc","env","wsp","fetchLongDesc","skinClassStlCode","itAttr_skClassStl","appendChild","createElement","î","shortDesc","registerSkin","window","customElements","define","elt","mainWedlet","super","futureTask","msg"],"mappings":"OAAiCA,eAAW;OACpCC,UAAWC,QAAI;OACTC,QAAI;OACVC,OAAG;OAEHC,UAAM;OAENC,wBAAoB;AAM5B,MAAMC,uCAAuCC,YAA7CC;AAiBSC,KAAAC,cAAgB,MAXxBF,gBAAgBG,IAAcC,QAC7BH,KAAKG,OAAS,IAAIC,qCAAqCJ,KAAMG;AAC7DH,KAAKK,IAAMF,OAAOG,OAAOD;AACzB,MAAME,GAAKP,KAAKQ,aAAab,MAAMc;AACnCT,KAAKK,IAAIK,YAAYV,KAAKW,UAAWJ,IAGtCR,iBAAiBa,IAA+BC,UAC/Cb,KAAKc,SAKNf,eACC,GAAIC,KAAKC,cAAe;AACxB,IACCD,KAAKC,cAAgB;AACrB,MAAMK,OAASN,KAAKG,OAAOG;AAC3B,MAAMS,UAAYT,OAAOS;AACzB,MAAMR,GAAKP,KAAKgB;AAChBT,GAAGU,UAAY;AACf,MAAMC,KAAaxB,GAAGyB,YAAYnB,KAAKG,OAAOiB,UAAWL,UAAUM;AACnE,IAAIH,OAAI,MAAJA,YAAI,OAAA,EAAJA,KAAMI,YAAa/B,UAAUgC,QAAS,CACzC,MAAMC,WAAcN,KAAiBO,aAAa;AAClD,GAAID,WAAY,CACf,MAAME,eAAiB1B,KAAKK,IAAIsB,IAAIC,IAAIC,cAAcL;AACtD,MAAMM,iBAAoBJ,SAAiBK;AAC3C,GAAID,iBAAkB,CACrBvB,GAAGU,UAAY;AACfV,GAAGyB,YAAYxC,IAAAyC,cAACrC,oBAAmB,CAAAsC,IAAI,CACtC7B,IAAKL,KAAKK,IACV8B,UAAWT,wBAOf1B,KAAKC,cAAgB,QAKxBR,IAAIY,IAAI+B,aAAa,iCAAkC,EAAsB;AAI7EC,OAAOC,eAAeC,OAAO,iCAAkC1C;AAG/D,MAAMO,6CAA6Cd,WAIlDS,YAAmByC,IAAqCC,YAAsBC,MAAMD;AAAjEzC,KAAAwC,IAAAA;AAFnBxC,KAAA2C,WAAa,EAIb5C,oBAAoB6C,KACnB5C,KAAKwC,IAAI1B","sourcesContent":["import {IElementWedlet, IWedlet, WedletFork} from \"back/edit/wed/wedlets/wedlet\";\nimport {ENodeType, JSX} from \"lib/commons/xml/dom\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {XA} from \"lib/commons/xml/xAddr\";\nimport {IXmlMsg} from \"lib/edit/ot/xmlHouse\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {IJmlNode, IJmlSubSet} from \"lib/commons/xml/jml\";\nimport {SkinClassStlPreview} from \"../../previews\";\nimport {IWspUiEnv} from \"lib/wsp/wsp\";\n\n/**\n * Skinset : bandeau des propriétés d'une entrée de skin\n */\nclass DecorPreviewSkinEntryInSkinset extends HTMLElement implements IElementWedlet {\n\n\twedlet: DecorPreviewSkinEntryInSkinsetWedlet;\n\n\tprotected reg: IReg<IWspUiEnv>;\n\n\tconfigWedletElt(tpl: Element, wedlet: IWedlet): void {\n\t\tthis.wedlet = new DecorPreviewSkinEntryInSkinsetWedlet(this, wedlet);\n\t\tthis.reg = wedlet.wedMgr.reg;\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis.reg.installSkin(this.localName, sr);\n\t}\n\n\trefreshBindValue(val: IJmlNode | string | null, children?: IJmlSubSet) {\n\t\tthis.redraw();\n\t}\n\n\tprivate redrawPending = false;\n\n\tasync redraw() {\n\t\tif (this.redrawPending) return;\n\t\ttry {\n\t\t\tthis.redrawPending = true;\n\t\t\tconst wedMgr = this.wedlet.wedMgr;\n\t\t\tconst docHolder = wedMgr.docHolder;\n\t\t\tconst sr = this.shadowRoot;\n\t\t\tsr.innerHTML = \"\";\n\t\t\tconst node: Node = XA.findDomLast(this.wedlet.wedAnchor, docHolder.getDocument());\n\t\t\tif (node?.nodeType === ENodeType.element) {\n\t\t\t\tconst skinRefUri = (node as Element).getAttribute(\"sc:refUri\");\n\t\t\t\tif (skinRefUri) {\n\t\t\t\t\tconst longDesc = await this.reg.env.wsp.fetchLongDesc(skinRefUri);\n\t\t\t\t\tconst skinClassStlCode = (longDesc as any).itAttr_skClassStl;\n\t\t\t\t\tif (skinClassStlCode) {\n\t\t\t\t\t\tsr.innerHTML = \"\";\n\t\t\t\t\t\tsr.appendChild(<SkinClassStlPreview î={{\n\t\t\t\t\t\t\treg: this.reg,\n\t\t\t\t\t\t\tshortDesc: longDesc,\n\t\t\t\t\t\t}}/>);\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.redrawPending = false;\n\t\t}\n\t}\n}\n\nREG.reg.registerSkin('decor-styler-skinset-skinentry', 1, /* language=CSS */ `\n\n`);\n\nwindow.customElements.define(\"decor-styler-skinset-skinentry\", DecorPreviewSkinEntryInSkinset);\n\n\nclass DecorPreviewSkinEntryInSkinsetWedlet extends WedletFork {\n\n\tfutureTask = 0;\n\n\tconstructor(public elt: DecorPreviewSkinEntryInSkinset, mainWedlet: IWedlet) {super(mainWedlet)}\n\n\tupdateInDescendants(msg: IXmlMsg) {\n\t\tthis.elt.redraw();\n\t}\n\n}"]}