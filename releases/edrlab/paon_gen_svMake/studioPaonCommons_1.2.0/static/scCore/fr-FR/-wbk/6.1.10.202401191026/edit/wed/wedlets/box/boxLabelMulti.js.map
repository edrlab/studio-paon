{"version":3,"sources":["/@back@/edit/wed/wedlets/box/boxLabelMulti.ts"],"names":["WEDLET","BoxLabel","DOM","BoxLabelMulti","[object Object]","tpl","wedlet","this","labelAdjuster","labels","ch","firstElementChild","nextElementSibling","localName","push","hostAtt","getAttribute","labelAdjust","bind","model","wedParent","addCustomAdjust","val","classList","toggle","isVirtual","window","customElements","define","parent","counter","visitWedletChildren","Infinity","w","nodeName","nodeType","label","undefined","length","findNext","element","shadowRoot","n","setTextContent","textContent","setAttr","VISITOPTIONS_includeVirtuals"],"mappings":"OAA8CA,WAAO;OAC7CC,aAAS;OAGTC,QAAI;OAwBN,MAAOC,sBAAsBF,SAIlCG,gBAAgBC,IAAsCC,QACrDC,KAAKD,OAASA;AACdC,KAAKF,IAAMA;AACX,IAAKA,IAAIG,cAAe,CACvB,MAAMC,OAA6B;AACnC,IAAK,IAAIC,GAAKL,IAAIM,kBAAmBD,GAAIA,GAAKA,GAAGE,mBAAoB,CACpE,GAAIF,GAAGG,YAAc,QAASJ,OAAOK,KAAKJ,IAE3CL,IAAII,OAASA;AACbJ,IAAIU,QAAUV,IAAIW,aAAa;AAC/BX,IAAIG,cAAgBS,YAAYC,KAAKb,IAAKC,OAAOa,OAEjDb,OAAOc,UAAwBC,gBAAgBhB,IAAIG,eAGrDJ,iBAAiBkB,KAChBf,KAAKgB,UAAUC,OAAO,UAAWjB,KAAKD,OAAOmB,cAI/CC,OAAOC,eAAeC,OAAO,kBAAmBzB;AAShD,SAASc,YAAyCE,MAAqBU,QACtE,IAAIC,QAAU;AACdD,OAAOE,oBAAoB,EAAGC,SAAWC,IACxC,GAAIA,EAAEd,MAAMe,WAAaf,MAAMe,UAAYD,EAAEd,MAAMgB,WAAahB,MAAMgB,SAAU,CAC/E,IAAIC,MAAQ7B,KAAKE,OAAOqB;AACxB,GAAIM,QAAUC,UAAWD,MAAQ7B,KAAKE,OAAOF,KAAKE,OAAO6B,OAAS;AAClEpC,IAAIqC,SAASN,EAAEO,QAAQC,WAAY,KAAOC,IACzC,GAAIA,aAAavC,eAAiBuC,EAAErC,MAAQE,KAAM,CACjDL,IAAIyC,eAAeD,EAAGN,MAAMQ;AAC5B1C,IAAI2C,QAAQH,EAAG,QAASN,MAAMpB,aAAa;AAC3C,OAAO,KAER,OAAO;AAER,GAAIT,KAAKQ,QAAS,CACjB,IAAIO,IAAMc,MAAMpB,aAAa;AAC7B,GAAIM,KAAO,KAAMA,IAAMf,KAAKE,OAAOF,KAAKE,OAAO6B,OAAS,GAAGtB,aAAa;AACxEd,IAAI2C,QAAQZ,EAAEO,QAASjC,KAAKQ,QAASO,KAEtCQ,YAEC9B,OAAO8C","sourcesContent":["import {IChildWedlet, IParentWedlet, IWedlet, WEDLET} from \"back/edit/wed/wedlets/wedlet\";\nimport {BoxLabel} from \"back/edit/wed/wedlets/box/boxTags\";\nimport {BoxWedlet} from \"back/edit/wed/wedlets/box/box\";\nimport {IWedletModel} from \"back/edit/wed/wedCore\";\nimport {DOM} from \"lib/commons/xml/dom\";\nimport {IWedletSingleElt} from \"back/edit/wed/wedlets/wedletSingleElt\";\nimport {IJmlNode} from \"lib/commons/xml/jml\";\n\n/**\n * Affichage d'un label différent en fonction de la position de cet élement dans son contexte parent.\n * La position est calculée par rapport aux frères précédents du même modèle de wedlet.\n *\n * <wed:bind eltName=\"x:y\" wedlet=\"Box\">\n *  <box-ctn>\n *    <style>...</style>\n *    <div class=\"head\">\n *      <box-label-multi setHostAtt=\"x-pos\">\n *        <label hostAtt=\"first\">Label 1ère instance du bind</label>\n *        <label hostAtt=\"2\">Label 2ème instance du bind</label>\n *        <label hostAtt=\"next\">Label des instances suivantes du bind</label>\n *      </box-label-multi>\n *    </div>\n *    <div class=\"body\">\n *      <wed:children/>\n *    </div>\n *  </box-ctn>\n * </wed:bind>\n */\nexport class BoxLabelMulti extends BoxLabel {\n\n\ttpl: ILabelAdjusterPointer;\n\n\tconfigWedletElt(tpl: Element & ILabelAdjusterPointer, wedlet: IWedlet) {\n\t\tthis.wedlet = wedlet;\n\t\tthis.tpl = tpl;\n\t\tif (!tpl.labelAdjuster) {\n\t\t\tconst labels: HTMLLabelElement[] = [];\n\t\t\tfor (let ch = tpl.firstElementChild; ch; ch = ch.nextElementSibling) {\n\t\t\t\tif (ch.localName === \"label\") labels.push(ch as HTMLLabelElement);\n\t\t\t}\n\t\t\ttpl.labels = labels;\n\t\t\ttpl.hostAtt = tpl.getAttribute(\"setHostAtt\");\n\t\t\ttpl.labelAdjuster = labelAdjust.bind(tpl, wedlet.model);\n\t\t}\n\t\t(wedlet.wedParent as BoxWedlet).addCustomAdjust(tpl.labelAdjuster);\n\t}\n\n\trefreshBindValue(val: IJmlNode) {\n\t\tthis.classList.toggle(\"virtual\", this.wedlet.isVirtual());\n\t}\n}\n\nwindow.customElements.define(\"box-label-multi\", BoxLabelMulti);\n\ninterface ILabelAdjusterPointer extends Element {\n\tlabelAdjuster?: (w: BoxWedlet) => void\n\tlabels?: HTMLLabelElement[]\n\thostAtt?: string\n}\n\n/** Appelé à chaque changement dans le contexte parent. */\nfunction labelAdjust(this: ILabelAdjusterPointer, model: IWedletModel, parent: BoxWedlet & IParentWedlet) {\n\tlet counter = 0;\n\tparent.visitWedletChildren(0, Infinity, (w: IChildWedlet & IWedletSingleElt) => {\n\t\tif (w.model.nodeName === model.nodeName && w.model.nodeType === model.nodeType) {\n\t\t\tlet label = this.labels[counter];\n\t\t\tif (label === undefined) label = this.labels[this.labels.length - 1];\n\t\t\tDOM.findNext(w.element.shadowRoot, null, (n: Node): n is Node => {\n\t\t\t\tif (n instanceof BoxLabelMulti && n.tpl === this) {\n\t\t\t\t\tDOM.setTextContent(n, label.textContent);\n\t\t\t\t\tDOM.setAttr(n, \"title\", label.getAttribute(\"title\"));\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tif (this.hostAtt) {\n\t\t\t\tlet val = label.getAttribute(\"hostAtt\");\n\t\t\t\tif (val == null) val = this.labels[this.labels.length - 1].getAttribute(\"hostAtt\");\n\t\t\t\tDOM.setAttr(w.element, this.hostAtt, val);\n\t\t\t}\n\t\t\tcounter++;\n\t\t}\n\t}, WEDLET.VISITOPTIONS_includeVirtuals);\n}"]}