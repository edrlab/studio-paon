{"version":3,"sources":["/@back@/edit/wed/wedlets/box/boxUrlCtrl.tsx"],"names":["WEDLET","DOMSH","Button","JSX","REG","REMOTE","JML","LANG","BoxInput","BoxInputUrl","[object Object]","tpl","wedlet","this","dispatchMode","super","configWedletElt","sr","attachShadow","SHADOWDOM_INIT","installSkins","hasChildNodes","cloneSimpleContent","focusableElement","shadowRoot","querySelector","appendChild","createElement","type","isCaretInput","setAttribute","window","customElements","define","BoxUrlCtrl","HTMLElement","modeAuto","getAttribute","_statusMarker","className","_refreshBtn","disabled","_oldXmlChars","title","report","checkUrl","wedMgr","reg","status","desc","id","icon","ui-context","onclick","onRefresh","localName","append","refreshStatus","clearStatus","val","jmlNode2value","onChange","from","chars","msg","stringInsert","len","stringDelete","findHost","registerSkin"],"mappings":"OAAiCA,WAAO;OAChCC,UAAM;OACNC,WAAO;OACPC,QAAI;OACJC,QAAI;OACJC,WAAO;OACGC,QAAI;OAEdC,SAAK;OACLC,aAAS;OAGX,MAAOC,oBAAoBD,SAEhCE,gBAAgBC,IAAcC,QAC7BC,KAAKC,aAAe;AACpBC,MAAMC,gBAAgBL,IAAKC,QAGlBF,cAAcC,KACvB,MAAMM,GAAKJ,KAAKK,aAAajB,MAAMkB;AACnCnB,OAAOoB,aAAaT,IAAKM,GAAIJ,KAAKD,OAAQ;AAC1C,GAAID,IAAIU,gBAAiB,CACxBrB,OAAOsB,mBAAmBL,GAAIN;AAC9BE,KAAKU,iBAAmBV,KAAKW,WAAWC,cAAc,gBAEvD,IAAKZ,KAAKU,iBAAkBV,KAAKU,iBAAmBN,GAAGS,YAAYvB,IAAAwB,cAAA,QAAA,CAAOC,KAAK;AAC/E,GAAIf,KAAKgB,eAAgBhB,KAAKiB,aAAa,YAAa,UAI1DC,OAAOC,eAAeC,OAAO,gBAAiBxB;OAKxC,MAAOyB,mBAAmBC,YAO/BC,eAAgB,OAAOvB,KAAKwB,aAAa,kBAAoB,OAE7D3B,cACCG,KAAKyB,cAAcC,UAAY;AAC/B1B,KAAK2B,YAAYC,UAAY5B,KAAK6B,aAGnChC,sBACC,IAAKG,KAAK6B,aAAc;AACxB7B,KAAK2B,YAAYC,SAAW;AAC5B5B,KAAKyB,cAAcC,UAAY;AAC/B1B,KAAKyB,cAAcK,MAAQ;AAC3B,MAAMC,aAAevC,OAAOwC,SAAShC,KAAK6B,aAAc7B,KAAKD,OAAOkC,OAAOC;AAC3ElC,KAAK2B,YAAYC,SAAW;AAC5B5B,KAAKyB,cAAcC,UAAYK,OAAOI;AACtCnC,KAAKyB,cAAcK,MAAQC,OAAOK,KAGnCvC,gBAAgBC,IAAcC,QAC7BC,KAAKD,OAASA;AACdC,KAAK2B,YAAcrC,IAAAwB,cAACzB,OAAM,CAACgD,GAAG,UAAUC,KAAK,oCAAmCC,aAAY,MAAMC,QAASxC,KAAKyC;AAChHzC,KAAKyB,cAAgBnC,IAAAwB,cAAA,MAAA,CAAKuB,GAAG;AAC7B,MAAMjC,GAAKJ,KAAKK,aAAajB,MAAMkB;AACnCnB,OAAOoB,aAAaT,IAAKM,GAAIL,OAAQC,KAAK0C;AAC1CtC,GAAGuC,OAAO3C,KAAK2B,YAAa3B,KAAKyB,eAGxB5B,WACT,GAAIG,KAAKuB,SAAUvB,KAAK4C;KACnB5C,KAAK6C,cAGXhD,iBAAiBiD,KAChB9C,KAAK6B,aAAepC,IAAIsD,cAAcD,MAAQ;AAC9C9C,KAAKgD,WAGNnD,YAAYoD,KAAcC,MAAeC,KACxCnD,KAAK6B,aAAenC,KAAK0D,aAAapD,KAAK6B,aAAcoB,KAAMC;AAC/DlD,KAAKgD,WAGNnD,YAAYoD,KAAcI,IAAaF,KACtCnD,KAAK6B,aAAenC,KAAK4D,aAAatD,KAAK6B,aAAcoB,KAAMI;AAC/DrD,KAAKgD,WAGNnD,aAAaqD,MAAeC,KAC3BnD,KAAK6B,aAAeqB;AACpBlD,KAAKgD,WAGNnD,YACCT,MAAMmE,SAAqBvD,MAAM4C,iBAInCrD,IAAI2C,IAAIsB,aAAa,eAAgB,EAAsB;AA0C3DtC,OAAOC,eAAeC,OAAO,eAAgBC","sourcesContent":["import {IElementWedlet, IWedlet, WEDLET} from \"back/edit/wed/wedlets/wedlet\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {Button} from \"back/commons/widgets/buttons\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {REG} from \"lib/commons/registry\";\nimport {REMOTE} from \"lib/core/remote\";\nimport {IJmlNode, JML} from \"lib/commons/xml/jml\";\nimport {IXmlMsg} from \"lib/edit/ot/xmlHouse\";\nimport {LANG} from \"lib/commons/lang\";\nimport {BoxInput} from \"back/edit/wed/wedlets/box/boxTags\";\n\n\nexport class BoxInputUrl extends BoxInput {\n\n\tconfigWedletElt(tpl: Element, wedlet: IWedlet) {\n\t\tthis.dispatchMode = \"blur\";\n\t\tsuper.configWedletElt(tpl, wedlet);\n\t}\n\n\tprotected _createShadow(tpl: Element) {\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tWEDLET.installSkins(tpl, sr, this.wedlet, 'box-input');\n\t\tif (tpl.hasChildNodes()) {\n\t\t\tWEDLET.cloneSimpleContent(sr, tpl);\n\t\t\tthis.focusableElement = this.shadowRoot.querySelector(\"input,.input\");\n\t\t}\n\t\tif (!this.focusableElement) this.focusableElement = sr.appendChild(<input type=\"url\"/>);\n\t\tif (this.isCaretInput()) this.setAttribute(\"edit-mode\", \"caret\");\n\t}\n}\n\nwindow.customElements.define(\"box-input-url\", BoxInputUrl);\n\n/**\n *  Permet le lancement de la v√©rification d'une URL et l'affichage du statut du rapport.\n */\nexport class BoxUrlCtrl extends HTMLElement implements IElementWedlet {\n\twedlet: IWedlet;\n\n\t_oldXmlChars: string;\n\t_statusMarker: HTMLDivElement;\n\t_refreshBtn: Button;\n\n\tget modeAuto() {return this.getAttribute(\"refresh-mode\") === \"auto\"}\n\n\tclearStatus() {\n\t\tthis._statusMarker.className = '';\n\t\tthis._refreshBtn.disabled = !this._oldXmlChars;\n\t}\n\n\tasync refreshStatus() {\n\t\tif (!this._oldXmlChars) return;\n\t\tthis._refreshBtn.disabled = true;\n\t\tthis._statusMarker.className = 'pending';\n\t\tthis._statusMarker.title = \"Validation en cours...\";\n\t\tconst report = await REMOTE.checkUrl(this._oldXmlChars, this.wedlet.wedMgr.reg);\n\t\tthis._refreshBtn.disabled = false;\n\t\tthis._statusMarker.className = report.status;\n\t\tthis._statusMarker.title = report.desc;\n\t}\n\n\tconfigWedletElt(tpl: Element, wedlet: IWedlet) {\n\t\tthis.wedlet = wedlet;\n\t\tthis._refreshBtn = <Button id=\"refresh\" icon=\"/@skin@/commons/icons/refresh.svg\" ui-context=\"bar\" onclick={this.onRefresh}/> as Button;\n\t\tthis._statusMarker = <div id=\"status\"/> as HTMLDivElement;\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tWEDLET.installSkins(tpl, sr, wedlet, this.localName);\n\t\tsr.append(this._refreshBtn, this._statusMarker);\n\t}\n\n\tprotected onChange() {\n\t\tif (this.modeAuto) this.refreshStatus();\n\t\telse this.clearStatus();\n\t}\n\n\trefreshBindValue(val: IJmlNode) {\n\t\tthis._oldXmlChars = JML.jmlNode2value(val) || \"\";\n\t\tthis.onChange();\n\t}\n\n\tinsertChars(from: number, chars: string, msg: IXmlMsg) {\n\t\tthis._oldXmlChars = LANG.stringInsert(this._oldXmlChars, from, chars);\n\t\tthis.onChange();\n\t}\n\n\tdeleteChars(from: number, len: number, msg: IXmlMsg) {\n\t\tthis._oldXmlChars = LANG.stringDelete(this._oldXmlChars, from, len);\n\t\tthis.onChange();\n\t}\n\n\treplaceChars(chars: string, msg: IXmlMsg) {\n\t\tthis._oldXmlChars = chars;\n\t\tthis.onChange();\n\t}\n\n\tonRefresh(this: Button) {\n\t\tDOMSH.findHost<BoxUrlCtrl>(this).refreshStatus();\n\t}\n}\n\nREG.reg.registerSkin('box-url-ctrl', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-width: 0;\n\t\tmin-height: 0;\n\t\talign-items: center;\n\t}\n\n\t::slotted(*) {\n\t\tflex: 1;\n\t}\n\n\t#refresh {\n\t\tpadding: 0;\n\t\t--icon-size: 1em;\n\t}\n\n\t#status {\n\t\twidth: 10px;\n\t\theight: 10px;\n\t\tbackground-repeat: no-repeat;\n\t}\n\n\t#status.pending {\n\t\tbackground-image: url(/@skin@/edit/wed/urlCtrl/pending.svg);\n\t}\n\n\t#status.ok {\n\t\tbackground-image: url(/@skin@/edit/wed/urlCtrl/ok.svg);\n\t}\n\n\t#status.auth,\n\t#status.invalid,\n\t#status.net {\n\t\tbackground-image: url(/@skin@/edit/wed/urlCtrl/warn.svg);\n\t}\n\n\t#status.error {\n\t\tbackground-image: url(/@skin@/edit/wed/urlCtrl/error.svg);\n\t}\n`);\n\nwindow.customElements.define(\"box-url-ctrl\", BoxUrlCtrl);\n"]}