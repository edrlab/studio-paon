{"version":3,"sources":["/@back@/edit/wed/wedlets/box/boxUpProperty.ts"],"names":["isWedletSingleElt","BoxUpProperty","HTMLElement","[object Object]","super","this","style","userSelect","tpl","wedlet","propertyName","getAttribute","upSelector","val","textContent","findAttributeValue","window","customElements","define","attributeName","axePos","indexOf","axe","substring","minLevel","maxLevel","bounds","parseInt","i","wedParent","lastFindPlaceholder","element","up"],"mappings":"OACQA,sBAAkB;OAYpB,MAAOC,sBAAsBC,YAQlCC,cACCC;AACAC,KAAKC,MAAMC,WAAa,OAGzBJ,gBAAgBK,IAAcC,QAC7BJ,KAAKI,OAASA;AACdJ,KAAKK,aAAeF,IAAIG,aAAa;AACrCN,KAAKO,WAAaJ,IAAIG,aAAa,cAGpCR,iBAAiBU,KAChBR,KAAKS,YAAcC,mBAAmBV,KAAKI,OAAQJ,KAAKK,aAAcL,KAAKO,aAI7EI,OAAOC,eAAeC,OAAO,kBAAmBjB;AAEhD,SAASc,mBAAmBN,OAAiBU,cAAuBP,YACnE,MAAMQ,OAASR,WAAWS,QAAQ;AAClC,GAAID,SAAW,EAAG,CACjB,MAAME,IAAMV,WAAWW,UAAU,EAAGH;AACpC,IAAII;AACJ,IAAIC;AACJ,MAAMC,OAASd,WAAWW,UAAUH,OAAS;AAC7C,GAAIM,OAAOL,QAAQ,MAAQ,EAAG,CAC7BG,SAAWG,SAASD,OAAOH,UAAU,EAAGG,OAAOL,QAAQ,MAAO;AAC9DI,SAAWE,SAASD,OAAOH,UAAUG,OAAOL,QAAQ,KAAO,GAAI,QACzD,CACNG,SAAW;AACXC,SAAWE,SAASD,OAAQ,IAE7B,OAAQJ,KACR,IAAK,OACJ,IAAK,IAAIM,EAAI,EAAGnB,QAAUmB,EAAIJ,SAAUI,IAAKnB,OAASA,OAAOoB;AAC7D,IAAIC,oBAAsB;AAC1B,IAAK,IAAIF,EAAIJ,SAAUf,QAAUmB,EAAIH,SAAUG,IAAK,CACnDnB,OAASA,OAAOoB;AAChB,GAAIpB,QAAUT,kBAAkBS,SAAWA,OAAOsB,QAAQpB,aAAaQ,eACtEW,oBAAsBrB,OAAOsB,QAAQpB,aAAaQ,eAEpD,OAAOW;AACP;AACD,IAAK,KACJ,IAAK,IAAIF,EAAI,EAAGnB,QAAUmB,EAAIJ,SAAUI,IAAKnB,OAASA,OAAOoB;AAC7D,IAAK,IAAID,EAAIJ,SAAUf,QAAUmB,EAAIH,SAAUG,IAAK,CACnD,GAAInB,QAAUT,kBAAkBS,SAAWA,OAAOsB,QAAQpB,aAAaQ,eAAgB,CACtF,OAAOV,OAAOsB,QAAQpB,aAAaQ,eAEpCV,OAASA,OAAOoB,UAEjB;AACD,QACC,KAAM,oBAAsBjB,gBAEvB,CACN,MAAMoB,GAAKL,SAASf,WAAY;AAChC,IAAK,IAAIgB,EAAI,EAAGnB,QAAUmB,EAAII,GAAIJ,IAAKnB,OAASA,OAAOoB;AACvD,GAAIpB,QAAUT,kBAAkBS,QAC/B,OAAOA,OAAOsB,QAAQpB,aAAaQ","sourcesContent":["import {IElementWedlet, IWedlet} from \"back/edit/wed/wedlets/wedlet\";\nimport {isWedletSingleElt} from \"back/edit/wed/wedlets/wedletSingleElt\";\nimport {IJmlNode} from \"lib/commons/xml/jml\";\n\n/**\n *  Recherche la valeur d'un attribut dans l'élément racine des ascendants du wedlet courant\n *    <box-up-property name=\"placeholder\" upSelector=\"down:4\"/>\n *  Selecteur :\n *      upSelector=\"5\"         att spécifié en remontant 5 niveaux\n *      upSelector=\"down:4\"    premier att non vide en partant de la position 4, et en redescendant jusqu'à la position courant\n *      upSelector=\"down:4:2\"  premier att non vide en partant de la position 4, et en redescendant jusqu'à la position 2\n *      upSelector=\"up:2:4\"    premier att non vide en partant de la position 2, et en remontant jusqu'à la position 4\n */\nexport class BoxUpProperty extends HTMLElement implements IElementWedlet {\n\n\twedlet: IWedlet;\n\n\tpropertyName: string;\n\n\tupSelector: string;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.style.userSelect = \"none\";\n\t}\n\n\tconfigWedletElt(tpl: Element, wedlet: IWedlet) {\n\t\tthis.wedlet = wedlet;\n\t\tthis.propertyName = tpl.getAttribute(\"name\");\n\t\tthis.upSelector = tpl.getAttribute(\"upSelector\");\n\t}\n\n\trefreshBindValue(val: IJmlNode) {\n\t\tthis.textContent = findAttributeValue(this.wedlet, this.propertyName, this.upSelector);\n\t}\n}\n\nwindow.customElements.define(\"box-up-property\", BoxUpProperty);\n\nfunction findAttributeValue(wedlet: IWedlet, attributeName: string, upSelector: string) {\n\tconst axePos = upSelector.indexOf(\":\");\n\tif (axePos != -1) {\n\t\tconst axe = upSelector.substring(0, axePos);\n\t\tlet minLevel;\n\t\tlet maxLevel;\n\t\tconst bounds = upSelector.substring(axePos + 1);\n\t\tif (bounds.indexOf(\":\") > -1) {\n\t\t\tminLevel = parseInt(bounds.substring(0, bounds.indexOf(\":\")), 10);\n\t\t\tmaxLevel = parseInt(bounds.substring(bounds.indexOf(\":\") + 1), 10);\n\t\t} else {\n\t\t\tminLevel = 0;\n\t\t\tmaxLevel = parseInt(bounds, 10);\n\t\t}\n\t\tswitch (axe) {\n\t\tcase \"down\" :\n\t\t\tfor (let i = 0; wedlet && i < minLevel; i++) wedlet = wedlet.wedParent;\n\t\t\tlet lastFindPlaceholder = \"\";\n\t\t\tfor (let i = minLevel; wedlet && i < maxLevel; i++) {\n\t\t\t\twedlet = wedlet.wedParent;\n\t\t\t\tif (wedlet && isWedletSingleElt(wedlet) && wedlet.element.getAttribute(attributeName))\n\t\t\t\t\tlastFindPlaceholder = wedlet.element.getAttribute(attributeName);\n\t\t\t}\n\t\t\treturn lastFindPlaceholder;\n\t\t\tbreak;\n\t\tcase \"up\" :\n\t\t\tfor (let i = 0; wedlet && i < minLevel; i++) wedlet = wedlet.wedParent;\n\t\t\tfor (let i = minLevel; wedlet && i < maxLevel; i++) {\n\t\t\t\tif (wedlet && isWedletSingleElt(wedlet) && wedlet.element.getAttribute(attributeName)) {\n\t\t\t\t\treturn wedlet.element.getAttribute(attributeName);\n\t\t\t\t}\n\t\t\t\twedlet = wedlet.wedParent;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault :\n\t\t\tthrow \"axe unknown in : \" + upSelector;\n\t\t}\n\t} else {\n\t\tconst up = parseInt(upSelector, 10);\n\t\tfor (let i = 0; wedlet && i < up; i++) wedlet = wedlet.wedParent;\n\t\tif (wedlet && isWedletSingleElt(wedlet))\n\t\t\treturn wedlet.element.getAttribute(attributeName);\n\t}\n}\n"]}