{"version":3,"sources":["/@back@/commons/widgets/popupable.tsx"],"names":["BaseElement","BASIS","Label","Button","REG","VIEWS","DOM","JSX","DOMSH","GFX","IS_Popupable","n","EPopupType","MxPopupable","Base","type","opened","this","hasAttribute","view","firstElementChild","windowBar","findNext","shadowRoot","WindowBar","[object Object]","init","super","_initialize","popupType","attachShadow","SHADOWDOM_INIT","sr","reg","findReg","installSkin","_initAndInstallSkin","localName","appendChild","createElement","id","onfocus","onFocusStart","contentRoot","eltForMove","resizer","WindowResizer","initialize","titleBar","tiInit","barLabel","label","ti","slot","_builBodySlot","onFocusEnd","_subPopupSlot","name","_externalResize","proxy","onExternalResize","bind","previousWidth","previousHeight","timeout","observeResize","window","_internalResize","observer","ResizeObserver","onInternalResize","skipNextEvent","request","target","freeze","addEventListener","ev","onKeyDown","key","preventDefault","stopImmediatePropagation","tooltip","tryClose","parent","parentElement","popup","_bodySlot","anchor","uiContainer","logicalParent","_returnValue","undefined","_restoreFocus","restoreFocus","findDeepActiveElement","document","findLogicalParentOrSelf","IS_element","dispatchEvent","CustomEvent","bubbles","composed","cancelable","internalResizeFreeze","parentPopup","findPopupableParent","remove","setAttribute","body","menu","dialog","floating","_closeLstns","isAncestor","activeElement","firstFocusable","findFlatNext","IS_focusable","focus","tabIndex","onScrollPrevent","passive","_focusReentrance","subDialog","subPopup","assignedNodes","menuOnPointerDown","menuOnContextMenu","_currentAnchor","viewPortY","fixSize","innerWidth","innerHeight","_setPosition","onViewShown","returnValue","closing","detail","eventType","removeEventListener","clearTimeout","disconnect","onViewHidden","usedOnce","canHideView","close","Promise","resolve","_waitingClose","push","onViewBeforeHide","beforeCloseEvent","onViewWaitForHide","closed","removeAttribute","matches","isConnected","parentNode","fct","visitor","options","visible","result","parentLastDatas","button","composedPath","rootMenu","stopPropagation","st","style","top","left","width","initWidth","height","initHeight","maxHeight","initMaxHeight","maxWidth","getBoundingClientRect","padding","viewPortPadding","maxW","documentElement","clientWidth","offsetHeight","Math","min","clientHeight","aroundElem","isAroundPosition","elem","HTMLElement","fixAroundPos","isFixedPosition","initX","max","initY","isRelativePosition","fixRelativePos","fixScreenPos","parseInt","substr","length","manuallyMoved","manuallyResized","getComputedStyle","parseFloat","Object","assign","anchorRect","round","right","bottom","pos","targetW","targetH","fromRect","posFrom","intersectWith","intersect","dir","direction","x","fromX","marginX","targetX","tolX","toleranceX","winX","y","fromY","marginY","targetY","tolY","toleranceY","winY","notAvailableSpace","winW","winH","maxWinW","maxWinH","originalW","originalH","offsetWidth","resetMaxSize","viewPortX","newFocus","popupable","findHost","findFlatPrevious","findFlatLastDesc","lastChild","DEBUG_TOOLTIP","cancelIdleCallback","requestIdleCallback","updatePosition","entries","unobserve","requestAnimationFrame","delta","observe","registerSkin","noDrag","getAttribute","initLabel","noShadow","ellipsis","closeButton","initBtn","newInit","uiContext","icon","title","onclick","ondragstart","windowDragStart","ondragover","defaulDragHover","customElements","define","toMove","rect","margin","dataTransfer","effectAllowed","setDragImage","baseLeft","screenX","baseTop","screenY","ondrag","clientX","dropEffect","addHandler","div","draggable","resizerDragStart","dR","dB","baseRight","baseBottom","indexOf","from","root","findFlatParentElt"],"mappings":"OAAQA,YAAaC,MAAOC,UAAiC;OACrDC,WAAoB;OACMC,QAAI;OACaC,UAAM;OACjDC,IAAkBC,QAAI;OACtBC,UAAM;OAENC,QAAI;OAqFL,MAAMC,aAAiBC,GAA4BA,GAAK,gBAAiBA;OAEhF,IAAkBC,YAAlB,SAAkBA,YAMjBA,WAAAA,WAAA,QAAA,GAAA;AAMAA,WAAAA,WAAA,UAAA,GAAA;AAMAA,WAAAA,WAAA,YAAA,GAAA;AAMAA,WAAAA,WAAA,WAAA,GAAA,WAxBD,CAAkBA,aAAAA,WAAU;OA+BtB,SAAUC,YAAgDC,KAASC,MACxE,OAAO,MAAMF,oBAAoBC,KAwChCE,aAAc,OAAOC,KAAKC,aAAa,UAEvCC,WAAmB,OAAOF,KAAKG,kBAE/BC,gBAAmC,OAAOf,IAAIgB,SAASL,KAAKM,WAAYN,KAAKM,WAAaZ,GAAsBA,aAAaa,WAKnHC,YAAYC,MACrBC,MAAMC,YAAYF;AAClBT,KAAKY,UAAYd;AACjBE,KAAKa,aAAatB,MAAMuB;AAExB,MAAMC,GAAKf,KAAKM;AAChB,MAAMU,IAAMhB,KAAKiB,QAAQR;AACzBO,IAAIE,YAAY,YAAaH;AAC7Bf,KAAKmB,oBAAoBnB,KAAKoB,UAAWX;AAGzCT,KAAKM,WAAWe,YAAY/B,IAAAgC,cAAA,SAAA,CAAQC,GAAG,aAAaC,QAASxB,KAAKyB;AAGlEzB,KAAK0B,YAAc1B,KAAK2B,WAAaZ,GAAGM,YAAY/B,IAAAgC,cAAA,MAAA,CAAKC,GAAG;AAC5D,GAAId,KAAKmB,QAAS5B,KAAK0B,YAAc1B,KAAK0B,YAAYL,aAAY,IAAIQ,eAAgBC,WAAWrB,KAAKmB;AAEtG,GAAInB,KAAKsB,SAAU,CAClB,MAAMC,cAAgCvB,KAAKsB,WAAa,SAAW,CAACE,SAAU,CAACC,MAAOzB,KAAKsB,WAAatB,KAAKsB;AAC7G,MAAMI,GAAKnC,KAAK0B,YAAYL,aAAY,IAAId,WAAYuB,WAAWE;AACnEG,GAAGC,KAAO,QAEXpC,KAAKqC;AACLrC,KAAKM,WAAWe,YAAY/B,IAAAgC,cAAA,SAAA,CAAQC,GAAG,WAAWC,QAASxB,KAAKsC;AAChEtC,KAAKuC,cAAgBvC,KAAKM,WAAWe,YAAY/B,IAAAgC,cAAA,OAAA,CAAMkB,KAAK;AAG5DxC,KAAKyC,gBAAkB,CACtBC,MAAO1C,KAAK2C,iBAAiBC,KAAK5C,MAClC6C,cAAe,EACfC,eAAgB,EAChBC,QAAS;AAGV,GAAItC,KAAKuC,gBAAkB,OAAS,mBAAoBC,OAAQ,CAC/DjD,KAAKkD,gBAAkB,CACtBC,SAAU,IAAIC,eAAepD,KAAKqD,kBAClCC,cAAe,KACfC,QAAS,EACTC,OAAQxD,KAAK0B,YACb+B,OAAQ,GAIVzD,KAAK0D,iBAAiB,WAAW,SAA6BC,IAC7D,IAAK3D,KAAK4D,UAAUD,IAAK,CAExB,GAAIA,GAAGE,MAAQ,SAAU,CACxBF,GAAGG;AACHH,GAAGI;AACH,GAAI/D,KAAKY,WAAajB,WAAWqE,QAAS,CACzC,IAAIA,QAAUhE;AAEd,EAAG,CACFgE,QAAQC;AACR,MAAMC,OAASF,QAAQG;AACvBH,QAAUvE,aAAayE,SAAWA,OAAOtD,YAAcjB,WAAWqE,SAAWE,aACrEF,aACH,CACNhE,KAAKiE,WAEN,IAAIG,MAAQpE;AACZ,EAAG,CACFoE,MAAMH;AAENG,MAAQ3E,aAAa2E,MAAMD,gBAAkBC,MAAMD,cAAcvD,YAAcjB,WAAWqE,SAAWI,MAAMD,oBACnGC,YAMH5D,gBACTR,KAAKqE,UAAYrE,KAAK0B,YAAYL,YAAY/B,IAAAgC,cAAA,OAAA,CAAMC,GAAG,UAGxDf,KAAK8D,OAAsBC,YAAmBC,eAC7C,GAAIxE,KAAKD,OAAQ,OAAO;AACxBC,KAAKyE,aAAeC;AACpB1E,KAAK2E,cAAgB3E,KAAK4E,cAAgBrF,MAAMsF,sBAAsBC;AACtE9E,KAAKuE,YAAcA;AACnBvE,KAAKwE,cAAgBA,gBAAkBE,UAAYF,cAAgBnF,IAAI0F,wBAAwBR,YAAa,KAAMlF,IAAI2F;AAEtH,GAAIhF,KAAKiF,cAAc,IAAIC,YAAY,SAAU,CAACC,QAAS,MAAOC,SAAU,MAAOC,WAAY,UAAY,MAAO,OAAO;AAEzHrF,KAAKsF,qBAAqB;AAC1BtF,KAAKuF,YAAcC,oBAAoBjB;AACvC,GAAIvE,KAAKuF,YAAa,CAErBvF,KAAKyF;AACLzF,KAAK0F,aAAa,OAAQ;AAC1B1F,KAAK0F,aAAa,SAAU;AAC5B1F,KAAKuF,YAAYlE,YAAYrB,UACvB,CACNA,KAAKyF;AACLzF,KAAK0F,aAAa,SAAU;AAC5BZ,SAASa,KAAKtE,YAAYrB,MAI3B,GAAIF,OAASH,WAAWiG,KAAM5F,KAAK0F,aAAa,OAAQ;KACnD,GAAI5F,OAASH,WAAWkG,QAAU/F,MAAQH,WAAWmG,SAAU9F,KAAK0F,aAAa,OAAQ;KACzF,GAAI5F,OAASH,WAAWqE,QAAShE,KAAK0F,aAAa,OAAQ;AAEhE1F,KAAK+F,YAAc;AAEnB,GAAIjG,OAASH,WAAWiG,MAAQ9F,MAAQH,WAAWkG,OAAQ,CAC1D,IAAKtG,MAAMyG,WAAWhG,KAAKqE,UAAWS,SAASmB,eAAgB,CAE9D,MAAMC,eAAiB3G,MAAM4G,aAAanG,KAAKqE,UAAWrE,KAAK0B,YAAarC,IAAI+G;AAChF,GAAIF,eAAgBA,eAAeG;IAC9B,CACJrG,KAAK0B,YAAY4E,SAAW;AAC5BtG,KAAK0B,YAAY2E,SAKnBrG,KAAK0D,iBAAiB,aAAc1D,KAAKuG,gBAAiB,CAACC,QAAS;AACpExG,KAAK0D,iBAAiB,YAAa1D,KAAKuG,gBAAiB,CAACC,QAAS;AACnExG,KAAK+F,YAAY,cAAgB/F,KAAKuG;AACtCvG,KAAK+F,YAAY,aAAe/F,KAAKuG,gBAGtC,GAAIzG,OAASH,WAAWkG,OAAQ,CAE/B7F,KAAKyG,iBAAmB,KACvB,IAAIC,UAAY;AAChB,IAAK,MAAMC,YAAY3G,KAAKuC,cAAcqE,gBAAiB,CAC1D,GAAKD,SAAwB/F,WAAajB,WAAWkG,OAAQ,CAC5Da,UAAY;AACZ,OAGF,IAAKA,UAAW1G,KAAK0B,YAAY2E;AAElCpD,OAAOS,iBAAiB,QAAS1D,KAAKyG,kBAIvC,GAAI3G,OAASH,WAAWiG,KAAM,CAC7B5F,KAAK0D,iBAAiB,cAAe1D,KAAK6G;AAC1C7G,KAAK0D,iBAAiB,cAAe1D,KAAK8G;AAC1C9G,KAAK+F,YAAY,eAAiB/F,KAAK6G;AACvC7G,KAAK+F,YAAY,eAAiB/F,KAAK8G;AACvC9G,KAAK+G,eAAiBzC,YAChB,GAAIxE,OAASH,WAAWkG,OAAQ,CACtC7F,KAAK+G,eAAiBzC,QAAU,CAAC0C,UAAW,SAAUC,QAAS,WACzD,GAAInH,OAASH,WAAWmG,UAAYhG,OAASH,WAAWqE,QAAS,CACvEhE,KAAK+G,eAAiBzC,OAIvBtE,KAAKyC,gBAAgBI,cAAgBI,OAAOiE;AAC5ClH,KAAKyC,gBAAgBK,eAAiBG,OAAOkE;AAC7ClE,OAAOS,iBAAiB,SAAU1D,KAAKyC,gBAAgBC;AAEvD1C,KAAKoH,aAAapH,KAAK+G;AACvB/G,KAAKsF,sBAAsB;AAE3BtF,KAAKqH;AACL,OAAO,KAKR7G,MAAM8G,aACL,IAAKtH,KAAKD,QAAUC,KAAKuH,QAAS,OAAO;AACzCvH,KAAKyE,aAAe6C;AACpBtH,KAAKuH,QAAU;AACfvH,KAAKiF,cAAc,IAAIC,YAAY,gBAAiB,CACnDC,QAAS,MACTC,SAAU,MACVC,WAAY,MACZmC,OAAQ,CAACF,YAAatH,KAAKyE;AAE5BzE,KAAKuH,QAAU;AACf,IAAK,MAAME,aAAazH,KAAK+F,YAAa/F,KAAK0H,oBAAoBD,UAAWzH,KAAK+F,YAAY0B;AAC/F,GAAIzH,KAAKyG,iBAAkBxD,OAAOyE,oBAAoB,QAAS1H,KAAKyG;AACpExD,OAAOyE,oBAAoB,SAAU1H,KAAKyC,gBAAgBC;AAC1DiF,aAAa3H,KAAKyC,gBAAgBM;AAClC,GAAI/C,KAAKkD,gBAAiBlD,KAAKkD,gBAAgBC,SAASyE;AACxD5H,KAAK6H,aAAa7H,KAAK8H;AACvB,OAAO,KAGRtH,eAAe8G,aACd,IAAKtH,KAAKD,OAAQ,OAAO;AACzBC,KAAKyE,aAAe6C;AACpB,SAAUlI,MAAM2I,YAAY/H,KAAM,MAAO,CACxC,OAAOA,KAAKgI,MAAMV,aAEnB,OAAO,MAGR9G,cACC,OAAO,IAAIyH,QAASC,UACnB,IAAKlI,KAAKmI,cAAenI,KAAKmI,cAAgB,CAACD;KAC1ClI,KAAKmI,cAAcC,KAAKF,WAI/B1H,cACCR,KAAKiF,cAAc,IAAIC,YAAY,UAAW,CAACC,QAAS,MAAOC,SAAU;AACzEhG,MAAMiI,YAAYrH,KAAKE,MAGxBM,iBAAiBwH,OAChB,IAAK,MAAMrB,YAAY3G,KAAKuC,cAAcqE,gBAA4B,CACrE,GAAI,qBAAsBD,WAAaA,SAAS0B,iBAAiBL,OAAQ,OAAO,MAEjF,GAAIhI,KAAKE,MAAQ,qBAAsBF,KAAKE,OAASF,KAAKE,KAAKmI,iBAAiBL,OAAQ,OAAO;AAE/F,GAAIA,MAAO,CACV,MAAMM,iBAAmB,IAAIpD,YAAY,gBAAiB,CACzDC,QAAS,MACTC,SAAU,MACVC,WAAY,KACZmC,OAAQ,CAACF,YAAatH,KAAKyE;AAE5B,GAAIzE,KAAKiF,cAAcqD,oBAAsB,MAAO,OAAO,MAE5D,OAAO,KAGR9H,wBAAwBwH,OACvB,IAAK,MAAMrB,YAAY3G,KAAKuC,cAAcqE,gBAA4B,CACrE,GAAI,sBAAuBD,iBAAmBA,SAAS4B,kBAAkBP,OAAQ,OAAO,MAEzF,GAAIhI,KAAKE,MAAQ,sBAAuBF,KAAKE,aAAeF,KAAKE,KAAKqI,kBAAkBP,OAAQ,OAAO;AAEvG,OAAO,KAIRxH,aAAagI,QACZ,IAAK,MAAM7B,YAAY3G,KAAKuC,cAAcqE,gBAA4B,CACrExH,MAAMyI,aAAalB,SAAU6B,QAE9BpJ,MAAMyI,aAAa7H,KAAKE,KAAMsI;AAG9BxI,KAAKyI,gBAAgB;AAGrB,GAAIzI,KAAK2E,eAAiB3E,KAAK0B,aAAe1B,KAAK0I,QAAQ,kBAAoB1I,KAAK2E,cAAcgE,YAAa,CAC9G3I,KAAK2E,cAAc0B;AACnBrG,KAAK2E,cAAgB,KAGtB,GAAI3E,KAAK4I,WAAY5I,KAAKyF;AAE1B,GAAIzF,KAAKmI,cAAe,CACvB,IAAK,MAAMU,OAAO7I,KAAKmI,cAAeU,IAAI7I,KAAKyE;AAC/CzE,KAAKmI,cAAgB,KAEtBnI,KAAKiF,cAAc,IAAIC,YAAY,UAAW,CAACC,QAAS,KAAMC,SAAU,MAAOoC,OAAQ,CAACF,YAAatH,KAAKyE;OAEnGzE,KAAKwE,cAGbhE,WAAWsI,QAA+BC,SACzC,GAAIA,SAAWA,QAAQC,UAAYhJ,KAAKD,OAAQ;AAChD,IAAIkJ;AACJ,GAAIjJ,KAAKE,KAAM+I,OAASH,QAAQ9I,KAAKE;AACrC,GAAI+I,SAAWvE,UAAW,OAAOuE;AACjC,IAAK,MAAMtC,YAAY3G,KAAKuC,cAAcqE,gBAA4B,CACrEqC,OAASH,QAAQnC;AACjB,GAAIsC,SAAWvE,UAAW,OAAOuE,QAInCzI,sBAAsBsI,QAAwCC,SAC7D,GAAIA,SAAWA,QAAQC,UAAYhJ,KAAKD,OAAQ;AAChD,IAAIkJ;AACJ,GAAIjJ,KAAKE,KAAM+I,aAAeH,QAAQ9I,KAAKE;AAC3C,GAAI+I,SAAWvE,UAAW,OAAOuE;AACjC,IAAK,MAAMtC,YAAY3G,KAAKuC,cAAcqE,gBAA4B,CACrEqC,aAAeH,QAAQnC;AACvB,GAAIsC,SAAWvE,UAAW,OAAOuE,QAQnCzI,eAAe0I,kBAML1I,UAAUmD,IAA6B,OAAO,MAI9CnD,kBAAkBmD,IAC3B,GAAIA,GAAGwF,QAAU,GAAKxF,GAAGyF,eAAe,KAAOpJ,KAAM,CACpD2D,GAAGG;AACH,IAAIuF,SAAuBrJ;AAC3B,MAAOqJ,SAAS9D,aAAe8D,SAAS9D,YAAY3E,WAAajB,WAAWiG,KAAMyD,SAAWA,SAAS9D;AACtG8D,SAASpF,YAKDzD,kBAAkBmD,IAC3B,GAAIA,GAAGyF,eAAe,KAAOpJ,KAAM,CAClC2D,GAAG2F;AACH3F,GAAGG;AACH,IAAIuF,SAAuBrJ;AAC3B,MAAOqJ,SAAS9D,aAAe8D,SAAS9D,YAAY3E,WAAajB,WAAWiG,KAAMyD,SAAWA,SAAS9D;AACtG8D,SAASpF,YAKDzD,gBAAgBmD,IACzB,GAAIA,GAAGyF,eAAe,IAAMpJ,KAAM2D,GAAGG,iBAG5BtD,aAAa8D,QACtBtE,KAAKsF,qBAAqB;AAC1B,MAAMiE,GAAKvJ,KAAK2B,WAAW6H;AAG3BD,GAAGE,IAAM;AACTF,GAAGG,KAAO;AACVH,GAAGI,MAASrF,OAAqBsF,WAAa;AAC9CL,GAAGM,OAAUvF,OAAqBwF,YAAc;AAChDP,GAAGQ,UAAazF,OAAqB0F,eAAiB;AACtDT,GAAGU,SAAW;AACd,IAAIN,MAACA,MAAKE,OAAEA,QAAU7J,KAAK2B,WAAWuI;AAEtC,GAAK5F,OAAqB2C,QAAS,CAClC,MAAMkD,QAAW7F,OAA6B8F,iBAAmB;AACjE,MAAMC,KAAOvF,SAASwF,gBAAgBC,YAAcJ,QAAU;AAC9D,GAAIR,MAAQU,KAAM,CACjBV,MAAQU;AACRd,GAAGI,MAAQA,MAAQ;AACnBE,OAAS7J,KAAK2B,WAAW6I,kBACnBjB,GAAGI,MAAQA,MAAQ;AAC1BJ,GAAGM,OAASY,KAAKC,IAAI5F,SAASwF,gBAAgBK,aAAeR,QAAU,EAAGN,QAAU,KAGrF,MAAMe,WAAaC,iBAAiBvG,QAAUA,OAAOwG,KAAQxG,kBAAkByG,YAAczG,OAAS;AACtG,GAAIsG,YAAcA,aAAe5K,KAAK2B,WAA6E,CAClH3B,KAAKgL,aAAaJ,WAAYrB,GAAII,MAAOE,aACnC,GAAIoB,gBAAgB3G,QAAS,CACnC,GAAIA,OAAO4G,MAAQvB,OAAS7E,SAASwF,gBAAgBC,YAAahB,GAAGG,KAAOpF,OAAO4G,MAAQ;KACtF3B,GAAGG,KAAOe,KAAKU,IAAI,EAAGrG,SAASwF,gBAAgBC,YAAcZ,OAAS;AAC3E,GAAIrF,OAAO8G,MAAQvB,QAAU/E,SAASwF,gBAAgBK,aAAcpB,GAAGE,IAAMnF,OAAO8G,MAAQ;KACvF7B,GAAGE,IAAMgB,KAAKU,IAAI,EAAGrG,SAASwF,gBAAgBK,aAAed,QAAU,UACtE,GAAIwB,mBAAmB/G,QAAS,CACtCtE,KAAKsL,eAAehH,OAAQtE,KAAK2B,WAAYgI,MAAOE,YAC9C,CACN7J,KAAKuL,aAAajH,OAA6BtE,KAAK2B,WAAYgI,MAAOE,QAGxE,IAAMvF,OAAqB2C,QAAS,CAEnCsC,GAAGU,SAAYnF,SAASwF,gBAAgBC,YAAciB,SAASjC,GAAGG,KAAK+B,OAAO,EAAGlC,GAAGG,KAAKgC,OAAS,IAAO;AACzG,IAAMpH,OAAqB0F,cAAe,CACzCT,GAAGQ,UAAajF,SAASwF,gBAAgBK,aAAea,SAASjC,GAAGE,IAAIgC,OAAO,EAAGlC,GAAGE,IAAIiC,OAAS,IAAO,MAG3G1L,KAAK+G,eAAiBzC;AACtBtE,KAAKsF,sBAAsB,GAG5B9E,iBACC,GAAKR,KAAK2L,eAAiB3L,KAAK4L,gBAAkB,CACjD,MAAMpC,MAAQqC,iBAAiB7L,KAAK2B;AACpC,IAAI2C;AAEJ,GAAItE,KAAK2L,cAAe,CACvBrH,OAAS,CACR4G,MAAOY,WAAWtC,MAAME,MAAQzG,OAAOiE,WAAalH,KAAKyC,gBAAgBI,cACzEuI,MAAOU,WAAWtC,MAAMC,KAAOxG,OAAOkE,YAAcnH,KAAKyC,gBAAgBK,eACzE8G,UAAY5J,KAAK+G,eAA6B6C,UAC9CE,WAAa9J,KAAK+G,eAA6B+C,WAC/C7C,QAAUjH,KAAK+G,eAA6BE,aAEvC,CACN,GAAIjH,KAAK+G,0BAA0BgE,YAAa,CAC/CzG,OAAS,CACR4G,MAAOY,WAAWtC,MAAME,MACxB0B,MAAOU,WAAWtC,MAAMC,KACxBG,UAAW,KACXE,WAAY,KACZ7C,QAAS,WAEJ,CACN3C,OAASyH,OAAOC,OAAO,GAAIhM,KAAK+G,iBAGlC,GAAI/G,KAAK4L,gBAAiB,CACzBtH,OAAO2C,QAAU;AACjB3C,OAAOsF,UAAYkC,WAAWtC,MAAMG,OAAS1G,OAAOiE,WAAalH,KAAKyC,gBAAgBI,cAAgB;AACtGyB,OAAOwF,WAAcgC,WAAWtC,MAAMK,QAAU5G,OAAOkE,YAAcnH,KAAKyC,gBAAgBK,eAAkB,KAE7G9C,KAAKoH,aAAa9C,YACZ,CACNtE,KAAKoH,aAAapH,KAAK+G,iBAIfvG,aAAa8D,OAA8BiF,GAAyBI,MAAeE,QAC5F,MAAMoC,WAAa,SAAU3H,OAASA,OAASA,OAAO4F;AACtD,GAAI+B,WAAWvC,KAAOC,OAAS7E,SAASwF,gBAAgBC,YAAahB,GAAGG,KAAOe,KAAKyB,MAAMD,WAAWvC,MAAQ;KACxGH,GAAGG,KAAOe,KAAKU,IAAI,EAAGV,KAAKyB,MAAMD,WAAWE,MAAQxC,QAAU;AACnE,GAAIsC,WAAWG,OAASvC,QAAU/E,SAASwF,gBAAgBK,aAAcpB,GAAGE,IAAMgB,KAAKyB,MAAMD,WAAWG,QAAU;KAC7G7C,GAAGE,IAAMgB,KAAKU,IAAI,EAAGV,KAAKyB,MAAMD,WAAWxC,IAAMI,SAAW,KAGxDrJ,eAAe6L,IAAwB7I,OAAqB8I,QAAiBC,SACtF,IAAIC,SAAWH,IAAII,QAAQvC;AAC3B,GAAImC,IAAIK,cAAeF,SAAWhN,IAAImN,UAAUH,SAAUH,IAAIK,cAAcxC,0BAA4BmC,IAAIK,cAAcxC;AAC1H,MAAM0C,IAAM3J,OAAO4I,iBAAiBQ,IAAII,SAASI,WAAa;AAE9D,IAAIC;AACJ,OAAQT,IAAIU,OACZ,IAAK,MACJD,EAAIF,MAAQ,MAAQJ,SAASL,MAAQK,SAAS9C;AAC9C;AACD,IAAK,SACJoD,EAAIN,SAAS9C,MAAQ8C,SAASL,MAAQK,SAAS9C,MAAQ;AACvD;AACD,QACCoD,EAAIF,MAAQ,MAAQJ,SAAS9C,KAAO8C,SAASL,MAE9C,GAAIE,IAAIW,QAASF,GAAKF,MAAQ,MAAQP,IAAIW,SAAWX,IAAIW;AACzD,OAAQX,IAAIY,SACZ,IAAK,MACJ,GAAIL,MAAQ,MAAOE,GAAKR;AACxB;AACD,IAAK,SACJQ,GAAMF,MAAQ,OAAUN,QAAU,EAAIA,QAAU;AAChD;AACD,QACC,GAAIM,MAAQ,MAAOE,GAAKR,QAGzB,MAAMY,KAAOb,IAAIc,YAAc;AAC/B,MAAMC,KAAOtI,SAASwF,gBAAgBC,YAAc+B;AACpD,GAAIQ,IAAMI,MAAQJ,GAAKM,KAAOF,KAAM,CACnC,IAAIG;AACJ,OAAQhB,IAAIiB,OACZ,IAAK,SACJD,EAAIb,SAASJ;AACb;AACD,IAAK,SACJiB,EAAIb,SAAS/C,KAAO+C,SAASJ,OAASI,SAAS/C,KAAO;AACtD;AACD,QACC4D,EAAIb,SAAS/C,IAEd,GAAI4C,IAAIkB,QAASF,GAAKhB,IAAIkB;AAC1B,OAAQlB,IAAImB,SACZ,IAAK,SACJH,GAAKd;AACL;AACD,IAAK,SACJc,GAAKd,QAAU;AACf,MAED,MAAMkB,KAAOpB,IAAIqB,YAAc;AAC/B,MAAMC,KAAO7I,SAASwF,gBAAgBK,aAAe4B;AACrD,GAAIc,IAAMI,MAAQJ,GAAKM,KAAOF,KAAM,CACnCjK,OAAOgG,MAAMC,IAAMgB,KAAKU,IAAI,EAAGV,KAAKC,IAAIiD,KAAMN,IAAM;AACpD7J,OAAOgG,MAAME,KAAOe,KAAKU,IAAI,EAAGV,KAAKC,IAAI0C,KAAMN,IAAM;AACrD,OAAO,MAGT,GAAIT,IAAIuB,kBAAmB,CAC1B,GAAIvC,mBAAmBgB,IAAIuB,mBAAoB,OAAO5N,KAAKsL,eAAee,IAAIuB,kBAAmBpK,OAAQ8I,QAASC;AAClHvM,KAAKuL,aAAac,IAAIuB,kBAAmBpK,OAAQ8I,QAASC,aACpD,CACNvM,KAAKgL,aAAaqB,IAAII,QAASjJ,OAAOgG,MAAO8C,QAASC,SAEvD,OAAO,KAGE/L,aAAa8D,OAA2Bd,OAAqB8I,QAAiBC,SACvF,MAAMK,IAAM3J,OAAO4I,iBAAiBrI,QAAQqJ,WAAa;AACzD,MAAM1C,QAAU7F,OAAO8F,iBAAmB;AAC1C,MAAMyD,KAAO/I,SAASwF,gBAAgBC;AACtC,MAAMuD,KAAOhJ,SAASwF,gBAAgBK;AACtC,MAAMoD,QAAUF,KAAO1D,QAAUA;AACjC,MAAM6D,QAAUF,KAAO3D,QAAUA;AACjC,GAAImC,QAAUyB,SAAWxB,QAAUyB,QAAS,CAE3C,MAAMC,UAAYzK,OAAOgG,MAAMS;AAC/B,MAAMiE,UAAY1K,OAAOgG,MAAMO;AAC/B,GAAIuC,QAAUyB,QAASvK,OAAOgG,MAAMS,SAAW8D,QAAU;AACzD,GAAIxB,QAAUyB,QAASxK,OAAOgG,MAAMO,UAAYiE,QAAU;AAC1D1B,QAAU9I,OAAO2K;AACjB5B,QAAU/I,OAAOgH;AACjB,MAAM4D,aAAe,KACpB5K,OAAOgG,MAAMS,SAAWgE;AACxBzK,OAAOgG,MAAMO,UAAYmE;AACzBlO,KAAK0H,oBAAoB,UAAW0G;AAErCpO,KAAK0D,iBAAiB,UAAW0K,cAElC,IAAItB;AACJ,IAAIO;AACJ,GAAI/I,OAAO+J,YAAc,QAASvB,EAAIF,MAAQ,MAAQzC,QAAU0D,KAAOvB,QAAUnC;KAC5E,GAAI7F,OAAO+J,YAAc,MAAOvB,EAAIF,MAAQ,MAAQiB,KAAOvB,QAAUnC,QAAUA;KAC/E2C,GAAKe,KAAOvB,SAAW;AAC5B,GAAIhI,OAAO0C,YAAc,SAAUqG,EAAIS,KAAOvB,QAAUpC;KACnD,GAAI7F,OAAO0C,YAAc,MAAOqG,GAAKS,KAAOvB,SAAW;KACvD,GAAIjI,OAAO0C,YAAc,SAAUqG,GAAKS,KAAOvB,SAAW;KAC1Dc,EAAIlD;AACT3G,OAAOgG,MAAMC,IAAM4D,EAAI;AACvB7J,OAAOgG,MAAME,KAAOoD,EAAI,KAGzBtM,eACC,IAAI8N;AACJ,MAAMC,UAAYhP,MAAMiP,SAAsBxO;AAC9C,GAAIF,OAASH,WAAWqE,QAAS,CAChCsK,SAAWjP,IAAI+G,aAAamI,UAAUhK,aAAegK,UAAUhK,YAAchF,MAAMkP,iBAAiBF,UAAUhK,YAAaO,SAAUzF,IAAI+G;AACzImI,UAAUtK,eACJ,CACNqK,SAAW/O,MAAMmP,iBAAiBH,UAAU7M,YAAYiN,UAAWtP,IAAI+G,cAExE,GAAIkI,SAAUA,SAASjI,QAGxB7F,aACC,IAAI8N;AACJ,MAAMC,UAAYhP,MAAMiP,SAAsBxO;AAC9C,GAAIF,OAASH,WAAWqE,QAAS,CAChC,IAAI4K,cAAe,CAClBN,SAAW/O,MAAM4G,aAAaoI,UAAUhK,YAAaO,SAAUzF,IAAI+G;AACnEmI,UAAUtK,gBAEL,CACNqK,SAAW/O,MAAM4G,aAAaoI,UAAU7M,YAAa6M,UAAU7M,YAAarC,IAAI+G,cAEjF,GAAIkI,SAAUA,SAASjI,QAGxB7F,iBAAoCmD,IACnC,GAAI3D,KAAKyC,gBAAgBM,UAAY,KAAME,OAAO4L,mBAAmB7O,KAAKyC,gBAAgBM;AAC1F/C,KAAKyC,gBAAgBM,QAAUE,OAAO6L,oBAAoB,KACzD9O,KAAKyC,gBAAgBM,QAAU;AAC/B/C,KAAK+O;AACL/O,KAAKyC,gBAAgBI,cAAgBI,OAAOiE;AAC5ClH,KAAKyC,gBAAgBK,eAAiBG,OAAOkE,cAI/C3G,iBAA6BwO,SAC5B,MAAMT,UAAY/I,oBAAoBwJ,QAAQ,GAAGxL;AACjD,GAAI+K,UAAUrL,gBAAgBI,cAAe,CAC5CiL,UAAUrL,gBAAgBI,cAAgB;AAC1C,OAGD,GAAIiL,UAAUrL,gBAAgBK,QAAS;AACvC,GAAIgL,UAAU3C,gBAAiB,CAC9B2C,UAAUrL,gBAAgBC,SAAS8L,UAAUV,UAAUrL,gBAAgBM;AACvE,OAGD+K,UAAUrL,gBAAgBK,QAAUN,OAAOiM,sBAAsB,KAChEX,UAAUrL,gBAAgBK,QAAU;AACpCgL,UAAUQ,mBAIZvO,qBAAqB2O,OACpB,GAAInP,KAAKkD,gBAAiB,CACzBlD,KAAKkD,gBAAgBO,QAAU0L;AAC/B,GAAInP,KAAKkD,gBAAgBO,SAAW,EAAGzD,KAAKkD,gBAAgBC,SAAS8L,UAAUjP,KAAKkD,gBAAgBM;KAC/F,GAAIxD,KAAKkD,gBAAgBO,SAAW,EAAG,CAC3CzD,KAAKkD,gBAAgBI,cAAgB;AACrCtD,KAAKkD,gBAAgBC,SAASiM,QAAQpP,KAAKkD,gBAAgBM,YAOhErE,IAAI6B,IAAIqO,aAAa,YAAa,EAAsB;AAgFxD,SAASxE,iBAAiBvG,QAA0C,MAAO,SAAUA,OAOrF,SAAS2G,gBAAgB3G,QAAwC,MAAO,UAAWA,OAmBnF,SAAS+G,mBAAmB/G,QAA2C,OAAOA,OAAOmI,eAkB/E,MAAOlM,kBAAkBxB,YAI9BuQ,aAAuB,OAAOtP,KAAKuP,aAAa,eAAiB,OAEvD/O,YAAYC,MACrB,MAAMM,GAAKf,KAAKa,aAAatB,MAAMuB;AACnC,MAAME,IAAMhB,KAAKiB,QAAQR;AACzB,UAAWA,KAAKwB,WAAa,WAAY,CACxClB,GAAGM,YAAYZ,KAAKwB,gBACd,CACN,IAAIuN;AACJ,GAAI/O,KAAKwB,SAAU,CAClBuN,UAAY/O,KAAKwB;AACjB,KAAM,aAAcuN,WAAYA,UAAUC,SAAW;AACrD,KAAM,aAAcD,WAAYA,UAAUE,SAAW,SAC/C,CACNF,UAAY,CAACC,SAAU,KAAMC,SAAU,MAExCF,UAAUxO,IAAMA;AAChBhB,KAAKiC,SAAWlB,GAAGM,aAAY,IAAIpC,OAAQ6C,WAAW0N,YAEvD,GAAI/O,KAAKkP,cAAgB,KAAM,CAC9B,MAAMC,QAAU5Q,MAAM6Q,QAAQpP,KAAKkP,YAAa3O;AAChD,IAAK4O,QAAQE,UAAWF,QAAQE,UAAY;AAC5C,KAAM,SAAUF,SAAUA,QAAQG,KAAO;AACzC,IAAKH,QAAQI,MAAOJ,QAAQI,MAAQ;AACpChQ,KAAK2P,YAAc5O,GAAGM,aAAY,IAAInC,QAAS4C,WAAW8N;AAC1D5P,KAAK2P,YAAYM,QAAWtM,KAAiB6B,oBAAoBxF,MAAMiE,YAExEjE,KAAKmB,oBAAoB,eAAgBV;AACzC,IAAKA,KAAK6O,OAAQtP,KAAK0F,aAAa,YAAa;AACjD,IAAK1F,KAAKsP,OAAQ,CACjBtP,KAAKkQ,YAAcC;AACnBnQ,KAAKoQ,WAAaC,kBAKrBlR,IAAI6B,IAAIqO,aAAa,eAAgB,EAAsB;AAmC3DiB,eAAeC,OAAO,eAAgBhQ;AAGtC,SAAS4P,gBAAiCxM,IACzC,MAAM4K,UAAY/I,oBAAoBxF;AACtCuO,UAAU5C,cAAgB;AAC1B,MAAM6E,OAASjC,UAAU5M;AACzB,MAAM8O,KAAOD,OAAOtG;AAEpB,MAAMX,GAAKiH,OAAOhH;AAClBD,GAAGmH,OAAS;AACZnH,GAAGG,KAAO+G,KAAK/G,KAAO;AACtBH,GAAGE,IAAMgH,KAAKhH,IAAM;AACpBF,GAAGI,MAAQ8G,KAAK9G,MAAQ;AACxBJ,GAAGM,OAAS4G,KAAK5G,OAAS;AAC1BN,GAAG4C,MAAQ;AACX5C,GAAG6C,OAAS;AACZzI,GAAGgN,aAAaC,cAAgB;AAChCjN,GAAGgN,aAAaE,aAAavR,IAAAgC,cAAA,OAAA,MAAS,EAAG;AACzC,MAAMwP,SAAWL,KAAK/G,KAAO/F,GAAGoN;AAChC,MAAMC,QAAUP,KAAKhH,IAAM9F,GAAGsN;AAC9BjR,KAAKkR,OAAUvN,KACd,GAAIA,GAAGwN,UAAY,EAAG;AACtBX,OAAOhH,MAAME,KAAQoH,SAAWnN,GAAGoN,QAAW;AAC9CP,OAAOhH,MAAMC,IAAOuH,QAAUrN,GAAGsN,QAAW,MAI9C,SAASZ,gBAAgB1M,IACxBA,GAAGgN,aAAaS,WAAa;AAC7BzN,GAAGG,wBAWE,MAAOjC,sBAAsB9C,YACxByB,YAAYC,MACrB,MAAMM,GAAKf,KAAKa,aAAatB,MAAMuB;AACnCd,KAAKmB,oBAAoBnB,KAAKoB,UAAWX;AACzCT,KAAKqR,WAAW,KAAMtQ;AACtBf,KAAKqR,WAAW,IAAKtQ;AACrBf,KAAKqR,WAAW,KAAMtQ;AACtBf,KAAKqR,WAAW,IAAKtQ;AACrBA,GAAGM,YAAY/B,IAAAgC,cAAA,OAAA;AACftB,KAAKqR,WAAW,IAAKtQ;AACrBf,KAAKqR,WAAW,IAAKtQ;AACrBA,GAAGM,YAAY/B,IAAAgC,cAAA,OAAA,CAAMkB,KAAK;AAC1BxC,KAAKqR,WAAW,IAAKtQ;AACrBf,KAAKqR,WAAW,KAAMtQ;AACtBf,KAAKqR,WAAW,IAAKtQ;AACrBf,KAAKqR,WAAW,KAAMtQ,IAGbP,WAAW6L,IAAatL,IACjC,MAAMuQ,IAAMvQ,GAAGM,YAAY/B,IAAAgC,cAAA,MAAA,CAAKC,GAAI8K,IAAKkF,UAAU;AACnDD,IAAIpB,YAAcsB;AAClBF,IAAIlB,WAAaC,iBAKnB,SAASmB,iBAAuC7N,IAC/C,MAAM4K,UAAY/I,oBAAoBxF;AACtCuO,UAAU3C,gBAAkB;AAC5B,MAAM4E,OAASjC,UAAU5M;AACzB,MAAM8O,KAAOD,OAAOtG;AAEpB,MAAMX,GAAKiH,OAAOhH;AAClBD,GAAGmH,OAAS;AACZnH,GAAGG,KAAO+G,KAAK/G,KAAO;AACtBH,GAAGE,IAAMgH,KAAKhH,IAAM;AACpB,MAAMgI,GAAK3M,SAASwF,gBAAgBC,YAAckG,KAAKtE;AACvD5C,GAAG4C,MAAQsF,GAAK;AAChB,MAAMC,GAAK5M,SAASwF,gBAAgBK,aAAe8F,KAAKrE;AACxD7C,GAAG6C,OAASsF,GAAK;AACjBnI,GAAGI,MAAQ;AACXJ,GAAGM,OAAS;AACZlG,GAAGgN,aAAaC,cAAgB;AAChCjN,GAAGgN,aAAaE,aAAavR,IAAAgC,cAAA,OAAA,MAAS,EAAG;AACzC,MAAM+K,IAAMrM,KAAKuP,aAAa;AAC9B,MAAMuB,SAAWL,KAAK/G,KAAO/F,GAAGoN;AAChC,MAAMC,QAAUP,KAAKhH,IAAM9F,GAAGsN;AAC9B,MAAMU,UAAYF,GAAK9N,GAAGoN;AAC1B,MAAMa,WAAaF,GAAK/N,GAAGsN;AAC3BjR,KAAKkR,OAAUvN,KACd,GAAIA,GAAGoN,UAAY,EAAG;AACtB,GAAI1E,IAAIwF,QAAQ,MAAQ,EAAGrB,OAAOhH,MAAME,KAAQoH,SAAWnN,GAAGoN,QAAW;AACzE,GAAI1E,IAAIwF,QAAQ,MAAQ,EAAGrB,OAAOhH,MAAMC,IAAOuH,QAAUrN,GAAGsN,QAAW;AACvE,GAAI5E,IAAIwF,QAAQ,MAAQ,EAAGrB,OAAOhH,MAAM2C,MAASwF,UAAYhO,GAAGoN,QAAW;AAC3E,GAAI1E,IAAIwF,QAAQ,MAAQ,EAAGrB,OAAOhH,MAAM4C,OAAUwF,WAAajO,GAAGsN,QAAW,MAI/EX,eAAeC,OAAO,mBAAoB1O;AAE1C1C,IAAI6B,IAAIqO,aAAa,mBAAoB,EAAsB;OAuDzD,SAAU7J,oBAAoBsM,KAAYC,MAC/C,OAAOxS,MAAMyS,kBAAkBF,KAAMC,KAAMtS,qBAIrC,MAAMmP,cAAgB;AAE7BzP,IAAI6B,IAAIqO,aAAa,kBAAmB,EAAsB","sourcesContent":["import {BaseElement, BASIS, Label, OLabelInit, OSkinableInit} from \"back/commons/basis\";\nimport {Button, OButtonInit} from \"back/commons/widgets/buttons\";\nimport {IDomLogical, IRegPointer, REG} from 'lib/commons/registry';\nimport {IView, IViewsContainer, OViewVisitOptions, VIEWS} from \"lib/commons/views\";\nimport {DOM, INodeFilter, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {ILastDatasBuilder, JLastDatas} from \"lib/commons/lastDatas\";\nimport {GFX} from \"lib/commons/utils/gfx\";\n\n/**\n *\n */\nexport interface ICloseable<R> {\n\tclose(returnValue?: R): boolean\n}\n\n/**\n * Option d'initialisation de l'observation du resize\n */\nexport interface OResizeObserverInit {\n\tobserveResize?: boolean;\n}\n/**\n * Interface pour les widgets de type tooltip, menu, dialogue, fenêtres flotantes...\n */\nexport interface IPopupable<R = {}> extends HTMLElement, ICloseable<R> {\n\n\topened: boolean;\n\n\t/**\n\t * Ouvre le popup.\n\t * @param anchor Positionnement du popup. Pour certains types de popupable, l'anchor n'est pas exploité (dialog).\n\t * @param uiContainer Noeud contexte à partir duquel l'insertion graphique doit être évaluée (gestion du z-index des différentes fenêtres).\n\t *      Utile lors que l'affichage s'effectue dans le contexte d'un autre IPopupable (dialogue...) :\n\t *      on doit retrouver ce IPopupable parent pour gérer les z-index correctement.\n\t *      Il sert également à resituer le focus à la sortie du popup.\n\t * @param logicalParent affecte la propriété this.logicalParent pendant l'ouverture du popup\n\t *      Préserve la hiérarchie \"logique\" pour retrouver le registre courant, etc.\n\t * @event c-show Lancer avant l'affichage de la popup, peut être annulé pour empêcher l'affichage\n\t * @event c-shown Lancer lorsque la popup est affiché\n\t * @return true si la popup a été effectivement ouvert, false si la popup est déjà ouvert ou si l'ouverture a échoué (menu vide par ex.).\n\t */\n\tshow(anchor: OPopupAnchor, uiContainer: Node, logicalParent?: Element): boolean;\n\n\t/**\n\t * @event c-beforeclose {@link IPopupCloseEvent} Lancer avant la fermeture de la popup, ne peut être annulé pour empêcher la fermeture\n\t * @event c-close {@link IPopupCloseEvent} Lancer après la fermeture de la fenêtre\n\t * @return true Si la fenêtre a été effectivement fermée, false sinon : cloture refusée ou popup déjà fermée\n\t */\n\tclose(returnValue?: R): boolean;\n\n\t/**\n\t * Tente de fermer ce dialogue si le contenu l'autorise.\n\t *\n\t * @event c-beforeclose {@link IPopupCloseEvent} Lancer avant la fermeture de la popup, peut être annulé pour empêcher la fermeture\n\t * @event c-close {@link IPopupCloseEvent} Lancer après la fermeture de la fenêtre\n\t */\n\ttryClose(returnValue?: R): Promise<boolean>;\n\n\t/** Promesse résolue à la prochaine fermeture de cette popup avec returnValue en paramètre. */\n\tonNextClose(): Promise<R>;\n\n\t/** Type de la popup */\n\tpopupType: EPopupType;\n\n\t/** Parent de la popup */\n\tparentPopup: IPopupable;\n\n\t/** Container contenant le slot principal */\n\tcontentRoot: Node;\n\n\t/** Element à utiliser pour le changement des coordonnées lors d'un déplacement du popup. */\n\teltForMove: HTMLElement;\n\n\t/** Indique si la popup a été déplacée par l'utilisateur (@link WindowBar} */\n\tmanuallyMoved: boolean;\n\n\t/** Indique si la popup a été redimensionnée par l'utilisateur (@link WindowResizer} */\n\tmanuallyResized: boolean;\n\n\t/** Repositionne la popup par rapport à la dernière ancre utilisée ou recalculée si l'utilisateur l'a modifiée */\n\tupdatePosition(): void\n\n\t/** Fige le resize intrinsèque (issu du contenu) de la popup pendant un traitement asynchrone. */\n\tinternalResizeFreeze(delta: number): void\n}\n\n/** Interface pour les évènements c-close et c-beforeclose d'une popup */\nexport interface IPopupCloseEvent extends CustomEvent {\n\tdetail: { returnValue: any };\n}\n\nexport const IS_Popupable = ((n: any): n is IPopupable => n && 'onNextClose' in n) as INodeFilter<IPopupable>;\n\nexport const enum EPopupType {\n\t/**\n\t * Menus, menus contextuels, sous-menus.\n\t * Capture les events sur toute la surface, toute action sortant du\n\t * menu (click) ferme le menu.\n\t */\n\tmenu,\n\n\t/**\n\t * Dialogue modal. Capture les events sur toute la surface,\n\t * toute action en dehors du dialogue est tuée.\n\t */\n\tdialog,\n\n\t/**\n\t * Fenêtre flottante\n\t * Aucune capture sur la surface de la page, pas de gestion de focus, ni d'évènements de fermeture.\n\t */\n\tfloating,\n\n\t/**\n\t * Tooltips.\n\t * Aucune capture sur la surface de la page, pas de gestion de focus, ni d'évènements de fermeture, non fixé à la page\n\t */\n\ttooltip\n}\n\n/**\n * Mixin pour qu'un élément implémente IPopupable pour les\n * menus, menus contextuels, dialogues, fenêtres flottantes et tooltips.\n */\nexport function MxPopupable<T extends Constructor<BaseElement>>(Base: T, type: EPopupType) {\n\treturn class MxPopupable extends Base implements IPopupable, IDomLogical, IView, IViewsContainer, ILastDatasBuilder {\n\t\tpopupType: EPopupType;\n\t\tparentPopup: IPopupable;\n\t\tcontentRoot: HTMLElement;\n\t\teltForMove: HTMLElement;\n\t\tmanuallyMoved: boolean;\n\t\tmanuallyResized: boolean;\n\n\t\tuiContainer: Node;\n\t\tlogicalParent: Element;\n\n\t\t/** A la fermeture du popup, focus cet élement. */\n\t\trestoreFocus?: HTMLElement;\n\n\t\t/** Mémoire de l'élément qui sera focusé à la fermeture = this.restoreFocus déclaré OU l'élément actif courant avant ouverture du popup. */\n\t\tprotected _restoreFocus?: HTMLElement;\n\t\tprotected _focusReentrance: EventListenerOrEventListenerObject;\n\t\tprotected _currentAnchor: OPopupAnchor;\n\t\tprotected _bodySlot: HTMLSlotElement;\n\t\tprotected _subPopupSlot: HTMLSlotElement;\n\t\tprotected _externalResize: {\n\t\t\tproxy: EventListener,\n\t\t\ttimeout: number,\n\t\t\tpreviousWidth: number,\n\t\t\tpreviousHeight: number\n\t\t};\n\t\tprotected _internalResize: {\n\t\t\tobserver: ResizeObserver,\n\t\t\trequest: number,\n\t\t\tskipNextEvent: boolean,\n\t\t\ttarget: HTMLElement,\n\t\t\tfreeze: number\n\t\t};\n\n\t\tprotected _returnValue: any;\n\n\t\tprotected _closeLstns: Dict<EventListener>;\n\t\tprotected _waitingClose: ((value?: any) => void)[];\n\n\n\t\tget opened() {return this.hasAttribute('opened')}\n\n\t\tget view(): IView {return this.firstElementChild as IView}\n\n\t\tget windowBar(): WindowBar | null {return DOM.findNext(this.shadowRoot, this.shadowRoot, (n): n is WindowBar => n instanceof WindowBar)}\n\n\t\t/** Si true, la view contenue sera définitivement fermée libération des ressources). */\n\t\tusedOnce?: boolean;\n\n\t\tprotected _initialize(init: IRegPointer<any> & OResizeObserverInit & OTitleBarPointer & OResizerPointer) {\n\t\t\tsuper._initialize(init);\n\t\t\tthis.popupType = type;\n\t\t\tthis.attachShadow(DOMSH.SHADOWDOM_INIT);\n\n\t\t\tconst sr = this.shadowRoot;\n\t\t\tconst reg = this.findReg(init);\n\t\t\treg.installSkin('popupable', sr);\n\t\t\tthis._initAndInstallSkin(this.localName, init);\n\n\t\t\t// focusStart, focusEnd permettent de verrouiller le focus dans le popup (excepté pour les tooltip)\n\t\t\tthis.shadowRoot.appendChild(<button id=\"focusStart\" onfocus={this.onFocusStart}/> as HTMLButtonElement);\n\n\t\t\t// Slot principal sur le contentRoot, cad la div de position ou le resizer\n\t\t\tthis.contentRoot = this.eltForMove = sr.appendChild(<div id=\"content\"></div>);\n\t\t\tif (init.resizer) this.contentRoot = this.contentRoot.appendChild(new WindowResizer().initialize(init.resizer));\n\t\t\t// Ajout de la barre de titre\n\t\t\tif (init.titleBar) {\n\t\t\t\tconst tiInit: OWindowBarInit = typeof init.titleBar === \"string\" ? {barLabel: {label: init.titleBar}} : init.titleBar;\n\t\t\t\tconst ti = this.contentRoot.appendChild(new WindowBar().initialize(tiInit));\n\t\t\t\tti.slot = \"title\";\n\t\t\t}\n\t\t\tthis._builBodySlot();\n\t\t\tthis.shadowRoot.appendChild(<button id=\"focusEnd\" onfocus={this.onFocusEnd}/>);\n\t\t\tthis._subPopupSlot = this.shadowRoot.appendChild(<slot name=\"subPopup\"/>) as HTMLSlotElement;\n\n\t\t\t// Initialisation de la structure pour gérer les redimensionnement externe\n\t\t\tthis._externalResize = {\n\t\t\t\tproxy: this.onExternalResize.bind(this),\n\t\t\t\tpreviousWidth: 0,\n\t\t\t\tpreviousHeight: 0,\n\t\t\t\ttimeout: 0\n\t\t\t};\n\t\t\t// Initialisation de la structure pour gérer les redimensionnement interne\n\t\t\tif (init.observeResize !== false && 'ResizeObserver' in window) {\n\t\t\t\tthis._internalResize = {\n\t\t\t\t\tobserver: new ResizeObserver(this.onInternalResize),\n\t\t\t\t\tskipNextEvent: true,\n\t\t\t\t\trequest: 0,\n\t\t\t\t\ttarget: this.contentRoot,\n\t\t\t\t\tfreeze: 0\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.addEventListener('keydown', function (this: MxPopupable, ev: KeyboardEvent) {\n\t\t\t\tif (!this.onKeyDown(ev)) {\n\t\t\t\t\t//Comportement par défaut, on ferme le popup sur Escape.\n\t\t\t\t\tif (ev.key === 'Escape') {\n\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t\t\tif (this.popupType == EPopupType.tooltip) {\n\t\t\t\t\t\t\tlet tooltip = this as IPopupable;\n\t\t\t\t\t\t\t// Fermeture de toute la hiéarchie de tooltip sur le Escape\n\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\ttooltip.tryClose();\n\t\t\t\t\t\t\t\tconst parent = tooltip.parentElement;\n\t\t\t\t\t\t\t\ttooltip = IS_Popupable(parent) && parent.popupType === EPopupType.tooltip && parent;\n\t\t\t\t\t\t\t} while (tooltip);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.tryClose();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet popup = this as IPopupable;\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tpopup.tryClose();\n\t\t\t\t\t\t\t// Fermeture de toute la hiéarchie de tooltip sur le Escape\n\t\t\t\t\t\t\tpopup = IS_Popupable(popup.parentElement) && popup.parentElement.popupType === EPopupType.tooltip && popup.parentElement;\n\t\t\t\t\t\t} while (popup);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tprotected _builBodySlot() {\n\t\t\tthis._bodySlot = this.contentRoot.appendChild(<slot id=\"body\"/>) as HTMLSlotElement;\n\t\t}\n\n\t\tshow(anchor: OPopupAnchor, uiContainer: Node, logicalParent?: Element): boolean {\n\t\t\tif (this.opened) return false;\n\t\t\tthis._returnValue = undefined;\n\t\t\tthis._restoreFocus = this.restoreFocus || DOMSH.findDeepActiveElement(document) as HTMLElement;\n\t\t\tthis.uiContainer = uiContainer;\n\t\t\tthis.logicalParent = logicalParent !== undefined ? logicalParent : DOM.findLogicalParentOrSelf(uiContainer, null, DOM.IS_element);\n\n\t\t\tif (this.dispatchEvent(new CustomEvent('c-show', {bubbles: false, composed: false, cancelable: true})) === false) return false;\n\n\t\t\tthis.internalResizeFreeze(1);\n\t\t\tthis.parentPopup = findPopupableParent(uiContainer);\n\t\t\tif (this.parentPopup) {\n\t\t\t\t//popup dans un popup, on imbrique.\n\t\t\t\tthis.remove();\n\t\t\t\tthis.setAttribute('slot', 'subPopup');\n\t\t\t\tthis.setAttribute('opened', 'sub');\n\t\t\t\tthis.parentPopup.appendChild(this);\n\t\t\t} else {\n\t\t\t\tthis.remove();\n\t\t\t\tthis.setAttribute('opened', 'main');\n\t\t\t\tdocument.body.appendChild(this);\n\t\t\t}\n\n\t\t\t// Aria roles\n\t\t\tif (type === EPopupType.menu) this.setAttribute('role', 'menu');\n\t\t\telse if (type === EPopupType.dialog || type == EPopupType.floating) this.setAttribute('role', 'dialog');\n\t\t\telse if (type === EPopupType.tooltip) this.setAttribute('role', 'tooltip');\n\n\t\t\tthis._closeLstns = {};\n\n\t\t\tif (type === EPopupType.menu || type == EPopupType.dialog) {\n\t\t\t\tif (!DOMSH.isAncestor(this._bodySlot, document.activeElement)) {\n\t\t\t\t\t// Focus sur le premier élément du menu ou du dialog\n\t\t\t\t\tconst firstFocusable = DOMSH.findFlatNext(this._bodySlot, this.contentRoot, DOM.IS_focusable);\n\t\t\t\t\tif (firstFocusable) firstFocusable.focus();\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.contentRoot.tabIndex = 0;\n\t\t\t\t\t\tthis.contentRoot.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ajout des listeners de capture du scroll pour les dialog et le menu\n\t\t\t\tthis.addEventListener('mousewheel', this.onScrollPrevent, {passive: false});\n\t\t\t\tthis.addEventListener('touchmove', this.onScrollPrevent, {passive: false});\n\t\t\t\tthis._closeLstns['mousewheel'] = this.onScrollPrevent;\n\t\t\t\tthis._closeLstns['touchmove'] = this.onScrollPrevent;\n\t\t\t}\n\n\t\t\tif (type === EPopupType.dialog) {\n\t\t\t\t// Permet de replacer le focus dans la dialogue si celui-ci était sorti de la page\n\t\t\t\tthis._focusReentrance = () => {\n\t\t\t\t\tlet subDialog = false;\n\t\t\t\t\tfor (const subPopup of this._subPopupSlot.assignedNodes()) {\n\t\t\t\t\t\tif ((subPopup as IPopupable).popupType == EPopupType.dialog) {\n\t\t\t\t\t\t\tsubDialog = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!subDialog) this.contentRoot.focus();\n\t\t\t\t};\n\t\t\t\twindow.addEventListener('focus', this._focusReentrance);\n\t\t\t}\n\n\t\t\t// Listeners de fermeture du menu\n\t\t\tif (type === EPopupType.menu) {\n\t\t\t\tthis.addEventListener('pointerdown', this.menuOnPointerDown);\n\t\t\t\tthis.addEventListener(\"contextmenu\", this.menuOnContextMenu);\n\t\t\t\tthis._closeLstns['pointerdown'] = this.menuOnPointerDown;\n\t\t\t\tthis._closeLstns['contextmenu'] = this.menuOnContextMenu;\n\t\t\t\tthis._currentAnchor = anchor;\n\t\t\t} else if (type === EPopupType.dialog) {\n\t\t\t\tthis._currentAnchor = anchor || {viewPortY: 'middle', fixSize: true};\n\t\t\t} else if (type === EPopupType.floating || type === EPopupType.tooltip) {\n\t\t\t\tthis._currentAnchor = anchor;\n\t\t\t}\n\n\n\t\t\tthis._externalResize.previousWidth = window.innerWidth;\n\t\t\tthis._externalResize.previousHeight = window.innerHeight;\n\t\t\twindow.addEventListener('resize', this._externalResize.proxy);\n\n\t\t\tthis._setPosition(this._currentAnchor);\n\t\t\tthis.internalResizeFreeze(-1);\n\n\t\t\tthis.onViewShown();\n\t\t\treturn true;\n\t\t}\n\n\t\tprotected closing?: boolean;\n\n\t\tclose(returnValue?: any): boolean {\n\t\t\tif (!this.opened || this.closing) return false;\n\t\t\tthis._returnValue = returnValue;\n\t\t\tthis.closing = true; //reentrancy guard\n\t\t\tthis.dispatchEvent(new CustomEvent('c-beforeclose', {\n\t\t\t\tbubbles: false,\n\t\t\t\tcomposed: false,\n\t\t\t\tcancelable: false,\n\t\t\t\tdetail: {returnValue: this._returnValue}\n\t\t\t}));\n\t\t\tthis.closing = false;\n\t\t\tfor (const eventType in this._closeLstns) this.removeEventListener(eventType, this._closeLstns[eventType]);\n\t\t\tif (this._focusReentrance) window.removeEventListener('focus', this._focusReentrance);\n\t\t\twindow.removeEventListener('resize', this._externalResize.proxy);\n\t\t\tclearTimeout(this._externalResize.timeout);\n\t\t\tif (this._internalResize) this._internalResize.observer.disconnect();\n\t\t\tthis.onViewHidden(this.usedOnce);\n\t\t\treturn true;\n\t\t}\n\n\t\tasync tryClose(returnValue?: any): Promise<boolean> {\n\t\t\tif (!this.opened) return false;\n\t\t\tthis._returnValue = returnValue;\n\t\t\tif (await VIEWS.canHideView(this, true)) {\n\t\t\t\treturn this.close(returnValue);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tonNextClose(): Promise<any> {\n\t\t\treturn new Promise((resolve: (value?: any) => void) => {\n\t\t\t\tif (!this._waitingClose) this._waitingClose = [resolve];\n\t\t\t\telse this._waitingClose.push(resolve);\n\t\t\t});\n\t\t}\n\n\t\tonViewShown() {\n\t\t\tthis.dispatchEvent(new CustomEvent('c-shown', {bubbles: false, composed: false}));\n\t\t\tVIEWS.onViewShown(this.view);\n\t\t}\n\n\t\tonViewBeforeHide(close?: boolean): boolean {\n\t\t\tfor (const subPopup of this._subPopupSlot.assignedNodes() as IView[]) {\n\t\t\t\tif ('onViewBeforeHide' in subPopup && !subPopup.onViewBeforeHide(close)) return false;\n\t\t\t}\n\t\t\tif (this.view && 'onViewBeforeHide' in this.view && !this.view.onViewBeforeHide(close)) return false;\n\n\t\t\tif (close) {\n\t\t\t\tconst beforeCloseEvent = new CustomEvent('c-beforeclose', {\n\t\t\t\t\tbubbles: false,\n\t\t\t\t\tcomposed: false,\n\t\t\t\t\tcancelable: true,\n\t\t\t\t\tdetail: {returnValue: this._returnValue}\n\t\t\t\t});\n\t\t\t\tif (this.dispatchEvent(beforeCloseEvent) === false) return false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tasync onViewWaitForHide(close?: boolean): Promise<boolean> {\n\t\t\tfor (const subPopup of this._subPopupSlot.assignedNodes() as IView[]) {\n\t\t\t\tif ('onViewWaitForHide' in subPopup && !await subPopup.onViewWaitForHide(close)) return false;\n\t\t\t}\n\t\t\tif (this.view && 'onViewWaitForHide' in this.view && !await this.view.onViewWaitForHide(close)) return false;\n\t\t\t// Pas d'attente pour la popup proprement dite\n\t\t\treturn true;\n\t\t}\n\n\t\t/** Replace le popup dans son contexte d'origine et dispatch les evts de la fermeture. */\n\t\tonViewHidden(closed?: boolean) {\n\t\t\tfor (const subPopup of this._subPopupSlot.assignedNodes() as IView[]) {\n\t\t\t\tVIEWS.onViewHidden(subPopup, closed);\n\t\t\t}\n\t\t\tVIEWS.onViewHidden(this.view, closed);\n\n\t\t\t// Pas d'attente pour la popup proprement dite\n\t\t\tthis.removeAttribute('opened');\n\n\t\t\t// On restore le focus que si le popup détient le toujours (ie une action ne l'a pas volotairement placé en dehors).\n\t\t\tif (this._restoreFocus && this.contentRoot && this.matches(\":focus-within\") && this._restoreFocus.isConnected) {\n\t\t\t\tthis._restoreFocus.focus();\n\t\t\t\tthis._restoreFocus = null;\n\t\t\t}\n\n\t\t\tif (this.parentNode) this.remove();\n\n\t\t\tif (this._waitingClose) {\n\t\t\t\tfor (const fct of this._waitingClose) fct(this._returnValue);\n\t\t\t\tthis._waitingClose = null;\n\t\t\t}\n\t\t\tthis.dispatchEvent(new CustomEvent('c-close', {bubbles: true, composed: false, detail: {returnValue: this._returnValue}}));\n\n\t\t\tdelete this.logicalParent; //il sera réaffecté au prochain appel show().\n\t\t}\n\n\t\tvisitViews(visitor: (view: IView) => any, options?: OViewVisitOptions): any {\n\t\t\tif (options && options.visible && !this.opened) return;\n\t\t\tlet result;\n\t\t\tif (this.view) result = visitor(this.view);\n\t\t\tif (result !== undefined) return result;\n\t\t\tfor (const subPopup of this._subPopupSlot.assignedNodes() as IView[]) {\n\t\t\t\tresult = visitor(subPopup);\n\t\t\t\tif (result !== undefined) return result;\n\t\t\t}\n\t\t}\n\n\t\tasync visitViewsAsync(visitor: (view: IView) => Promise<any>, options?: OViewVisitOptions): Promise<any> {\n\t\t\tif (options && options.visible && !this.opened) return;\n\t\t\tlet result;\n\t\t\tif (this.view) result = await visitor(this.view);\n\t\t\tif (result !== undefined) return result;\n\t\t\tfor (const subPopup of this._subPopupSlot.assignedNodes() as IView[]) {\n\t\t\t\tresult = await visitor(subPopup);\n\t\t\t\tif (result !== undefined) return result;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * On tue le parcours de la hiérarchie à la racine d'un popupable. C'est le contexte\n\t\t * suscpetible de réouvrir ce popupable qui doit appeler LASTDATAS.buildLastDatas(..., popupable)\n\t\t */\n\t\tbuildLastDatas(parentLastDatas: JLastDatas): void {}\n\n\t\t/**\n\t\t * Pour EPopupType.menu, permet de surcharger le comportement du popup sur un KeyboardEvent.\n\t\t * @return true si l'event a été pris en charge.\n\t\t */\n\t\tprotected onKeyDown(ev: KeyboardEvent): boolean {return false}\n\n\n\t\t/** Pour EPopupType.menu, listener qui ferme la popup ou le menu racine sur un clic en dehors du contentRoot */\n\t\tprotected menuOnPointerDown(ev: PointerEvent) {\n\t\t\tif (ev.button != 2 && ev.composedPath()[0] === this) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tlet rootMenu: IPopupable = this;\n\t\t\t\twhile (rootMenu.parentPopup && rootMenu.parentPopup.popupType == EPopupType.menu) rootMenu = rootMenu.parentPopup;\n\t\t\t\trootMenu.tryClose();\n\t\t\t}\n\t\t}\n\n\t\t/** Pour EPopupType.menu, listener qui ferme la popup ou le menu racine sur un contextmenu en dehors du contentRoot */\n\t\tprotected menuOnContextMenu(ev: MouseEvent) {\n\t\t\tif (ev.composedPath()[0] === this) {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tev.preventDefault();\n\t\t\t\tlet rootMenu: IPopupable = this;\n\t\t\t\twhile (rootMenu.parentPopup && rootMenu.parentPopup.popupType == EPopupType.menu) rootMenu = rootMenu.parentPopup;\n\t\t\t\trootMenu.tryClose();\n\t\t\t}\n\t\t}\n\n\t\t/** Pour EPopupType.menu, listener qui bloque le scroll lorsque le menu est ouvert */\n\t\tprotected onScrollPrevent(ev: MouseEvent) {\n\t\t\tif (ev.composedPath()[0] == this) ev.preventDefault();\n\t\t}\n\n\t\tprotected _setPosition(anchor: OPopupAnchor) {\n\t\t\tthis.internalResizeFreeze(1);\n\t\t\tconst st = this.eltForMove.style;\n\t\t\t// on le force au début en haut à gauche pour éviter tout effet de pre-sizing lié à sa\n\t\t\t// position relative naturelle et les limites du viewport qui peuvent réduire sa hauteur ou largeur.\n\t\t\tst.top = '0';\n\t\t\tst.left = '0';\n\t\t\tst.width = (anchor as OInitSize).initWidth || null;\n\t\t\tst.height = (anchor as OInitSize).initHeight || null;\n\t\t\tst.maxHeight = (anchor as OInitSize).initMaxHeight || null;\n\t\t\tst.maxWidth = null;\n\t\t\tlet {width, height} = this.eltForMove.getBoundingClientRect();\n\n\t\t\tif ((anchor as OInitSize).fixSize) {\n\t\t\t\tconst padding = (anchor as OViewPortPosition).viewPortPadding || 10;\n\t\t\t\tconst maxW = document.documentElement.clientWidth - padding * 2;\n\t\t\t\tif (width > maxW) {\n\t\t\t\t\twidth = maxW;\n\t\t\t\t\tst.width = width + 'px';\n\t\t\t\t\theight = this.eltForMove.offsetHeight;\n\t\t\t\t} else st.width = width + 'px';\n\t\t\t\tst.height = Math.min(document.documentElement.clientHeight - padding * 2, height) + 'px';\n\t\t\t}\n\n\t\t\tconst aroundElem = isAroundPosition(anchor) ? anchor.elem : (anchor instanceof HTMLElement ? anchor : null);\n\t\t\tif (aroundElem && aroundElem !== this.eltForMove /*anchor === node => anchor props portés par le popup (notif) */) {\n\t\t\t\tthis.fixAroundPos(aroundElem, st, width, height);\n\t\t\t} else if (isFixedPosition(anchor)) {\n\t\t\t\tif (anchor.initX + width <= document.documentElement.clientWidth) st.left = anchor.initX + 'px';\n\t\t\t\telse st.left = Math.max(0, document.documentElement.clientWidth - width) + 'px';\n\t\t\t\tif (anchor.initY + height <= document.documentElement.clientHeight) st.top = anchor.initY + 'px';\n\t\t\t\telse st.top = Math.max(0, document.documentElement.clientHeight - height) + 'px';\n\t\t\t} else if (isRelativePosition(anchor)) {\n\t\t\t\tthis.fixRelativePos(anchor, this.eltForMove, width, height);\n\t\t\t} else {\n\t\t\t\tthis.fixScreenPos(anchor as OViewPortPosition, this.eltForMove, width, height);\n\t\t\t}\n\n\t\t\tif (!(anchor as OInitSize).fixSize) {\n\t\t\t\t//On impose les maxHeight et maxWidth pour restreindre node\n\t\t\t\tst.maxWidth = (document.documentElement.clientWidth - parseInt(st.left.substr(0, st.left.length - 2))) + 'px';\n\t\t\t\tif (!(anchor as OInitSize).initMaxHeight) {\n\t\t\t\t\tst.maxHeight = (document.documentElement.clientHeight - parseInt(st.top.substr(0, st.top.length - 2))) + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._currentAnchor = anchor;\n\t\t\tthis.internalResizeFreeze(-1);\n\t\t}\n\n\t\tupdatePosition() {\n\t\t\tif ((this.manuallyMoved || this.manuallyResized)) {\n\t\t\t\tconst style = getComputedStyle(this.eltForMove);\n\t\t\t\tlet anchor: Exclude<OPopupAnchor, HTMLElement>;\n\n\t\t\t\tif (this.manuallyMoved) {\n\t\t\t\t\tanchor = {\n\t\t\t\t\t\tinitX: parseFloat(style.left) * window.innerWidth / this._externalResize.previousWidth,\n\t\t\t\t\t\tinitY: parseFloat(style.top) * window.innerHeight / this._externalResize.previousHeight,\n\t\t\t\t\t\tinitWidth: (this._currentAnchor as OInitSize).initWidth,\n\t\t\t\t\t\tinitHeight: (this._currentAnchor as OInitSize).initHeight,\n\t\t\t\t\t\tfixSize: (this._currentAnchor as OInitSize).fixSize,\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (this._currentAnchor instanceof HTMLElement) {\n\t\t\t\t\t\tanchor = {\n\t\t\t\t\t\t\tinitX: parseFloat(style.left),\n\t\t\t\t\t\t\tinitY: parseFloat(style.top),\n\t\t\t\t\t\t\tinitWidth: null,\n\t\t\t\t\t\t\tinitHeight: null,\n\t\t\t\t\t\t\tfixSize: false\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tanchor = Object.assign({}, this._currentAnchor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.manuallyResized) {\n\t\t\t\t\tanchor.fixSize = true;\n\t\t\t\t\tanchor.initWidth = parseFloat(style.width) * window.innerWidth / this._externalResize.previousWidth + 'px';\n\t\t\t\t\tanchor.initHeight = (parseFloat(style.height) * window.innerHeight / this._externalResize.previousHeight) + 'px';\n\t\t\t\t}\n\t\t\t\tthis._setPosition(anchor);\n\t\t\t} else {\n\t\t\t\tthis._setPosition(this._currentAnchor);\n\t\t\t}\n\t\t}\n\n\t\tprotected fixAroundPos(anchor: Element | ClientRect, st: CSSStyleDeclaration, width: number, height: number) {\n\t\t\tconst anchorRect = 'left' in anchor ? anchor : anchor.getBoundingClientRect();\n\t\t\tif (anchorRect.left + width <= document.documentElement.clientWidth) st.left = Math.round(anchorRect.left) + 'px';\n\t\t\telse st.left = Math.max(0, Math.round(anchorRect.right - width)) + 'px';\n\t\t\tif (anchorRect.bottom + height <= document.documentElement.clientHeight) st.top = Math.round(anchorRect.bottom) + 'px';\n\t\t\telse st.top = Math.max(0, Math.round(anchorRect.top - height)) + 'px';\n\t\t}\n\n\t\tprotected fixRelativePos(pos: ORelativePosition, target: HTMLElement, targetW: number, targetH: number): boolean {\n\t\t\tlet fromRect = pos.posFrom.getBoundingClientRect();\n\t\t\tif (pos.intersectWith) fromRect = GFX.intersect(fromRect, pos.intersectWith.getBoundingClientRect()) || pos.intersectWith.getBoundingClientRect();\n\t\t\tconst dir = window.getComputedStyle(pos.posFrom).direction || 'ltr';\n\n\t\t\tlet x;\n\t\t\tswitch (pos.fromX) {\n\t\t\tcase 'end':\n\t\t\t\tx = dir === 'ltr' ? fromRect.right : fromRect.left;\n\t\t\t\tbreak;\n\t\t\tcase 'middle':\n\t\t\t\tx = fromRect.left + (fromRect.right - fromRect.left) / 2;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tx = dir === 'ltr' ? fromRect.left : fromRect.right;\n\t\t\t}\n\t\t\tif (pos.marginX) x += dir === 'ltr' ? pos.marginX : -pos.marginX;\n\t\t\tswitch (pos.targetX) {\n\t\t\tcase 'end':\n\t\t\t\tif (dir === 'ltr') x -= targetW;\n\t\t\t\tbreak;\n\t\t\tcase 'middle':\n\t\t\t\tx += (dir === 'ltr') ? -targetW / 2 : targetW / 2;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (dir === 'rtl') x -= targetW;\n\t\t\t}\n\n\t\t\tconst tolX = pos.toleranceX || 0;\n\t\t\tconst winX = document.documentElement.clientWidth - targetW;\n\t\t\tif (x >= -tolX && x <= winX + tolX) {\n\t\t\t\tlet y;\n\t\t\t\tswitch (pos.fromY) {\n\t\t\t\tcase 'bottom':\n\t\t\t\t\ty = fromRect.bottom;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'middle':\n\t\t\t\t\ty = fromRect.top + (fromRect.bottom - fromRect.top) / 2;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\ty = fromRect.top;\n\t\t\t\t}\n\t\t\t\tif (pos.marginY) y += pos.marginY;\n\t\t\t\tswitch (pos.targetY) {\n\t\t\t\tcase 'bottom':\n\t\t\t\t\ty -= targetH;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'middle':\n\t\t\t\t\ty -= targetH / 2;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconst tolY = pos.toleranceY || 0;\n\t\t\t\tconst winY = document.documentElement.clientHeight - targetH;\n\t\t\t\tif (y >= -tolY && y <= winY + tolY) {\n\t\t\t\t\ttarget.style.top = Math.max(0, Math.min(winY, y)) + 'px';\n\t\t\t\t\ttarget.style.left = Math.max(0, Math.min(winX, x)) + 'px';\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (pos.notAvailableSpace) {\n\t\t\t\tif (isRelativePosition(pos.notAvailableSpace)) return this.fixRelativePos(pos.notAvailableSpace, target, targetW, targetH);\n\t\t\t\tthis.fixScreenPos(pos.notAvailableSpace, target, targetW, targetH);\n\t\t\t} else {\n\t\t\t\tthis.fixAroundPos(pos.posFrom, target.style, targetW, targetH);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tprotected fixScreenPos(anchor: OViewPortPosition, target: HTMLElement, targetW: number, targetH: number) {\n\t\t\tconst dir = window.getComputedStyle(target).direction || 'ltr';\n\t\t\tconst padding = anchor.viewPortPadding || 10;\n\t\t\tconst winW = document.documentElement.clientWidth;\n\t\t\tconst winH = document.documentElement.clientHeight;\n\t\t\tconst maxWinW = winW - padding - padding;\n\t\t\tconst maxWinH = winH - padding - padding;\n\t\t\tif (targetW > maxWinW || targetH > maxWinH) {\n\t\t\t\t//on restreint les dimensions\n\t\t\t\tconst originalW = target.style.maxWidth;\n\t\t\t\tconst originalH = target.style.maxHeight;\n\t\t\t\tif (targetW > maxWinW) target.style.maxWidth = maxWinW + 'px';\n\t\t\t\tif (targetH > maxWinH) target.style.maxHeight = maxWinH + 'px';\n\t\t\t\ttargetW = target.offsetWidth;\n\t\t\t\ttargetH = target.offsetHeight;\n\t\t\t\tconst resetMaxSize = () => {\n\t\t\t\t\ttarget.style.maxWidth = originalW;\n\t\t\t\t\ttarget.style.maxHeight = originalH;\n\t\t\t\t\tthis.removeEventListener('c-close', resetMaxSize);\n\t\t\t\t};\n\t\t\t\tthis.addEventListener('c-close', resetMaxSize);\n\t\t\t}\n\t\t\tlet x: number;\n\t\t\tlet y: number;\n\t\t\tif (anchor.viewPortX === 'start') x = dir === 'ltr' ? padding : winW - targetW - padding;\n\t\t\telse if (anchor.viewPortX === 'end') x = dir === 'ltr' ? winW - targetW - padding : padding;\n\t\t\telse x = (winW - targetW) / 2;\n\t\t\tif (anchor.viewPortY === 'bottom') y = winH - targetH - padding;\n\t\t\telse if (anchor.viewPortY === '1/3') y = (winH - targetH) / 3;\n\t\t\telse if (anchor.viewPortY === 'middle') y = (winH - targetH) / 2;\n\t\t\telse y = padding;\n\t\t\ttarget.style.top = y + 'px';\n\t\t\ttarget.style.left = x + 'px';\n\t\t}\n\n\t\tonFocusStart(this: Button): void {\n\t\t\tlet newFocus;\n\t\t\tconst popupable = DOMSH.findHost<MxPopupable>(this);\n\t\t\tif (type === EPopupType.tooltip) {\n\t\t\t\tnewFocus = DOM.IS_focusable(popupable.uiContainer) ? popupable.uiContainer : DOMSH.findFlatPrevious(popupable.uiContainer, document, DOM.IS_focusable);\n\t\t\t\tpopupable.tryClose();\n\t\t\t} else {\n\t\t\t\tnewFocus = DOMSH.findFlatLastDesc(popupable.contentRoot.lastChild, DOM.IS_focusable);\n\t\t\t}\n\t\t\tif (newFocus) newFocus.focus();\n\t\t}\n\n\t\tonFocusEnd(this: Button): void {\n\t\t\tlet newFocus;\n\t\t\tconst popupable = DOMSH.findHost<MxPopupable>(this);\n\t\t\tif (type === EPopupType.tooltip) {\n\t\t\t\tif(!DEBUG_TOOLTIP) {\n\t\t\t\t\tnewFocus = DOMSH.findFlatNext(popupable.uiContainer, document, DOM.IS_focusable);\n\t\t\t\t\tpopupable.tryClose();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnewFocus = DOMSH.findFlatNext(popupable.contentRoot, popupable.contentRoot, DOM.IS_focusable);\n\t\t\t}\n\t\t\tif (newFocus) newFocus.focus();\n\t\t}\n\n\t\tonExternalResize(this: MxPopupable, ev: UIEvent) {\n\t\t\tif (this._externalResize.timeout !== null) window.cancelIdleCallback(this._externalResize.timeout);\n\t\t\tthis._externalResize.timeout = window.requestIdleCallback(() => {\n\t\t\t\tthis._externalResize.timeout = null;\n\t\t\t\tthis.updatePosition();\n\t\t\t\tthis._externalResize.previousWidth = window.innerWidth;\n\t\t\t\tthis._externalResize.previousHeight = window.innerHeight;\n\t\t\t});\n\t\t}\n\n\t\tonInternalResize(this: void, entries: ResizeObserverEntry[]): void {\n\t\t\tconst popupable = findPopupableParent(entries[0].target) as MxPopupable;\n\t\t\tif (popupable._internalResize.skipNextEvent) {\n\t\t\t\tpopupable._internalResize.skipNextEvent = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (popupable._internalResize.request) return;\n\t\t\tif (popupable.manuallyResized) {\n\t\t\t\tpopupable._internalResize.observer.unobserve(popupable._internalResize.target);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpopupable._internalResize.request = window.requestAnimationFrame(() => {\n\t\t\t\tpopupable._internalResize.request = 0;\n\t\t\t\tpopupable.updatePosition();\n\t\t\t});\n\t\t}\n\n\t\tinternalResizeFreeze(delta: number) {\n\t\t\tif (this._internalResize) {\n\t\t\t\tthis._internalResize.freeze += delta;\n\t\t\t\tif (this._internalResize.freeze === 1) this._internalResize.observer.unobserve(this._internalResize.target)\n\t\t\t\telse if (this._internalResize.freeze === 0) {\n\t\t\t\t\tthis._internalResize.skipNextEvent = true;\n\t\t\t\t\tthis._internalResize.observer.observe(this._internalResize.target);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nREG.reg.registerSkin('popupable', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: none;\n\t}\n\n\t:host([opened]) {\n\t\tdisplay: block;\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tz-index: 1001;\n\t\tpointer-events: none;\n\t}\n\n\t#content {\n\t\tdisplay: flex;\n\t\tposition: fixed;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\tbox-sizing: border-box;\n\t\tpointer-events: auto;\n\t}\n\n\t#focusStart, #focusEnd {\n\t\tposition: absolute;\n\t\tborder: 0;\n\t\tpadding: 0;\n\t}\n`);\n\n\nexport interface OTitleBarPointer {\n\ttitleBar?: OWindowBarInit | string;\n}\n\nexport interface OResizerPointer {\n\tresizer?: OWindowResizerInit\n}\n\nexport type OPopupAnchor =\n/** Positionne le popup au dessus ou en dessous de cet élément, aligné à gauche ou à droite en fonction l'espace dispo. */\n\tHTMLElement\n\t/** Similaire au positionnement par élément mais avec les options d'initialisation de taille */\n\t| OAroundPosition\n\t/** Coordonnées fixées, mais contraintes par la taille de la window. */\n\t| OFixedPosition\n\t/** Position relative avancée. */\n\t| ORelativePosition\n\t/** Position relative au viewport. */\n\t| OViewPortPosition;\n\n\nexport interface OInitSize {\n\t/** Largeur à utiliser pour initialiser le popup. */\n\tinitWidth?: string\n\t/** Hauteur à utiliser pour initialiser le popup. */\n\tinitHeight?: string\n\n\t/**\n\t * Si activé, ajoute les propriétés width / height après l'initialisation du popup.\n\t *\n\t * Nécessaire si le contenu contient une zone de scroll en flex=1.\n\t * Inconvénient: ne s'adapte plus dynamiquement en fonction des changements du contenu.\n\t *\n\t * Les dialogs et floatting windows sont en fixSize=true par défaut,\n\t * => ajouter explicitement fixSize=false si le dialogue ne s'ajuste pas à la hauteur (ie pas de flex=1)\n\t */\n\tfixSize?: boolean\n\n\t/** Si fixSize=false, spécifie un min au max-height du popup.*/\n\tinitMaxHeight?: string\n}\n\nexport interface OAroundPosition extends OInitSize {\n\telem: HTMLElement | ClientRect\n}\n\nfunction isAroundPosition(anchor: any): anchor is OAroundPosition { return 'elem' in anchor }\n\nexport interface OFixedPosition extends OInitSize {\n\tinitX: number\n\tinitY: number\n}\n\nfunction isFixedPosition(anchor: any): anchor is OFixedPosition {return 'initX' in anchor}\n\nexport interface ORelativePosition extends OInitSize {\n\tposFrom: Element\n\t/** Intersection du rect de posFrom avec intersectWith. */\n\tintersectWith?: Element\n\tfromX?: 'start' /* default */ | 'middle' | 'end'\n\ttargetX?: 'start' /* default */ | 'middle' | 'end'\n\t/* Distance en pixel entre les deux lignes. si >0 target est plus à droite de posFrom en LTR, l'inverse en RTL. */\n\tmarginX?: number\n\t/* Variation autorisée de la margin en pixels pour trouver l'espace nécessaire. Toujours >0.*/\n\ttoleranceX?: number\n\tfromY?: 'top' /* default */ | 'middle' | 'bottom'\n\ttargetY?: 'top' /* default */ | 'middle' | 'bottom'\n\tmarginY?: number\n\ttoleranceY?: number\n\tnotAvailableSpace?: ORelativePosition | OViewPortPosition\n}\n\nfunction isRelativePosition(anchor: any): anchor is ORelativePosition {return anchor.posFrom}\n\nexport interface OViewPortPosition extends OInitSize {\n\tviewPortX?: 'start' | 'middle' /* default */ | 'end'\n\tviewPortY?: 'top' /* default */ | '1/3' | 'middle' | 'bottom'\n\tviewPortPadding?: number //10 par défaut, pour start, end, top, bottom\n}\n\nexport interface WindowBar extends OWindowBarInit {\n\tinitialize(init: OWindowBarInit): this;\n}\n\nexport interface OWindowBarInit extends OSkinableInit {\n\tcloseButton?: OButtonInit;\n\tbarLabel?: OLabelInit | (() => HTMLElement);\n\tnoDrag?: boolean;\n}\n\nexport class WindowBar extends BaseElement {\n\tcloseButton?: Button;\n\tbarLabel?: Label;\n\n\tget noDrag(): boolean {return this.getAttribute('draggable') !== 'true'}\n\n\tprotected _initialize(init: OWindowBarInit) {\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tconst reg = this.findReg(init);\n\t\tif (typeof init.barLabel === \"function\") {\n\t\t\tsr.appendChild(init.barLabel());\n\t\t} else {\n\t\t\tlet initLabel: OLabelInit;\n\t\t\tif (init.barLabel) {\n\t\t\t\tinitLabel = init.barLabel;\n\t\t\t\tif (!('noShadow' in initLabel)) initLabel.noShadow = true;\n\t\t\t\tif (!('ellipsis' in initLabel)) initLabel.ellipsis = true;\n\t\t\t} else {\n\t\t\t\tinitLabel = {noShadow: true, ellipsis: true};\n\t\t\t}\n\t\t\tinitLabel.reg = reg;\n\t\t\tthis.barLabel = sr.appendChild(new Label().initialize(initLabel));\n\t\t}\n\t\tif (init.closeButton !== null) {\n\t\t\tconst initBtn = BASIS.newInit(init.closeButton, reg);\n\t\t\tif (!initBtn.uiContext) initBtn.uiContext = 'custom';\n\t\t\tif (!('icon' in initBtn)) initBtn.icon = '/@skin@/commons/widgets/popupable/close.svg';\n\t\t\tif (!initBtn.title) initBtn.title = 'Fermer';\n\t\t\tthis.closeButton = sr.appendChild(new Button().initialize(initBtn));\n\t\t\tthis.closeButton.onclick = (ev: UIEvent) => {findPopupableParent(this).tryClose()};\n\t\t}\n\t\tthis._initAndInstallSkin('c-window-bar', init);\n\t\tif (!init.noDrag) this.setAttribute('draggable', 'true');\n\t\tif (!this.noDrag) {\n\t\t\tthis.ondragstart = windowDragStart;\n\t\t\tthis.ondragover = defaulDragHover;\n\t\t}\n\t}\n}\n\nREG.reg.registerSkin('c-window-bar', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: min-content;\n\t\tmin-width: 0;\n\t\talign-items: center;\n\t\tcolor: var(--dialog-color);\n\t\tbackground-color: var(--dialog-bgcolor);\n\t\t--pressed-bgcolor: var(--inv-pressed-bgcolor);\n\t\t--filter: var(--inv-filter);\n\t\t--hover-filter: var(--inv-hover-filter);\n\t\t--active-filter: var(--inv-active-filter);\n\t\tpadding: 0.2em 0.5em;\n\t}\n\n\tc-label {\n\t\tflex: 1;\n\t\tuser-select: none;\n\t\tfont-size: 1.1em;\n\t\twidth: min-content;\n\t\toverflow: hidden;\n\t\tdisplay: -webkit-box;\n\t  -webkit-line-clamp: 2;\n\t  -webkit-box-orient: vertical;\n\t}\n\n\tc-button {\n\t\tmargin-inline-start: .5em;\n\t}\n\n\t.icon {\n\t\tbackground: var(--dialog-color) var(--icon-img) no-repeat center / contain;\n\t}\n`);\n\ncustomElements.define('c-window-bar', WindowBar);\n\n\nfunction windowDragStart(this: WindowBar, ev: DragEvent) {\n\tconst popupable = findPopupableParent(this);\n\tpopupable.manuallyMoved = true;\n\tconst toMove = popupable.eltForMove;\n\tconst rect = toMove.getBoundingClientRect();\n\t//On fige :\n\tconst st = toMove.style;\n\tst.margin = \"unset\"; //Peut perturber (margin: auto dans dialog).\n\tst.left = rect.left + 'px';\n\tst.top = rect.top + 'px';\n\tst.width = rect.width + 'px';\n\tst.height = rect.height + 'px';\n\tst.right = null;\n\tst.bottom = null;\n\tev.dataTransfer.effectAllowed = 'move';\n\tev.dataTransfer.setDragImage(<span/>, 0, 0);\n\tconst baseLeft = rect.left - ev.screenX;\n\tconst baseTop = rect.top - ev.screenY;\n\tthis.ondrag = (ev: DragEvent) => {\n\t\tif (ev.clientX === 0) return;//bug chrome63 : au drop un event 'drag' avec tout à 0 est dispatché.\n\t\ttoMove.style.left = (baseLeft + ev.screenX) + 'px';\n\t\ttoMove.style.top = (baseTop + ev.screenY) + 'px';\n\t};\n}\n\nfunction defaulDragHover(ev: DragEvent) {\n\tev.dataTransfer.dropEffect = 'move';\n\tev.preventDefault();\n}\n\n\nexport interface OWindowResizerInit extends OSkinableInit {}\n\n\nexport interface WindowResizer {\n\tinitialize(init?: OWindowResizerInit): this;\n}\n\nexport class WindowResizer extends BaseElement {\n\tprotected _initialize(init: OSkinableInit) {\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tthis.addHandler(\"tl\", sr);\n\t\tthis.addHandler(\"t\", sr);\n\t\tthis.addHandler(\"tr\", sr);\n\t\tthis.addHandler(\"l\", sr);\n\t\tsr.appendChild(<slot/>);\n\t\tthis.addHandler(\"r\", sr);\n\t\tthis.addHandler(\"l\", sr);\n\t\tsr.appendChild(<slot name=\"title\"/>);\n\t\tthis.addHandler(\"r\", sr);\n\t\tthis.addHandler(\"bl\", sr);\n\t\tthis.addHandler(\"b\", sr);\n\t\tthis.addHandler(\"br\", sr);\n\t}\n\n\tprotected addHandler(pos: string, sr: ShadowRoot) {\n\t\tconst div = sr.appendChild(<div id={pos} draggable=\"true\"/>);\n\t\tdiv.ondragstart = resizerDragStart;\n\t\tdiv.ondragover = defaulDragHover\n\t}\n\n}\n\nfunction resizerDragStart(this: HTMLDivElement, ev: DragEvent) {\n\tconst popupable = findPopupableParent(this);\n\tpopupable.manuallyResized = true;\n\tconst toMove = popupable.eltForMove;\n\tconst rect = toMove.getBoundingClientRect();\n\t//On fige :\n\tconst st = toMove.style;\n\tst.margin = \"unset\"; //Peut perturber (margin: auto dans dialog).\n\tst.left = rect.left + 'px';\n\tst.top = rect.top + 'px';\n\tconst dR = document.documentElement.clientWidth - rect.right;\n\tst.right = dR + 'px';\n\tconst dB = document.documentElement.clientHeight - rect.bottom;\n\tst.bottom = dB + 'px';\n\tst.width = 'auto'; //écrase la valeur fit-content dans dialog\n\tst.height = 'auto'; //écrase la valeur fit-content dans dialog\n\tev.dataTransfer.effectAllowed = 'move';\n\tev.dataTransfer.setDragImage(<span/>, 0, 0);\n\tconst pos = this.getAttribute('id');\n\tconst baseLeft = rect.left - ev.screenX;\n\tconst baseTop = rect.top - ev.screenY;\n\tconst baseRight = dR + ev.screenX;\n\tconst baseBottom = dB + ev.screenY;\n\tthis.ondrag = (ev: DragEvent) => {\n\t\tif (ev.screenX === 0) return;//bug chrome63 : au drop un event 'drag' avec tout à 0 est dispatché.\n\t\tif (pos.indexOf('l') >= 0) toMove.style.left = (baseLeft + ev.screenX) + 'px';\n\t\tif (pos.indexOf('t') >= 0) toMove.style.top = (baseTop + ev.screenY) + 'px';\n\t\tif (pos.indexOf('r') >= 0) toMove.style.right = (baseRight - ev.screenX) + 'px';\n\t\tif (pos.indexOf('b') >= 0) toMove.style.bottom = (baseBottom - ev.screenY) + 'px';\n\t};\n}\n\ncustomElements.define('c-window-resizer', WindowResizer);\n\nREG.reg.registerSkin('c-window-resizer', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: grid;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tgrid-template-columns: 7px 1fr 7px;\n\t\tgrid-template-rows: 7px auto 1fr 7px;\n\t\tgrid-template-areas: \"tl t tr\" \"l title r\" \"l slot r\" \"bl b br\";\n\t\tmargin: -7px;\n\t}\n\n\t:host(:focus) {\n\t\toutline: var(--focus-outline);\n\t}\n\n\tslot {\n\t\tgrid-area: slot;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\toverflow: auto;\n\t}\n\n\tslot[name=title] {\n\t\tgrid-area: title;\n\t\toverflow: hidden;\n\t}\n\n\tdiv {\n\t\tgrid-area: attr(id);\n\t}\n\n\t#tl {\n\t\tcursor: se-resize;\n\t}\n\n\t#br {\n\t\tcursor: se-resize;\n\t}\n\n\t#t, #b {\n\t\tcursor: ns-resize;\n\t}\n\n\t#tr, #bl {\n\t\tcursor: ne-resize;\n\t}\n\n\t#l, #r {\n\t\tcursor: ew-resize;\n\t}\n`);\n\nexport function findPopupableParent(from: Node, root?: Element): IPopupable {\n\treturn DOMSH.findFlatParentElt(from, root, IS_Popupable);\n}\n\n/** Utilisé pour bloquer la fermeture du popup sur perte du focus et peremettre le debug. */\nexport const DEBUG_TOOLTIP = false; //false\n\nREG.reg.registerSkin(\"standard-dialog\", 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t}\n\n  #main {\n\t  flex: 1;\n\t  display: flex;\n\t  min-height: 0;\n\t  min-width: 0;\n\t  flex-direction: column;\n\t  padding: 1em;\n  }\n\n\t#footer {\n\t\tdisplay: flex;\n\t\tmin-height: fit-content;\n\t\tmin-width: 0;\n\t\talign-items: center;\n\t\tjustify-content: flex-end;\n\t\tborder-top: 1px solid var(--border-color);\n\t}\n`);\n"]}