{"version":3,"sources":["/@back@/commons/basis.tsx"],"names":["REG","DOM","JSX","DOMSH","Desk","ACTION","LANG","isEltRefreshable","elt","BaseElement","HTMLElement","[object Object]","this","_refreshFreeze","delta","refreshFreeze","ch","findFirstChild","findNextSibling","refreshFreezeAll","initialized","_initialize","init","buildInitFromAtts","console","warn","_shouldRefresh","_refresh","initialize","isConnected","hasAttribute","skin","BASIS","extractAttr","skinOver","defaultSkin","reg","findReg","installSkin","shadowRoot","sk","split","children","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","append","BaseElementAsync","initStatus","initializedAsync","Promise","resolve","reject","_initResolved","_initRejected","then","cb","e","promise","Error","isEltInitableAsync","isEltInitableAsyncPending","registerSkin","Box","localName","customElements","define","Label","icon","_icon","value","refresh","label","_label","val","hidden","setHidden","title","setAttrBool","ellipsis","noShadow","_initSkin","appendChild","document","createElement","super","_iconElt","_createIcon","_lastUrlIcon","style","setProperty","startsWith","_labelElt","_createLabel","setTextContent","insertBefore","class","nextSibling","connectedCallback","titleOnEllipsisObserver","observe","unobserve","FileSystemPath","openBtn","revealBtn","type","addEventListener","event","window","getSelection","selectAllChildren","textContent","md","getAttribute","lv","setAttribute","removeAttribute","parentElt","electron","_openBtnElt","î","role","onclick","doOpen","findLastChild","_revealBtnElt","doReveal","ev","postMessage","path","findHost","location","origin","stopPropagation","msg","disabled","MsgLabel","level","standardMsg","setStandardMsg","className","setAttr","MsgOver","node","HTMLIFrameElement","HTMLImageElement","HTMLMediaElement","getFlatParentElt","over","removeMsg","st","getComputedStyle","position","_wasStatic","parentNode","remove","Clickable","tabIndexCustom","_tabIndexCustom","makeClickable","extractAttrAsNumber","tabIndex","compatTable","set","prototype","requestIdleCallback","FreeElement","freeInitialize","call","svc","getSvc","Object","assign","FreeElementAsync","in","key","isAnyControlPressed","stopImmediatePropagation","preventDefault","click","name","defaultVal","Number","parseInt","refreshTree","from","excludeFrom","tw","createTreeWalker","NodeFilter","SHOW_ELEMENT","nextNode","currentNode","clearContent","lastChild","prev","previousSibling","removeChild","newInit","i","create","ResizeObserver","entries","entry","target","scrollWidth","Math","ceil","contentRect","width","scrollHeight","height","ensureVisible","scrollCtn","blockPos","scrollBehavior","getBoundingClientRect","scrollBox","min","abs","bottom","top","scrollIntoView","block","behavior","DEBUG"],"mappings":"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","sourcesContent":["import {IReg, IRegPointer, REG} from 'lib/commons/registry';\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {Desk} from \"lib/commons/desk\";\nimport {ACTION} from \"lib/commons/actions\";\nimport {LANG} from \"lib/commons/lang\";\nimport {Button, OButtonActionsInit} from \"back/commons/widgets/buttons\";\n\n/** Widget avec un cycle d'initialisation. */\nexport interface IEltInitable extends HTMLElement {\n\n\t/**\n\t * Initialise le widget via les paramètres de la méthode et/ou les attributs du widget.\n\t * Seul le 1er appel à cette méthode est pris en compte. Les appels suivants sur la même instance sont ignorés.\n\t * Cette méthode est automatiquement appelée, sans paramètre, lorsque l'élément est inséré\n\t * dans le document via CustomElement.connectedCallback().\n\t *\n\t * IMPORTANT : pour initialiser le widget avec des paramètres, l'appel doit être réalisé avant l'insertion du widget dans le document.\n\t *\n\t * Note : certaines méthodes du widget pourraient ne pas fonctionner correctement avant cette initialisation.\n\t */\n\tinitialize(init?: any): this\n\n\t/** Indique si le widget a été initialisé. */\n\treadonly initialized: boolean\n\n\t/**\n\t * Création ou enrichissement d'un objet d'init à partir des attributs de l'élement destiné à\n\t * alimenter par défaut initialize(init). Si l'implémentation utilise l'attribut\n\t * pour mémoriser le state ou la config correspondant, la propriété n'est pas renseignée\n\t * dans l'objet init retourné.\n\t *\n\t * @param init Objet déjà construit, éventuellement pré-renseigné, avec un reg par exemple.\n\t * @return L'objet init enrichi ou instancié s'il n'était pas spécifié en paramètre.\n\t */\n\tbuildInitFromAtts(init?: any): any\n}\n\n/** Widget avec un cycle d'initialisation asynchrone. */\nexport interface IEltInitableAsync extends IEltInitable {\n\n\t/** Statut du widget vis à vis de son cycle d'initilaisation. */\n\tinitStatus: 'unInited' | 'pending' | 'inited' | 'initFailed'\n\n\t/** Promesse résolue (ou rejetée) lorsque le widget est initialisé (ou en échec). */\n\tinitializedAsync: Promise<this>\n}\n\n/** Widget gérant des états et un processus de refresh. */\nexport interface IEltRefreshable extends HTMLElement {\n\n\t/** Enclenche le processus de refresh. */\n\trefresh(): void\n\n\t/**\n\t * Gèle ou dégèle l'élément et ses sous-élements internes (dans son shadowRoot).\n\t * Permet de bloquer les refresh pendant un batch.\n\t *\n\t * try {\n\t *    widget.refreshFreeze(1);\n\t *    ...\n\t * } finally {\n\t *    widget.refreshFreeze(-1);\n\t *    widget.refresh();\n\t * }\n\t *\n\t * @see BaseElement.refreshFreezeAll(elt, delta)\n\t */\n\trefreshFreeze(delta: number): void\n}\n\nexport function isEltRefreshable(elt: any): elt is IEltRefreshable {return elt && ('refreshFreeze' in elt)}\n\n\n/** Config pour skin personnalisé du widget. */\nexport interface OSkinableInit extends IRegPointer<any> {\n\n\t/** Registre à utiliser pour résoudre les skins. */\n\treg?: IReg<any>\n\n\t/** Code extPoints du skin principal personnalisé à installer. */\n\tskin?: string\n\n\t/** Codes extPoints séparés par des espaces de skins de surcharge du skin principal à installer. */\n\tskinOver?: string\n}\n\n/**\n * Base pour tous les éléments IEltInitable et IEltStatable.\n *\n * Attributes :\n * Config attributes: skin, skin-over\n */\nexport class BaseElement extends HTMLElement implements CustomElement, IEltInitable, IEltRefreshable {\n\t/** Gèle ou dégèle toute une descendance. */\n\tstatic refreshFreezeAll(elt: IEltRefreshable, delta: number) {\n\t\telt.refreshFreeze(delta);\n\t\tfor (let ch = DOM.findFirstChild(elt, isEltRefreshable); ch; ch = DOM.findNextSibling(ch, isEltRefreshable)) {\n\t\t\tBaseElement.refreshFreezeAll(ch, delta);\n\t\t}\n\t}\n\n\tprotected _refreshFreeze = 1;\n\n\tget initialized(): boolean {return this._initialize === null}\n\n\tinitialize(init?: any): this {\n\t\tif (this._initialize !== null) {\n\t\t\tthis._initialize(init == null ? this.buildInitFromAtts() : init);\n\t\t\tthis._initialize = null;\n\t\t\tthis._refreshFreeze--;\n\t\t} else if (init) {\n\t\t\tconsole.warn(\"Widget already initialized\", this, init);\n\t\t}\n\t\treturn this;\n\t}\n\n\trefresh() {\n\t\tif (this._shouldRefresh()) this._refresh();\n\t}\n\n\trefreshFreeze(delta: number) {\n\t\tthis._refreshFreeze += delta;\n\t}\n\n\tconnectedCallback() {\n\t\t//on saute l'appel à this.refresh() et this._shouldRefresh(): le refresh s'impose à ce stade (sauf si _refreshFreeze>0).\n\t\t//Plus optimisé pour les widgets agrégeant d'autres widgets qui dispatchent le refresh sur les\n\t\t//sous-widgets dans la méthode refresh() et pas _refresh(), ce qui est recommandé.\n\t\tthis.initialize();\n\t\tif (this._refreshFreeze === 0) this._refresh();\n\t}\n\n\t/** Evalue si l'état et la situation du widget justifie un appel à _refresh()*/\n\tprotected _shouldRefresh(): boolean {return this._refreshFreeze === 0 && this.isConnected}\n\n\t/** Execute un refresh du widget en prenant en compte le nouvel état du widget. */\n\tprotected _refresh() {}\n\n\t/**\n\t * Initialisation de l'état et configuration du widget.\n\t * Méthode appelée une seule fois dans la vie du widget.\n\t */\n\tprotected _initialize(init: any): void {}\n\n\t/**\n\t * Création ou enrichissement d'un objet d'init à partir des attributs de l'élement destiné à\n\t * alimenter par défaut _initialize(init). Si l'implémentation utilise l'attribut\n\t * pour mémoriser le state ou la config correspondant, la propriété n'est pas renseignée\n\t * dans l'objet init retourné.\n\t *\n\t * @param init Objet déjà construit, éventuellement pré-renseigné, avec un reg par exemple.\n\t */\n\tbuildInitFromAtts(init?: OSkinableInit): any {\n\t\tif (!init) init = {};\n\t\tif (this.hasAttribute('skin')) init.skin = BASIS.extractAttr(this, 'skin');\n\t\tif (this.hasAttribute('skinOver')) init.skinOver = BASIS.extractAttr(this, 'skinOver');\n\t\treturn init;\n\t}\n\n\t/** Installe le skin du widget, éventuellement personnalisé par la config. */\n\t_initAndInstallSkin(defaultSkin: string | null, init: OSkinableInit | null) {\n\t\tconst skin = init?.skin || defaultSkin;\n\t\tconst skinOver = init?.skinOver;\n\t\tif (skin || skinOver) {\n\t\t\tconst reg = this.findReg(init);\n\t\t\tif (skin) reg.installSkin(skin, this.shadowRoot);\n\t\t\tif (skinOver) {\n\t\t\t\tfor (const sk of skinOver.split(' ')) reg.installSkin(sk, this.shadowRoot);\n\t\t\t}\n\t\t}\n\t}\n\n\t/** Méthode utilitaire pour attacher un shadow et définir le skin et des enfants dessus */\n\t_attach(defaultSkin: string | null, init: OSkinableInit | null, ...children: Node[]): ShadowRoot {\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(defaultSkin, init);\n\t\tDOM.append(sr, ...children);\n\t\treturn sr;\n\t}\n\n\tfindReg<ENV>(init: IRegPointer<ENV>): IReg<ENV> {\n\t\treturn REG.findReg(this, init);\n\t}\n\n\t_JsxProps: any;\n}\n\n/**\n * Base pour tous les éléments IEltInitableAsync et IEltStatable.\n */\nexport class BaseElementAsync extends BaseElement implements IEltInitableAsync {\n\n\tinitStatus: 'unInited' | 'pending' | 'inited' | 'initFailed' = 'unInited';\n\n\tinitializedAsync = new Promise<this>((resolve, reject) => {\n\t\tthis._initResolved = resolve;\n\t\tthis._initRejected = reject;\n\t});\n\tprotected _initResolved: (value: this) => void;\n\tprotected _initRejected: (reason?: any) => void;\n\n\tget initialized(): boolean {return this.initStatus === 'inited'}\n\n\tinitialize(init: any = this.buildInitFromAtts()): this {\n\t\tif (this.initStatus === 'unInited') {\n\t\t\tthis.initStatus = 'pending';\n\t\t\tthis._initialize(init).then(() => {\n\t\t\t\tthis.initStatus = 'inited';\n\t\t\t\tthis._refreshFreeze--;\n\t\t\t\tconst cb = this._initResolved;\n\t\t\t\tthis._initResolved = null;\n\t\t\t\tthis._initRejected = null;\n\t\t\t\tcb(this);\n\t\t\t}, (e) => {\n\t\t\t\tthis.initStatus = 'initFailed';\n\t\t\t\tconst cb = this._initRejected;\n\t\t\t\tthis._initResolved = null;\n\t\t\t\tthis._initRejected = null;\n\t\t\t\tcb(e);\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t\treturn this;\n\t}\n\n\tconnectedCallback() {\n\t\tthis.initialize();\n\t\tthis.initializedAsync.then(() => {\n\t\t\tif (this._refreshFreeze === 0) this._refresh();\n\t\t});\n\t}\n\n\t/** A appeler si le widget est réinitialisé. */\n\treinitializeStarted(promise: Promise<void>) {\n\t\tthis.initStatus = 'pending';\n\t\tthis.initializedAsync = promise.then(\n\t\t\t() => {\n\t\t\t\tthis.initStatus = 'inited';\n\t\t\t\treturn this\n\t\t\t},\n\t\t\t(e) => {\n\t\t\t\tthis.initStatus = 'initFailed';\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t);\n\t}\n\n\tprotected _initialize(init: any): Promise<void> {throw Error(\"not implemented\")};\n}\n\nexport function isEltInitableAsync(elt: any): elt is IEltInitableAsync {return elt && elt.initializedAsync}\n\nexport function isEltInitableAsyncPending(elt: any): elt is IEltInitableAsync {return elt && elt.initializedAsync && (elt.initStatus === 'unInited' || elt.initStatus === 'pending')}\n\ntype Writable<T> = { -readonly [P in keyof T]: T[P] };\nexport type PickInit<T, K extends keyof T> = Partial<Writable<Pick<T, K>>>;\n\nREG.reg.registerSkin('basis', 1, /* language=CSS */ `\n\t:root {\n\t\tfont-family: var(--font-default);\n\t\tfont-size: 10pt;\n\t\tword-break: break-word;\n\t\tbackground-color: var(--bgcolor);\n\t\tcolor: var(--color);\n\t\taccent-color: var(--selection-bgcolor);\n\t}\n\t\n\t:root::selection {\n\t\tcolor: var(--selection-color);\n\t\tbackground: var(--selection-bgcolor);\n\t}\n`);\n\n/**\n * Composant générique qui crée un shadowRoot et initilise un skin et un skinOver si spécifiés.\n */\nexport interface Box extends BaseElement {\n\tinitialize(init?: OSkinableInit): this;\n}\n\nexport class Box extends BaseElement {\n\n\tprotected _initialize(init: OSkinableInit) {\n\t\tif (!this.shadowRoot) this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t}\n}\n\ncustomElements.define('c-box', Box);\n\n\n/**\n * Widget affichant un label et/ou une icone.\n *\n * Attributes : cf BaseElement +\n * State live attributes:      hidden\n * State init attributes:      label, icon\n * Classes:                    vertical\n */\n\nexport interface OLabelInit extends OSkinableInit {\n\tlabel?: string\n\ticon?: string\n\ttitle?: string\n\thidden?: boolean\n\t/**\n\t * Inclut l'icone et le span du label en fils direct (pas en shadowDom).\n\t * Facilite le stylage externe mais désactive tout stylage standard.\n\t * Les propriétés skin et skinOver ne sont alors pas utilisées.\n\t */\n\tnoShadow?: boolean;\n\n\t/**\n\t * Ajoute les propriétés pour gérer l'ellipse du contenu. Si noShadow est à true,\n\t * c'est au parent de les ajouter.\n\t * Si aucun title n'est défini dans l'init, un title basé sur le contenu textuel\n\t * du label sera ajouté / enlever en fonction de la présence de l'ellipse.\n\t */\n\tellipsis?: boolean;\n}\n\nexport interface Label extends BaseElement {\n\tinitialize(init?: OLabelInit): this;\n}\n\nexport class Label extends BaseElement {\n\tprotected _label: string;\n\tprotected _icon: string;\n\n\tget icon(): string {return this._icon}\n\n\tset icon(value: string) {\n\t\tif (this._icon != value) {\n\t\t\tthis._icon = value;\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tget label(): string {return this._label}\n\n\tset label(val: string) {\n\t\tif (this._label != val) {\n\t\t\tthis._label = val;\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tget hidden() {return this.hasAttribute('hidden')}\n\n\tset hidden(val: boolean) {\n\t\tif (DOM.setHidden(this, val)) this.refresh();\n\t}\n\n\t_iconElt: HTMLElement;\n\t_labelElt: HTMLElement;\n\n\tprotected _initialize(init: OLabelInit) {\n\t\tif ('icon' in init) this._icon = init.icon;\n\t\tif ('label' in init) this._label = init.label;\n\t\tif ('title' in init) this.title = init.title;\n\t\tif ('hidden' in init) this.hidden = init.hidden;\n\t\tif ('ellipsis' in init) DOM.setAttrBool(this, 'ellipsis', init.ellipsis);\n\t\tif (!init.noShadow) {\n\t\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\t\tthis._initSkin(init);\n\t\t\tsr.appendChild(document.createElement('slot'));\n\t\t}\n\t}\n\n\tbuildInitFromAtts(init?: OLabelInit): OLabelInit {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tif (this.hasAttribute('label')) init.label = BASIS.extractAttr(this, 'label');\n\t\tif (this.hasAttribute('icon')) init.icon = BASIS.extractAttr(this, 'icon');\n\t\treturn init;\n\t}\n\n\tprotected _initSkin(init: OSkinableInit) {\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t}\n\n\tprotected _refresh() {\n\t\tif (this.hidden) return;\n\n\t\tconst icon = this.icon;\n\t\tif (icon) {\n\t\t\tif (!this._iconElt) this._createIcon();\n\t\t\tif (this._lastUrlIcon !== icon) {\n\t\t\t\t//NOTE : DOM.setStyle() avec une url ne marche pas à cause des escapings.\n\t\t\t\tthis._lastUrlIcon = icon;\n\t\t\t\tthis.style.setProperty('--icon-img', icon.startsWith('--') ? `var(${icon})` : `url(\"${icon}\")`);\n\t\t\t}\n\t\t\tDOM.setHidden(this._iconElt, false);\n\t\t} else {\n\t\t\tif (this._iconElt) DOM.setHidden(this._iconElt, true);\n\t\t}\n\n\t\tconst label = this.label;\n\t\tif (label != null) {\n\t\t\tif (!this._labelElt) this._createLabel();\n\t\t\tDOM.setTextContent(this._labelElt, label);\n\t\t\tDOM.setHidden(this._labelElt, false);\n\t\t} else {\n\t\t\tif (this._labelElt) DOM.setHidden(this._labelElt, true);\n\t\t}\n\t}\n\n\tprotected _lastUrlIcon: string;\n\n\t/** crétaion de l'icon à la demande. */\n\t_createIcon() {\n\t\tthis._iconElt = (this.shadowRoot || this).insertBefore(<span class='icon'/>, this._labelElt);\n\t}\n\n\t/** crétaion du label à la demande. */\n\t_createLabel() {\n\t\tthis._labelElt = (this.shadowRoot || this).insertBefore(<span class='label'/>, this._iconElt ? this._iconElt.nextSibling : null);\n\t}\n\n\tconnectedCallback() {\n\t\tsuper.connectedCallback();\n\t\tif (this.hasAttribute('ellipsis') && !this.title) BASIS.titleOnEllipsisObserver.observe(this);\n\t}\n\n\tdisconnectedCallback() {\n\t\tif (this.hasAttribute('ellipsis')) BASIS.titleOnEllipsisObserver.unobserve(this);\n\t}\n}\n\ncustomElements.define('c-label', Label);\n\nREG.reg.registerSkin('c-label', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tjustify-content: center;\n\t}\n\n\t:host([ellipsis]) {\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.icon {\n\t\theight: var(--icon-size);\n\t\twidth: var(--icon-size);\n\t\tmin-height: var(--icon-size);\n\t\tmin-width: var(--icon-size);\n\t\tbackground: var(--icon-color) var(--icon-img) no-repeat center / contain;\n\t\tfilter: var(--filter);\n\t\t/*mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*-webkit-mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*background-blend-mode: multiply;*/\n\t}\n\n\t.icon:not([hidden]) + .label {\n\t\t-webkit-margin-start: 0.3em;\n\t\tmargin-inline-start: 0.3em;\n\t}\n\n\t:host(.vertical) {\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t}\n\n\t:host(.vertical) > .icon {\n\t\theight: calc(var(--icon-size) * 1.5);\n\t\twidth: calc(var(--icon-size) * 1.5);\n\t}\n`);\n\n/**\n * Widget c-filesystem-path :affichage d'un path FS, avec btns d'action (ouverture, révéler)\n *\n * Attributs : cf Label +\n * - type : 'dir' par défaut\n * - openBtn : false par défaut. SSi type='file'. Visible QUE dans le contexte \"electron\"\n * - revealBtn : true par défaut. Visible QUE dans le contexte \"electron\"\n *\n * Class :\n * - small\n */\n\nexport interface OFileSystemPathInit extends OLabelInit {\n\topenBtn?: boolean\n\trevealBtn?: boolean\n\ttype?: 'file' | 'dir'\n}\n\nexport interface FileSystemPath extends Label {\n\tinitialize(init?: OFileSystemPathInit): this;\n}\n\nexport class FileSystemPath extends Label {\n\n\tprotected _openBtnElt: Button;\n\n\tprotected _revealBtnElt: Button;\n\n\t_initialize(init: OFileSystemPathInit) {\n\t\tsuper._initialize(init);\n\t\tconst reg = this.findReg(init);\n\t\tthis.openBtn = (\"openBtn\" in init) ? init.openBtn : false;\n\t\tthis.revealBtn = (\"revealBtn\" in init) ? init.revealBtn : true;\n\t\tthis.type = init.type || 'dir';\n\t\tthis.addEventListener(\"click\", (event) => {\n\t\t\tif (this._labelElt)\n\t\t\t\twindow.getSelection().selectAllChildren(this._labelElt);\n\t\t})\n\t}\n\n\tprotected _initSkin(init: OSkinableInit) {\n\t\tconst reg = this.findReg(init);\n\t\treg.installSkin('c-label', this.shadowRoot);\n\t\tsuper._initSkin(init);\n\t}\n\n\t/** utile pour titleOnEllipsisObserver */\n\tget textContent(): string {\n\t\treturn this._labelElt.textContent;\n\t}\n\n\tget openBtn(): boolean {return this.hasAttribute(\"openBtn\")}\n\n\tset openBtn(md: boolean) {\n\t\tDOM.setAttrBool(this, \"openBtn\", md)\n\t}\n\n\tget revealBtn(): boolean {return this.hasAttribute(\"revealBtn\")}\n\n\tset revealBtn(md: boolean) {\n\t\tDOM.setAttrBool(this, \"revealBtn\", md)\n\t}\n\n\tget type(): 'file' | 'dir' {return this.getAttribute(\"type\") as any}\n\n\tset type(lv: 'file' | 'dir') {\n\t\tif (lv)\n\t\t\tthis.setAttribute(\"type\", lv);\n\t\telse\n\t\t\tthis.removeAttribute(\"type\");\n\t}\n\n\tbuildInitFromAtts(init?: OFileSystemPathInit): OMsgLabelInit {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tif (this.hasAttribute('openBtn')) init.openBtn = true;\n\t\tif (this.hasAttribute('revealBtn')) init.revealBtn = true;\n\t\tif (this.hasAttribute('type')) init.type = BASIS.extractAttr(this, 'type') as any;\n\t\treturn init;\n\t}\n\n\tprotected _refresh() {\n\t\tsuper._refresh();\n\t\tconst parentElt = this.shadowRoot || this;\n\t\tif (Desk.electron && this.openBtn && !this._openBtnElt)\n\t\t\tthis._openBtnElt = parentElt.insertBefore(<c-button class=\"openBtn\" î={{title: \"Ouvrir...\", icon: \"/@skin@/commons/icons/open.svg\", role: \"spinbutton\"} as OButtonActionsInit<any>}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={this.doOpen}/>, DOM.findLastChild(parentElt)) as Button;\n\t\tif (Desk.electron && this.revealBtn && !this._revealBtnElt)\n\t\t\tthis._revealBtnElt = parentElt.insertBefore(<c-button class=\"revealBtn\" î={{title: \"Révéler...\", icon: \"/@skin@/commons/icons/reveal.svg\", role: \"spinbutton\"} as OButtonActionsInit<any>}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={this.doReveal}/>, DOM.findLastChild(parentElt)) as Button;\n\t}\n\n\t/** Révéler le path */\n\tprotected doReveal(ev: Event): void {\n\t\twindow.postMessage({type: \"client:modules:localServer:reveal\", path: DOMSH.findHost<FileSystemPath>(this).textContent}, location.origin)\n\t\tev.stopPropagation();\n\t}\n\n\t/** Ouvrir le path */\n\tprotected doOpen(ev: Event): void {\n\t\twindow.postMessage({type: \"client:modules:localServer:open\", path: DOMSH.findHost<FileSystemPath>(this).textContent}, location.origin);\n\t\tev.stopPropagation();\n\t}\n\n\t/**\n\t * Si msg==null, c-filesystem-path passé en display:none.\n\t * Si msg===\"\", c-filesystem-path vide mais pas hidden\n\t */\n\tsetPath(msg: string | null, type: 'file' | 'dir' | null, openBtn?: boolean | null, revealBtn?: boolean | null, icon?: string): this {\n\t\tif (msg == null) {\n\t\t\tthis.hidden = true;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tthis.refreshFreeze(1);\n\t\t\t\tthis.label = msg;\n\t\t\t\tif (icon !== null) this.icon = icon;\n\t\t\t\tif (type !== null) this.type = type;\n\t\t\t\tif (openBtn !== null) this.openBtn = openBtn;\n\t\t\t\tif (revealBtn !== null) this.revealBtn = revealBtn;\n\t\t\t\tif (this._openBtnElt)\n\t\t\t\t\tthis._openBtnElt.disabled = msg === \"\";\n\t\t\t\tif (this._revealBtnElt)\n\t\t\t\t\tthis._openBtnElt.disabled = msg === \"\";\n\t\t\t\tthis.hidden = false;\n\t\t\t} finally {\n\t\t\t\tthis.refreshFreeze(-1);\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n}\n\nREG.reg.registerSkin('c-filesystem-path', 1, /* language=CSS */ `\n\t:host {\n\t\tjustify-content: left;\n\t\talign-items: center;\n\t}\n\n\t:host([hidden]) {\n\t\tdisplay: none;\n\t}\n\n\t:host(:not([type=file])) .openBtn {\n\t\tdisplay: none;\n\t}\n\n\t:host(.small) {\n\t\tfont-size: .8em;\n\t\tcolor: var(--info-color);\n\t}\n\n\t.openBtn, .revealBtn {\n\t\tdisplay: inline-flex;\n\t\tunicode-bidi: isolate;\n\t}\n\n`);\n\ncustomElements.define('c-filesystem-path', FileSystemPath);\n\n\n/**\n * Widget c-msg\n *\n * Attributs : cf Label +\n * - level\n * - standard-msg\n *\n * Classes :\n * - headband : affichage sous forme de bandeau.\n */\n\nexport interface OMsgLabelInit extends OLabelInit {\n\tlevel?: 'info' | 'error' | 'warning' | 'valid' | null\n\tstandardMsg?: 'loading' | 'saving' | 'deleting' | 'needAuth' | 'accessDenied' | 'netError' | null\n}\n\nexport interface MsgLabel extends Label {\n\tinitialize(init?: OMsgLabelInit): this;\n}\n\nexport class MsgLabel extends Label {\n\n\t_initialize(init: OMsgLabelInit) {\n\t\tif (init.level) this.level = init.level;\n\t\tif (init.standardMsg) this.setStandardMsg(init.standardMsg);\n\t\tsuper._initialize(init);\n\t}\n\n\tbuildInitFromAtts(init?: OMsgLabelInit): OMsgLabelInit {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tif (this.hasAttribute('standard-msg')) init.standardMsg = BASIS.extractAttr(this, 'standard-msg') as any;\n\t\treturn init;\n\t}\n\n\tget level(): 'info' | 'error' | 'warning' | 'valid' | null {return this.getAttribute(\"level\") as any}\n\n\tset level(lv: 'info' | 'error' | 'warning' | 'valid' | null) {\n\t\tif (lv)\n\t\t\tthis.setAttribute(\"level\", lv);\n\t\telse\n\t\t\tthis.removeAttribute(\"level\");\n\t}\n\n\tsetStandardMsg(msg: 'loading' | 'saving' | 'deleting' | 'needAuth' | 'accessDenied' | 'netError' | null): this {\n\t\tif (!msg) {\n\t\t\tthis.hidden = true;\n\t\t} else {\n\t\t\tthis.hidden = false;\n\t\t\tthis.className = msg;\n\t\t\tswitch (msg) {\n\t\t\tcase 'loading':\n\t\t\t\tDOM.setAttr(this, \"level\", \"info\");\n\t\t\t\tthis.label = \"Chargement en cours...\";\n\t\t\t\tbreak;\n\t\t\tcase 'saving':\n\t\t\t\tDOM.setAttr(this, \"level\", \"info\");\n\t\t\t\tthis.label = \"Enregistrement en cours...\";\n\t\t\t\tbreak;\n\t\t\tcase 'deleting':\n\t\t\t\tDOM.setAttr(this, \"level\", \"info\");\n\t\t\t\tthis.label = \"Suppression en cours...\";\n\t\t\t\tbreak;\n\t\t\tcase 'needAuth':\n\t\t\t\tDOM.setAttr(this, \"level\", \"info\");\n\t\t\t\tthis.label = \"Connexion nécessaire\";\n\t\t\t\tbreak;\n\t\t\tcase 'accessDenied':\n\t\t\t\tDOM.setAttr(this, \"level\", \"error\");\n\t\t\t\tthis.label = \"Autorisation refusée\";\n\t\t\t\tbreak;\n\t\t\tcase 'netError':\n\t\t\t\tDOM.setAttr(this, \"level\", \"error\");\n\t\t\t\tthis.label = \"Accès au serveur impossible\";\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Si msg==null, c-msg passé en display:none.\n\t * Si msg===\"\", c-msg vide mais pas hidden\n\t */\n\tsetCustomMsg(msg: string | null, level?: 'info' | 'error' | 'warning' | 'valid' | null, icon?: string): this {\n\t\tif (msg == null) {\n\t\t\tthis.hidden = true;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tthis.refreshFreeze(1);\n\t\t\t\tthis.label = msg;\n\t\t\t\tthis.icon = icon;\n\t\t\t\tthis.level = level;\n\t\t\t\tthis.hidden = false;\n\t\t\t} finally {\n\t\t\t\tthis.refreshFreeze(-1);\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\n\nREG.reg.registerSkin('c-msg', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1 0 auto;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\t:host([hidden]) {\n\t\tdisplay: none;\n\t}\n\n\t:host(.headband) {\n\t\tflex: 0 0 auto;\n\t\tmin-height: 1.7em;\n\t}\n\n\t:host([level=info]) {\n\t\tcolor: var(--info-color);\n\t\tfont-style: italic;\n\t}\n\n\t:host([level=error]) {\n\t\tcolor: var(--error-color);\n\t}\n\n\t:host([level=warning]) {\n\t\tcolor: var(--warning-color);\n\t}\n\n\t:host([level=valid]) {\n\t\tcolor: var(--valid-color);\n\t}\n`);\n\ncustomElements.define('c-msg', MsgLabel);\n\n/**\n * Message qui se place par dessus d'un objet de référence dans le but d'en bloquer les intercations\n * et d'informer l'utilisateur via le message.\n */\nexport class MsgOver extends MsgLabel {\n\tover: HTMLElement;\n\tprotected _wasStatic: boolean;\n\n\tprotected _initSkin(init: OSkinableInit) {\n\t\tconst reg = this.findReg(init);\n\t\treg.installSkin('c-msg', this.shadowRoot);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t}\n\n\tshowMsgOver(node: HTMLElement): this {\n\t\twhile (node && node instanceof HTMLIFrameElement || node instanceof HTMLImageElement || node instanceof HTMLMediaElement) {\n\t\t\t//Impossible d'accrocher un msgOver sur ces éléments\n\t\t\t//XXX A affiner... quid si display = 'contents', 'table'...\n\t\t\tnode = DOMSH.getFlatParentElt(node) as HTMLElement;\n\t\t}\n\t\tif (this.over && this.over !== node) this.removeMsg();\n\t\tthis.over = node;\n\t\tconst st = window.getComputedStyle(node);\n\t\tif (st.position === \"static\") {\n\t\t\tnode.style.position = \"relative\";\n\t\t\tthis._wasStatic = true;\n\t\t} else {\n\t\t\tthis._wasStatic = false;\n\t\t}\n\t\t(node.shadowRoot || node).appendChild(this);\n\t\treturn this;\n\t}\n\n\tasync waitFor<T>(cb: PromiseLike<T> | (() => PromiseLike<T>)): Promise<T> {\n\t\ttry {\n\t\t\treturn await (typeof cb === 'function' ? (cb as () => PromiseLike<any>)() : cb);\n\t\t} finally {\n\t\t\tthis.removeMsg();\n\t\t}\n\t}\n\n\tremoveMsg(): this {\n\t\tif (!this.over) return;\n\t\tif (this._wasStatic) this.over.style.position = \"static\";\n\t\tif (this.parentNode) this.remove();\n\t\treturn this;\n\t}\n}\n\nREG.reg.registerSkin('c-msg-over', 1, /* language=CSS */ `\n\t:host {\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\ttop: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground-color: rgba(0, 0, 0, .5);\n\t\tz-index: 1000000;\n\t}\n\n\t.label {\n\t\tbackground: linear-gradient(to top, transparent, var(--bgcolor) .5em, var(--bgcolor) 50%, transparent),\n\t\tlinear-gradient(to bottom, transparent, var(--bgcolor) .5em, var(--bgcolor) 50%, transparent);\n\t\tborder-radius: .5em;\n\t\tpadding: .5em;\n\t}\n`);\n\ncustomElements.define('c-msg-over', MsgOver);\n\n\n/**\n * Widget de base: focusable et clickable affichant un label et/ou une icone.\n * Usages: bouton, checkbox, radio...\n *\n * Attributes : cf Label +\n * State live attributes: disabled\n * State init attributes: tabindex-custom\n */\nexport interface OClickableInit extends OLabelInit {\n\tdisabled?: boolean\n\ttabIndexCustom?: number\n}\n\nexport interface Clickable extends Label {\n\tinitialize(init?: OClickableInit, ...args: any[]): this;\n}\n\n/** Widgets susceptibles de déclencher une action comme un bouton, un checkbox, un radiobutton... */\nexport abstract class Clickable extends Label {\n\t_tabIndexCustom: number;\n\n\tget disabled(): boolean {return this.hasAttribute('disabled')}\n\n\tset disabled(val: boolean) {\n\t\tif (DOM.setAttrBool(this, 'disabled', val)) this.refresh();\n\t}\n\n\t/**\n\t * 0 par défaut.\n\t * -1 pour empêcher que ce 'clickable', même enabled, soit accessible par navigation (tab).\n\t * -2 pour empêcher que ce 'clickable', même enabled, soit focusable (revient à suppr l'attribut tabindex)\n\t */\n\tget tabIndexCustom(): number {return this._tabIndexCustom}\n\n\tset tabIndexCustom(val: number) {\n\t\tif (this._tabIndexCustom !== val) {\n\t\t\tthis._tabIndexCustom = val;\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tprotected _initialize(init: OClickableInit) {\n\t\tBASIS.makeClickable(this);\n\t\tif (init.disabled) DOM.setAttrBool(this, 'disabled', true);\n\t\tthis._tabIndexCustom = init.tabIndexCustom || 0;\n\t\tsuper._initialize(init);\n\t}\n\n\tbuildInitFromAtts(init?: OClickableInit): OClickableInit {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tinit.tabIndexCustom = '_tabIndexCustom' in this ? this._tabIndexCustom : BASIS.extractAttrAsNumber(this, 'tabindex-custom', 0);\n\t\treturn init;\n\t}\n\n\tprotected _refresh() {\n\t\tsuper._refresh();\n\t\tthis.tabIndex = this.disabled ? -1 : this.tabIndexCustom;\n\t}\n\n}\n\n/** Skin pour des petits scrollbar. */\nREG.reg.registerSkin(\"scroll/small\", 1,  /* language=CSS */ `\n\t::-webkit-scrollbar {\n\t\twidth: .6em;\n\t\theight: .6em;\n\t}\n\n\t::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scroll-color);\n\t\tfilter: opacity(.1);\n\t}\n\n\t::-webkit-scrollbar-thumb {\n\t\tborder-radius: .2em;\n\t\tbox-shadow: inset 0 0 .3em var(--scroll-thumb-color);\n\t}\n\n\t* {\n\t\tscrollbar-width: thin;\n\t}\n`);\n\n\n/** Skin pour des larges scrollbar. */\nREG.reg.registerSkin(\"scroll/large\", 1,  /* language=CSS */ `\n\t::-webkit-scrollbar {\n\t\twidth: 1em;\n\t\theight: 1em;\n\t\tbackground: var(--scroll-color);\n\t}\n\n\t::-webkit-scrollbar-thumb {\n\t\tborder-radius: .2em;\n\t\tbox-shadow: inset 0 0 .3em var(--scroll-thumb-color);\n\t}\n\n\t::-webkit-scrollbar-track {\n\t\tbackground: var(--scroll-color, #f3f3f3);\n\t}\n\n\t::-webkit-scrollbar-button:single-button {\n\t\tbackground-color: #bbbbbb;\n\t\tdisplay: block;\n\t\tbox-shadow: inset 0 0 .2em var(--scroll-thumb-color);\n\t\theight: 1em;\n\t\twidth: 1em;\n\t}\n\n\t::-webkit-scrollbar-corner {\n\t\tbackground-color: transparent;\n\t}\n\n\t::-webkit-scrollbar-button:single-button:hover {\n\t\tbox-shadow: inset 0 0 .4em var(--scroll-thumb-color);\n\t}\n\n\t::-webkit-scrollbar-button:single-button:vertical:decrement {\n\t\tbackground: center center no-repeat url(/@skin@/commons/widgets/scrollUp.svg);\n\t\tfilter: var(--filter);\n\t}\n\n\t::-webkit-scrollbar-button:single-button:vertical:increment {\n\t\tbackground: center center no-repeat url(/@skin@/commons/widgets/scrollDown.svg);\n\t\tfilter: var(--filter);\n\t}\n\n\t::-webkit-scrollbar-button:single-button:horizontal:decrement {\n\t\tbackground: center center no-repeat url(/@skin@/commons/widgets/scrollLeft.svg);\n\t}\n\n\t::-webkit-scrollbar-button:single-button:horizontal:increment {\n\t\tbackground: center center no-repeat url(/@skin@/commons/widgets/scrollRight.svg);\n\t}\n`);\n\n\n/** Tests de compat des navigateurs pour le code de Wui_Commons.*/\nDesk.compatTable.set('commons', function (): boolean {\n\tif (!window.customElements || !HTMLElement.prototype.attachShadow) return false;\n\tif (!window.requestIdleCallback) return false;\n\t// On ne considère pas ResizeObserver obligatoire dans commons bien qu'utilisé sur les popups (mais sur des cas relativement marginaux). Cela permet l'usage de Firefox 68 ESR.\n\t//ajouter MutationObserver, IntersectionObserver ?\n\treturn true;\n});\n\n\n/**\n * Custom élément construit dynamiquement.\n * Indispensable quand des modules doivent pouvoir être chargés dans le même contexte de window\n * mais peuvent être en conflit (différentes versions d'un pack, etc.)\n */\nexport interface FreeElement extends BaseElement {\n\tinitialize(init: OFreeElementInit): this\n}\n\nexport interface OFreeElementInit {\n\tfreeInitialize: (this: FreeElement, init: OFreeElementInit) => void\n}\n\nexport class FreeElement extends BaseElement {\n\n\tprotected _initialize(init: OFreeElementInit) {\n\t\tinit.freeInitialize.call(this, init);\n\t}\n\n\tbuildInitFromAtts(init?: OSkinableInit): any {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tif (this.hasAttribute('svc')) {\n\t\t\tconst reg = REG.findReg(this);\n\t\t\tconst svc = reg.getSvc(this.getAttribute('svc')) as OFreeElementInit;\n\t\t\tif (svc) init = Object.assign(init, svc)\n\t\t}\n\t\treturn init;\n\t}\n}\n\ncustomElements.define('c-free', FreeElement);\n\n\nexport interface FreeElementAsync extends BaseElementAsync {\n\tinitialize(init: OFreeElementAsyncInit): this\n}\n\nexport interface OFreeElementAsyncInit {\n\tfreeInitialize: (this: FreeElement, init: OFreeElementAsyncInit) => Promise<void>\n}\n\nexport class FreeElementAsync extends BaseElementAsync {\n\n\tprotected async _initialize(init: OFreeElementAsyncInit) {\n\t\treturn init.freeInitialize.call(this, init);\n\t}\n\n\tbuildInitFromAtts(init?: OSkinableInit): any {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tif (this.hasAttribute('svc')) {\n\t\t\tconst reg = REG.findReg(this);\n\t\t\tconst svc = reg.getSvc(this.getAttribute('svc')) as OFreeElementAsyncInit;\n\t\t\tif (svc) init = Object.assign(init, svc)\n\t\t}\n\t\treturn init;\n\t}\n\n}\n\ncustomElements.define('c-free-async', FreeElementAsync);\n\n\nexport namespace BASIS {\n\n\t/** Rend un élément focusable et exécutable. */\n\texport function makeClickable(elt: HTMLElement) {\n\t\telt.tabIndex = 0;\n\t\telt.addEventListener('keypress', function (ev: KeyboardEvent) {\n\t\t\tif (LANG.in(ev.key, 'Enter', ' ') && !ACTION.isAnyControlPressed(ev)) {\n\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\tev.preventDefault();\n\t\t\t\tthis.click();\n\t\t\t}\n\t\t});\n\t}\n\n\texport function extractAttr(node: Element, name: string): string {\n\t\treturn node.getAttribute(name);\n\t\t//let val = node.getAttribute(name);\n\t\t//if (val != null) node.removeAttribute(name);\n\t\t//return val;\n\t}\n\n\texport function extractAttrAsNumber(node: Element, name: string, defaultVal: number): number {\n\t\tif (node.hasAttribute(name)) return Number.parseInt(extractAttr(node, name)) || defaultVal;\n\t\treturn defaultVal;\n\t}\n\n\texport function refreshTree(from: Element | Document | DocumentFragment, excludeFrom?: boolean) {\n\t\tconst tw = document.createTreeWalker(from, NodeFilter.SHOW_ELEMENT);\n\t\tif (excludeFrom && !tw.nextNode()) return;\n\t\tdo {\n\t\t\tif (isEltRefreshable(tw.currentNode)) tw.currentNode.refresh();\n\t\t} while (tw.nextNode());\n\t}\n\n\t/**\n\t * Efface tous les fils sauf les balises <style>.\n\t * @see VIEWS.clearContent()\n\t */\n\texport function clearContent(sr: ShadowRoot) {\n\t\tlet ch = sr.lastChild;\n\t\twhile (ch) {\n\t\t\tif (ch.localName !== \"style\") {\n\t\t\t\tconst prev = ch.previousSibling as ChildNode;\n\t\t\t\tsr.removeChild(ch);\n\t\t\t\tch = prev;\n\t\t\t} else {\n\t\t\t\tch = ch.previousSibling as ChildNode;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Instancie un nouvel objet init en s'appuyant sur un éventuel objet existant en prototype\n\t * et en associant un registre.\n\t */\n\texport function newInit<I extends IRegPointer<any>>(from: I, reg: IReg<any>): I {\n\t\tconst i = Object.create(from || null);\n\t\ti.reg = reg;\n\t\treturn i;\n\t}\n\n\t/**\n\t * ResizeObserver s'occupant de définir un title basé sur le contenu en fonction\n\t * de l'état d'overflow, utile quand un ellipsis est défini sur l'élement.\n\t */\n\texport const titleOnEllipsisObserver = new ResizeObserver((entries) => {\n\t\tfor (const entry of entries) {\n\t\t\tconst target = entry.target as HTMLElement;\n\t\t\tif (target.scrollWidth > Math.ceil(entry.contentRect.width) || target.scrollHeight > Math.ceil(entry.contentRect.height) /* check height aussi pour ellipsis avec css line-clamp */) {\n\t\t\t\ttarget.title = entry.target.textContent;\n\t\t\t} else {\n\t\t\t\ttarget.title = \"\";\n\t\t\t}\n\t\t}\n\t});\n\n\t/**\n\t * Rend visible un elt dans un scrollable container en gérant le scroll smooth si \"raisonnable\"\n\t * (contournement imparfait de l'instabilité de chromium sur le scroll smooth).\n\t */\n\texport function ensureVisible(elt: HTMLElement, scrollCtn: HTMLElement | null, blockPos: 'nearest' | 'start' = 'start') {\n\t\tif (scrollCtn) {\n\t\t\tif (getComputedStyle(scrollCtn).scrollBehavior === 'smooth') {\n\t\t\t\tconst target = elt.getBoundingClientRect();\n\t\t\t\tconst scrollBox = scrollCtn.getBoundingClientRect();\n\t\t\t\tlet delta: number;\n\t\t\t\tif (blockPos === 'nearest') {\n\t\t\t\t\tdelta = Math.min(Math.abs(target.bottom - scrollBox.top), Math.abs(target.top - scrollBox.bottom));\n\t\t\t\t} else {\n\t\t\t\t\tdelta = Math.abs(target.top - scrollBox.top);\n\t\t\t\t}\n\t\t\t\tif (delta > scrollBox.height * 2) {\n\t\t\t\t\t//console.log(\"box scrollBehavior:::instant\");\n\t\t\t\t\tscrollCtn.style.scrollBehavior = 'auto';\n\t\t\t\t\telt.scrollIntoView({block: blockPos, behavior: 'auto'});\n\t\t\t\t\tscrollCtn.style.scrollBehavior = 'smooth';\n\t\t\t\t} else {\n\t\t\t\t\t//console.log(\"box scrollBehavior:::smooth\");\n\t\t\t\t\telt.scrollIntoView({block: blockPos, behavior: 'smooth'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//smooth désactivé.\n\t\t\t\telt.scrollIntoView({block: blockPos});\n\t\t\t}\n\t\t} else {\n\t\t\telt.scrollIntoView({block: blockPos, behavior: 'smooth'});\n\t\t}\n\t}\n\n\texport const DEBUG = false;\n\n}\n"]}