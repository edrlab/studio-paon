{"version":3,"sources":["/@back@/wsp/widgets/search/taskCrit.tsx"],"names":["DOM","JSX","REG","SearchItemSgnRegexp","SearchLifeCycleStates","SearchTasksAll","SearchTasksByUsers","SearchTasksDeadline","SearchTasksScheduled","UiCritArea","UiCritBase","EUserAspects","InputUserPanel","UserRef","EItemTypeFamily","ETaskFeatures","LC_DEFAULT_NAME","LC_STATE_DEFAULT_KEY","LC_STATE_DEFAULT_NAME","InputPeriod","ItemCritRespsonsabilities","LANG","reg","addSvcToList","TaskCritFullWsp","withStageCompleted","this","_completed","checked","withStagePending","_pending","withStageForthcoming","_forthcoming","[object Object]","init","super","_initialize","wsp","env","sr","shadowRoot","appendChild","createElement","class","insertAlternativesBtn","optsRoot","type","onclick","onChange","firstElementChild","xml","actStages","_a","getAttribute","split","indexOf","stages","push","crit","buildCrit","toDom","setAttribute","getUiCritXmlAtt","AREA","setLabel","setCritSgn","setReplacePattern","setGroup","setBuildAbstract","ctx","actStagesTitles","join","customElements","define","registerSvc","TaskCritByUsers","withExpandUsersToGroups","_toGroupsElt","withExpandUsersToMembers","_toMembersElt","withGroups","universe","useUsers","hasAspect","groupable","_userElt","initialize","name","emptySelectionMsg","userCard","usersGridInit","usersSrv","filterTypeInputVisibility","filterType","addEventListener","critGroups","title","users","value","expandUsers","_b","_c","responsibilities","_d","_respElt","opt","options","selected","includes","resps","setExpandToMembers","setExpandToGroups","setResps","usersListVal","accounts","usersObj","forEach","account","pos","î","nickOrAccount","withIcon","modelResps","wspMetaUi","listResps","respsArr","respsLabels","resp","currentResp","find","entry","code","respsVal","length","TaskCritForMe","auth","config","noAuthentication","currentAuthenticatedUser","TaskCritType","it","getItemTypes","_typesElt","onchange","multiple","isFamily","task","getModel","getTitle","getIcon","style","backgroundImage","critHead","selectedIndex","itModelsArray","selectedOptions","Array","from","map","escape4Regexp","selectedItModels","buildUiXmlCrit","itModels","itLabels","itTypesArray","itModel","getItemType","itLabel","itCount","registerSkin","TaskCritDeadline","_dateElt","defaultLabel","modes","buildDefaultModes_futurAndPast","icon","critArea","img","src","head","getLabel","initHeadFromArea","reset","hasAttribute","Number","parseInt","isSpecified","buildFromInputPeriod","undefined","currentMode","getId","date1","valueAsNumber","toString","date2","setVisible","tasksIt","filter","hasFeature","deadline","uiCurrentModeId","uiCurrentMode","uiCurrentModeLabel","selectedLabel","TaskCritScheduled","scheduling","TaskCritLifeCycle","installSkin","_lcElt","lcs","getLcStates","size","optFrp","label","lc","data-model","color","iconUrl","setAttrBool","getLcName","lcStates","lcStatesArr","statesWithModel","lcName","uiCritStatesByModelsStr","uiCritStatesByModels","makeLcLabelEntry","lcCode","getLcStateOrUnknown","args","vals","Set","add","sort","lcStatesLabels","ItemCritRespsonsabilities_task","target","AREA_task"],"mappings":"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","sourcesContent":["import \"back/wsp/widgets/search/itemCrit\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {REG} from \"lib/commons/registry\";\nimport {ISearchCrit, SearchItemSgnRegexp, SearchLifeCycleStates, SearchTasksAll, SearchTasksByUsers, SearchTasksDeadline, SearchTasksScheduled} from \"lib/wsp/search\";\nimport {OUiCritInit, UiCritArea, UiCritBase} from \"back/wsp/widgets/search/uiCrit\";\nimport {EActStage} from \"lib/wsp/src\";\nimport {EUserAspects} from \"lib/core/user\";\nimport {InputUserPanel, OInputUserInit} from \"back/core/widgets/inputs\";\nimport {OUserRefInit, UserRef} from \"back/core/widgets/userRef\";\nimport {EItemTypeFamily, ETaskFeatures, ItemTypeTask, LC_DEFAULT_NAME, LC_STATE_DEFAULT_KEY, LC_STATE_DEFAULT_NAME} from \"lib/wsp/wspMetaUi\";\nimport {InputPeriod, InputPeriodAction} from \"back/core/widgets/inputPeriod\";\nimport {ItemCritRespsonsabilities} from \"back/wsp/widgets/search/itemCrit\";\nimport {LANG} from \"lib/commons/lang\";\n\n// Déclaration des criterions génériques pour la recherche d'items 'wsp.crit.tasks'.\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-uicrit-bool:and\", 1, \"wsp-uicrit-bool:and\");\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-uicrit-bool:or\", 1, \"wsp-uicrit-bool:or\");\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"and\", 1, \"and\");\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"or\", 1, \"or\");\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-uicrit-free\", 1, \"wsp-uicrit-free\");\n//REG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-uicrit-xpath\", 1, \"wsp-uicrit-xpath\");\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"exp\", 1, \"exp\");\n\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-itemcrit-title\", 1, \"wsp-itemcrit-title\");\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-itemcrit-lastmodif\", 1, \"wsp-itemcrit-lastmodif\");\n\n/**\n * Scope de recherche sur tout l'atelier.\n */\nexport class TaskCritFullWsp extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-taskcrit-fullwsp\")\n\t\t.setLabel(\"Tâches de l'atelier\")\n\t\t.setCritSgn(\"scope\").setReplacePattern(/\\bscope\\b/)\n\t\t.setGroup(\"scope\")\n\t\t.setBuildAbstract(function (this: UiCritArea, xml: Element, ctx: OUiCritInit) {\n\t\t\tconst actStages = xml.getAttribute(\"actStages\")?.split(\" \");\n\t\t\tconst actStagesTitles = [];\n\t\t\tif (actStages?.indexOf(\"completed\") > -1) actStagesTitles.push(\"close\");\n\t\t\tif (actStages?.indexOf(\"pending\") > -1) actStagesTitles.push(\"en cours\");\n\t\t\tif (actStages?.indexOf(\"forthcoming\") > -1) actStagesTitles.push(\"à venir\");\n\t\t\tconst stages = actStagesTitles.join(', ');\n\t\t\t// FIXME : periodOp\n\t\t\treturn <span class=\"crit\">Tâches de l'atelier ({actStagesTitles.join(', ')})</span>;\n\t\t});\n\n\tprotected _pending: HTMLInputElement;\n\tprotected _completed: HTMLInputElement;\n\tprotected _forthcoming: HTMLInputElement;\n\n\tget withStageCompleted(): boolean {return this._completed.checked}\n\n\tget withStagePending(): boolean {return this._pending.checked}\n\n\tget withStageForthcoming(): boolean {return this._forthcoming.checked}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst wsp = this.reg.env.wsp;\n\t\tconst sr = this.shadowRoot;\n\t\tsr.appendChild(<div class=\"critHead\">\n\t\t\t<span class=\"critTitle\">Tâches de l'atelier</span>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tlet optsRoot = sr.appendChild(<div class=\"h\"/>) as HTMLDivElement;\n\t\tthis._pending = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" checked onclick={this.onChange}/>en cours</label>).firstElementChild as HTMLInputElement;\n\t\tthis._completed = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" onclick={this.onChange}/>closes</label>).firstElementChild as HTMLInputElement;\n\t\tthis._forthcoming = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" checked onclick={this.onChange}/>à venir</label>).firstElementChild as HTMLInputElement;\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tconst actStages = xml.getAttribute(\"actStages\")?.split(\" \");\n\t\tthis._pending.checked = actStages?.indexOf(\"pending\") > -1;\n\t\tthis._completed.checked = actStages?.indexOf(\"completed\") > -1;\n\t\tthis._forthcoming.checked = actStages?.indexOf(\"forthcoming\") > -1;\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst stages: EActStage[] = [];\n\t\tif (this.withStagePending) stages.push(\"pending\");\n\t\tif (this.withStageCompleted) stages.push(\"completed\");\n\t\tif (this.withStageForthcoming) stages.push(\"forthcoming\");\n\t\treturn new SearchTasksAll(stages);\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit = this.buildCrit().toDom();\n\t\tcrit.setAttribute(\"uiCrit\", this.getUiCritXmlAtt());\n\t\treturn crit;\n\t}\n}\ncustomElements.define(\"wsp-taskcrit-fullwsp\", TaskCritFullWsp);\nREG.reg.registerSvc(\"wsp-taskcrit-fullwsp\", 1, TaskCritFullWsp.AREA);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-fullwsp\", 1, \"wsp-taskcrit-fullwsp\");\n\n\n/**\n * Scope de recherche pour des users donnés\n */\nexport class TaskCritByUsers extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-taskcrit-byusers\")\n\t\t.setLabel(\"Tâches des utilisateurs\")\n\t\t.setGroup(\"scope\")\n\t\t.setCritSgn(\"scope\").setReplacePattern(/\\bscope\\b/)\n\t\t.setBuildAbstract(function (this: UiCritArea, xml: Element, ctx: OUiCritInit) {\n\t\t\t// - actStages\n\t\t\tconst actStages = xml.getAttribute(\"actStages\")?.split(\" \");\n\t\t\tconst actStagesTitles = [];\n\t\t\tif (actStages.indexOf(\"completed\") > -1) actStagesTitles.push(\"close\");\n\t\t\tif (actStages.indexOf(\"pending\") > -1) actStagesTitles.push(\"en cours\");\n\t\t\tif (actStages.indexOf(\"forthcoming\") > -1) actStagesTitles.push(\"à venir\");\n\t\t\tconst stages = actStagesTitles.join(', ');\n\t\t\t// users\n\t\t\tlet usersListVal: HTMLElement;\n\t\t\tconst users = xml.getAttribute(\"users\");\n\t\t\tif (users) {\n\t\t\t\tconst accounts = users.split(\" \");\n\t\t\t\tconst usersObj = <span/>;\n\t\t\t\taccounts.forEach((account, pos) => {\n\t\t\t\t\tif (pos > 0)\n\t\t\t\t\t\tusersObj.appendChild(<span> ou </span>);\n\t\t\t\t\tusersObj.appendChild(<UserRef class=\"inline list\" î={{reg: ctx.reg, nickOrAccount: account, withIcon: false} as OUserRefInit}/>)\n\t\t\t\t});\n\t\t\t\tusersListVal = <span>'{usersObj}'</span>;\n\n\t\t\t\tconst expandUsers = xml.getAttribute(\"expandUsers\")?.split(\" \");\n\t\t\t\tif (expandUsers?.indexOf(\"toGroups\") && expandUsers.indexOf(\"toMembers\"))\n\t\t\t\t\tusersListVal.appendChild(<span> (étendu aux membres/groupes)</span>);\n\t\t\t\tif (expandUsers?.indexOf(\"toGroups\"))\n\t\t\t\t\tusersListVal.appendChild(<span> (étendu aux groupes)</span>);\n\t\t\t\tif (expandUsers?.indexOf(\"toMembers\"))\n\t\t\t\t\tusersListVal.appendChild(<span> (étendu aux membres)</span>);\n\t\t\t}\n\t\t\t// Resps\n\t\t\tconst modelResps = ctx.reg.env.wsp.wspMetaUi.listResps('task');\n\t\t\tconst respsArr = xml.getAttribute(\"responsibilities\")?.split(\" \");\n\t\t\tconst respsLabels: string[] = [];\n\t\t\tif (respsArr) respsArr.forEach((resp) => {\n\t\t\t\tconst currentResp = modelResps.find((entry) => entry.code === resp);\n\t\t\t\trespsLabels.push(currentResp ? currentResp.name : resp);\n\t\t\t});\n\t\t\tlet respsVal: HTMLElement;\n\n\t\t\tif (respsLabels.length == 1) {\n\t\t\t\tconst resp = respsLabels[0];\n\t\t\t\trespsVal = <span>{`(ayant la responsabilité '${resp}')`}</span>;\n\t\t\t} else if (respsLabels.length > 1) {\n\t\t\t\tconst resps = respsLabels.join(\" ou \");\n\t\t\t\trespsVal = <span>{`(ayant l'une des responsabilités '${resps}')`}</span>;\n\t\t\t}\n\n\t\t\t// FIXME : l10n\n\t\t\treturn <span class=\"crit\">Tâches des utilisateurs {usersListVal} {respsVal} dans l'un des états '{actStagesTitles.join(', ')}'</span>;\n\t\t});\n\n\tprotected _userElt: InputUserPanel<any>;\n\tprotected _toGroupsElt: HTMLInputElement;\n\tprotected _toMembersElt: HTMLInputElement;\n\n\tprotected _pending: HTMLInputElement;\n\tprotected _completed: HTMLInputElement;\n\tprotected _forthcoming: HTMLInputElement;\n\n\tprotected _respElt: HTMLSelectElement;\n\n\tget withStageCompleted(): boolean {return this._completed.checked}\n\n\tget withStagePending(): boolean {return this._pending.checked}\n\n\tget withStageForthcoming(): boolean {return this._forthcoming.checked}\n\n\tget withExpandUsersToGroups(): boolean {return this._toGroupsElt?.checked}\n\n\tget withExpandUsersToMembers(): boolean {return this._toMembersElt?.checked}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\n\t\tconst withGroups = this.reg.env.universe.useUsers.hasAspect(EUserAspects.groupable);\n\n\t\t// users\n\t\tthis._userElt = new InputUserPanel().initialize({\n\t\t\tname: \"choiceUser\",\n\t\t\treg: this.reg,\n\t\t\temptySelectionMsg: withGroups ? \"Utilisateurs/groupes...\" : \"Utilisateurs...\",\n\t\t\tuserCard: \"multi\",\n\t\t\tusersGridInit: {\n\t\t\t\tusersSrv: this.reg.env.universe.useUsers,\n\t\t\t\tfilterTypeInputVisibility: true,\n\t\t\t\tfilterType: null,\n\t\t\t},\n\t\t} as OInputUserInit<any>) as InputUserPanel<any>;\n\t\tthis._userElt.addEventListener(\"change\", this.onChange);\n\n\t\tlet critGroups;\n\t\tif (withGroups) {\n\t\t\tthis._toGroupsElt = <input type=\"checkbox\" onclick={this.onChange}/> as HTMLInputElement;\n\t\t\tthis._toMembersElt = <input type=\"checkbox\" onclick={this.onChange}/> as HTMLInputElement;\n\t\t\tcritGroups = <div class=\"h\">\n\t\t\t\t<label class=\"opt\" title=\"Inclure les items associés aux groupes auxquels les utilisateurs sélectionnés appartiennent\">{this._toGroupsElt}+ groupes</label>\n\t\t\t\t<label class=\"opt\" title=\"Inclure les items associés aux membres des groupes sélectionnés\">{this._toMembersElt}+ membres</label>\n\t\t\t</div>;\n\t\t}\n\n\t\tsr.appendChild(<div class=\"critHead\">\n\t\t\t<span class=\"critTitle\">Tâches des utilisateurs</span>\n\t\t\t<div class=\"inputsCtn\">\n\t\t\t\t{this._userElt}\n\t\t\t\t{critGroups}\n\t\t\t</div>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\n\t\t// actStage\n\t\tlet optsRoot = sr.appendChild(<div class=\"h\"/>) as HTMLDivElement;\n\t\tthis._pending = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" checked onclick={this.onChange}/>en cours</label>).firstElementChild as HTMLInputElement;\n\t\tthis._completed = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" onclick={this.onChange}/>closes</label>).firstElementChild as HTMLInputElement;\n\t\tthis._forthcoming = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" checked onclick={this.onChange}/>à venir</label>).firstElementChild as HTMLInputElement;\n\n\t\t// resp\n\t\t/* non implémenter coté java : eu.scenari.wspodb.search.execexp.TasksByUsersExecExp.filterResps\n\t\t\t\tCrirère dédié utilisé\n\t\tthis._respElt = <select onchange={this.onChange} class=\"respSelect\" multiple=\"true\"/> as HTMLSelectElement;\n\t\tthis.reg.env.wsp.wspMetaUi.hasForthcomingTasks()\n\t\tconst resps = this.reg.env.wsp.wspMetaUi.listResps('task');\n\t\tresps?.forEach((resp) => {\n\t\t\tlet opt = this._respElt.appendChild(<option value={resp.code}>{resp.name}</option>);\n\t\t\tif(resp.desc) opt.title = resp.desc;\n\t\t});\n\t\tsr.appendChild(\n\t\t\t<div class=\"h\">\n\t\t\t\t<div class=\"v usersBox\">\n\t\t\t\t\t<span>Responsabilité</span>\n\t\t\t\t\t{this._respElt}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t\t */\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\t// users\n\t\tconst users = xml.getAttribute(\"users\")?.split(\" \");\n\t\tthis._userElt.value = users;\n\t\tconst expandUsers = xml.getAttribute(\"expandUsers\")?.split(\" \");\n\t\tthis._toGroupsElt.checked = expandUsers?.indexOf(\"toGroups\") > -1;\n\t\tthis._toMembersElt.checked = expandUsers?.indexOf(\"toMembers\") > -1;\n\n\t\t// actStages\n\t\tconst actStages = xml.getAttribute(\"actStages\")?.split(\" \");\n\t\tthis._pending.checked = actStages?.indexOf(\"pending\") > -1;\n\t\tthis._completed.checked = actStages?.indexOf(\"completed\") > -1;\n\t\tthis._forthcoming.checked = actStages?.indexOf(\"forthcoming\") > -1;\n\n\t\t// resps\n\t\tconst responsibilities = xml.getAttribute(\"responsibilities\")?.split(\" \");\n\t\tif (responsibilities && this._respElt) {\n\t\t\tfor (const opt of this._respElt.options)\n\t\t\t\topt.selected = responsibilities.includes(opt.value)\n\n\t\t}\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\t// actStages\n\t\tconst stages: EActStage[] = [];\n\t\tif (this.withStagePending) stages.push(\"pending\");\n\t\tif (this.withStageCompleted) stages.push(\"completed\");\n\t\tif (this.withStageForthcoming) stages.push(\"forthcoming\");\n\t\t// resps\n\t\tconst resps = [];\n\t\tif (this._respElt)\n\t\t\tfor (const opt of this._respElt.options)\n\t\t\t\tresps.push(opt.value)\n\n\t\tconst crit = new SearchTasksByUsers(this._userElt.value, stages)\n\t\t\t.setExpandToMembers(this._toMembersElt?.checked)\n\t\t\t.setExpandToGroups(this._toGroupsElt?.checked)\n\t\t\t.setResps(resps);\n\t\treturn crit || new SearchTasksAll(stages);\n\t}\n\n}\n\ncustomElements.define(\"wsp-taskcrit-byusers\", TaskCritByUsers);\nREG.reg.registerSvc(\"wsp-taskcrit-byusers\", 1, TaskCritByUsers.AREA);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-byusers\", 1, \"wsp-taskcrit-byusers\");\n\n\n/**\n * Scope de recherche pour des le user courant\n */\nexport class TaskCritForMe extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-taskcrit-forme\")\n\t\t.setLabel(\"Mes tâches\")\n\t\t.setGroup(\"scope\")\n\t\t.setCritSgn(\"scope\").setReplacePattern(/\\bscope\\b/)\n\t\t.setBuildAbstract(function (this: UiCritArea, xml: Element, ctx: OUiCritInit) {\n\t\t\t// - actStages\n\t\t\tconst actStages = xml.getAttribute(\"actStages\")?.split(\" \");\n\t\t\tconst actStagesTitles = [];\n\t\t\tif (actStages.indexOf(\"completed\") > -1) actStagesTitles.push(\"close\");\n\t\t\tif (actStages.indexOf(\"pending\") > -1) actStagesTitles.push(\"en cours\");\n\t\t\tif (actStages.indexOf(\"forthcoming\") > -1) actStagesTitles.push(\"à venir\");\n\t\t\tconst stages = actStagesTitles.join(', ');\n\n\t\t\t// FIXME : l10n\n\t\t\treturn <span class=\"crit\">Mes tâches dans l'un des états '{actStagesTitles.join(', ')}'</span>;\n\t\t});\n\n\tprotected _pending: HTMLInputElement;\n\tprotected _completed: HTMLInputElement;\n\tprotected _forthcoming: HTMLInputElement;\n\n\tget withStageCompleted(): boolean {return this._completed.checked}\n\n\tget withStagePending(): boolean {return this._pending.checked}\n\n\tget withStageForthcoming(): boolean {return this._forthcoming.checked}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\n\t\tsr.appendChild(<div class=\"critHead\">\n\t\t\t<span class=\"critTitle\">Mes tâches</span>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\n\t\t// actStage\n\t\tlet optsRoot = sr.appendChild(<div class=\"h\"/>) as HTMLDivElement;\n\t\tthis._pending = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" checked onclick={this.onChange}/>en cours</label>).firstElementChild as HTMLInputElement;\n\t\tthis._completed = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" onclick={this.onChange}/>closes</label>).firstElementChild as HTMLInputElement;\n\t\tthis._forthcoming = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" checked onclick={this.onChange}/>à venir</label>).firstElementChild as HTMLInputElement;\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\t// actStages\n\t\tconst actStages = xml.getAttribute(\"actStages\")?.split(\" \");\n\t\tthis._pending.checked = actStages?.indexOf(\"pending\") > -1;\n\t\tthis._completed.checked = actStages?.indexOf(\"completed\") > -1;\n\t\tthis._forthcoming.checked = actStages?.indexOf(\"forthcoming\") > -1;\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst stages: EActStage[] = [];\n\t\tif (this.withStagePending) stages.push(\"pending\");\n\t\tif (this.withStageCompleted) stages.push(\"completed\");\n\t\tif (this.withStageForthcoming) stages.push(\"forthcoming\");\n\n\t\tconst auth = this.reg.env.universe.auth;\n\t\tif (auth.config.noAuthentication || !auth.currentAuthenticatedUser) return new SearchTasksAll(stages);\n\t\treturn new SearchTasksByUsers([auth.currentAuthenticatedUser.account], stages).setExpandToGroups(true) || new SearchTasksAll(stages);\n\t}\n\n}\n\ncustomElements.define(\"wsp-taskcrit-forme\", TaskCritForMe);\nREG.reg.registerSvc(\"wsp-taskcrit-forme\", 1, TaskCritForMe.AREA);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-forme\", 1, \"wsp-taskcrit-forme\");\n\n/**\n * Type de la tache\n *    <wsp-taskcrit-type/>\n */\nexport class TaskCritType extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-taskcrit-type\").setLabel(\"Type\")\n\t\t.setCritSgn(\"type\").setGroup(\"task\").setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\t\tconst itModels = xml ? xml.getAttribute('uiItModels') : null;\n\t\t\tconst itLabels: string[] = [];\n\t\t\tif (itModels != null) {\n\t\t\t\tconst itTypesArray = itModels.split(\"|\");\n\t\t\t\titTypesArray.forEach(itModel => {\n\t\t\t\t\titLabels.push(ctx.reg.env.wsp.wspMetaUi.getItemType(itModel).getTitle());\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (itLabels.length == 1) {\n\t\t\t\tconst itLabel = <span class=\"critVal\">{itLabels[0]}</span>;\n\t\t\t\treturn <span class=\"crit\">Type '{itLabel}'</span>;\n\t\t\t} else if (itLabels.length < 5) {\n\t\t\t\treturn <span class=\"crit\">Types '{itLabels.join(', ')}'</span>;\n\t\t\t} else {\n\t\t\t\tconst itCount = <span class=\"critVal\">{itLabels.length}</span>;\n\t\t\t\treturn <span class=\"crit\" title={itLabels.join(\", \")}>{itCount} types</span>;\n\t\t\t}\n\t\t});\n\n\tprotected _typesElt: HTMLSelectElement;\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tconst it = this.reg.env.wsp.wspMetaUi.getItemTypes();\n\n\t\tthis._typesElt = <select onchange={this.onChange} multiple=\"true\"/> as HTMLSelectElement;\n\t\tit.forEach((entry) => {\n\t\t\tif (entry.isFamily(EItemTypeFamily.task)) {\n\t\t\t\tconst opt = this._typesElt.appendChild(<option value={entry.getModel()}>{entry.getTitle()}</option>);\n\t\t\t\tif (entry.getIcon()) opt.style.backgroundImage = `url(\"${entry.getIcon()}\")`;\n\t\t\t}\n\t\t});\n\n\t\tconst critHead = sr.appendChild(<div class=\"critHead\">\n\t\t\t<span class=\"critTitle\">Type(s) :</span>\n\t\t\t{this._typesElt}\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tthis._typesElt.selectedIndex = -1;\n\t\tconst itModelsArray = xml?.getAttribute('uiItModels')?.split(\"|\") || [];\n\t\tfor (const opt of this._typesElt.options)\n\t\t\topt.selected = itModelsArray.indexOf(opt.value) > -1 ? true : false;\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tif (this._typesElt.selectedOptions)\n\t\t\treturn new SearchItemSgnRegexp(Array.from(this._typesElt.selectedOptions).map(entry => '@' + LANG.escape4Regexp(entry.value) + \"\\\\b.*\"));\n\t}\n\n\t/**\n\t *  Critères UI :\n\t *    uiItModels : liste des itModels sélectionnés, sépapés par un |\n\t */\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst selectedItModels: string[] = [];\n\t\tfor (const opt of this._typesElt.selectedOptions)\n\t\t\tif (opt.selected) selectedItModels.push(opt.value)\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tif (crit && selectedItModels) crit.setAttribute(\"uiItModels\", selectedItModels.join(\"|\"));\n\t\treturn crit;\n\t}\n\n}\ncustomElements.define(\"wsp-taskcrit-type\", TaskCritType);\nREG.reg.registerSkin('wsp-taskcrit-type', 1, /* language=CSS */ `\n\tselect {\n\t\t/*flex:1;*/\n\t}\n\n\toption {\n\t\t/*background-image: url(\"affecteeDynamiquement\");*/\n\t  background-repeat: no-repeat;\n\t  background-size: auto 1rem;\n\t  min-width: 3rem;\n\t  padding-inline-start: 1.3rem;\n  }\n`);\nREG.reg.registerSvc(\"wsp-taskcrit-type\", 1, TaskCritType.AREA);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-type\", 1, \"wsp-taskcrit-type\");\n\n/**\n * Deadline de la tache\n *    <wsp-taskcrit-deadline/>\n */\nexport class TaskCritDeadline extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-taskcrit-deadline\")\n\t\t.setLabel(\"Date limite\").setReplacePattern(/\\bdate\\b/).setGroup(\"task\")\n\t\t.setVisible((ctx) => {\n\t\t\tconst wspMetaUi = ctx.reg.env.wsp.wspMetaUi;\n\t\t\tconst tasksIt: ItemTypeTask[] = wspMetaUi.getItemTypes().filter((entry) => entry.isFamily(EItemTypeFamily.task)) as ItemTypeTask[];\n\t\t\treturn tasksIt?.find(entry => entry.hasFeature(ETaskFeatures.deadline)) ? true : false;\n\t\t})\n\t\t.setCritSgn(\"type\").setGroup(\"task\").setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\t\t//FIXME : afficher une forme lisible de la date spécifiée\n\t\t\tconst modes = InputPeriod.buildDefaultModes_futurAndPast();\n\t\t\tconst uiCurrentModeId = xml?.getAttribute(\"uiCurrentMode\");\n\t\t\tconst uiCurrentMode: InputPeriodAction = uiCurrentModeId ? modes.find((entry) => entry.getId() === uiCurrentModeId) as InputPeriodAction : null;\n\t\t\tconst uiCurrentModeLabel = uiCurrentMode?.selectedLabel || uiCurrentMode?.getLabel(null);\n\t\t\treturn uiCurrentModeLabel ? <span class=\"crit\"><span class=\"critTitle\">Date limite de type</span> '<span class=\"critVal\">{uiCurrentModeLabel}</span>'</span> : <span class=\"crit\"><span class=\"critTitle\">Date limite</span></span>;\n\t\t});\n\n\tprotected _dateElt: InputPeriod;\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tthis._dateElt = new InputPeriod().initialize({defaultLabel: \"Choisir une valeur...\", modes: InputPeriod.buildDefaultModes_futurAndPast()});\n\t\tthis._dateElt.addEventListener(\"change\", this.onChange);\n\t\tthis._dateElt.addEventListener(\"input\", this.onChange);\n\t\tconst icon = this.critArea ? this.critArea.getIcon({reg: this.reg}) : null;\n\t\tconst img = icon ? <img src={icon}/> : null;\n\t\tconst head = sr.appendChild(<div class=\"critHead\">\n\t\t\t{img}\n\t\t\t<span class=\"critTitle\">{this.critArea ? this.critArea.getLabel({reg: this.reg}) : \"\"}</span>\n\t\t\t{this._dateElt}\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tthis._dateElt.reset(xml.getAttribute(\"uiCurrentMode\"), xml.hasAttribute(\"uiCurrentLess\") ? Number.parseInt(xml.getAttribute(\"uiCurrentLess\")) : null, xml.hasAttribute(\"uiCurrentMore\") ? Number.parseInt(xml.getAttribute(\"uiCurrentMore\")) : null);\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tif (this._dateElt.isSpecified())\n\t\t\treturn SearchTasksDeadline.buildFromInputPeriod(this._dateElt);\n\t\treturn undefined;\n\t}\n\n\t/**\n\t *  Critères UI :\n\t *    uiCurrentMode, uiCurrentLess, uiCurrentMore\n\t */\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tif (crit) {\n\t\t\tif (crit && this._dateElt.isSpecified()) {\n\t\t\t\tcrit.setAttribute(\"uiCurrentMode\", this._dateElt.currentMode.getId());\n\t\t\t\t// Valeurs brutes (sans les regles d'exclusion/normalisation qui sont fournies par le \"currentMode\")\n\t\t\t\tif (this._dateElt.date1.valueAsNumber) crit.setAttribute(\"uiCurrentLess\", this._dateElt.date1.valueAsNumber.toString());\n\t\t\t\tif (this._dateElt.date2.valueAsNumber) crit.setAttribute(\"uiCurrentMore\", this._dateElt.date2.valueAsNumber.toString());\n\t\t\t}\n\t\t}\n\t\treturn crit;\n\t}\n\n}\ncustomElements.define(\"wsp-taskcrit-deadline\", TaskCritDeadline);\nREG.reg.registerSvc(\"wsp-taskcrit-deadline\", 1, TaskCritDeadline.AREA);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-deadline\", 1, \"wsp-taskcrit-deadline\");\n\n/**\n * Deadline de la tache\n *    <wsp-taskcrit-scheduled/>\n */\nexport class TaskCritScheduled extends TaskCritDeadline {\n\n\tstatic AREA = new UiCritArea(\"wsp-taskcrit-scheduled\")\n\t\t.setLabel(\"Date de planification\").setReplacePattern(/\\bdate\\b/).setGroup(\"task\")\n\t\t.setVisible((ctx) => {\n\t\t\tconst wspMetaUi = ctx.reg.env.wsp.wspMetaUi;\n\t\t\tconst tasksIt: ItemTypeTask[] = wspMetaUi.getItemTypes().filter((entry) => entry.isFamily(EItemTypeFamily.task)) as ItemTypeTask[];\n\t\t\treturn tasksIt?.find(entry => entry.hasFeature(ETaskFeatures.scheduling)) ? true : false;\n\t\t})\n\t\t.setCritSgn(\"type\").setGroup(\"task\").setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\t\t//FIXME : afficher une forme lisible de la date spécifiée\n\t\t\tconst modes = InputPeriod.buildDefaultModes_futurAndPast();\n\t\t\tconst uiCurrentModeId = xml?.getAttribute(\"uiCurrentMode\");\n\t\t\tconst uiCurrentMode: InputPeriodAction = uiCurrentModeId ? modes.find((entry) => entry.getId() === uiCurrentModeId) as InputPeriodAction : null;\n\t\t\tconst uiCurrentModeLabel = uiCurrentMode?.selectedLabel || uiCurrentMode?.getLabel(null);\n\t\t\treturn uiCurrentModeLabel ? <span class=\"crit\"><span class=\"critTitle\">Date de planification de type</span> '<span class=\"critVal\">{uiCurrentModeLabel}</span>'</span> :\n\t\t\t\t<span class=\"crit\"><span class=\"critTitle\">Date de planification</span></span>;\n\t\t});\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tif (this._dateElt.isSpecified())\n\t\t\treturn SearchTasksScheduled.buildFromInputPeriod(this._dateElt);\n\t\treturn undefined;\n\t}\n}\n\ncustomElements.define(\"wsp-taskcrit-scheduled\", TaskCritScheduled);\nREG.reg.registerSvc(\"wsp-taskcrit-scheduled\", 1, TaskCritScheduled.AREA);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-scheduled\", 1, \"wsp-taskcrit-scheduled\");\n\n/**\n * Cycle de vie de la tache\n *    <wsp-taskcrit-lifecycle/>\n */\nexport class TaskCritLifeCycle extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-taskcrit-lifecycle\")\n\t\t.setLabel((ctx) => ctx.reg.env.wsp.wspMetaUi.getLcName())\n\t\t.setVisible((ctx) => {\n\t\t\tconst wspMetaUi = ctx.reg.env.wsp.wspMetaUi;\n\t\t\tconst tasksIt: ItemTypeTask[] = wspMetaUi.getItemTypes().filter((entry) => entry.isFamily(EItemTypeFamily.task)) as ItemTypeTask[];\n\t\t\treturn tasksIt?.find(entry => entry.getLcStates()?.size) ? true : false;\n\t\t})\n\t\t.setCritSgn(\"lifecycle\").setGroup(\"task\").setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\t\tconst lcName = LC_DEFAULT_NAME;\n\t\t\tconst uiCritStatesByModelsStr = xml.getAttribute(\"uiCritStatesByModels\");\n\t\t\tif (uiCritStatesByModelsStr && uiCritStatesByModelsStr.length) {\n\t\t\t\tconst wspMetaUi = ctx.reg.env.wsp.wspMetaUi;\n\t\t\t\tconst uiCritStatesByModels = uiCritStatesByModelsStr.split(\" \");\n\n\t\t\t\tfunction makeLcLabelEntry(itModel: string, lcCode: string): string {\n\t\t\t\t\tconst it = wspMetaUi.getItemType(itModel) as ItemTypeTask;\n\t\t\t\t\tconst lc = it?.getLcStateOrUnknown(lcCode);\n\t\t\t\t\treturn lc.name || lcCode;\n\t\t\t\t}\n\n\t\t\t\tif (uiCritStatesByModels.length == 1) {\n\t\t\t\t\tconst args = uiCritStatesByModels[0].split(\":\");\n\t\t\t\t\t<span class=\"crit\">État du {lcName} : <span class=\"critVal\">{makeLcLabelEntry(args[0], args[1])}</span></span>\n\t\t\t\t} else {\n\t\t\t\t\tconst vals = new Set<string>();\n\t\t\t\t\tuiCritStatesByModels.forEach((entry) => {\n\t\t\t\t\t\tconst args = entry.split(\":\");\n\t\t\t\t\t\tvals.add(makeLcLabelEntry(args[0], args[1]));\n\t\t\t\t\t});\n\t\t\t\t\treturn <span class=\"crit\">États du {lcName} : <span class=\"critVal\">{Array.from(vals).sort().join(\", \")}</span></span>\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst lcStates = xml.getAttribute(\"lcStates\") || \"\";\n\t\t\t\tconst lcStatesArr = lcStates.split(\" \");\n\t\t\t\tconst lcStatesLabels = lcStatesArr.join(\", \");\n\t\t\t\treturn <span class=\"crit\">État(s) du {lcName} : <span class=\"critVal\">{lcStatesLabels}</span></span>;\n\t\t\t}\n\t\t});\n\n\tprotected _lcElt: HTMLSelectElement;\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tthis.reg.installSkin(\"wsp-taskcrit-lifecycle\", sr);\n\n\t\tthis._lcElt = <select onchange={this.onChange} class=\"lcSelect\" multiple=\"true\"/> as HTMLSelectElement;\n\n\t\tconst wspMetaUi = this.reg.env.wsp.wspMetaUi;\n\t\tconst tasksIt: ItemTypeTask[] = wspMetaUi.getItemTypes().filter((entry) => entry.isFamily(EItemTypeFamily.task)) as ItemTypeTask[];\n\t\ttasksIt.forEach((it) => {\n\t\t\tconst lcs = it.getLcStates();\n\t\t\tif (lcs.size) {\n\t\t\t\tlet optFrp = this._lcElt.appendChild(this._lcElt.appendChild(<optgroup label={it.getTitle()}/>));\n\t\t\t\tlcs.forEach((lc) => {\n\t\t\t\t\tlet opt = optFrp.appendChild(<option value={lc.code || LC_STATE_DEFAULT_KEY} data-model={it.getModel()}>{lc.name || LC_STATE_DEFAULT_NAME}</option>);\n\t\t\t\t\topt.style.color = lc.color || \"var(--color)\";\n\t\t\t\t\tif (lc.iconUrl) opt.style.backgroundImage = `url(\"${lc.iconUrl}\")`;\n\t\t\t\t\tif (lc.code == \"\") DOM.setAttrBool(opt, \"selected\", true);\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\t\tconst critHead = sr.appendChild(<div class=\"critHead\">\n\t\t\t<div class=\"h\">\n\t\t\t\t<span class=\"critTitle\">{this.reg.env.wsp.wspMetaUi.getLcName()}</span>\n\t\t\t\t{this._lcElt}\n\t\t\t</div>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\t// LC\n\t\tthis._lcElt.selectedIndex = -1;\n\t\tconst lcStates = xml.getAttribute(\"lcStates\") || \"\";\n\t\tconst lcStatesArr = lcStates.split(\" \");\n\t\tArray.from(this._lcElt.options).forEach(opt => {\n\t\t\topt.selected = lcStatesArr.includes(opt.value)\n\t\t})\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tlet crit = new SearchLifeCycleStates();\n\t\tcrit.lcStates = [];\n\t\tArray.from(this._lcElt.selectedOptions).forEach(opt => crit.lcStates.push(opt.value));\n\t\treturn crit;\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tif (crit) {\n\t\t\tconst statesWithModel: string[] = [];\n\t\t\tArray.from(this._lcElt.selectedOptions).forEach(opt => statesWithModel.push(opt.getAttribute('data-model') + \":\" + opt.value));\n\t\t\tcrit.setAttribute(\"uiCritStatesByModels\", statesWithModel.join(\" \"));\n\t\t}\n\t\treturn crit;\n\t}\n\n}\n\ncustomElements.define(\"wsp-taskcrit-lifecycle\", TaskCritLifeCycle);\nREG.reg.registerSkin('wsp-taskcrit-lifecycle', 1, /* language=CSS */ `\n\tselect {\n\t\tflex: 1;\n\t\tresize: vertical;\n\t\theight: 10rem;\n\t}\n\n\toption {\n\t\t/*background-image: url(\"affecteeDynamiquement\");*/\n\t\tbackground-repeat: no-repeat;\n\t\tbackground-size: auto 1rem;\n\t\tmin-width: 3rem;\n\t\tpadding-inline-start: 1.3rem;\n\t  margin-inline-start: 1.3rem;\n  }\n\n  option::before {\n\t  content: \"\" !important;\n  }\n\n`);\nREG.reg.registerSvc(\"wsp-taskcrit-lifecycle\", 1, TaskCritLifeCycle.AREA);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-lifecycle\", 1, \"wsp-taskcrit-lifecycle\");\n\n/**\n * Resps\n */\nclass ItemCritRespsonsabilities_task extends ItemCritRespsonsabilities {\n\tprotected target: 'task' | 'item' = \"task\";\n}\n\ncustomElements.define(\"wsp-taskcrit-respsonsabilities\", ItemCritRespsonsabilities_task);\nREG.reg.registerSvc(\"wsp-taskcrit-respsonsabilities\", 1, ItemCritRespsonsabilities.AREA_task);\nREG.reg.addSvcToList(\"wsp.crit.tasks\", \"wsp-taskcrit-respsonsabilities\", 1, \"wsp-taskcrit-respsonsabilities\");"]}