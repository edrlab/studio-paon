{"version":3,"sources":["/@back@/wsp/views/item/itemAudio.tsx"],"names":["BaseElement","installSrcViewFileDrop","REG","JSX","DOMSH","WSP","SRC","ItemAudio","[object Object]","init","this","reg","findReg","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","env","audio","createElement","src","getStreamUrl","transform","controls","appendChild","place","eventsMgr","on","msg","srcRef","longDesc","getStreamStampedUrl","wsp","itemType","getMainStreamSrcUri","srcDt","registerSkin","customElements","define"],"mappings":"OAAQA,gBAA2B;OACfC,2BAAuB;OAC7BC,QAAI;OAEVC,QAAI;OACJC,UAAM;OACYC,QAAI;OACtBC,QAAI;OAkBN,MAAOC,kBAAkBP,YAG9BQ,YAAYC,MACXC,KAAKC,IAAMD,KAAKE,QAAQH;AACxB,MAAMI,GAAKH,KAAKI,aAAaV,MAAMW;AACnCL,KAAKM,oBAAoBN,KAAKO,UAAWR;AACzCR,uBAAuBS,KAAKC,IAAKD;AACjC,MAAMQ,IAACA,KAAOR,KAAKC;AACnB,MAAMQ,MAAQhB,IAAAiB,cAAA,QAAA,CAAOC,IAAKX,KAAKY,aAAaJ,IAAKT,KAAKc,WAAYC,SAAQ;AAC1EX,GAAGY,YAAYN;AAGfD,IAAIQ,MAAMC,UAAUC,GAAG,eAAiBC,MACvC,GAAIvB,IAAIwB,OAAOZ,IAAIa,YAAczB,IAAIwB,OAAOD,KAAM,CACjDV,MAAME,IAAMX,KAAKY,aAAaJ,IAAKT,KAAKc,cAK3Cf,aAAaU,IAAiBK,WAC7B,OAAOlB,IAAI2B,oBAAoBd,IAAIe,IAAKf,IAAIgB,SAASC,oBAAoBjB,IAAIa,UAAWb,IAAIa,SAASK,MAAOb,YAI9GrB,IAAIS,IAAI0B,aAAa,iBAAkB,EAAsB;AAa7DC,eAAeC,OAAO,iBAAkBhC","sourcesContent":["import {BaseElement, OSkinableInit} from \"back/commons/basis\";\nimport {IItemUiEnv, installSrcViewFileDrop} from \"back/wsp/views/itemMain\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IView} from \"lib/commons/views\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {JWspUriChangeMsg, WSP} from \"lib/wsp/wsp\";\nimport {SRC} from \"lib/wsp/src\";\n\n/**\n * View d'affichage d'un flux audio.\n *\n * TODO forme d'onde...\n *\n * Config attributes:\n */\nexport interface OItemAudioInit extends OSkinableInit {\n\treg?: IReg<IItemUiEnv>\n\ttransform?: string\n}\n\nexport interface ItemAudio extends BaseElement {\n\tinitialize(init: OItemAudioInit): this;\n}\n\nexport class ItemAudio extends BaseElement implements IView {\n\treg: IReg<IItemUiEnv>;\n\n\t_initialize(init: OItemAudioInit) {\n\t\tthis.reg = this.findReg(init);\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tinstallSrcViewFileDrop(this.reg, this);\n\t\tconst {env} = this.reg;\n\t\tconst audio = <audio src={this.getStreamUrl(env, init.transform)} controls/>;\n\t\tsr.appendChild(audio);\n\n\t\t// Listener sur les changements de la ressource\n\t\tenv.place.eventsMgr.on(\"wspUriChange\", (msg: JWspUriChangeMsg) => {\n\t\t\tif (SRC.srcRef(env.longDesc) === SRC.srcRef(msg)) {\n\t\t\t\taudio.src = this.getStreamUrl(env, init.transform)\n\t\t\t}\n\t\t});\n\t}\n\n\tgetStreamUrl(env: IItemUiEnv, transform: string) {\n\t\treturn WSP.getStreamStampedUrl(env.wsp, env.itemType.getMainStreamSrcUri(env.longDesc), env.longDesc.srcDt, transform)\n\t}\n}\n\nREG.reg.registerSkin(\"wsp-item-audio\", 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tpadding: 1px;\n\t}\n`);\n\n\ncustomElements.define(\"wsp-item-audio\", ItemAudio);\n"]}