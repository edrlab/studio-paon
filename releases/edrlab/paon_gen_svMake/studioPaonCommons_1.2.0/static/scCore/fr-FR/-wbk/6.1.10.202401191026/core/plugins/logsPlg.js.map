{"version":3,"sources":["/@back@/core/plugins/logsPlg.tsx"],"names":["SimpleTagArea","REG","LogsApp","Action","ActionHackCtx","initApp","reg","WrapReg","[object Object]","sub","super","this","ctx","buttonNode","initButtonNode","wrap","action","d","desk","addAppBuilder","LogsAppBuilder","addToList","setLabel","setExecute","event","findAndOpenApp","logsUniverse","setVisible","atLeastOneEntry","env","resolver","resolve","data","skin","skinOver","newElt","initialize"],"mappings":"OAEQA,kBAAc;OACKC,QAAI;OAGvBC,YAAQ;OACRC,OAAQC,kBAAuB;;OAYjC,SAAUC,QAAQC,IAA0BL,IAAIK,KACrD,MAAMC,gBAAgBH,cACrBI,YAAYC,IAAyCH,KACpDI,MAAMD;AAD8CE,KAAAL,IAAAA,IAIrDE,QAAQI,KAAmC,OAAOD,KAAKL,IAEvDE,eAAeK,WAAqBD,KAElCC,WAAyCP,IAAMK,KAAKL;AACrDK,KAAKF,IAAIK,eAAeD,WAAYF,KAAKL,MAI3C,SAASS,KAAKC,QACb,OAAO,IAAIT,QAAQS,OAAQV,KAG5B,MAAMW,EAAIC;AACVD,EAAEE,cAAc,IAAIC,eAAed;AAGnCL,IAAIK,IAAIe,UAAU,uCAAwC,OAAQ,EAAGN,MAAK,IAAIZ,QAASmB,SAAS,kBAC9FC,YAAW,SAAwBX,IAAKY,OACvCN,KAA0BO,eAAe,CAACC,aAAc,UAEzDC,WAAYf,KACLV,QAAQ0B,gBAAgBhB,IAAIN,OAC/B,IAcP,MAAMc,uBAAuBpB,cAM5BQ,YAAmBF,KAClBI,MAAM,WAAYJ,IAAIuB,IAAIC,SAASC,QAAQ;AADzBpB,KAAAL,IAAAA,IAInBE,cAAcwB,MAA8B,MAAO,iBAAkBA,KAErExB,OAAOI,KACN,IAAKA,IAAIqB,KAAMrB,IAAIqB,KAAOtB,KAAKsB;AAC/B,IAAKrB,IAAIsB,SAAUtB,IAAIsB,SAAWvB,KAAKuB;AACvCtB,IAAIN,IAAMK,KAAKL;AACf,OAAQI,MAAMyB,OAAOvB,KAAiBwB,WAAWxB","sourcesContent":["import {OSkinableInit} from \"back/commons/basis\";\nimport {AppFrameDeskFeat, IApp, IAppBuilder, IAppCtx, JAppDef} from \"back/core/appFrame\";\nimport {SimpleTagArea} from \"lib/commons/areas\";\nimport {IReg, IRegPointer, REG} from 'lib/commons/registry';\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {IBasicUniversePointer, IUniverseEnv} from \"lib/core/universe\";\nimport {LogsApp} from \"back/core/apps/logsApp\";\nimport {Action, ActionHackCtx, IAction} from \"lib/commons/actions\";\nimport \"back/core/plugins/plugins_Perms\";\n\n/**\n * Affichage des logs des différents univers référencés\n *\n * @param contexte reg :\n * \t- liste des JLogsAppEntry à traiter : \"plg:logs:entries\".\n *\n * \tUn univers peut être la porte d'accès à un espace de logs plus global (du .server, ...)\n *\n */\nexport function initApp(reg: IReg<IUniverseEnv> = REG.reg) {\n\tclass WrapReg extends ActionHackCtx<Element, IReg<IUniverseEnv>> {\n\t\tconstructor(sub: IAction<IReg<IUniverseEnv>>, public reg: IReg<IUniverseEnv>) {\n\t\t\tsuper(sub);\n\t\t}\n\n\t\twrapCtx(ctx: Element): IReg<IUniverseEnv> {return this.reg}\n\n\t\tinitButtonNode(buttonNode: Element, ctx: Element) {\n\t\t\t//Affectation du bon registre dans le contexte graphique.\n\t\t\t(buttonNode as IRegPointer<IUniverseEnv>).reg = this.reg;\n\t\t\tthis.sub.initButtonNode(buttonNode, this.reg);\n\t\t}\n\t}\n\n\tfunction wrap(action: IAction<IReg<IUniverseEnv>>): IAction<Element> {\n\t\treturn new WrapReg(action, reg);\n\t}\n\n\tconst d = desk as AppFrameDeskFeat;\n\td.addAppBuilder(new LogsAppBuilder(reg));\n\n\t//Menu Options > admin\n\tREG.reg.addToList(\"appframe:header:toolbar:params:admin\", \"logs\", 1, wrap(new Action().setLabel(\"Logs système\")\n\t\t.setExecute(function (this: Action, ctx, event) {\n\t\t\t(desk as AppFrameDeskFeat).findAndOpenApp({logsUniverse: null} as JLogsAppDef);\n\t\t})\n\t\t.setVisible((ctx: IReg<IUniverseEnv>) => {\n\t\t\treturn LogsApp.atLeastOneEntry(ctx.reg);\n\t\t})), 10);\n}\n\n\n/**\n * Schéma du hash de l'URL pour le LogsApp.\n * exemple : (logsUnivers'')\n */\nexport interface JLogsAppDef extends JAppDef {\n\t/** Code de l'univers à afficher */\n\tlogsUnivers?: string[] | null\n}\n\n/** Construction async de l'app LogsApp. */\nclass LogsAppBuilder extends SimpleTagArea<IAppCtx<IBasicUniversePointer>, IApp<IBasicUniversePointer>> implements OSkinableInit, IAppBuilder<IBasicUniversePointer, IBasicUniversePointer> {\n\n\tskin?: string;\n\n\tskinOver?: string;\n\n\tconstructor(public reg: IReg<any>) {\n\t\tsuper('logs-app', reg.env.resolver.resolve(\":back:core/apps/logsApp.js\"));\n\t}\n\n\tisAppDefMatch(data: JLogsAppDef) : boolean {return \"logsUniverse\" in data}\n\n\tnewElt(ctx: IAppCtx<IBasicUniversePointer> & OSkinableInit): LogsApp {\n\t\tif (!ctx.skin) ctx.skin = this.skin;\n\t\tif (!ctx.skinOver) ctx.skinOver = this.skinOver;\n\t\tctx.reg = this.reg;\n\t\treturn (super.newElt(ctx) as LogsApp).initialize(ctx);\n\t}\n\n}\n\n"]}