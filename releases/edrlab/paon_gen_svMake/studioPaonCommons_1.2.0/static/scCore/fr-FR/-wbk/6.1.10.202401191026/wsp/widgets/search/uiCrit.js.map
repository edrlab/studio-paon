{"version":3,"sources":["/@back@/wsp/widgets/search/uiCrit.tsx"],"names":["BaseElement","DOM","JSX","DOMSH","REG","Area","SimpleTagArea","Button","ButtonActions","ACTION","Action","SearchAnd","SearchFree","SearchFullXPath","SearchItemLinks","SearchNot","SearchOccurencesSubExp","SearchOr","SearchRegexpUri","LANG","POPUP","IS_UiCritWidget","n","HTMLElement","buildCritAreaFromXml","elt","criterions","undefined","key","getAttribute","localName","UiCritUnknown","AREA","UiCritArea","[object Object]","ctx","w","super","buildBody","critArea","this","uiCrit","replacePattern","critSgn","test","fct","canReplace","xml","options","createElement","class","getLabel","buildAbstract","buildWedSearch","UiCritBase","init","reg","findReg","attachShadow","SHADOWDOM_INIT","installSkin","shadowRoot","_initAndInstallSkin","onChange","dispatchChangeEvent","bind","headElt","desc","getDescription","title","buildInitFromAtts","criterionsHolder","findParentElt","initFromXmlCrit","crit","buildCrit","toDom","setAttribute","getUiCritXmlAtt","dispatchEvent","CustomEvent","bubbles","hideAlternativesBtn","CritAction","area","replace","getId","ev","loadBody","initialize","currentCritXml","buildUiXmlCrit","parentNode","insertBefore","remove","initFromInsAction","actions","Object","values","isVisible","push","length","buildAlternativesBtn","î","label","actionContext","registerSkin","UiCritBoolArea","id","hideCritHeader","_group","_id","UiCritBool","liaise","liaiseNot","chAbstract","ch","firstElementChild","nextElementSibling","isNot","chXml","chCrit","sub","ser","s","booleanOp","_initialize","head","appendChild","setLabel","AREA_AND","AREA_OR","setExecute","_refresh","addEventListener","target","parentElement","deleteCrit","stopImmediatePropagation","refreshFreeze","critXml","insertCrit","findFirstChild","findNextSibling","pushIfDefined","asXml","root","notOp","notOpt","UiCritNotOptional","initFromContext","refresh","op","setTextContent","insFound","next","booleanContext","_insertAddBtn","before","skin","onclick","onInsert","getGroup","getIcon","isEnabled","critCtn","crits","filter","map","injectSepByGroup","showPopupActionsFromEvent","AREA_AND_ROOT","AREA_OR_ROOT","customElements","define","_booleanContext","v","_isNot","NotAction","_label","api","popupBtn","icon","onDelete","getChildCrit","findHost","composed","UiCritFree","sr","insertAlternativesBtn","input","onblur","onBlur","oninput","onInput","value","validateInput","dom","parseDomValid","documentElement","txt","setCustomValidity","reportValidity","me","_dirty","setGroup","setBuildAbstract","UiCritSrcUri","isRegExp","_regExpElt","checked","_textElt","type","querySelector","optsRoot","hasAttribute","RegExp","regexp","escapeChar4Regexp","setCritSgn","setReplacePattern","searchValue","searchTxt","UiCritXpath","nsListCode","_Ns","Map","_DefaultNsCodeList","_xpathElt","nsList","getListAsMap","prefix","set","UiCritSubRequestArea","traitsCodeList","UiCritSubRequest","operator","OP","LinkExpXml","findSubExpLinksElement","subCritRootXml","subCritRoot","subCritRootAbstract","linkTraitFilter","linkTraitFilterAbstract","traits","areaShortLabel","_a","_b","_c","initHeadFromArea","buttonActions","_trFilterElt","onchange","selected","tr","_opElt","_opValueElt","min","step","_subExpElt","subExp","Number","parseInt","searchItemLinks","AREA_DESC","AREA_ASC","AREA_PARENTS","setPath","setLinkTraitFilter","subExpCritElt","removeChild","lastChild","AREA_CHILDREN","gt","gt=","lt","lt=","="],"mappings":"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","sourcesContent":["import {BaseElement, OSkinableInit} from \"back/commons/basis\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IWspUiEnv} from \"lib/wsp/wsp\";\nimport {Area, IArea, SimpleTagArea} from \"lib/commons/areas\";\nimport {Button, ButtonActions, OButtonActionsInit} from \"back/commons/widgets/buttons\";\nimport {ACTION, Action, IAction, IActionToggle} from \"lib/commons/actions\";\nimport {EOperatorsSimple, ISearchCrit, SearchAnd, SearchFree, SearchFullXPath, SearchItemLinks, SearchNot, SearchOccurencesSubExp, SearchOr, SearchRegexpUri} from \"lib/wsp/search\";\nimport {LANG} from \"lib/commons/lang\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {JWedSearchBarParams} from \"back/edit/wed/features/searchBar\";\n\n/**\n * Factory des widgets d'affichage des critères de recherche.\n * Par défaut, la liste des critères disponibles est issue de la liste d'extPoints :\n * - \"wsp.crit.items\" pour les recherches d'items.\n * - \"wsp.crit.tasks\" pour les recherches de tâches.\n */\nexport interface IUiCritArea extends IArea<OUiCritInit, IUiCritWidget> {\n\n\t/** Signature du critère pour gérer les alternatives autorisées. */\n\tcritSgn?: string\n\n\t/** Evalue si un critère issu de cette factory pourrait remplacer le critère instancié passé en paramètre. */\n\tcanReplace(uiCrit: IUiCritWidget, ctx: OUiCritInit): boolean\n\n\t/** Construit un résumé HTML textuel (enrichi d'éventuels tooltips) de ce critère de recherche. */\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined\n\n\t/** Construit des critère de recherches Wed internes à l'item pour poursuivre la requete dans l'item. */\n\tbuildWedSearch?(xml: Element, criterions: Dict<IUiCritArea>): JWedSearchBarParams | undefined\n}\n\n/**\n *\n */\nexport interface IUiCritWidget extends BaseElement {\n\n\tcritArea: IUiCritArea\n\n\tinitialize(init: OUiCritInit): this;\n\n\t/** Initialisation du critère à partir de sa forme xml. Doit être appelé après initialize(init). */\n\tinitFromXmlCrit(xml: Element): Promise<this>\n\n\t/**\n\t * Initialise ce critère lorsqu'il est issu d'une action d'insertion / remplacement de l'utilisateur.\n\t * Permet d'enclencher l'ouverture auto d'un popup par ex.\n\t * La méthode this.dispatchChangeEvent() est automatiquement appelée par cette méthode.\n\t * Cette méthode doit être appelé après initialize(init).\n\t */\n\tinitFromInsAction(xml?: Element): Promise<this>\n\n\tbuildCrit(): ISearchCrit | undefined\n\n\tbuildUiXmlCrit(): Element | undefined\n\n\t/** Dispatch un event 'wsp-uicrit-change' signalant un changement. */\n\tdispatchChangeEvent(): void\n}\n\nexport function IS_UiCritWidget(n: any): n is IUiCritWidget {return n instanceof HTMLElement && ('buildCrit' in n)}\n\n/**\n * Recherche d'un constructeur de widget de critère à partir de sa représentation xml.\n */\nexport function buildCritAreaFromXml(elt: Element, criterions: Dict<IUiCritArea>): IUiCritArea | undefined {\n\tif (!elt) return undefined;\n\tconst key = elt.getAttribute('uiCrit') || elt.localName;\n\treturn (criterions ? criterions[key] : null) || UiCritUnknown.AREA;\n}\n\n\n/** Impl de base de IUiCritArea */\nexport class UiCritArea extends SimpleTagArea<OUiCritInit, IUiCritWidget> implements IUiCritArea {\n\n\t/** Pattern de regroupement des critères remplaçables entre eux. */\n\treplacePattern?: RegExp;\n\n\tcritSgn?: string;\n\n\tbuildBody(ctx: OUiCritInit): IUiCritWidget {\n\t\tconst w = super.buildBody(ctx);\n\t\tw.critArea = this;\n\t\treturn w;\n\t}\n\n\tcanReplace(uiCrit: IUiCritWidget, ctx: OUiCritInit): boolean {\n\t\tif (!this.replacePattern || !uiCrit.critArea.critSgn) return false;\n\t\treturn this.replacePattern.test(uiCrit.critArea.critSgn);\n\t}\n\n\tsetCritSgn(critSgn: string): this {\n\t\tthis.critSgn = critSgn;\n\t\treturn this;\n\t}\n\n\tsetReplacePattern(replacePattern: RegExp): this {\n\t\tthis.replacePattern = replacePattern;\n\t\treturn this;\n\t}\n\n\tsetCanReplace(fct: (uiCrit: IUiCritWidget, ctx: OUiCritInit) => boolean): this {\n\t\tthis.canReplace = fct;\n\t\treturn this;\n\t}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\treturn <span class=\"crit\">{this.getLabel(ctx)}</span>;\n\t}\n\n\tsetBuildAbstract(fct: (xml: Element, ctx: OUiCritInit, options?: any) => HTMLElement | undefined): this {\n\t\tthis.buildAbstract = fct;\n\t\treturn this;\n\t}\n\n\tbuildWedSearch(xml: Element, criterions: Dict<IUiCritArea>): JWedSearchBarParams | undefined {return undefined}\n\n\tsetBuildWedSearch(fct: (xml: Element, criterions: Dict<IUiCritArea>) => JWedSearchBarParams): this {\n\t\tthis.buildWedSearch = fct;\n\t\treturn this;\n\t}\n}\n\nexport interface OUiCritInit extends OSkinableInit {\n\treg: IReg<IWspUiEnv>\n\n\t/**\n\t * Map des critères disponibles pour ce contexte de recherche. La key de la map est l'id de l'Area\n\t * qui doit être la valeur de l'attribut \"uiCrit\" de la forme sérialisée en XML du critère.\n\t * Par défaut, la liste des critères disponibles est issue de la liste d'extPoints :\n\t * - \"wsp.crit.items\" pour les recherches d'items.\n\t * - \"wsp.crit.tasks\" pour les recherches de tâches.\n\t */\n\tcriterions?: Dict<IUiCritArea>;\n\n\thideAlternativesBtn?: boolean\n}\n\nexport interface OUiCritWithInputInit {\n\tplaceholder?: string\n}\n\n/**\n * Widget de base pour l'affichage d'un critère de recherche.\n * Doit émettre un event \"wsp-uicrit-change\" à chaque changement effectif du critère.\n */\nexport abstract class UiCritBase extends BaseElement implements IUiCritWidget {\n\n\t/** Factory de ce widget*/\n\tcritArea: IUiCritArea;\n\n\treg: IReg<IWspUiEnv>;\n\n\tcriterions: Dict<IUiCritArea>;\n\n\t/** this.dispatchChangeEvent.bind(this) */\n\tprotected onChange: () => void;\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tif (!this.criterions) this.criterions = init.criterions;\n\t\tthis.reg = this.findReg(init);\n\t\tthis.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis.reg.installSkin('wsp-uicrit', this.shadowRoot);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tthis.onChange = this.dispatchChangeEvent.bind(this);\n\t}\n\n\tstatic initHeadFromArea(critArea: IUiCritArea, ctx: OUiCritInit, headElt: HTMLElement) {\n\t\tif (critArea && headElt) {\n\t\t\tconst desc = critArea.getDescription(ctx);\n\t\t\tif (desc) headElt.title = desc;\n\t\t}\n\t}\n\n\tbuildInitFromAtts(init?: OUiCritInit): any {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tif (!init.criterions) {\n\t\t\tconst criterionsHolder = DOMSH.findParentElt(this, null, (n: any): n is Element => (n as OUiCritInit).criterions != null) as any as OUiCritInit;\n\t\t\tif (criterionsHolder) init.criterions = criterionsHolder.criterions;\n\t\t}\n\t\treturn init;\n\t}\n\n\tabstract initFromXmlCrit(xml: Element): Promise<this>;\n\n\tasync initFromInsAction(xml?: Element): Promise<this> {\n\t\tif (xml) await this.initFromXmlCrit(xml);\n\t\tthis.dispatchChangeEvent();\n\t\treturn this;\n\t}\n\n\tabstract buildCrit(): ISearchCrit | undefined;\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit = this.buildCrit();\n\t\tif (!crit) return undefined;\n\t\tconst elt = crit.toDom();\n\t\tif (elt) elt.setAttribute(\"uiCrit\", this.getUiCritXmlAtt());\n\t\treturn elt;\n\t}\n\n\t/** Valeur de l'attribut XML 'uiCrit' utilisé pour sérialiser ce critère en XML. */\n\tprotected getUiCritXmlAtt(): string {\n\t\treturn this.localName;\n\t}\n\n\tdispatchChangeEvent() {\n\t\tthis.dispatchEvent(new CustomEvent('wsp-uicrit-change', {bubbles: true}));\n\t}\n\n\tprotected insertAlternativesBtn(init: OUiCritInit): ButtonActions<OUiCritInit> | null {\n\t\tif (init.hideAlternativesBtn) return null;\n\n\t\tclass CritAction extends Action<OUiCritInit> {\n\t\t\tconstructor(public area: IUiCritArea, public replace: UiCritBase) {\n\t\t\t\tsuper(area.getId());\n\t\t\t}\n\n\t\t\tgetLabel(ctx: OUiCritInit): string {return this.area.getLabel(ctx)}\n\n\t\t\tasync execute(ctx: OUiCritInit, ev?: Event) {\n\t\t\t\tconst elt = (await this.area.loadBody(ctx)).initialize(ctx);\n\t\t\t\tconst currentCritXml = this.replace.buildUiXmlCrit();\n\t\t\t\tthis.replace.parentNode.insertBefore(elt, this.replace);\n\t\t\t\tthis.replace.remove();\n\t\t\t\telt.initFromInsAction(currentCritXml);\n\t\t\t}\n\t\t}\n\n\t\tconst actions = [] as IAction<OUiCritInit>[];\n\t\tfor (const area of Object.values(init.criterions)) {\n\t\t\tif (area !== this.critArea && area.canReplace(this, init) && area.isVisible(this)) actions.push(new CritAction(area, this));\n\t\t}\n\t\treturn actions.length > 0 ? this.buildAlternativesBtn(actions, this.findReg(init)) : null;\n\t}\n\n\tprotected buildAlternativesBtn(actions: IAction<OUiCritInit>[], reg: IReg<IWspUiEnv>): ButtonActions<OUiCritInit> | null {\n\t\treturn <ButtonActions class=\"altBtn\" î={{\n\t\t\treg: reg,\n\t\t\tlabel: \"⇄\",\n\t\t\tactions: actions,\n\t\t\tactionContext: this\n\t\t}}/> as ButtonActions<OUiCritInit>;\n\t}\n\n}\n\n/** Stylage commun à tous les widgets de définition de crtitères. */\nREG.reg.registerSkin('wsp-uicrit', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: block;\n\t\tpadding: 2px;\n\t\toverflow: hidden;\n\t}\n\n\t:focus-visible {\n\t\toutline: var(--focus-outline);\n\t}\n\n\t.critHead {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tuser-select: none;\n\t\talign-items: center;\n\t}\n\n\t.critTitle {\n\t\tfont-weight: bold;\n\t\tmargin: 2px;\n\t}\n\n\tc-button-actions {\n\t\tmin-width: fit-content;\n\t}\n\n\t.h {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t}\n\n\tinput[type=search] {\n\t\tflex: 1;\n\t}\n\n\t.inputsCtn {\n\t\tmargin-inline-start: 1em;\n\t}\n\n\tinput, select {\n\t\tmargin-inline-start: 1em;\n\t\tbackground-color: var(--form-bgcolor);\n\t\tcolor: var(--form-color);\n\t\tborder: 1px solid var(--border-color);\n\t\tfont-size: inherit;\n\t}\n\n\t.opt {\n\t\tfont-size: var(--label-size);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tuser-select: none;\n\t}\n\n\t:invalid {\n\t\tborder-color: var(--error-color);\n\t\tcolor: var(--error-color);\n\t}\n\n\t.altBtn {\n\t\tdisplay: inline-flex;\n\t\tbackground: var(--insbtn-bg);\n\t\tcolor: var(--insbtn-color);\n\t\tborder: 1px outset var(--border-color);\n\t\tborder-radius: 3px;\n\t\tmargin: 0 2px;\n\t\tpadding: 2px;\n\t}\n\n\t.altBtn:hover {\n\t\tbackground: var(--insbtn-hover-bg);\n\t}\n`);\n\n/** Area pour les opérateurs booléen AND / OR intégrant le sous opérateur NOT optionnel pour chaque fils. */\nclass UiCritBoolArea extends Area<OUiCritInit, IUiCritWidget> implements IUiCritArea {\n\n\tconstructor(id: 'and' | 'or', public hideCritHeader?: boolean) {\n\t\tsuper(id);\n\t\tif (!hideCritHeader) this._group = \"bool\";\n\t}\n\n\tgetLabel(ctx: OUiCritInit): string {return this._id === 'or' ? \"Groupe de critères (... OU ...)\" : \"Groupe de critères (... ET ...)\"}\n\n\tbuildBody(ctx: OUiCritInit): IUiCritWidget {\n\t\tconst w = new UiCritBool();\n\t\tw.critArea = this;\n\t\treturn w;\n\t}\n\n\tcanReplace(uiCrit: IUiCritWidget, ctx: OUiCritInit): boolean {return uiCrit instanceof UiCritBool}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\tconst liaise = this._id === 'or' ? \" OU \" : \" ET \";\n\t\tconst liaiseNot = this._id === 'or' ? \" OU SAUF \" : \" ET SAUF \";\n\t\tconst chAbstract = [] as HTMLElement[];\n\t\tfor (let ch = xml.firstElementChild; ch; ch = ch.nextElementSibling) {\n\t\t\tconst isNot = ch.localName === 'not';\n\t\t\tconst chXml = isNot ? ch.firstElementChild : ch;\n\t\t\tconst chCrit = buildCritAreaFromXml(chXml, ctx.criterions);\n\t\t\tconst sub = chCrit ? chCrit.buildAbstract(chXml, ctx) : <span class=\"critUnknown\"><span class=\"xml\">{DOM.ser(chXml)}</span></span>;\n\t\t\tif (sub) {\n\t\t\t\tif (chAbstract.length > 0) chAbstract.push(<span class=\"boolOp\">{isNot ? liaiseNot : liaise}</span>);\n\t\t\t\telse if (isNot) chAbstract.push(<span class=\"boolOp\"> SAUF </span>);\n\t\t\t\tchAbstract.push(sub);\n\t\t\t}\n\t\t}\n\t\tif (chAbstract.length === 0) return undefined;\n\t\tif (this.hideCritHeader) return <span>{chAbstract}</span>;\n\t\treturn <span class=\"boolGroup\">\n\t\t\t<span class=\"boolBracket\">(</span>\n\t\t\t{chAbstract}\n\t\t\t<span class=\"boolBracket\">)</span>\n\t\t\t</span>;\n\t}\n\n\tbuildWedSearch(xml: Element, criterions: Dict<IUiCritArea>): JWedSearchBarParams {\n\t\tfor (let ch = xml.firstElementChild; ch; ch = ch.nextElementSibling) {\n\t\t\tconst chCrit = buildCritAreaFromXml(ch, criterions);\n\t\t\tif (chCrit && (\"buildWedSearch\" in chCrit)) {\n\t\t\t\tconst s = chCrit.buildWedSearch(ch, criterions);\n\t\t\t\tif (s) return s;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Widgets pour les opérateurs booléens AND et OR.\n */\nexport class UiCritBool extends UiCritBase {\n\n\tstatic AREA_AND = new UiCritBoolArea('and');\n\tstatic AREA_OR = new UiCritBoolArea('or');\n\tstatic AREA_AND_ROOT = new UiCritBoolArea('and', true);\n\tstatic AREA_OR_ROOT = new UiCritBoolArea('or', true);\n\n\tcritArea: UiCritBoolArea;\n\n\tget booleanOp(): 'and' | 'or' {return this.critArea.getId() as 'and' | 'or'};\n\n\tlabel: HTMLElement;\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tif (!this.critArea.hideCritHeader) {\n\t\t\tconst head = this.shadowRoot.appendChild(<div id=\"critHead\"/>);\n\t\t\tthis.label = head.appendChild(<span/>);\n\t\t\thead.appendChild(this.buildAlternativesBtn([new Action<OUiCritInit>('altBool')\n\t\t\t\t.setLabel((ctx: OUiCritInit) => {\n\t\t\t\t\treturn this.critArea === UiCritBool.AREA_AND ? UiCritBool.AREA_OR.getLabel(ctx) : UiCritBool.AREA_AND.getLabel(ctx);\n\t\t\t\t})\n\t\t\t\t.setExecute(() => {\n\t\t\t\t\tthis.critArea = this.critArea === UiCritBool.AREA_AND ? UiCritBool.AREA_OR : UiCritBool.AREA_AND;\n\t\t\t\t\tthis._refresh();\n\t\t\t\t})], this.reg));\n\t\t}\n\t\tthis.shadowRoot.appendChild(<slot id=\"critCh\"/>);\n\t\tthis.addEventListener(\"wsp-uicrit-toDelete\", (ev: CustomEvent) => {\n\t\t\tconst ch = ev.target as Node;\n\t\t\tif (ch && ch.parentElement === this) this.deleteCrit(ch as IUiCritWidget);\n\t\t\tev.stopImmediatePropagation();\n\t\t})\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tthis.refreshFreeze(1);\n\t\ttry {\n\t\t\tfor (let ch = xml.firstElementChild; ch; ch = ch.nextElementSibling) {\n\t\t\t\tconst isNot = ch.localName === 'not';\n\t\t\t\tconst critXml = isNot ? ch.firstElementChild : ch;\n\t\t\t\tconst critArea = buildCritAreaFromXml(critXml, this.criterions);\n\t\t\t\tif (critArea) {\n\t\t\t\t\tconst crit = await critArea.loadBody(this);\n\t\t\t\t\tif (crit) {\n\t\t\t\t\t\tcrit.initialize(this);\n\t\t\t\t\t\tawait crit.initFromXmlCrit(critXml);\n\t\t\t\t\t\tthis.insertCrit(crit, isNot);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.refreshFreeze(-1);\n\t\t}\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst crit = this.booleanOp === 'or' ? new SearchOr() : new SearchAnd();\n\t\tfor (let ch = DOM.findFirstChild(this, IS_UiCritWidget); ch; ch = DOM.findNextSibling(ch, IS_UiCritWidget)) {\n\t\t\tLANG.pushIfDefined(crit, ch.buildCrit());\n\t\t}\n\t\treturn crit.length > 0 ? crit : undefined;\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\treturn JSX.asXml(() => {\n\t\t\tconst root = this.booleanOp === 'or' ? <or/> : <and/>;\n\t\t\tif (!this.critArea.hideCritHeader) root.setAttribute(\"uiCrit\", this.booleanOp === 'or' ? \"wsp-uicrit-bool:or\" : \"wsp-uicrit-bool:and\");\n\t\t\tfor (let ch = DOM.findFirstChild(this, IS_UiCritWidget); ch; ch = DOM.findNextSibling(ch, IS_UiCritWidget)) {\n\t\t\t\tconst sub = ch.buildUiXmlCrit();\n\t\t\t\tif (sub) root.appendChild(sub);\n\t\t\t}\n\t\t\treturn root; //NON root.hasChildNodes() ? root : undefined; Sinon mauvaise reconstruction graphique.\n\t\t});\n\t}\n\n\tinsertCrit(crit: IUiCritWidget, notOp?: boolean, insertBefore?: HTMLElement) {\n\t\tconst notOpt = new UiCritNotOptional().initialize(this).initFromContext(this.booleanOp, notOp);\n\t\t//TODO notOpt.setAttribute(\"draggable\", \"true\");\n\t\tnotOpt.appendChild(crit);\n\t\tthis.insertBefore(notOpt, insertBefore);\n\t\tcrit.initFromInsAction();\n\t\tthis.refresh();\n\t}\n\n\tdeleteCrit(crit: IUiCritWidget) {\n\t\tcrit.remove();\n\t\tthis.dispatchChangeEvent();\n\t\tthis.refresh();\n\t}\n\n\t_refresh() {\n\t\tconst op = this.booleanOp;\n\t\tif (this.label) DOM.setTextContent(this.label, op === 'and' ? \"Tous les sous-critères sont remplis\" : \"Au moins un des sous-critères est rempli\");\n\t\tlet insFound = false;\n\t\tfor (let ch = this.firstElementChild; ch;) {\n\t\t\tconst next = ch.nextElementSibling;\n\t\t\tif (ch instanceof Button) {\n\t\t\t\tif (insFound) ch.remove();\n\t\t\t\telse insFound = true;\n\t\t\t} else if (ch instanceof UiCritNotOptional) {\n\t\t\t\tch.booleanContext = op;\n\t\t\t\tif (!insFound) this._insertAddBtn(ch);\n\t\t\t\telse insFound = false;\n\t\t\t}\n\t\t\tch = next;\n\t\t}\n\t\tif (!insFound) this._insertAddBtn(null);\n\t}\n\n\tprotected _insertAddBtn(before: Element) {\n\t\tthis.insertBefore(<Button class=\"insCrit\" skin=\"wsp-uicrit-bool/insCrit\" label=\"+\" title=\"Insérer un critère\" onclick={this.onInsert}/>, before);\n\t}\n\n\tprotected onInsert(this: Button, ev: MouseEvent) {\n\n\t\tclass CritAction extends Action<Button> {\n\t\t\tconstructor(public critArea: IUiCritArea) {\n\t\t\t\tsuper(critArea.getId());\n\t\t\t}\n\n\t\t\tgetGroup(ctx: Button): string {\n\t\t\t\treturn this.critArea.getGroup(ctx.parentElement as UiCritBool);\n\t\t\t}\n\n\t\t\tgetLabel(ctx: Button): string {\n\t\t\t\treturn this.critArea.getLabel(ctx.parentElement as UiCritBool);\n\t\t\t}\n\n\t\t\tgetIcon(ctx: Button): string {\n\t\t\t\treturn this.critArea.getIcon(ctx.parentElement as UiCritBool);\n\t\t\t}\n\n\t\t\tgetDescription(ctx: Button): string {\n\t\t\t\treturn this.critArea.getDescription(ctx.parentElement as UiCritBool);\n\t\t\t}\n\n\t\t\tisVisible(ctx: Button): boolean {return this.critArea.isVisible(ctx.parentElement as UiCritBool)}\n\n\t\t\tisEnabled(ctx: Button): boolean {return this.critArea.isEnabled(ctx.parentElement as UiCritBool)}\n\n\t\t\tasync execute(ctx: Button, ev?: Event) {\n\t\t\t\tconst critCtn = ctx.parentElement as UiCritBool;\n\t\t\t\tcritCtn.insertCrit(await this.critArea.loadBody(critCtn), false, ctx);\n\t\t\t}\n\t\t}\n\n\t\tconst critCtn = this.parentElement as UiCritBool;\n\t\tlet crits = Object.values(critCtn.criterions)\n\t\t\t.filter((area) => area.getGroup(critCtn))\n\t\t\t.map((area) => new CritAction(area)) as IAction<Button>[];\n\t\tcrits = ACTION.injectSepByGroup(crits, \"props bool scope * advanced\", this);\n\n\t\tPOPUP.showPopupActionsFromEvent({\n\t\t\tactions: crits,\n\t\t\tactionContext: this\n\t\t}, ev);\n\t}\n\n}\n\n\nREG.reg.registerSkin('wsp-uicrit-bool', 1, /* language=CSS */ `\n\t#critCh {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\tmargin: .5em 2px;\n\t}\n`);\n\nREG.reg.registerSkin('wsp-uicrit-bool/insCrit', 1, /* language=CSS */ `\n\t:host {\n\t\tcolor: var(--insbtn-color);\n\t\tbackground-color: var(--bgcolor);\n\t\talign-self: start;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbox-sizing: border-box;\n\t\tborder: 1px outset var(--border-color);\n\t\tborder-radius: 3px;\n\t\tcursor: pointer;\n\t\theight: 1.2em;\n\t\twidth: 1.2em;\n\t\tmargin: -.6em 0;\n\t\tpadding: 0 2px;\n\t\tz-index: 1;\n\t\tuser-select: none;\n\t}\n\n\t:host(:focus) {\n\t\toutline: var(--focus-outline);\n\t}\n\n\t.label {\n\t\tflex: 1;\n\t\tdisplay: block;\n\t\tbackground: var(--insbtn-bg);\n\t\tline-height: 1.2em;\n\t\tmin-width: 1.2em;\n\t\ttext-align: center;\n\t}\n\n\t:host(:hover) {\n\t\tbackground-color: var(--insbtn-hover-bg);\n\t}\n`);\ncustomElements.define(\"wsp-uicrit-bool\", UiCritBool);\n\n\n/**\n * Container d'un et d'un seul 'vrai' IUiCritWidget destiné à gérer le critère optionnel not() pour chaque\n * fils d'un IUiCritWidget AND ou OR.\n */\nexport class UiCritNotOptional extends UiCritBase {\n\n\tpublic popupBtn: ButtonActions<UiCritNotOptional>;\n\n\tprotected _booleanContext: 'and' | 'or';\n\tprotected _isNot: boolean;\n\n\tget booleanContext(): 'and' | 'or' {return this._booleanContext;}\n\n\tset booleanContext(v: 'and' | 'or') {\n\t\tif (this._booleanContext !== v) {\n\t\t\tthis._booleanContext = v;\n\t\t\tthis._refresh();\n\t\t}\n\t}\n\n\tget isNot(): boolean {return this._isNot}\n\n\tset isNot(v: boolean) {\n\t\tif (this._isNot !== v) {\n\t\t\tthis._isNot = v;\n\t\t\tthis._refresh();\n\t\t\tthis.dispatchChangeEvent();\n\t\t}\n\t}\n\n\tgetChildCrit(): IUiCritWidget | null {return DOM.findFirstChild(this, IS_UiCritWidget)}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\n\t\tclass NotAction extends Action<UiCritNotOptional> implements IActionToggle<UiCritNotOptional> {\n\t\t\tconstructor(public isNot: boolean, public crit: UiCritNotOptional) {\n\t\t\t\tsuper(isNot ? 'not' : '');\n\t\t\t\tif (isNot) {\n\t\t\t\t\tthis._label = function (ctx: UiCritNotOptional) {return ctx.booleanContext === 'or' ? \"OU SAUF\" : \"ET SAUF\"};\n\t\t\t\t} else {\n\t\t\t\t\tthis._label = function (ctx: UiCritNotOptional) {return ctx.booleanContext === 'or' ? \"OU\" : \"ET\"};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tisToggle(ctx: UiCritNotOptional): this is IActionToggle<UiCritNotOptional> {return true}\n\n\t\t\t/** null pour l'état 'mixed'. */\n\t\t\tgetDatas(api: 'toggle', ctx: UiCritNotOptional): boolean | null {return this.isNot === ctx.isNot}\n\n\t\t\tisEnabled(ctx: UiCritNotOptional): boolean {\n\t\t\t\tif (this.isNot === ctx.isNot) return false;\n\t\t\t\treturn super.isEnabled(ctx);\n\t\t\t}\n\n\t\t\texecute(ctx: UiCritNotOptional, ev?: Event): any | \"noPreventDefault\" {\n\t\t\t\tthis.crit.isNot = this.isNot;\n\t\t\t}\n\t\t}\n\n\t\tthis.popupBtn = this.shadowRoot.appendChild(<ButtonActions î={{\n\t\t\tactionContext: this,\n\t\t\tactions: [new NotAction(false, this), new NotAction(true, this)]\n\t\t} as OButtonActionsInit<UiCritNotOptional>}/> as ButtonActions<UiCritNotOptional>);\n\t\tthis.shadowRoot.appendChild(<slot/>);\n\t\tthis.shadowRoot.appendChild(<Button id=\"del\" title=\"Supprimer\" icon=\"/@skin@/commons/icons/delete.svg\" onclick={this.onDelete}/> as Button);\n\t}\n\n\tinitFromContext(booleanContext: 'and' | 'or', isNot: boolean): this {\n\t\tthis._booleanContext = booleanContext;\n\t\tthis._isNot = isNot;\n\t\tthis.refresh();\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst ch = this.getChildCrit();\n\t\tif (!ch) return undefined;\n\t\tconst crit = ch.buildCrit();\n\t\tif (!crit) return undefined;\n\t\treturn this._isNot ? new SearchNot(crit) : crit;\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst ch = this.getChildCrit();\n\t\tif (!ch) return undefined;\n\t\tconst crit = ch.buildUiXmlCrit();\n\t\treturn crit && this._isNot ? <not>{crit}</not> : crit;\n\t}\n\n\tprotected onDelete(this: Button, ev: MouseEvent) {\n\t\tDOMSH.findHost(this).dispatchEvent(new CustomEvent(\"wsp-uicrit-toDelete\", {bubbles: true, composed: true}));\n\t}\n\n\tprotected _refresh() {\n\t\tthis.popupBtn.label = this.isNot ? this.booleanContext === 'or' ? \"OU SAUF\" : \"ET SAUF\" : this.booleanContext === 'or' ? \"OU\" : \"ET\";\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\t//NOT USED.\n\t\treturn this;\n\t}\n}\n\n/** Stylage commun à tous les widgets de définition de crtitères. */\nREG.reg.registerSkin('wsp-uicrit-notopt', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tborder: 1px solid var(--border-color);\n\t\tmargin-bottom: -1px;\n\t}\n\n\t::slotted(*) {\n\t\tflex: 1;\n\t}\n`);\n\ncustomElements.define(\"wsp-uicrit-notopt\", UiCritNotOptional);\n\n\n/**\n * UiCritFree\n * @uiLabel : label libre de cette condition exploité dans l'abstract\n */\nexport class UiCritFree extends UiCritBase {\n\n\tstatic AREA = new UiCritArea('wsp-uicrit-free').setLabel(\"Condition XML avancée\").setGroup(\"advanced\").setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\tconst label = xml.getAttribute(\"uiLabel\");\n\t\treturn label ? <span class=\"crit\"><span class=\"critVal\">{label}</span></span> : <span class=\"crit\">Condition avancée</span>;\n\t});\n\n\tinput: HTMLTextAreaElement;\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tthis.reg.installSkin('wsp-uicrit-free', sr);\n\t\tsr.appendChild(<div id=\"critHead\">\n\t\t\t<span>Condition XML avancée</span>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tthis.input = sr.appendChild(<textarea onblur={this.onBlur} oninput={this.onInput}/>) as HTMLTextAreaElement;\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tthis.input.value = DOM.ser(xml);\n\t\tthis.validateInput();\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tif (!this.input.value) return undefined;\n\t\tconst dom = DOM.parseDomValid(this.input.value);\n\t\tif (!dom) return undefined;\n\t\treturn new SearchFree(dom.documentElement);\n\t}\n\n\tvalidateInput(): boolean {\n\t\tconst txt = this.input.value;\n\t\tconst dom = txt ? DOM.parseDomValid(txt) : null;\n\t\tthis.input.setCustomValidity(dom ? \"\" : \"Cette condition XML n'est pas syntaxiquement correcte\");\n\t\treturn this.input.reportValidity();\n\t}\n\n\t_dirty: boolean;\n\n\tonInput(this: HTMLTextAreaElement) {\n\t\tconst me = DOMSH.findHost<UiCritFree>(this);\n\t\tme._dirty = true;\n\t}\n\n\tonBlur(this: HTMLTextAreaElement) {\n\t\tconst me = DOMSH.findHost<UiCritFree>(this);\n\t\tif (me._dirty) {\n\t\t\tme._dirty = false;\n\t\t\tif (me.validateInput()) me.onChange();\n\t\t}\n\t}\n\n}\n\ncustomElements.define(\"wsp-uicrit-free\", UiCritFree);\n\nREG.reg.registerSkin('wsp-uicrit-free', 1, /* language=CSS */ `\n\ttextarea {\n\t\twidth: -webkit-fill-available;\n\t\theight: -webkit-fill-available;\n\t}\n`);\n\n/**\n * UiCritUnknown\n */\nexport class UiCritUnknown extends UiCritFree {\n\n\tstatic AREA = new UiCritArea('wsp-uicrit-unknown').setLabel(\"Condition inconnue\");\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit = this.buildCrit();\n\t\tif (!crit) return undefined;\n\t\treturn crit.toDom();\n\t}\n}\n\ncustomElements.define(\"wsp-uicrit-unknown\", UiCritUnknown);\n\n/**\n * UiCritSrcUri\n */\nexport class UiCritSrcUri extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-uicrit-srcuri-regexp\").setLabel(\"Chemin de l'item\")\n\t\t.setCritSgn(\"string\").setReplacePattern(/\\bstring\\b/).setGroup(\"advanced\").setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\t\tconst searchValue = xml.getAttribute(\"uiPathSearch\") || \"\";\n\t\t\tconst searchTxt = `Chemin de l'item contient \"${searchValue}\"`;\n\t\t\treturn <span class=\"crit\"><span class=\"critVal\">{searchTxt}</span></span>;\n\t\t});\n\n\tprotected _textElt: HTMLInputElement;\n\tprotected _regExpElt: HTMLInputElement;\n\n\tget isRegExp(): boolean {return this._regExpElt ? this._regExpElt.checked : false}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tthis._textElt = sr.appendChild(<div class=\"critHead\">\n\t\t\t<span class=\"critTitle\">Chemin</span>\n\t\t\t<input type=\"search\" oninput={this.onChange}/>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>).querySelector(\"input\");\n\t\tconst optsRoot = sr.appendChild(<div class=\"h\"/>);\n\t\tthis._regExpElt = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" onclick={this.onChange}/>Expression régulière</label>).firstElementChild as HTMLInputElement;\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tif (xml.hasAttribute('uiPathSearch')) {\n\t\t\t// texte\n\t\t\tthis._textElt.value = xml.getAttribute('uiPathSearch') || \"\";\n\t\t\tthis._regExpElt.checked = false;\n\t\t} else {\n\t\t\t// regExp\n\t\t\tthis._textElt.value = xml.getAttribute('regexp') || \"\";\n\t\t\tthis._regExpElt.checked = true;\n\t\t}\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst v = this._textElt.value;\n\t\tif (v && this.isRegExp) {\n\t\t\treturn new SearchRegexpUri(new RegExp(v));\n\t\t} else if (v) {\n\t\t\tconst regexp = new RegExp(\".*\" + v.replace(/\\W/g, LANG.escapeChar4Regexp) + \".*\", \"i\");\n\t\t\treturn new SearchRegexpUri(regexp);\n\t\t} else\n\t\t\treturn undefined;\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tif (crit && !this.isRegExp) crit.setAttribute(\"uiPathSearch\", this._textElt.value);\n\t\treturn crit;\n\t}\n\n}\n\ncustomElements.define(\"wsp-uicrit-srcuri-regexp\", UiCritSrcUri);\n\n\n/**\n * UiCritSrcUri\n */\nexport class UiCritXpath extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-uicrit-xpath\").setLabel(\"XPath\")\n\t\t.setCritSgn(\"string\").setReplacePattern(/\\bstring\\b/).setGroup(\"advanced\").setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\t\tconst searchTxt = <span class=\"critVal\">{xml.getAttribute(\"xpathSearch\") || \"\"}</span>;\n\t\t\treturn <span class=\"crit\">XPath : '{searchTxt}'</span>;\n\t\t});\n\n\tprotected _xpathElt: HTMLInputElement;\n\n\t// key / value\n\tprotected _Ns: Map<string, string> = new Map<string, string>();\n\n\tprotected _DefaultNsCodeList: string;\n\n\tconstructor(public nsListCode: string = \"namespaces:defaultList\") {\n\t\tsuper();\n\t\tthis._DefaultNsCodeList = nsListCode;\n\t}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tthis._xpathElt = sr.appendChild(<div class=\"critHead\">\n\t\t\t<span class=\"critTitle\">XPath</span>\n\t\t\t<input type=\"search\" oninput={this.onInput} onblur={this.onBlur}/>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>).querySelector(\"input\");\n\n\t\t// TODO : ajouter un composant UI d'édition des ns\n\t\t// Ajout des NS par défaut\n\t\tconst nsList = this.reg.getListAsMap(this._DefaultNsCodeList) as Dict<string>;\n\t\tif (nsList) for (const prefix in nsList)\n\t\t\tthis._Ns.set(prefix == \"#default\" ? \"\" : prefix, nsList[prefix]);\n\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tthis._xpathElt.value = xml.getAttribute('xpathSearch') || \"\";\n\t\tlet ch = xml.firstElementChild;\n\t\twhile (ch) {\n\t\t\tif (ch.localName == \"ns\")\n\t\t\t\tthis._Ns.set(ch.getAttribute(\"prefix\"), ch.getAttribute(\"uri\"));\n\t\t\tch = ch.nextElementSibling;\n\t\t}\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst v = this._xpathElt.value;\n\t\tif (v)\n\t\t\treturn new SearchFullXPath(v, this._Ns);\n\t\treturn undefined;\n\t}\n\n\t_dirty: boolean;\n\n\tonInput(this: HTMLTextAreaElement) {\n\t\tconst me = DOMSH.findHost<UiCritXpath>(this);\n\t\tme._dirty = true;\n\t}\n\n\tonBlur(this: HTMLTextAreaElement) {\n\t\tconst me = DOMSH.findHost<UiCritXpath>(this);\n\t\tif (me._dirty) {\n\t\t\tme._dirty = false;\n\t\t\tme.onChange();\n\t\t}\n\t}\n\n}\n\ncustomElements.define(\"wsp-uicrit-xpath\", UiCritXpath);\n\n/**\n *  UiCritSubRequest\n */\n\n/** Area pour les opérateurs booléen AND / OR intégrant le sous opérateur NOT optionnel pour chaque fils. */\nclass UiCritSubRequestArea extends UiCritArea implements IUiCritArea {\n\n\tconstructor(id: 'desc' | 'asc' | 'parents' | 'children', public traitsCodeList: string | null = \"linktraits:search:defaultList\") {\n\t\tsuper(id);\n\t}\n\n\tgetLabel(ctx: OUiCritInit): string {\n\t\tswitch (this._id) {\n\t\tcase \"desc\" :\n\t\t\treturn \"Sous-requête dans le réseau descendant de l'item courant\";\n\t\tcase \"asc\" :\n\t\t\treturn \"Sous-requête dans le réseau ascendant de l'item courant\";\n\t\tcase \"children\" :\n\t\t\treturn \"Sous-requête dans les items liés de l'item courant\";\n\t\tdefault :\n\t\t\treturn \"Sous-requête dans les items liant l'item courant\";\n\t\t}\n\t}\n\n\tgetGroup(ctx: OUiCritInit): string {\n\t\treturn \"advanced\";\n\t}\n\n\tbuildBody(ctx: OUiCritInit): IUiCritWidget {\n\t\tconst w = new UiCritSubRequest();\n\t\tw.critArea = this;\n\t\treturn w;\n\t}\n\n\tcanReplace(uiCrit: IUiCritWidget, ctx: OUiCritInit): boolean {return uiCrit instanceof UiCritSubRequest}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\tconst operator = <span class=\"critVal\">{UiCritSubRequest.OP[xml.getAttribute(\"op\")][1]}</span>;\n\t\tconst value = <span class=\"critVal\">{xml.getAttribute(\"value\")}</span>;\n\n\t\tconst LinkExpXml = UiCritSubRequestArea.findSubExpLinksElement(xml);\n\t\tconst subCritRootXml = LinkExpXml?.nextElementSibling;\n\n\t\tconst subCritRoot = subCritRootXml ? buildCritAreaFromXml(subCritRootXml, ctx.criterions) : null;\n\t\tconst subCritRootAbstract = subCritRoot?.buildAbstract(subCritRootXml, ctx);\n\t\tconst linkTraitFilter = LinkExpXml?.getAttribute('linkTraitFilter') || \"\";\n\t\tlet linkTraitFilterAbstract: string = null;\n\t\tif (linkTraitFilter) {\n\t\t\tconst traits = ctx.reg.getListAsMap(this.traitsCodeList) as Dict<string> || {};\n\t\t\tlinkTraitFilterAbstract = `filtre '${traits[linkTraitFilter] || linkTraitFilter}'`;\n\t\t}\n\n\t\tlet areaShortLabel;\n\t\tswitch (this._id) {\n\t\tcase \"desc\" :\n\t\t\tareaShortLabel = <span>{linkTraitFilterAbstract ? `Nombre d'items descendants (${linkTraitFilterAbstract}) tels que :` : 'Nombre d\\'items descendants tels que :'} {subCritRootAbstract} {operator} {value}</span>;\n\t\t\tbreak;\n\t\tcase \"asc\" :\n\t\t\tareaShortLabel = <span>{linkTraitFilterAbstract ? `Nombre d'items ascendants (${linkTraitFilterAbstract}) tels que :` : 'Nombre d\\'items ascendants tels que :'} {subCritRootAbstract} {operator} {value}</span>;\n\t\t\tbreak;\n\t\tcase \"children\" :\n\t\t\tareaShortLabel = <span>{linkTraitFilterAbstract ? `Nombre d'items liés (${linkTraitFilterAbstract}) tels que :` : 'Nombre d\\'items liés tels que :'} {subCritRootAbstract} {operator} {value}</span>;\n\t\t\tbreak;\n\t\tdefault :\n\t\t\tareaShortLabel = <span>{linkTraitFilterAbstract ? `Nombre d'items liants (${linkTraitFilterAbstract}) tels que :` : 'Nombre d\\'items liants tels que :'} {subCritRootAbstract} {operator} {value}</span>;\n\t\t}\n\t\treturn <span class=\"boolGroup\">{areaShortLabel}</span>;\n\t}\n\n\t/** Retourne l'exp \"exp[path=\".\"]\" dans les 2 contextes possibles :\n\t * \t- exp[@type=\"OccurencesSubExp\"]/and/exp[path=\".\"]\n\t * \t- OU exp[@type=\"OccurencesSubExp\"]/exp[path=\".\"]*/\n\tstatic findSubExpLinksElement(xml: Element): Element | null {\n\t\tif (xml?.firstElementChild?.localName === 'and')\n\t\t\treturn xml.firstElementChild.firstElementChild?.getAttribute(\"path\") === \".\" ?\n\t\t\t\txml.firstElementChild.firstElementChild :\n\t\t\t\tnull;\n\t\telse\n\t\t\treturn xml?.firstElementChild?.getAttribute(\"path\") === \".\" ?\n\t\t\t\txml.firstElementChild :\n\t\t\t\tnull;\n\t}\n}\n\n\nexport class UiCritSubRequest extends UiCritBase {\n\n\tstatic AREA_DESC = new UiCritSubRequestArea(\"desc\");\n\n\tstatic AREA_ASC = new UiCritSubRequestArea(\"asc\");\n\n\tstatic AREA_CHILDREN = new UiCritSubRequestArea(\"children\");\n\n\tstatic AREA_PARENTS = new UiCritSubRequestArea(\"parents\");\n\n\tstatic OP: { [index: string]: any } = {\n\t\t//\"value\" : [longLabel, shortLabel]\n\t\t\"gt\": [\"Items trouvés supérieur à\", \">\"],\n\t\t\"gt=\": [\"Items trouvés supérieur ou égal à\", \">=\"],\n\t\t\"lt\": [\"Items trouvés inférieur à\", \"<\"],\n\t\t\"lt=\": [\"Items trouvés inférieur ou égal à\", \"<=\"],\n\t\t\"=\": [\"Items trouvés égal à\", \"=\"],\n\t};\n\n\tcritArea: UiCritSubRequestArea;\n\n\t_opElt: HTMLSelectElement;\n\n\t_opValueElt: HTMLInputElement;\n\n\t_subExpElt: UiCritBool;\n\n\t_trFilterElt: HTMLSelectElement | null;\n\n\tget traitsCodeList(): string | null {return this.critArea.traitsCodeList}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\n\t\tconst head = sr.appendChild(<div id=\"critHead\"/>);\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\t\thead.appendChild(<span class=\"critTitle\">{this.critArea.getLabel(null)}</span>);\n\t\tconst buttonActions = this.insertAlternativesBtn(init);\n\t\tif (buttonActions) head.appendChild(buttonActions);\n\n\t\tif (this.traitsCodeList) {\n\t\t\tconst traits = this.reg.getListAsMap(this.traitsCodeList) as Dict<string>;\n\t\t\tif (traits) {\n\t\t\t\tthis._trFilterElt = <select onchange={this.onChange}>\n\t\t\t\t\t<option value=\"\" selected>Aucun filtre</option>\n\t\t\t\t</select> as HTMLSelectElement;\n\t\t\t\tfor (const tr in traits)\n\t\t\t\t\tthis._trFilterElt.appendChild(<option value={tr}>{traits[tr]}</option>);\n\t\t\t\tsr.appendChild(<div class=\"h\">\n\t\t\t\t\t{this._trFilterElt}\n\t\t\t\t</div>)\n\t\t\t}\n\t\t}\n\n\t\tconst optsRoot = sr.appendChild(<div class=\"h\"/>);\n\t\tthis._opElt = optsRoot.appendChild(<select onchange={this.onChange}>\n\t\t\t<option value=\"gt\" selected>{UiCritSubRequest.OP[\"gt\"][0]}</option>\n\t\t\t<option value=\"gt=\">{UiCritSubRequest.OP[\"gt=\"][0]}</option>\n\t\t\t<option value=\"lt\">{UiCritSubRequest.OP[\"lt\"][0]}</option>\n\t\t\t<option value=\"lt=\">{UiCritSubRequest.OP[\"lt=\"][0]}</option>\n\t\t\t<option value=\"=\">{UiCritSubRequest.OP[\"=\"][0]}</option>\n\t\t</select>) as HTMLSelectElement;\n\t\tthis._opValueElt = optsRoot.appendChild(<input value=\"0\" type=\"number\" min=\"0\" step=\"1\" oninput={this.onChange} onchange={this.onChange}/>) as HTMLInputElement;\n\n\t\tsr.appendChild(<slot id=\"critCh\"/>);\n\t\tthis._subExpElt = this.appendChild(UiCritBool.AREA_AND.buildBody(this)) as UiCritBool;\n\t\tthis._subExpElt.initialize(this);\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tconst LinkExpXml = UiCritSubRequestArea.findSubExpLinksElement(xml);\n\t\tif (xml?.hasAttribute(\"op\")) this._opElt.value = xml.getAttribute(\"op\");\n\t\tif (xml?.hasAttribute(\"value\")) this._opValueElt.value = xml.getAttribute(\"value\");\n\t\tconst linkTraitFilter = LinkExpXml?.getAttribute('linkTraitFilter');\n\t\tif (linkTraitFilter && this._trFilterElt)\n\t\t\tthis._trFilterElt.value = linkTraitFilter\n\n\t\tif (LinkExpXml?.nextElementSibling)\n\t\t\tawait this._subExpElt.initFromXmlCrit(LinkExpXml.nextElementSibling);\n\t\treturn this;\n\t}\n\n\tasync initFromInsAction(xml?: Element): Promise<this> {\n\t\tconst LinkExpXml = UiCritSubRequestArea.findSubExpLinksElement(xml);\n\t\tconst linkTraitFilter = LinkExpXml?.getAttribute('linkTraitFilter');\n\t\tif (linkTraitFilter && this._trFilterElt)\n\t\t\tthis._trFilterElt.value = linkTraitFilter\n\t\treturn super.initFromInsAction(xml);\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\t// Critérion\n\t\tconst subExp = new SearchAnd();\n\t\tconst crit = new SearchOccurencesSubExp(this._opElt.value as EOperatorsSimple, Number.parseInt(this._opValueElt.value), subExp);\n\n\t\t// Condition sur le subExp\n\t\tlet searchItemLinks: SearchItemLinks;\n\t\tswitch (this.critArea) {\n\t\tcase UiCritSubRequest.AREA_DESC :\n\t\t\tsearchItemLinks = new SearchItemLinks(\"LinkDesc\");\n\t\t\tbreak;\n\t\tcase UiCritSubRequest.AREA_ASC :\n\t\t\tsearchItemLinks = new SearchItemLinks(\"LinkAsc\");\n\t\t\tbreak;\n\t\tcase UiCritSubRequest.AREA_PARENTS :\n\t\t\tsearchItemLinks = new SearchItemLinks(\"LinkParents\");\n\t\t\tbreak;\n\t\tdefault :\n\t\t\t// AREA_CHILDREN\n\t\t\tsearchItemLinks = new SearchItemLinks(\"LinkChildren\");\n\t\t}\n\t\tsearchItemLinks.setPath(\".\");\n\t\tsearchItemLinks.setLinkTraitFilter(this._trFilterElt?.value)\n\t\tsubExp.push(searchItemLinks);\n\n\t\t// Critérions fils\n\t\tLANG.pushIfDefined(subExp, this._subExpElt.buildCrit());\n\n\t\treturn crit;\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tcrit.setAttribute(\"uiCrit\", \"wsp-uicrit-subrequest:\" + this.critArea.getId());\n\t\tconst subExpCritElt = crit.firstElementChild;\n\t\t// Supp du bloc de critères \"fils\" non \"UI\"\n\t\tsubExpCritElt.removeChild(subExpCritElt.lastChild);\n\t\t// Ajout du bloc de critères \"fils\" \"UI\"\n\t\tsubExpCritElt.appendChild(this._subExpElt.buildUiXmlCrit());\n\t\treturn crit;\n\t}\n}\n\ncustomElements.define(\"wsp-uicrit-subrequest\", UiCritSubRequest);\n"]}