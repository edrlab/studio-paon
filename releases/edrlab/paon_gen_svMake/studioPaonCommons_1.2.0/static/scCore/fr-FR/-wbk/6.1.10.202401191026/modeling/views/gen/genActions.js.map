{"version":3,"sources":["/@back@/modeling/views/gen/genActions.tsx"],"names":["ActionWrapper","POPUP","GenAction","ActionActions","Desk","ShowPortalFrontsGenAction","[object Object]","frontsDescPath","id","super","this","_label","_icon","_description","_hideForStatuses","ctx","urlPub","wsp","wspServer","config","pubUrl","resolve","genInfo","uriPub","substr","resp","fetchJson","fronts","uiContext","parent","isVisible","actWeb","setLabel","setExecute","async","ctx1","ev","findFrontsUrl","window","open","url","length","console","log","actElectron","setVisible","electron","postMessage","type","name","title","save","newWindow","transient","location","origin","actClipboard","navigator","clipboard","writeText","e","showNotifForbidden","mainAction","otherActions","push","initialize","reg","actionContext","actionBtn","action","setOverridenSvc","getLabel","setIcon","getIcon","actionsBtn","actions","skinOver"],"mappings":"OAAQA,kBAAgC;OAGhCC,UAAM;OACNC,cAAU;OACVC,kBAAkC;OAClCC,SAAK;OAEP,MAAOC,kCAAkCH,UAE9CI,YAAsBC,eAAwBC,IAC7CC,MAAMD,IAAM;AADSE,KAAAH,eAAAA;AAErBG,KAAKC,OAAS;AACdD,KAAKE,MAAQ;AACbF,KAAKG,aAAe;AACpBH,KAAKI,iBAAmB,cAGzBR,oBAAoBS,KACnB,MAAMC,OAASD,IAAIE,IAAIC,UAAUC,OAAOC,OAAOC,QAAQN,IAAIO,QAAQC,OAAOC,OAAO;AACjF,MAAMC,WAAwET,OAAOU,UAAqEhB,KAAKH;AAC/J,OAAOkB,KAAKE,OAGbrB,kBAAkBS,IAAca,UAA6BC,QAC5D,IAAKnB,KAAKoB,UAAUf,KAAM,OAAO;AAEjC,MAAMgB,QAAS,IAAI7B,WAAY8B,SAAS,+BAA+BC,WAAWC,MAAOC,KAAMC,MAE9F,MAAMT,aAAejB,KAAK2B,cAActB;AACxCuB,OAAOC,KAAKZ,OAAO,GAAGa,IAAK;AAC3B,GAAIb,OAAOc,OAAS,EACnBC,QAAQC,IAAI,oBAAqBhB;AAGnC,MAAMiB,aAAc,IAAI1C,WAAY8B,SAAS,sCAAsCa,WAAY9B,KAAQX,KAAK0C,UAAUb,WAAWC,MAAOC,KAAMC,MAE7I,MAAMT,aAAejB,KAAK2B,cAActB;AACxCuB,OAAOS,YAAY,CAACC,KAAM,sBAAuBR,IAAKb,OAAO,GAAGa,IAAKS,KAAM,GAAGtB,OAAO,GAAGuB,sBAAuBC,KAAM,MAAOC,UAAW,CAACC,UAAW,OAAQC,SAASC;AACpK,GAAI5B,OAAOc,OAAS,EACnBC,QAAQC,IAAI,oBAAqBhB;AAGnC,MAAM6B,cAAe,IAAItD,WAAY8B,SAAS,wCAAwCC,WAAWC,MAAOC,KAAMC,MAE7G,MAAMT,aAAejB,KAAK2B,cAActB;AACxC,UACO0C,UAAUC,UAAUC,UAAUhC,OAAO,GAAGa,KAC7C,MAAOoB,GACR3D,MAAM4D,mBAAmB,sIAAuI9C,IAAIa,WAErK,GAAID,OAAOc,OAAS,EACnBC,QAAQC,IAAI,oBAAqBhB;AAGnC,IAAImC;AACJ,IAAIC,aAA4B;AAEhC,GAAI3D,KAAK0C,SAAU,CAClBgB,WAAalB;AACbmB,aAAaC,KAAKjC,OAAQyB,kBACpB,CACNM,WAAa/B;AACbgC,aAAaC,KAAKR,cAGnB,OAAO,IAAIrD,eAAyB8D,WAAW,CAC9CC,IAAKnD,IAAImD,IACTC,cAAepD,IACfqD,UAAW,CACVC,QAAQ,IAAIrE,eAAgBsE,gBAAgBR,YAC1C9B,SAAStB,KAAK6D,SAASxD,MACvByD,QAAQ9D,KAAK+D,QAAQ1D,OAExB2D,WAAY,CACXC,QAASZ,cAEVa,SAAU,kBACVhD,UAAWA,YAIbtB,UAAUS,KACT,IAAKA,IAAIO,QAAQC,OAAQ,OAAO;AAChC,OAAOd,MAAMqB,UAAUf","sourcesContent":["import {ActionWrapper, EButtonUiContext} from \"lib/commons/actions\";\nimport {IPubCtx} from \"lib/wsp/wspMetaUi\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {GenAction} from \"back/wsp/views/gen/genActions\";\nimport {ActionActions, OActionActionsInit} from \"back/commons/widgets/buttons\";\nimport {Desk} from \"lib/commons/desk\";\n\nexport class ShowPortalFrontsGenAction extends GenAction {\n\n\tconstructor(protected frontsDescPath: string, id?: string) {\n\t\tsuper(id || \"show\");\n\t\tthis._label = \"Ouvrir\";\n\t\tthis._icon = \"/@skin@/wsp/views/generators/show.svg\";\n\t\tthis._description = \"Ouvrir l'environnement de test...\";\n\t\tthis._hideForStatuses = \"failed,null\";\n\t}\n\n\tasync findFrontsUrl(ctx: IPubCtx): Promise<{ key: string, title: string, url: string }[]> {\n\t\tconst urlPub = ctx.wsp.wspServer.config.pubUrl.resolve(ctx.genInfo.uriPub.substr(1));\n\t\tconst resp: { fronts: { key: string, title: string, url: string }[] } = await urlPub.fetchJson<{ fronts: { key: string, title: string, url: string }[] }>(this.frontsDescPath);\n\t\treturn resp.fronts;\n\t}\n\n\tbuildCustomButton(ctx: IPubCtx, uiContext: EButtonUiContext, parent?: Element): Element | null | undefined {\n\t\tif (!this.isVisible(ctx)) return null;\n\n\t\tconst actWeb = new GenAction().setLabel(\"Ouvrir dans un navigateur\").setExecute(async (ctx1, ev) => {\n\t\t\t// FIXME : gérer le multi-fronts\n\t\t\tconst fronts = await this.findFrontsUrl(ctx);\n\t\t\twindow.open(fronts[0].url, '_blank');\n\t\t\tif (fronts.length > 1)\n\t\t\t\tconsole.log(\"TODO multi-fronts\", fronts);\n\t\t});\n\n\t\tconst actElectron = new GenAction().setLabel(\"Ouvrir dans une nouvelle fenêtre\").setVisible((ctx) => Desk.electron).setExecute(async (ctx1, ev) => {\n\t\t\t// FIXME : gérer le multi-fronts\n\t\t\tconst fronts = await this.findFrontsUrl(ctx);\n\t\t\twindow.postMessage({type: \"client:servers:open\", url: fronts[0].url, name: `${fronts[0].title} - SCENARItest`, save: false, newWindow: {transient: true}}, location.origin);\n\t\t\tif (fronts.length > 1)\n\t\t\t\tconsole.log(\"TODO multi-fronts\", fronts);\n\t\t});\n\n\t\tconst actClipboard = new GenAction().setLabel(\"Copier l'URL dans le presse-papier\").setExecute(async (ctx1, ev) => {\n\t\t\t// FIXME : gérer le multi-fronts\n\t\t\tconst fronts = await this.findFrontsUrl(ctx);\n\t\t\ttry {\n\t\t\t\tawait navigator.clipboard.writeText(fronts[0].url);\n\t\t\t} catch (e) {\n\t\t\t\tPOPUP.showNotifForbidden(\"Copie dans le presse-papier impossible. Vérifiez dans votre navigateur que vous avez autorisé ce site à accéder au presse-papier.\", ctx.uiContext);\n\t\t\t}\n\t\t\tif (fronts.length > 1)\n\t\t\t\tconsole.log(\"TODO multi-fronts\", fronts);\n\t\t});\n\n\t\tlet mainAction: GenAction;\n\t\tlet otherActions: GenAction[] = [];\n\n\t\tif (Desk.electron) {\n\t\t\tmainAction = actElectron;\n\t\t\totherActions.push(actWeb, actClipboard);\n\t\t} else {\n\t\t\tmainAction = actWeb;\n\t\t\totherActions.push(actClipboard);\n\t\t}\n\n\t\treturn new ActionActions<IPubCtx>().initialize({\n\t\t\treg: ctx.reg,\n\t\t\tactionContext: ctx,\n\t\t\tactionBtn: {\n\t\t\t\taction: new ActionWrapper().setOverridenSvc(mainAction)\n\t\t\t\t\t.setLabel(this.getLabel(ctx))\n\t\t\t\t\t.setIcon(this.getIcon(ctx))\n\t\t\t},\n\t\t\tactionsBtn: {\n\t\t\t\tactions: otherActions,\n\t\t\t},\n\t\t\tskinOver: \"dialog/c-button\",\n\t\t\tuiContext: uiContext,\n\t\t} as OActionActionsInit<IPubCtx>);\n\t}\n\n\tisVisible(ctx: IPubCtx): boolean {\n\t\tif (!ctx.genInfo.uriPub) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n}\n"]}