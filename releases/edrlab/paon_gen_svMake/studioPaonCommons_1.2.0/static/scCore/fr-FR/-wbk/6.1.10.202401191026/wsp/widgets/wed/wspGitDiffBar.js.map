{"version":3,"sources":["/@back@/wsp/widgets/wed/wspGitDiffBar.tsx"],"names":["DiffPanelBase","REG","EXmlDiffMode","callDiff","EGitState","WSP_GIT","GitHeadDiffPanel","[object Object]","action","bar","this","_initPanel","shadowRoot","appendChild","result","execDiff","params","erased","diffId","getId","fullRefresh","diff","gitSt","reg","env","longDesc","insynch","match","changed","modified","wedMgr","docHolder","setDiffSession","updateDiffResult","registerSkin","customElements","define"],"mappings":"OACQA,kBAAc;OAGdC,QAAI;OAEJC,iBAAa;;OAGbC,aAAS;OAETC,UAA0BC,YAAQ;OAMpC,MAAOC,yBAAyBN,cAIrCO,UAAUC,OAA6BC,KACtCC,KAAKC,WAAWH,OAAQC;AACxBC,KAAKE,WAAWC,YAAYH,KAAKI;AACjCJ,KAAKK;AACL,OAAOL,KAGRH,QAAQS,QACPN,KAAKO,OAASD,SAAW;AACzBN,KAAKK,WAGNR,kBACC,MAAO,CAACW,OAAQR,KAAKF,OAAOW,SAG7BZ,eAAea,aACd,GAAIA,YAAaV,KAAKO,OAAS;AAC/B,GAAGP,KAAKO,OAAQ,OAAOd,SAAS,GAAIO,KAAMR,aAAamB;AACvD,MAAMC,MAASZ,KAAKa,IAAIC,IAAIC,SAA2BH;AACvD,GAAGA,QAAUlB,UAAUsB,SAAWrB,QAAQsB,MAAML,MAAOlB,UAAUwB,UAAYvB,QAAQsB,MAAML,MAAOlB,UAAUyB,UAAW,CACtH,OAAO1B,SAAS,mBAAoBO,KAAMR,aAAamB,MAExDX,KAAKoB,OAAOC,UAAUC,eAAe;AACrCtB,KAAKuB,iBAAiB,aAIxBhC,IAAIsB,IAAIW,aAAa,mBAAoB,EAAsB;AAO/DC,eAAeC,OAAO,mBAAoB9B","sourcesContent":["/** */\nimport {DiffPanelBase} from \"back/edit/wed/features/diffBar_\";\nimport {OtherItemDiffAction} from \"back/wsp/widgets/wed/itemEditorExt\";\nimport {IWedDiffBar} from \"back/edit/wed/features/diffBar\";\nimport {REG} from \"lib/commons/registry\";\nimport {IItemUiEnv} from \"back/wsp/views/itemMain\";\nimport {EXmlDiffMode} from \"lib/edit/schema/diff\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport \"back/wsp/widgets/widgets_Perms\";\nimport {callDiff} from \"back/wsp/widgets/wed/wspDiffBar\";\nimport {JGitHeadWedDiffBarParams} from \"back/wsp/areas/gitOverrides\";\nimport {EGitState, JGitSrcFields, WSP_GIT} from \"lib/wsp/git\";\n\n\n/**\n *\n */\nexport class GitHeadDiffPanel extends DiffPanelBase<IItemUiEnv> {\n\n\terased?: boolean\n\n\tinitPanel(action: OtherItemDiffAction, bar: IWedDiffBar): this {\n\t\tthis._initPanel(action, bar);\n\t\tthis.shadowRoot.appendChild(this.result);\n\t\tthis.execDiff();\n\t\treturn this;\n\t}\n\n\tsetDiff(params: JGitHeadWedDiffBarParams | undefined | null): void {\n\t\tthis.erased = params === null;\n\t\tthis.execDiff();\n\t}\n\n\tbuildDiffParams(): JGitHeadWedDiffBarParams {\n\t\treturn {diffId: this.action.getId()}\n\t}\n\n\tasync execDiff(fullRefresh?: boolean): Promise<void> {\n\t\tif (fullRefresh) this.erased = false;\n\t\tif(this.erased) return callDiff(\"\", this, EXmlDiffMode.diff);\n\t\tconst gitSt = (this.reg.env.longDesc as JGitSrcFields).gitSt;\n\t\tif(gitSt === EGitState.insynch || WSP_GIT.match(gitSt, EGitState.changed) || WSP_GIT.match(gitSt, EGitState.modified)) {\n\t\t\treturn callDiff(\"special:git:head\", this, EXmlDiffMode.diff);\n\t\t}\n\t\tthis.wedMgr.docHolder.setDiffSession(null);\n\t\tthis.updateDiffResult(\"notFound\");\n\t}\n}\n\nREG.reg.registerSkin(\"wed-diff-githead\", 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t}\n`);\n\ncustomElements.define(\"wed-diff-githead\", GitHeadDiffPanel);"]}