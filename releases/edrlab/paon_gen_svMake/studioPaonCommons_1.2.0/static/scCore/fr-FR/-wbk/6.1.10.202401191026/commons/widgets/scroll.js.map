{"version":3,"sources":["/@back@/commons/widgets/scroll.tsx"],"names":["REG","BaseElement","Button","DOM","JSX","DOMSH","ArrowScrollBox","vertical","this","hasAttribute","val","setAttrBool","refresh","[object Object]","child","setTimeout","_content","scrollTop","offsetTop","ctnLeft","scrollLeft","tabLeft","offsetLeft","newLeft","offsetWidth","clientWidth","clientHeight","children","length","window","getComputedStyle","direction","isOverflow","scrollHeight","scrollWidth","init","cbOverflow","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","_start","createElement","id","_end","shadowRoot","appendChild","_startBtn","ui-context","hidden","aria-hidden","tabIndexCustom","icon","onclick","moveBackward","_endBtn","moveForward","intersectObserver","IntersectionObserver","bind","root","threshold","observe","scrollTimeout","addEventListener","clearTimeout","requestAnimationFrame","_refreshStates","passive","overflow","addClass","removeClass","disabled","reg","registerSkin","customElements","define","OrientedBox","_attach"],"mappings":"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","sourcesContent":["import {REG} from 'lib/commons/registry';\nimport {BaseElement, OSkinableInit} from \"back/commons/basis\";\nimport {Button} from \"back/commons/widgets/buttons\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\n\n/**\n * Widget gérant une zone scrollable dans une seule direction: horizontale ou verticale.\n *\n * State live attributes: vertical\n */\nexport interface ArrowScrollBox extends BaseElement {\n\tinitialize(init?: OArrowScrollBoxInit): this\n}\n\nexport interface OArrowScrollBoxInit extends OSkinableInit {\n\tvertical?: boolean\n\n\t/** Notifié à chaque changement d'état d'overflow/underflow. */\n\tcbOverflow?: (overflow: boolean) => void\n}\n\nexport class ArrowScrollBox extends BaseElement {\n\tcbOverflow: (overflow: boolean) => void;\n\n\tget vertical(): boolean {return this.hasAttribute('vertical')}\n\n\tset vertical(val: boolean) {\n\t\tif (DOM.setAttrBool(this, 'vertical', val)) this.refresh();\n\t}\n\n\tscrollToChild(child: HTMLElement) {\n\t\t//scroll parfois en echec au refresh d'une page, => setTimeout\n\t\tsetTimeout(() => {\n\t\t\tif (this.vertical) {\n\t\t\t\tthis._content.scrollTop = child.offsetTop;\n\t\t\t} else {\n\t\t\t\tconst ctnLeft = this._content.scrollLeft;\n\t\t\t\tconst tabLeft = child.offsetLeft;\n\t\t\t\tif (tabLeft < ctnLeft) {\n\t\t\t\t\tthis._content.scrollLeft = tabLeft;\n\t\t\t\t} else {\n\t\t\t\t\tconst newLeft = tabLeft + child.offsetWidth - this._content.clientWidth;\n\t\t\t\t\tif (newLeft > ctnLeft) this._content.scrollLeft = newLeft;\n\t\t\t\t}\n\t\t\t}\n\t\t}, 1);\n\t}\n\n\tmoveForward() {\n\t\tif (this.vertical) {\n\t\t\tthis._content.scrollTop += this._content.clientHeight / this.children.length;\n\t\t} else {\n\t\t\tif (window.getComputedStyle(this).direction === 'rtl')\n\t\t\t\tthis._content.scrollLeft -= this._content.clientWidth / this.children.length;\n\t\t\telse\n\t\t\t\tthis._content.scrollLeft += this._content.clientWidth / this.children.length;\n\t\t}\n\t}\n\n\tmoveBackward() {\n\t\tif (this.vertical) {\n\t\t\tthis._content.scrollTop -= this._content.clientHeight / this.children.length;\n\t\t} else {\n\t\t\tif (window.getComputedStyle(this).direction === 'rtl')\n\t\t\t\tthis._content.scrollLeft += this._content.clientWidth / this.children.length;\n\t\t\telse\n\t\t\t\tthis._content.scrollLeft -= this._content.clientWidth / this.children.length;\n\t\t}\n\t}\n\n\tget isOverflow(): boolean {return this.vertical ? this._content.scrollHeight > this._content.clientHeight : this._content.scrollWidth > this._content.clientWidth}\n\n\tprotected _start: HTMLDivElement;\n\tprotected _end: HTMLDivElement;\n\tprotected _startBtn: Button;\n\tprotected _endBtn: Button;\n\tprotected _content: HTMLDivElement;\n\n\tprotected _initialize(init: OArrowScrollBoxInit) {\n\t\tthis.vertical = init.vertical;\n\t\tthis.cbOverflow = init.cbOverflow;\n\n\t\tthis.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\n\t\tthis._start = <div id=\"start\"/> as HTMLDivElement;\n\t\tthis._end = <div id=\"end\"/> as HTMLDivElement;\n\n\t\tthis._content = this.shadowRoot.appendChild(<div id='content'>\n\t\t\t{this._start}\n\t\t\t<slot/>\n\t\t\t{this._end}\n\t\t</div> as HTMLDivElement);\n\n\n\t\tthis._startBtn = <Button id='startBtn' ui-context='custom' hidden='' aria-hidden=\"true\"/> as Button;\n\t\tthis._startBtn.tabIndexCustom = -1; //jamais focusable.\n\t\tthis._startBtn.icon = '--scroll-startbtn-icon';\n\t\tthis._startBtn.onclick = () => {this.moveBackward()};\n\t\tthis._endBtn = <Button id='endBtn' ui-context='custom' hidden='' aria-hidden=\"true\"/> as Button;\n\t\tthis._endBtn.tabIndexCustom = -1; //jamais focusable.\n\t\tthis._endBtn.icon = '--scroll-endbtn-icon';\n\t\tthis._endBtn.onclick = () => {this.moveForward()};\n\n\t\tthis.shadowRoot.appendChild(this._startBtn);\n\t\tthis.shadowRoot.appendChild(this._endBtn);\n\n\t\t// Intersection observer pour mise à jour du scroll\n\t\tconst intersectObserver = new IntersectionObserver(this.refresh.bind(this), {root: this._content, threshold: [0, 1]});\n\t\tintersectObserver.observe(this._start);\n\t\tintersectObserver.observe(this._end);\n\n\t\t// Listener sur scroll\n\t\tlet scrollTimeout: number;\n\t\tthis._content.addEventListener('scroll', () => {\n\t\t\tif (scrollTimeout) clearTimeout(scrollTimeout);\n\t\t\tscrollTimeout = window.setTimeout(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tthis._refreshStates();\n\t\t\t\t\tscrollTimeout = null;\n\t\t\t\t});\n\t\t\t}, 100);\n\t\t}, {passive: true});\n\n\t}\n\n\tprotected _refresh() {\n\t\tconst overflow = this.isOverflow;\n\t\tif (overflow) {\n\t\t\tif (DOM.addClass(this, 'scroll')) {\n\t\t\t\tthis._startBtn.hidden = false;\n\t\t\t\tthis._endBtn.hidden = false;\n\t\t\t}\n\t\t\tthis._refreshStates();\n\t\t\tif (this.cbOverflow) this.cbOverflow(true);\n\t\t} else {\n\t\t\tif (DOM.removeClass(this, 'scroll')) {\n\t\t\t\tthis._startBtn.hidden = true;\n\t\t\t\tthis._endBtn.hidden = true;\n\t\t\t\tif (this.cbOverflow) this.cbOverflow(false);\n\t\t\t}\n\t\t}\n\t\t//console.log(\"refresh:::overflow=\", overflow, \"hideBtn:::\", this._startBtn.hidden, this);\n\t}\n\n\tprotected _refreshStates() {\n\t\tif (this.vertical) {\n\t\t\tthis._startBtn.disabled = this._content.scrollTop === 0;\n\t\t\tthis._endBtn.disabled = this._content.scrollTop + this._content.clientHeight >= this._content.scrollHeight;\n\t\t} else {\n\t\t\tthis._startBtn.disabled = this._content.scrollLeft === 0;\n\t\t\tthis._endBtn.disabled = this._content.scrollLeft + this._content.clientWidth >= this._content.scrollWidth;\n\t\t}\n\t}\n}\n\nREG.reg.registerSkin('c-arrow-scroll-box', 1, /* language=CSS */ `\n\t:host {\n\t\tposition: relative;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t}\n\n\t:host([vertical]) {\n\t\tflex-direction: column;\n\t}\n\n\t#content {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex: 1;\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t\tscroll-behavior: smooth;\n\t\tflex-direction: inherit;\n\t\tjustify-content: inherit;\n\t}\n\n\t:host(:not([vertical]).scroll) {\n\t\tpadding-inline-start: var(--icon-size);\n\t\tpadding-inline-end: var(--icon-size);\n\t\t--scroll-startbtn-icon: var(--scroll-hstartbtn-icon, url('/@skin@/commons/icons/scrollArrowLeft.svg'));\n\t\t--scroll-endbtn-icon: var(--scroll-hendbtn-icon, url('/@skin@/commons/icons/scrollArrowRight.svg'));\n\t}\n\n\t:host([vertical].scroll) {\n\t\tpadding-top: var(--icon-size);\n\t\tpadding-bottom: var(--icon-size);\n\t\t--scroll-startbtn-icon: var(--scroll-vstartbtn-icon, url('/@skin@/commons/icons/scrollArrowTop.svg'));\n\t\t--scroll-endbtn-icon: var(--scroll-vendbtn-icon, url('/@skin@/commons/icons/scrollArrowBottom.svg'));\n\t}\n\n\t#startBtn {\n\t\tposition: absolute;\n\t\tbox-sizing: border-box;\n\t\tborder: none;\n\t}\n\n\t:host(:not([vertical])) > #startBtn {\n\t\tborder-inline-end: solid 1px var(--border-color);\n\t\ttop: 0;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\twidth: var(--icon-size);\n\t}\n\n\t:host([vertical]) > #startBtn {\n\t\tborder-bottom: solid 1px var(--border-color);\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\theight: var(--icon-size);\n\t}\n\n\t#startBtn[disabled] {\n\t\tborder-color: transparent;\n\t}\n\n\t#endBtn {\n\t\tposition: absolute;\n\t\tbox-sizing: border-box;\n\t\tborder: none;\n\t}\n\n\t:host(:not([vertical])) > #endBtn {\n\t\tborder-inline-start: solid 1px var(--border-color);\n\t\tright: 0;\n\t\ttop: 0;\n\t\tbottom: 0;\n\t\twidth: var(--icon-size);\n\t}\n\n\t:host([vertical]) > #endBtn {\n\t\tborder-top: solid 1px var(--border-color);\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\theight: var(--icon-size);\n\t}\n\n\t#endBtn[disabled] {\n\t\tborder-color: transparent;\n\t}\n`);\n\ncustomElements.define('c-arrow-scroll-box', ArrowScrollBox);\n\n/**\n * API équivalente à ArrowScrollBox mais sans aucune gestion d'ArrowScroll.\n */\nexport interface OrientedBox extends BaseElement {\n\tinitialize(init?: OOrientedBoxInit): this\n}\n\nexport interface OOrientedBoxInit extends OArrowScrollBoxInit {\n\n\t/** Jamais appelé. */\n\tcbOverflow?: never\n}\n\nexport class OrientedBox extends BaseElement {\n\n\tget vertical(): boolean {return this.hasAttribute('vertical')}\n\n\tset vertical(val: boolean) {\n\t\tDOM.setAttrBool(this, 'vertical', val);\n\t}\n\n\t/** Compat ArrowScrollBox, mais aucune action. */\n\tscrollToChild(child: HTMLElement) {}\n\n\tget isOverflow() {return false}\n\n\tprotected _initialize(init: OArrowScrollBoxInit) {\n\t\tthis.vertical = init.vertical;\n\t\tthis._attach(this.localName, init, <slot/>);\n\t}\n}\n\nREG.reg.registerSkin('c-oriented-box', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t}\n\n\t:host([vertical]) {\n\t\tflex-direction: column;\n\t}\n`);\n\ncustomElements.define('c-oriented-box', OrientedBox);\n"]}