{"version":3,"sources":["/@back@/commons/widgets/buttons.tsx"],"names":["Actionable","ActionableList","ACTIONABLES","BaseElement","BASIS","Clickable","PopupActions","ACTION","ActionWrapper","isAccelKeyMgrPointer","REG","DOM","JSX","DOMSH","Button","role","this","getAttribute","uiContext","[object Object]","init","super","_initialize","initButtonFromConfig","elt","setAttr","hasAttribute","setAttribute","shadowRoot","_initAndInstallSkin","reg","registerSkin","customElements","define","ButtonToggle","toggleOn","val","undefined","toString","refresh","ActionBtn","action","ctx","parent","isInstantiable","r","buildCustomButton","initialize","findReg","actionContext","skin","getSkin","skinOver","getSkinOver","actions","a","b","buildButton","push","groupsOrder","list","id","length","join","cache","get","injectSepByGroup","mergeLists","buildButtons","set","label","hideLabel","title","_appendAccel","ariaLabel","_hideLabel","icon","text","accel","_accel","_action","_actionContext","accelKeyMgr","searchAccelText","sr","attachShadow","SHADOWDOM_INIT","appendChild","document","createElement","getId","isMenu","_refresh","_accelElt","_createAccel","setTextContent","labelParent","class","_labelElt","_createLabel","ev","isAvailable","getDatas","_popupMenu","_createPopup","addEventListener","target","classList","remove","contains","add","show","posFrom","fromX","marginX","toleranceY","Number","MAX_SAFE_INTEGER","notAvailableSpace","targetX","toleranceX","stopImmediatePropagation","preventDefault","execute","dispatchEvent","CustomEvent","detail","actionable","bubbles","composed","ButtonActions","_actions","_popup","popup","groupOrder","onclick","disabled","openPopup","buildInitFromAtts","extractActionContextFromDom","extractActionsFromDom","ActionActions","actionBtn","actionsBtn","lastAsDefault","extractAttr","ctxSvc","actionBtnInit","Object","create","actionsBtnInit","localName","returnValue","newButton","tabIndexCustom","insertBefore","RadioBtnsActionable","nodeName","ctn","setAttrBool","refreshContent","buildBtn","act","prt","subActions","src","getIcon","listElt","getLabel","acionsElt","desc","getDescription","forEach","sub","append","setSkinOver","setOverridenSvc","override","getWrapped","isEnabled"],"mappings":"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","sourcesContent":["import {Actionable, ActionableList, ACTIONABLES, IActionable, IActionableList, OActionableInit, OActionableListInit} from \"back/commons/actionables\";\nimport {BaseElement, BASIS, Clickable, IEltRefreshable, OClickableInit, OSkinableInit, PickInit} from \"back/commons/basis\";\nimport {IPopupable, IPopupCloseEvent, ORelativePosition} from \"back/commons/widgets/popupable\";\nimport {PopupActions} from \"back/commons/widgets/popups\";\nimport {ACTION, ActionWrapper, EButtonUiContext, IAction, isAccelKeyMgrPointer,} from \"lib/commons/actions\";\nimport {IReg, REG} from 'lib/commons/registry';\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {OBarActionsInit} from \"back/commons/widgets/bars\";\n\n/**\n * c-button : bouton simple (action à programmer)\n * c-button-toggle : bouton à 2 ou 3 positions (action à programmer)\n * c-button-actions : bouton qui affiche en popup-menu une liste d'actions.\n *\n * c-action : bouton piloté par une action qui se mue en bouton simple, toggle ou menu en fonction du type de l'action.\n * c-action-actions : regroupement d'une action principale avec un menu d'actions secondaires.\n * c-bar-actions : Barre de boutons issue d'une liste d'actions.\n */\n\n\n/**\n * c-button : bouton simple.\n * Le script sur le onclick est spécifié par programmation.\n *\n * Attributes : cf Clickable +\n * Config attributes: role, ui-context\n *\n *\tClass :\n *\t\"submit\" pour les boutons : mise en exergue d'un bouton principal de validation (dans un dialog)\n */\nexport interface Button extends Clickable {\n\tinitialize(init?: OButtonInit): this;\n}\n\nexport type EButtonAriaRole = 'button' | 'menu' | 'menuitem' | 'spinbutton' | 'tab' | string;\n\n/**\n * Configuration d'un bouton : role aria et contexte graphique permettant d'adapter les règles d'affichage.\n */\nexport interface OButtonInit extends OClickableInit {\n\trole?: EButtonAriaRole\n\tuiContext?: EButtonUiContext\n}\n\nexport class Button extends Clickable {\n\n\tget role(): EButtonAriaRole {return this.getAttribute('role')}\n\n\tget uiContext(): EButtonUiContext {return this.getAttribute('ui-context')}\n\n\tprotected _initialize(init: OButtonInit) {\n\t\tsuper._initialize(init);\n\t\tinitButtonFromConfig(this, init);\n\t}\n\n\tprotected _initSkin() {}\n}\n\nfunction initButtonFromConfig(elt: BaseElement & { uiContext?: EButtonUiContext }, init: OButtonInit) {\n\tif (init.role) DOM.setAttr(elt, 'role', init.role);\n\telse if (!elt.hasAttribute('role')) elt.setAttribute('role', 'button');\n\tif (init.uiContext) DOM.setAttr(elt, 'ui-context', init.uiContext);\n\tif (elt.shadowRoot) elt._initAndInstallSkin(elt.uiContext ? elt.uiContext + '/c-button' : 'bar/c-button', init);\n}\n\nREG.reg.registerSkin('dialog/c-button', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-width: 0;\n\t\tmin-height: min-content;\n\t\tmax-height: 5em;\n\t\toverflow: hidden;\n\t\talign-items: center;\n\t\ttext-align: center;\n\t\tjustify-content: center;\n\t\tborder: 1px solid var(--border-color);\n\t\tborder-radius: 3px;\n\t\tpadding: 0.3ex 0.6ex;\n\t\tmargin: .5em;\n\t\tuser-select: none;\n\t}\n\n\t:host([hidden]) {\n\t\tdisplay: none;\n\t}\n\n\t:host([disabled]) {\n\t\topacity: .3;\n\t}\n\n\t:host(:not([disabled])) {\n\t\tcursor: pointer;\n\t}\n\n\t:host(.vertical) {\n\t\tflex-direction: column;\n\t}\n\n\t:host(.inline) {\n\t\tdisplay: inline-flex;\n\t}\n\n\t:host(.default:not([disabled])) {\n\t\t/*outline: 1px solid var(--border-color);\n\t\toutline-offset: -2px;*/\n\t\tcolor: var(--inv-color);\n\t\tbackground-color: var(--inv-bgcolor);\n\t}\n\n\t.icon {\n\t\theight: var(--icon-size);\n\t\twidth: var(--icon-size);\n\t\tmin-height: var(--icon-size);\n\t\tmin-width: var(--icon-size);\n\t\tbackground: var(--icon-color) var(--icon-img) no-repeat center / contain;\n\t\tfilter: var(--filter);\n\t\t/*mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*-webkit-mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*background-blend-mode: multiply;*/\n\t}\n\n\t:host(:hover:not([disabled])) > .icon {\n\t\tfilter: var(--hover-filter);\n\t}\n\n\t:host(:active:not([disabled])) > .icon {\n\t\tfilter: var(--actve-filter);\n\t}\n\n\t.icon:not([hidden]) + .label {\n\t\t-webkit-margin-start: 0.3em;\n\t\tmargin-inline-start: 0.3em;\n\t}\n\n\t:host(.vertical) .icon {\n\t\theight: calc(var(--icon-size) * 1.5);\n\t\twidth: calc(var(--icon-size) * 1.5);\n\t}\n\n\t.label {\n\t\t/* Utilisé seulement si white-space: nowrap; */\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t:host(:hover:not([disabled])) {\n\t\t/*box-shadow: inset 0 0 3px var(--border-color);*/\n\t\tbackground-color: var(--pressed-bgcolor);\n\t}\n\n\t:host(.default:hover:not([disabled])) {\n\t\tbackground-color: var(--inv-bgcolor);\n\t\tbackground-image: linear-gradient(var(--inv-pressed-bgcolor), var(--inv-pressed-bgcolor));\n\t}\n\n\t:host(:focus-visible) {\n\t\toutline: var(--focus-outline);\n\t\toutline-offset: -2px;\n\t}\n\n\t:host(:active:not([disabled])) {\n\t\tbackground-color: var(--pressed-bgcolor);\n\t\t/*box-shadow: inset 0 0 2px var(--border-color);*/\n\t}\n\n\t:host([role=menu]) {\n\t\tpadding-inline-end: 1.2em;\n\t\tbackground: var(--dropdown-url) no-repeat right / 1em;\n\t}\n\n\t:host([role=menu]:hover:not([disabled])) {\n\t\tbackground: var(--pressed-bgcolor) var(--dropdown-url) no-repeat right / 1em;\n\t}\n\n\t:host([aria-pressed])::before {\n\t\tcontent: '\\u2713\\u00A0';\n\t}\n\n\t:host([aria-pressed=true]) {\n\t\tborder: 1px inset var(--border-color);\n\t}\n\n\t:host([aria-pressed=false])::before {\n\t\tcolor: transparent;\n\t}\n\n\t:host([aria-pressed=mixed])::before {\n\t\tcolor: var(--fade-color);\n\t}\n\n\n`);\n\nREG.reg.registerSkin('bar/c-button', 1, /* language=CSS */ `\n\t:host {\n\t\tfont-size: var(--label-size);\n\t\tborder: solid 1px transparent;\n\t\tborder-radius: 3px;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\talign-items: center;\n\t\ttext-align: center;\n\t\tjustify-content: center;\n\t\t-moz-user-select: none;\n\t\t-ms-user-select: none;\n\t\tuser-select: none;\n\t}\n\n\t:host(:not([hidden])) {\n\t\tpadding: 2px 4px;\n\t}\n\n\t:host([hidden]) {\n\t\tdisplay: none;\n\t}\n\n\t:host(:not([disabled])) {\n\t\tcursor: pointer;\n\t}\n\n\t:host([disabled]) {\n\t\topacity: .5;\n\t}\n\n\t:host(.vertical) {\n\t\tflex-direction: column;\n\t}\n\n\t:host(.inline) {\n\t\tdisplay: inline-flex;\n\t}\n\n\t.icon {\n\t\theight: var(--icon-size);\n\t\twidth: var(--icon-size);\n\t\tmin-height: var(--icon-size);\n\t\tmin-width: var(--icon-size);\n\t\tbackground: var(--icon-color) var(--icon-img) no-repeat center / contain;\n\t\tfilter: var(--filter);\n\t\t/*mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*-webkit-mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*background-blend-mode: multiply;*/\n\t}\n\n\t:host(:hover:not([disabled])) > .icon {\n\t\tfilter: var(--hover-filter);\n\t}\n\n\t:host(:active:not([disabled])) > .icon {\n\t\tfilter: var(--active-filter);\n\t}\n\n\t.icon:not([hidden]) + .label {\n\t\t-webkit-margin-start: 0.3em;\n\t\tmargin-inline-start: 0.3em;\n\t}\n\n\t:host(.vertical) > .icon {\n\t\theight: calc(var(--icon-size) * 1.5);\n\t\twidth: calc(var(--icon-size) * 1.5);\n\t}\n\n\t.label {\n\t\t/* Utilisé seulement si white-space: nowrap; */\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t:host(:hover:not([disabled])) {\n\t\t/*box-shadow: inset 0 0 3px var(--border-color);*/\n\t\tbackground: var(--pressed-bgcolor);\n\t}\n\n\t:host(:focus) {\n\t\toutline: var(--focus-outline);\n\t\toutline-offset: -2px;\n\t}\n\n\t:host(:active:not([disabled])) {\n\t\tbackground-color: var(--pressed-bgcolor);\n\t\t/*box-shadow: inset 0 0 3px var(--border-color);*/\n\t}\n\n\t:host([role=menu]:not([disabled])) { /* NE PAS SUPPR :not([disabled]) pour priorité > :host(:hover:not([disabled])) */\n\t\tpadding-inline-end: 1.2em;\n\t\tbackground: var(--dropdown-url) no-repeat right / 1em;\n\t}\n\n\t:host([role=menu]:hover:not([disabled])) {\n\t\tbackground-color: var(--pressed-bgcolor);\n\t}\n\n\t:host([role=menu][disabled]) { /* NE PAS SUPPR [disabled] pour priorité > :host(:hover:not([disabled])) */\n\t\tpadding-inline-end: 1.2em;\n\t}\n\n\t:host([aria-pressed]) {\n\t\tborder: 1px outset var(--border-color);\n\t\tborder-radius: 3px;\n\t\tmargin-inline: 1px;\n\t}\n\n\t/* TODO aria-pressed=mixed */\n\t:host([aria-pressed=true]) {\n\t\tborder: 1px inset;\n\t\tbackground-color: var(--pressed-bgcolor);\n\t}\n\n\t/*:host([aria-pressed])::before {\n\t\tcontent:'\\u2713\\u00A0';\n\t}\n\n\t:host(:not([aria-pressed=true]))::before {\n\t\tcolor:transparent;\n\t}*/\n`);\n\nREG.reg.registerSkin('menu/c-button', 1, /* language=CSS */ `\n\t:host {\n\t\tpadding: .3ex;\n\t\tpadding-inline-start: 0;\n\t\tpadding-inline-end: .3em;\n\t\tdisplay: grid;\n\t\tmin-height: min-content;\n\t\tmin-width: min-content;\n\t\tgrid-template-areas: \"check icon label sub\";\n\t\tgrid-template-columns: 0 var(--icon-size) 1fr auto;\n\t\tcolumn-gap: .2em;\n\t\t-moz-user-select: none;\n\t\tuser-select: none;\n\t\tcursor: default;\n\t}\n\n\t:host([hidden]) {\n\t\tdisplay: none;\n\t}\n\n\t:host([disabled]) {\n\t\topacity: 0.6;\n\t}\n\n\t.icon {\n\t\tgrid-area: icon;\n\t\tbackground: var(--icon-color) var(--icon-img) no-repeat center / contain;\n\t\tbackground-origin: content-box;\n\t\twidth: var(--icon-size);\n\t\tfilter: var(--filter);\n\t}\n\n\t:host(:hover:not([disabled])) > .icon {\n\t\tfilter: var(--hover-filter);\n\t}\n\n\t.label {\n\t\tgrid-area: label;\n\t\twhite-space: nowrap;\n\t}\n\n\t.ctn {\n\t\tgrid-area: label;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\talign-items: center;\n\t}\n\n\t.ctn > .label {\n\t\tflex: 1;\n\t}\n\n\t.accel {\n\t\tpadding-inline-start: .3em;\n\t\tfont-style: italic;\n\t\tfont-size: 80%;\n\t\tcolor: grey;\n\t}\n\n\t:host(:focus) {\n\t\tbackground-color: var(--row-inSel-bgcolor);\n\t\toutline: none;\n\t}\n\n\t:host(.inSubMenu) {\n\t\tbackground-color: var(--row-inSel-unfocus-bgcolor);\n\t}\n\n\t:host([aria-haspopup]):after {\n\t\tgrid-area: sub;\n\t\tcontent: '';\n\t\tpadding-inline-start: 1em;\n\t\tbackground: var(--dropdown-url) no-repeat center / 1em;\n\t\ttransform: rotate(-90deg);\n\t}\n\n\t:host([aria-pressed]),\n\t:host([check-space]) {\n\t\tpadding-inline-start: .3em;\n\t\tgrid-template-columns: 1em var(--icon-size) 1fr auto;\n\t}\n\n\t:host([aria-pressed])::before {\n\t\tgrid-area: check;\n\t\tcontent: ' ';\n\t}\n\n\t:host([aria-pressed=true])::before {\n\t\tcolor: transparent;\n\t\tbackground-position: center;\n\t\tbackground-repeat: no-repeat;\n\t\tbackground-image: var(--row-current-img-end);\n\t}\n\n\t:host([aria-pressed=mixed])::before {\n\t\tcolor: var(--fade-color);\n\t\tcontent: '?';\n\t}\n`);\n\nREG.reg.registerSkin('custom/c-button', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\talign-items: center;\n\t\ttext-align: center;\n\t\tjustify-content: center;\n\t\t-moz-user-select: none;\n\t\tuser-select: none;\n\t}\n\n\t:host([hidden]) {\n\t\tdisplay: none;\n\t}\n\n\t:host([disabled]) {\n\t\topacity: 0.2;\n\t}\n\n\t:host(:not([disabled])) {\n\t\tcursor: pointer;\n\t}\n\n\t:host(.vertical) {\n\t\tflex-direction: column;\n\t}\n\n\t.icon {\n\t\theight: var(--icon-size);\n\t\twidth: var(--icon-size);\n\t\tmin-height: var(--icon-size);\n\t\tmin-width: var(--icon-size);\n\t\tbackground: var(--icon-color) var(--icon-img) no-repeat center / contain;\n\t\tfilter: var(--filter);\n\t\t/*mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*-webkit-mask: var(--icon-img) no-repeat center / contain;*/\n\t\t/*background-blend-mode: multiply;*/\n\t}\n\n\t:host(:hover:not([disabled])) > .icon {\n\t\tfilter: var(--hover-filter);\n\t}\n\n\t:host(.vertical) .icon {\n\t\theight: calc(var(--icon-size) * 1.5);\n\t\twidth: calc(var(--icon-size) * 1.5);\n\t}\n\n\t:host(:active:not([disabled])) > .icon {\n\t\tfilter: var(--active-filter);\n\t}\n\n\t.label {\n\t\tflex: 1;\n\t\t/* Utilisé seulement si white-space: nowrap; */\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.icon:not([hidden]) + .label {\n\t\tmargin-inline-start: .3em;\n\t}\n\n\t:host(:hover:not([disabled])) {\n\t\t/*box-shadow: inset 0 0 3px var(--border-color);*/\n\t\tbackground: var(--pressed-bgcolor);\n\t}\n\n\t:host(:focus-visible) {\n\t\toutline: var(--focus-outline);\n\t\toutline-offset: -2px;\n\t}\n\n\t:host(:active:not([disabled])) {\n\t\tbackground-color: var(--pressed-bgcolor);\n\t\t/*box-shadow: inset 0 0 2px var(--border-color);*/\n\t}\n\n`);\n\ncustomElements.define('c-button', Button);\n\n\n/**\n * Bouton à double (voir triple) état.\n *\n * Attributes : cf Button +\n * State updatable attribute : aria-pressed (=\"true\" | \"false\" | \"mixed\")\n */\nexport interface ButtonToggle extends Button {\n\tinitialize(init?: OButtonToggleInit): this;\n}\n\nexport interface OButtonToggleInit extends OButtonInit {\n\ttoggleOn?: boolean /*on/off*/ | null /*mixed*/\n}\n\nexport class ButtonToggle extends Button {\n\tget toggleOn(): boolean | null /* null pour 'mixed' */ | undefined /*pas encore init*/ {\n\t\tconst val = this.getAttribute('aria-pressed');\n\t\treturn val === 'true' ? true : val === 'false' ? false : val === 'mixed' ? null : undefined;\n\t}\n\n\tset toggleOn(val: boolean | null | undefined) {\n\t\tDOM.setAttr(this, 'aria-pressed', val != null ? val.toString() : val === undefined ? null : 'mixed');\n\t\tthis.refresh();\n\t}\n\n\t_initialize(init: OButtonToggleInit) {\n\t\tsuper._initialize(init);\n\t\tif (init.toggleOn !== undefined) {\n\t\t\t//true / false / null(mixed)\n\t\t\tthis.toggleOn = init.toggleOn;\n\t\t} else if (!this.hasAttribute('aria-pressed')) {\n\t\t\t//On impose l'état off si pas initialisé.\n\t\t\tthis.toggleOn = false;\n\t\t}\n\t}\n}\n\ncustomElements.define('c-button-toggle', ButtonToggle);\n\n\n//***************************************** ACTIONS *******************************************\n/**\n * c-action : bouton piloté par une Action.\n */\nexport interface ActionBtn<C> extends Actionable<C> {\n\tinitialize(init?: OActionBtnInit<C>): this;\n}\n\nexport interface OActionBtnInit<C> extends OActionableInit<C>, OButtonInit {\n\taccel?: string\n}\n\nexport class ActionBtn<C> extends Actionable<C> {\n\n\t/** Construit un ActionBtn en privillégiant la construction 'custom' de l'action sur l'implémentation standard. */\n\tstatic buildButton<C>(action: IAction<C>, ctx: C, uiContext: EButtonUiContext, parent?: Element): IActionable<C> {\n\t\tif (!action.isInstantiable(ctx)) return null;\n\t\tconst r = action.buildCustomButton(ctx, uiContext, parent) as IActionable<C>;\n\t\tif (r === null) return null;\n\t\treturn r || new ActionBtn<C>().initialize({\n\t\t\treg: REG.findReg(parent, ctx),\n\t\t\taction: action,\n\t\t\tactionContext: ctx,\n\t\t\tskin: action.getSkin(ctx),\n\t\t\tskinOver: action.getSkinOver(ctx),\n\t\t\tuiContext: uiContext,\n\t\t\trole: uiContext === 'menu' ? 'menuitem' : 'button'\n\t\t});\n\t}\n\n\tstatic buildButtons<C>(actions: IAction<C>[], ctx: C, uiContext: EButtonUiContext, parent?: Element): IActionable<C>[] {\n\t\tconst r = [];\n\t\tfor (const a of actions) {\n\t\t\tconst b = ActionBtn.buildButton(a, ctx, uiContext, parent);\n\t\t\tif (b) r.push(b);\n\t\t}\n\t\treturn r;\n\t}\n\n\n\t/**\n\t * Retourne une liste de boutons du cache du reg ou l'instancie pour fournir les boutons d'une toolbar partagée.\n\t * ATTENTION: tous les appels doivent considérer un ctx suffisamment équivalent pour la construction de cette liste de btns.\n\t */\n\tstatic mergeActionablesForBar<C>(reg: IReg<any>, groupsOrder: string, ctx: C, ...list: string[]): IActionable<C>[] {\n\t\tconst id = \"barActs:\" + (list.length === 1 ? list[0] : list.join());\n\t\tlet a = reg.cache.get(id) as IActionable<C>[];\n\t\tif (!a) {\n\t\t\tconst actions = ACTION.injectSepByGroup(reg.mergeLists(...list), groupsOrder, ctx);\n\t\t\ta = ActionBtn.buildButtons<C>(actions, ctx, 'bar');\n\t\t\treg.cache.set(id, a);\n\t\t}\n\t\treturn a;\n\t}\n\n\n\tprotected _accel: string;\n\n\tprotected _accelElt: HTMLElement;\n\n\tprotected _popupMenu: IPopupable & IActionableList<C> & IEltRefreshable;\n\n\tget role(): EButtonAriaRole {return this.getAttribute('role')}\n\n\tget uiContext(): EButtonUiContext {return this.getAttribute('ui-context')}\n\n\tget label(): string {\n\t\tif (this.hideLabel) return null;\n\t\treturn super.label;\n\t}\n\n\tset label(val: string) {\n\t\tsuper.label = val;\n\t}\n\n\tget title(): string {\n\t\tif (this.hideLabel) return this._appendAccel(super.label || super.title);\n\t\treturn this.uiContext === 'menu' ? super.title : this._appendAccel(super.title);\n\t}\n\n\tget ariaLabel(): string {\n\t\treturn super.label || super.title;\n\t}\n\n\t/** Masquage du label : Par défaut, pas de label dans une barre d'actions si une icone est dispo. */\n\t_hideLabel: boolean | undefined;\n\tprotected get hideLabel(): boolean {return this._hideLabel === undefined ? this.uiContext === 'bar' && !!this.icon : this._hideLabel}\n\n\tprotected _appendAccel(text: string) {\n\t\tconst accel = this.accel;\n\t\treturn accel ? text ? `${text} (${accel})` : `(${accel})` : text || '';\n\t}\n\n\tset title(val: string) {\n\t\tsuper.title = val;\n\t}\n\n\tget accel(): string {\n\t\tif (this._accel != null) return this._accel;\n\t\tif (this._action && isAccelKeyMgrPointer(this._actionContext)) {\n\t\t\treturn this._actionContext.accelKeyMgr.searchAccelText(this._action);\n\t\t}\n\t\treturn null;\n\t}\n\n\tset accel(val: string) {\n\t\tif (this._accel != val) {\n\t\t\tthis._accel = val;\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\n\tprotected _initialize(init: OActionBtnInit<C>) {\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tsr.appendChild(document.createElement('slot'));\n\t\tinitButtonFromConfig(this, init);\n\t\tsuper._initialize(init);\n\t\tif (init.accel) this._accel = init.accel;\n\t\tthis.setAttribute('id', this._action.getId());\n\t\tif (this._action.isMenu(this._actionContext)) {\n\t\t\tif (this.role === 'menuitem') {\n\t\t\t\t//sous-menu\n\t\t\t\tthis.setAttribute('aria-haspopup', 'true');\n\t\t\t} else {\n\t\t\t\tthis.setAttribute('role', 'menu');\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _refresh() {\n\t\tsuper._refresh();\n\t\tif (this.uiContext === 'menu') {\n\t\t\tconst accel = this.accel;\n\t\t\tif (accel) {\n\t\t\t\tif (!this._accelElt) this._createAccel();\n\t\t\t\tDOM.setTextContent(this._accelElt, accel);\n\t\t\t} else if (this._accelElt) DOM.setTextContent(this._accelElt, null);\n\t\t}\n\t}\n\n\t/** création de l'accel à la demande. */\n\tprotected _createAccel() {\n\t\tconst labelParent = this.shadowRoot.appendChild(<span class='ctn'/>);\n\t\tif (!this._labelElt) this._createLabel();\n\t\tlabelParent.appendChild(this._labelElt);\n\t\tthis._accelElt = labelParent.appendChild(<span class='accel'/>);\n\t}\n\n\tprotected _executeAction(ev: Event) {\n\t\tif (this._action && this._action.isAvailable(this._actionContext)) {\n\t\t\tif (this._action.isMenu(this._actionContext)) {\n\t\t\t\t//On affiche le menu contextuel de l'action.\n\t\t\t\tconst actions = this._action.getDatas('menu', this._actionContext);\n\t\t\t\tif (!this._popupMenu) {\n\t\t\t\t\tthis._popupMenu = this._createPopup({actions, actionContext: this._actionContext});\n\t\t\t\t\tthis._popupMenu.addEventListener('c-beforeclose', (ev: CustomEvent) => {\n\t\t\t\t\t\tif (ev.target === this._popupMenu) {\n\t\t\t\t\t\t\tthis.classList.remove('inSubMenu');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (this._popupMenu.contains(ev.target as Node)) return;\n\t\t\t\t\tthis._popupMenu.actions = actions;\n\t\t\t\t}\n\t\t\t\tthis.classList.add('inSubMenu');\n\t\t\t\tthis._popupMenu.show(this.uiContext !== 'menu' ? this : {\n\t\t\t\t\t//on le place à doite\n\t\t\t\t\tposFrom: this,\n\t\t\t\t\tfromX: 'end',\n\t\t\t\t\tmarginX: -5,\n\t\t\t\t\ttoleranceY: Number.MAX_SAFE_INTEGER,\n\t\t\t\t\tnotAvailableSpace: {\n\t\t\t\t\t\t//sinon, on le place à gauche en autorisant la superposition.\n\t\t\t\t\t\tposFrom: this,\n\t\t\t\t\t\ttargetX: 'end',\n\t\t\t\t\t\tmarginX: 5,\n\t\t\t\t\t\ttoleranceY: Number.MAX_SAFE_INTEGER,\n\t\t\t\t\t\ttoleranceX: Number.MAX_SAFE_INTEGER\n\t\t\t\t\t} as ORelativePosition\n\t\t\t\t} as ORelativePosition, this, this);\n\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\tev.preventDefault();\n\t\t\t} else {\n\t\t\t\t//On execute l'action.\n\t\t\t\t//.executeIfAvailable() NON déjà évalué en amont et pb pour les actions dont l'activation est async et forcé au niveau du button (cf paste bookmark par ex.).\n\t\t\t\tthis._action.execute(this._actionContext, ev);\n\t\t\t}\n\t\t}\n\t\tthis.dispatchEvent(new CustomEvent('c-actioned', {detail: {actionable: this}, bubbles: true, composed: true}));\n\t}\n\n\tprotected _createPopup(init: OActionableListInit<C>): IPopupable & IActionableList<C> & IEltRefreshable {\n\t\treturn new PopupActions<C>().initialize(init);\n\t}\n\n}\n\ncustomElements.define('c-action', ActionBtn);\n\n\n/**\n * Bouton affichant une liste d'actions en popup.\n *\n * Attributes : cf Button + ActionableList\n */\nexport interface ButtonActions<C> extends Button {\n\tinitialize(init?: OButtonActionsInit<C>): this;\n}\n\nexport interface OButtonActionsInit<C> extends OActionableListInit<C>, OButtonInit {}\n\nexport class ButtonActions<C> extends Button {\n\tprotected _actions: IAction<C>[];\n\tprotected _actionContext: C;\n\tprotected _popup: IPopupable & IActionableList<C>;\n\n\tget actions(): IAction<C>[] {return this._actions}\n\n\tset actions(actions: IAction<C>[]) {\n\t\tthis._actions = actions;\n\t\tif (this._popup) this._popup.actions = actions;\n\t}\n\n\tget actionContext(): C {return this._actionContext}\n\n\tget popup() {\n\t\tif (!this._popup) this._popup = this._createPopup();\n\t\treturn this._popup;\n\t}\n\n\tprotected _initialize(init: OButtonActionsInit<C>) {\n\t\tinit.role = 'menu';\n\t\tthis._actions = init.groupOrder == null ? init.actions : ACTION.injectSepByGroup(init.actions, init.groupOrder, this._actionContext);\n\t\tthis._actionContext = init.actionContext || (this as any as C); //A défaut de contextAction on prend l'élément courant.\n\t\tsuper._initialize(init);\n\t\tif (!this.onclick) this.onclick = function (this: ButtonActions<C>, ev: MouseEvent) {\n\t\t\tif (!this.disabled && (!this._popup || !this._popup.contains(ev.target as Node))) this.openPopup();\n\t\t}\n\t}\n\n\topenPopup() {\n\t\tthis.popup.show(this, this, this);\n\t}\n\n\tbuildInitFromAtts(init?: OButtonActionsInit<C>): OButtonActionsInit<C> {\n\t\tinit = super.buildInitFromAtts(init);\n\t\tinit.actionContext = ACTIONABLES.extractActionContextFromDom(this, init);\n\t\tinit.actions = ACTIONABLES.extractActionsFromDom(this, init);\n\t\treturn init;\n\t}\n\n\tprotected _createPopup(): IPopupable & IActionableList<C> {\n\t\treturn this.appendChild(new PopupActions<C>().initialize({actions: this.actions, actionContext: this.actionContext}));\n\t}\n}\n\ncustomElements.define('c-button-actions', ButtonActions);\n\n\n/**\n * tag: c-action-actions\n * Regroupement d'un c-action et d'un c-button-actions en un seul widget pour proposer des actions secondaires\n * à une action principale.\n * La config lastAsDefault permet de changer l'action principale par la dernière action sélectionnée dans le menu.\n *\n * Attributes : cf BaseElement +\n * Config attribute : ui-context, last-as-default\n * Config init attributes : action, actions, action-context\n * (todo Config attributes : action-skin, action-skin-over, actions-skin, actions-skin-over pour skins des actionBtn et actionsBtn ?)\n */\nexport interface ActionActions<C> extends BaseElement {\n\tinitialize(init?: OActionActionsInit<C>): this\n}\n\nexport interface OActionActionsInit<C> extends OSkinableInit, PickInit<ActionActions<C>, 'actionContext' | 'lastAsDefault' | 'uiContext'> {\n\tactionBtn?: OActionableInit<C>\n\tactionsBtn?: OActionableListInit<C>\n}\n\n\nexport class ActionActions<C> extends BaseElement {\n\tactionBtn: ActionBtn<C>;\n\tactionsBtn: ButtonActions<C>;\n\n\tget uiContext(): EButtonUiContext {return this.getAttribute('ui-context')}\n\n\tget lastAsDefault(): boolean {return this.hasAttribute('last-as-default')}\n\n\tget actionContext(): C {return this.actionBtn.actionContext}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.actionBtn = new ActionBtn();\n\t\tthis.actionsBtn = new ButtonActions();\n\t}\n\n\t_initialize(init: OActionActionsInit<C>) {\n\t\t//configs locales\n\t\tif (init.uiContext) this.setAttribute('ui-context', init.uiContext);\n\t\tif (init.lastAsDefault) this.setAttribute('last-as-default', \"\");\n\t\t//config par défaut.\n\t\tif (!this.hasAttribute('ui-context')) this.setAttribute('ui-context', 'bar');\n\n\t\t//transfert des attributs aux sub-widgets.\n\t\tDOM.setAttr(this.actionBtn, 'action', BASIS.extractAttr(this, 'action'));\n\t\tDOM.setAttr(this.actionsBtn, 'actions', BASIS.extractAttr(this, 'actions'));\n\t\tconst ctxSvc = BASIS.extractAttr(this, 'action-context');\n\t\tif (ctxSvc) {\n\t\t\tDOM.setAttr(this.actionBtn, 'action-context', ctxSvc);\n\t\t\tDOM.setAttr(this.actionsBtn, 'action-context', ctxSvc);\n\t\t}\n\t\t//ui-context\n\t\tif (!this.actionBtn.hasAttribute('ui-context')) this.actionBtn.setAttribute('ui-context', this.uiContext === 'bar' ? 'bar' : 'custom');\n\t\tif (!this.actionsBtn.hasAttribute('ui-context')) this.actionsBtn.setAttribute('ui-context', 'custom');\n\n\t\t//init des sous-éléments.\n\t\tconst actionBtnInit = init.actionBtn ? Object.create(init.actionBtn) : this.actionBtn.buildInitFromAtts();\n\t\tif (init.actionContext) actionBtnInit.actionContext = init.actionContext;\n\t\tconst actionsBtnInit = init.actionsBtn ? Object.create(init.actionsBtn) : this.actionsBtn.buildInitFromAtts();\n\t\tif (init.actionContext) actionsBtnInit.actionContext = init.actionContext;\n\n\t\tthis.actionBtn.initialize(actionBtnInit);\n\t\tthis.actionsBtn.initialize(actionsBtnInit);\n\n\t\t//construction du contenu du widget\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tsr.appendChild(this.actionBtn);\n\t\tsr.appendChild(this.actionsBtn);\n\n\t\tif (this.lastAsDefault) {\n\t\t\tthis.actionsBtn.popup.addEventListener('c-close', (ev: IPopupCloseEvent) => {\n\t\t\t\tif (!ev.detail.returnValue) return;\n\t\t\t\tconst newButton = new ActionBtn<C>().initialize({\n\t\t\t\t\taction: ev.detail.returnValue,\n\t\t\t\t\tactionContext: this.actionBtn.actionContext,\n\t\t\t\t\tuiContext: this.actionBtn.uiContext,\n\t\t\t\t\tskin: init.skin,\n\t\t\t\t\tskinOver: init.skinOver,\n\t\t\t\t\ttabIndexCustom: this.actionBtn.tabIndexCustom,\n\t\t\t\t} as OActionableInit<C> & OButtonInit);\n\t\t\t\tthis.shadowRoot.insertBefore(newButton, this.actionBtn);\n\t\t\t\tthis.actionBtn.remove();\n\t\t\t\tthis.actionBtn = newButton;\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected _refresh() {\n\t\tsuper._refresh();\n\t\tthis.actionBtn.refresh();\n\t\tthis.actionsBtn.refresh();\n\t}\n}\n\nREG.reg.registerSkin('c-action-actions', 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\ttext-align: center;\n\t\tjustify-content: center;\n\t}\n\n\t:host([ui-context=dialog]) {\n\t\tborder: solid 1px var(--border-color);\n\t\tmargin: .5em;\n\t}\n\n\t:host([ui-context=dialog]) > c-action {\n\t\tpadding: 0.3ex 0.6ex;\n\t\t/* RTL border-inline-end: */\n\t\tborder-inline-end: solid 1px var(--border-color);\n\t}\n\n\t:host([ui-context=dialog]) > c-action[aria-pressed]::before {\n\t\tgrid-area: check;\n\t\tcontent: '\\u2713';\n\t}\n\n\t:host([ui-context=dialog]) > c-action[aria-pressed=false]::before {\n\t\tcolor: transparent;\n\t}\n\n\t:host([ui-context=dialog]) > c-action[aria-pressed=mixed]::before {\n\t\tcolor: var(--fade-color);\n\t}\n\n\tc-action {\n\t\tflex: 1 1;\n\t}\n\n\tc-button-actions {\n\t\tbackground: var(--dropdown-url) no-repeat center / 1em;\n\t\tpadding: .5em;\n\t}\n`);\n\ncustomElements.define('c-action-actions', ActionActions);\n\n\n/**\n * ActionableList présentée sous forme de liste type radioBtn\n */\nexport class RadioBtnsActionable<C> extends ActionableList<C> {\n\n\tprotected _initialize(init: OBarActionsInit<C>) {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.nodeName, init);\n\t\tconst ctn = sr.appendChild(<slot/>);\n\t}\n\n\tget disabled(): boolean {return this.hasAttribute('disabled')}\n\n\tset disabled(val: boolean) {\n\t\tif (DOM.setAttrBool(this, 'disabled', val)) this.refreshContent();\n\t}\n\n\t_createButton(action: IAction<C>): Element {\n\t\tconst ctn = this;\n\t\tconst ctx = this._actionContext;\n\t\tconst buildBtn = (act: IAction<C>, prt: HTMLElement) => {\n\t\t\t//Sous-liste\n\t\t\tif (act.isMenu(ctx)) {\n\t\t\t\tif (act.isInstantiable(ctx)) {\n\t\t\t\t\tconst subActions = act.getDatas(\"menu\", ctx);\n\t\t\t\t\tif (subActions?.length > 0) {\n\t\t\t\t\t\tconst src = act.getIcon(ctx);\n\t\t\t\t\t\tconst listElt = <div class=\"radioBox\">\n\t\t\t\t\t\t\t<div class=\"icoLabel\">\n\t\t\t\t\t\t\t\t{src ? <img src={src} class=\"icon\"/> : undefined}\n\t\t\t\t\t\t\t\t<span class=\"label\">{act.getLabel(ctx)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>;\n\t\t\t\t\t\tconst acionsElt = listElt.appendChild(<div class=\"actionsList\"/>);\n\t\t\t\t\t\tconst desc = act.getDescription(ctx);\n\t\t\t\t\t\tif (desc) listElt.title = desc;\n\t\t\t\t\t\tsubActions.forEach((sub) => acionsElt.append(buildBtn(sub, listElt)));\n\t\t\t\t\t\treturn listElt;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t//Checkbox\n\t\t\treturn ActionBtn.buildButton(new ActionWrapper(act.getId()).setSkinOver(\"c-radios-actions-action\").setOverridenSvc(act).override('isEnabled', function (this: ActionWrapper<C>, ctx: C) {\n\t\t\t\tif (ctn.disabled) return false;\n\t\t\t\treturn this.getWrapped(ctx).isEnabled(ctx);\n\t\t\t}), ctx, ctn.uiContext, prt);\n\t\t}\n\t\treturn buildBtn(action, this);\n\t}\n\n}\n\ncustomElements.define('c-radios-actions', RadioBtnsActionable);\n\nREG.reg.registerSkin('c-radios-actions', 1, /* language=CSS */ `\n\t/* Séparateur */\n\t::slotted(hr) {\n\t\tdisplay: none;\n\t}\n`);\n\nREG.reg.registerSkin('c-radios-actions-action', 1, /* language=CSS */ `\n\t:host([aria-pressed])::before,\n\t:host(.unknlownValue)::before {\n\t\tcontent: '';\n\t\twidth: 1.5em;\n\t}\n\n\t:host([aria-pressed=true])::before,\n\t:host(.unknlownValue)::before {\n\t\tcontent: '✓';\n\t}\n\n\t:host(.unknlownValue) {\n\t\tcolor: var(--error-color);\n\t}\n\n\t:host(.unknlownValue[disabled]) {\n\t\topacity: 1;\n\t}\n\n`);"]}