{"version":3,"sources":["/@back@/wsp/apps/wspApp.tsx"],"names":["BASIS","MsgLabel","Workbench","DeleteSrc","ExportScar","ExportScwsp","FocusItemOrSpace","ImportFiles","ImportScar","OpenFastFindItem","OpenSearchItems","OpenWspTrash","RenameSrc","SetPermsSpace","ShortDescCopy","ShowNetItems","BookmarksArea","ExplorerArea","GeneratorTabsArea","NetItemsArea","SearchesArea","TasksArea","TocArea","SpaceTreeCollapseAllAction","SpaceTreeCopyTo","SpaceTreeCreateItem","SpaceTreeCreateSpace","SpaceTreeDuplicate","SpaceTreeFocusItem","SpaceTreeMoveTo","SpaceTreePaste","SpaceTreePasteMove","SpaceTreeRename","Action","ActionMenu","ActionSeparator","ActionSignboardWrapper","InfoBrokerBasic","REG","VIEWS","JSX","DOMSH","InfoCurrentItem","InfoFocusItem","InfoReqCurrentItem","ITEM","SRC","LASTDATAS","ItemViewerMulti","ELong2DateStyles","ESearchExportColumnStatus","SearchExportColumn","SearchFuncAccountProp","SearchFuncLong2Date","SearchFuncProps","SearchFuncResponsibles","SearchFuncTranslateStr","SearchFuncUri2LeafName","SearchFuncUri2Space","GridColDef","CellBuilderItModel","CellBuilderItModelFlagIcon","CellBuilderLc","CellBuilderLcFlag","CellBuilderResp","CellBuilderResps","CellBuilderSpace","CellBuilderSrcIconCode","CellBuilderTkDeadline","CellBuilderTkScheduledD","CellBuilderDate","CellBuilderString","CellBuilderAccount","ExportRes","ImportFolder","ImportRes","RibbonLc","RibbonResp","RibbonTasks","registerWspProtocolsActions","WspBaseApp","WedSearchCoordinator","EItemTypeFamily","ETaskFeatures","LC_DEFAULT_NAME","HistoEditPointsMgr","ActionBtn","ScanFsUpdatesAction","WspApp","[object Object]","this","shortDescs","emitter","init","_config","appDef","universe","reg","env","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","wsp","wspServer","wspsLive","findWsp","_initApp","infoBroker","addConsumer","workbench","itemViewer","sr","shadowRoot","pendingUi","_initWsp","_initReg","wedSearchCoord","clearContent","appendChild","createElement","class","getUserData","undefined","î","toolbarsPrefix","ctx","skinOver","lastDatasKey","lastDatas","lb","selTab","rt","rb","bl","br","config","backEnd","explo","getTab","btn","buildButton","className","_initAppHeader","tools","appHeader","_refreshTitle","_refreshMigration","main","hasFeature","fallbackOpenSrcRef","initViewer","srcRef","_lastWspMetaUi","wspMetaUi","injectLoads","getList","lstn","result","Promise","onViewHidden","reinitializeStarted","initialized","onContainerShown","onViewShown","initializedAsync","then","closed","injectClose","_a","_c","_b","place","closePlace","onContainerHidden","_d","_e","_lastMigrPopup","close","_f","def","isAvailable","onAppDefChange","reloadApp","dispatchInfo","info","shortDesc","revertable","dispatchEvent","CustomEvent","bubbles","detail","getSrcMainName","onInfo","parentLastDatas","buildLastDatas","longdesc","silent","srcSt","openTrashDialog","uiRoot","showMainView","selectLiveSrcUri","srcLiveUri","srcUri","app","histoEditMgr","addShortDescAction","action","accelKey","sortKey","addToList","getId","SINGLETON","addWspActionsMain","addGlobalAction","WorkbenchTools","OpenWspDocApp","addWspActionsConfig","addWspActionsContent","addWspActionsLayers","setHideItemFolderContent","setActionsLists","setAccelKeysLists","registerSvc","search","view","showView","persistSearch","setConfsList","addSpaceTreeAction","accel","pasteCtrl","requireSrcVisiblePerm","addColTask","colDef","registerCodefAsSvcCode","addSvcToList","id","addColTaskExport","addCol","addColExport","setLabel","setSortable","setFlex","setMinWidth","setCellBuilder","srcUriItemsSortFn","setColDef","setDict","it","getItemTypes","dict","forEach","entry","isFamily","task","getModel","getTitle","setExportStatus","exportable","setDescription","wspDefProps","drfRefWsp","import","initDrfReg","drvAxis","initDrvReg","gitSt","infoWsp","srcFields","initGitReg","getLcTransitions","listTr","ItemListTransition","lcName","getLcName","map","lcStates","getLcStates","st","values","code","name","gridColLc","setIconClass","setSkin","registerSkin","hasResps","listRespsItems","listResps","desc","userCard","setResp","ItemsSetResonsabilities","listRespsTasks","hasTasks","tasksIt","filter","override","set","find","deadline","setFormat","short","scheduling","setMaxWidth","size","Map","states","value","key","addShortDescTaskAction","customElements","define","super","_label","_description","_actions","getAreaTools","a","ShowTool","push","ShowFlapTabs","toolArea","_wrapped","api","selected","ev","toggleAreaTool","classList","contains","showFlapTabs","toggle","persistUS","getPersistUserStates","setUserDatas","_icon","_group","_visPerms","getPref","isVisible","curr","getItemType","itModel","datas","asDoc","desk","findAndOpenApp","u","wspDoc","doc"],"mappings":"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","sourcesContent":["import {BaseElementAsync, BASIS, MsgLabel, OSkinableInit} from \"back/commons/basis\";\nimport {AppFrameDeskFeat, IApp, IAppCtx} from \"back/core/appFrame\";\nimport {AppHeader} from \"back/core/widgets/appHeader\";\nimport {OWorkbenchInit, Workbench} from \"back/core/widgets/workbench\";\nimport {DeleteSrc, ExportScar, ExportScwsp, FocusItemOrSpace, ImportFiles, ImportScar, OpenFastFindItem, OpenSearchItems, OpenWspTrash, RenameSrc, SetPermsSpace, ShortDescCopy, ShowNetItems} from \"back/wsp/actions/srcActions\";\nimport {JWspAppDef, JWspDocAppDef} from \"back/wsp/plugins/wspsPlg\";\nimport {BookmarksArea, ExplorerArea, GeneratorTabsArea, NetItemsArea, SearchesArea, TasksArea, TocArea} from \"back/wsp/areas/wspWorkbench\";\nimport {SpaceTreeCollapseAllAction, SpaceTreeCopyTo, SpaceTreeCreateItem, SpaceTreeCreateSpace, SpaceTreeDuplicate, SpaceTreeFocusItem, SpaceTreeMoveTo, SpaceTreePaste, SpaceTreePasteMove, SpaceTreeRename} from \"back/wsp/views/spaceTree\";\nimport \"back/wsp/views/views_Perms\";\nimport {Action, ActionMenu, ActionSeparator, ActionSignboardWrapper, IAccelKeyMgrPointer, IAction, IActionToggle} from \"lib/commons/actions\";\nimport {IInfo, IInfoConsumer, InfoBrokerBasic} from \"lib/commons/infos\";\nimport {IReg, IRegPointer, REG} from 'lib/commons/registry';\nimport {IView, VIEWS} from \"lib/commons/views\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {IChainEnv} from \"lib/wsp/chain\";\nimport {InfoCurrentItem, InfoFocusItem, InfoReqCurrentItem, IShortDescCtx, ITEM} from \"lib/wsp/item\";\nimport {JSrcFields, SRC, srcRef} from \"lib/wsp/src\";\nimport {IWspEnv, IWspUiEnv} from \"lib/wsp/wsp\";\nimport {ILastDatasBuilder, JLastDatas, LASTDATAS} from \"lib/commons/lastDatas\";\nimport {IItemViewer} from \"back/wsp/views/itemMain\";\nimport {ItemViewerMulti} from \"back/wsp/views/itemViewerMulti\";\nimport {\n\tELong2DateStyles,\n\tESearchExportColumnStatus,\n\tISearchFunc,\n\tISearchPersist,\n\tISearchStore,\n\tSearchExportColumn,\n\tSearchFuncAccountProp,\n\tSearchFuncLong2Date,\n\tSearchFuncProps,\n\tSearchFuncResponsibles,\n\tSearchFuncTranslateStr,\n\tSearchFuncUri2LeafName,\n\tSearchFuncUri2Space\n} from \"lib/wsp/search\";\nimport {Searches} from \"back/wsp/views/searches\";\nimport {GridColDef} from \"back/commons/widgets/grid-core\";\nimport {\n\tCellBuilderItModel,\n\tCellBuilderItModelFlagIcon,\n\tCellBuilderLc,\n\tCellBuilderLcFlag,\n\tCellBuilderResp,\n\tCellBuilderResps,\n\tCellBuilderSpace,\n\tCellBuilderSrcIconCode,\n\tCellBuilderTkDeadline,\n\tCellBuilderTkScheduledD\n} from \"back/wsp/widgets/srcGridColumns\";\nimport {CellBuilderDate, CellBuilderString} from \"back/commons/widgets/grid-libs\";\nimport {IArea} from \"lib/commons/areas\";\nimport {CellBuilderAccount} from \"back/core/widgets/usersGrid\";\nimport {ExportRes, ImportFolder, ImportRes, ItemsSetResonsabilities} from \"back/wsp/actions/itemActions\";\nimport {RibbonLc, RibbonResp, RibbonTasks} from \"back/wsp/widgets/ribbon/ribbon\";\nimport {ItemListTransition} from \"back/wsp/actions/lcTaskActions\";\nimport {registerWspProtocolsActions} from \"back/wsp/actions/scProtocolActions\";\nimport \"back/wsp/apps/apps_Perms\";\nimport {WspBaseApp} from \"back/wsp/apps/wspBaseApp\";\nimport {IWedSearchCoordinatorPointer, WedSearchCoordinator} from \"back/edit/wed/features/searchBar\";\nimport {EItemTypeFamily, ETaskFeatures, ItemTypeTask, LC_DEFAULT_NAME} from \"lib/wsp/wspMetaUi\";\nimport {EGitState, JGitSrcFields} from \"lib/wsp/git\";\nimport {HistoEditPointsMgr, IHistoEditEnv} from \"lib/edit/histoEditPoints\";\nimport {ActionBtn} from \"back/commons/widgets/buttons\";\nimport {ScanFsUpdatesAction} from \"back/wsp/actions/wspActions\";\n\nexport interface OWspAppInit extends OSkinableInit, IAppCtx<IChainEnv> {\n\treg?: IReg<IChainEnv>\n\titemViewer?: IItemViewer\n\tappDef: JWspAppDef\n}\n\n/** App d'accès complet à un atelier. */\nexport interface WspApp extends BaseElementAsync, IView {\n\tinitialize(init: OWspAppInit): this;\n}\n\nexport class WspApp extends WspBaseApp implements IApp<IWspEnv>, IInfoConsumer, IAccelKeyMgrPointer<IRegPointer<IWspUiEnv>>, ILastDatasBuilder, IShortDescCtx {\n\n\n\tappDef: JWspAppDef;\n\n\tappHeader: AppHeader<WspApp>;\n\n\tworkbench: Workbench<IApp<IWspEnv>>;\n\n\titemViewer: IItemViewer;\n\n\tprotected _config: OWspAppInit;\n\n\t/** mémoire des derniers labels utilisés pour le label de la view. */\n\tprotected _lastSrcLabel: string;\n\n\tprotected _lastWspLabel: string;\n\n\t/** Api IShortDesc */\n\tshortDescs: JSrcFields[] = [];\n\n\t/** Api IShortDesc */\n\tget emitter() {return this}\n\n\tprotected async _initialize(init: OWspAppInit): Promise<void> {\n\t\tthis._config = init;\n\t\tthis.appDef = init.appDef;\n\t\tthis.universe = init.reg.env.universe;\n\n\t\tthis.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\n\t\tthis.wsp = this.universe.wspServer.wspsLive.findWsp(this.appDef.wsp, true);\n\t\treturn this._initApp(init);\n\t}\n\n\t/** Init ou RE-init de l'app. */\n\tprotected async _initApp(init: OWspAppInit) {\n\t\tthis.infoBroker = new InfoBrokerBasic();\n\t\tthis.infoBroker.addConsumer(this);\n\t\tthis.workbench = null;\n\t\tthis.itemViewer = null;\n\t\tconst sr = this.shadowRoot;\n\t\tconst pendingUi = new MsgLabel();\n\n\t\tif (!await this._initWsp(init, pendingUi)) return;\n\n\t\tif (!await this._initReg(init, \"wspApp\", \"ui.wspApp\", pendingUi)) return;\n\t\tconst reg = this.reg;\n\t\t(this.reg.env as IWedSearchCoordinatorPointer).wedSearchCoord = new WedSearchCoordinator();\n\n\t\tBASIS.clearContent(sr);\n\n\t\t//Construction du workbench\n\t\tthis.workbench = sr.appendChild(<Workbench class={reg.getUserData(\"showFlapTabs\", true) ? undefined : \"hideFlapTabs\"} î={{\n\t\t\ttoolbarsPrefix: \"wspApp:tools:\",\n\t\t\treg,\n\t\t\tctx: this,\n\t\t\tskinOver: \"wsp-app/c-workbench\",\n\t\t\tlastDatasKey: \"wb\",\n\t\t\tlastDatas: init.lastDatas && init.lastDatas[\"wb\"],\n\t\t\t//par défaut on masque les views en bas et à droite.\n\t\t\tlb: {selTab: \"\"},\n\t\t\trt: {selTab: \"\"},\n\t\t\trb: {selTab: \"\"},\n\t\t\tbl: {selTab: \"\"},\n\t\t\tbr: {selTab: \"\"}\n\t\t} as OWorkbenchInit}/>) as Workbench<IApp<IWspEnv>>;\n\n\t\tif (reg.env.universe.config.backEnd === \"fs\") {\n\t\t\tconst explo = this.workbench.getTab(\"explorer\");\n\t\t\tif (explo) {\n\t\t\t\tconst btn = ActionBtn.buildButton(new ScanFsUpdatesAction(), this, \"bar\", explo);\n\t\t\t\tbtn.className = \"label\"; //pour êter masqué si volet clos.\n\t\t\t\texplo.appendChild(btn);\n\t\t\t}\n\t\t}\n\n\t\t//AppHeader (après le workbench car on le référence dans le appHeader)\n\t\tthis._initAppHeader(init, [this.workbench, ...this.workbench.tools], \"actions:wspApp:main\", \"actions:wspApp:more\");\n\t\tthis.workbench.appendChild(this.appHeader);\n\n\t\t//\n\t\tthis._refreshTitle(null);\n\t\tthis._refreshMigration();\n\n\t\t//Construction de la mainView dans le workbench\n\t\tconst main = this.workbench.appendChild(<main/>);\n\t\tthis.itemViewer = init.itemViewer || new ItemViewerMulti();\n\t\tif (this.wsp.hasFeature('trash')) this.itemViewer.fallbackOpenSrcRef = this.fallbackOpenSrcRef;\n\t\tawait this.itemViewer.initViewer(reg, main, init.lastDatas, this.appDef.srcRef);\n\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\t\tinit.lastDatas = undefined;\n\n\t\tconst injectLoads = reg.getList<(app: WspApp) => void | Promise<void>>(\"wspApp:load\");\n\t\tif (injectLoads) for (const lstn of injectLoads) {\n\t\t\tconst result = lstn(this);\n\t\t\tif (result instanceof Promise) {\n\t\t\t\tawait result;\n\t\t\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\t\t\t}\n\t\t}\n\t}\n\n\treloadApp() {\n\t\tthis.onViewHidden(true)\n\t\tthis.reinitializeStarted(this._initApp(this._config));\n\t}\n\n\tonViewShown() {\n\t\tif (this.initialized) {\n\t\t\tif (this.workbench) VIEWS.onContainerShown(this.workbench);\n\t\t\tif (this.itemViewer) this.itemViewer.onViewShown();\n\t\t} else {\n\t\t\tthis.initializedAsync.then(() => this.onViewShown());\n\t\t}\n\t}\n\n\tonViewHidden(closed?: boolean): void {\n\t\tif (this.initialized) {\n\t\t\tif (closed) {\n\t\t\t\tconst injectClose = this.reg?.getList<(app: WspApp) => void>(\"wspApp:close\");\n\t\t\t\tif (injectClose) for (const lstn of injectClose) lstn(this);\n\t\t\t\tthis.reg?.env.place?.closePlace();\n\t\t\t}\n\t\t\tif (this.workbench) VIEWS.onContainerHidden(this.workbench, closed);\n\t\t\tthis.itemViewer?.onViewHidden(closed);\n\t\t\tthis._lastMigrPopup?.close();\n\t\t\tif (closed) this.reg?.close();\n\t\t} else {\n\t\t\tthis.initializedAsync.then(() => this.onViewHidden(closed));\n\t\t}\n\t}\n\n\tupdateAppDef(def: JWspAppDef): boolean {\n\t\tif (this.appDef === def) return true; //chgt issu d'ici\n\t\t//Si changement d'atelier on remplace totalement cette app.\n\t\tif (this.appDef.wsp && def.wsp !== this.appDef.wsp) return false;\n\t\tthis.appDef = def;\n\t\tif (this.initialized) {\n\t\t\tif (this.wsp && this.wsp.isAvailable) {\n\t\t\t\tthis.onAppDefChange();\n\t\t\t} else {\n\t\t\t\tthis.reloadApp();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.initializedAsync.then(() => this.onAppDefChange());\n\t\t}\n\t\treturn true;\n\t}\n\n\tprotected onAppDefChange() {\n\t\tif (this.appDef.srcRef) this.infoBroker.dispatchInfo(new InfoFocusItem(this.appDef.srcRef), this);\n\t}\n\n\tonInfo(info: IInfo): void {\n\t\tif (this.initialized) {\n\t\t\tif (info instanceof InfoCurrentItem) {\n\t\t\t\tconst shortDesc = info.shortDesc;\n\t\t\t\tconst srcRef = shortDesc ? SRC.srcRef(shortDesc) : null;\n\t\t\t\tif (srcRef != this.appDef.srcRef) {\n\t\t\t\t\tconst revertable = this.appDef.srcRef != null; //on ne sait pas reculer d'un srcRef existant vers aucun srcRef sélectionné.\n\t\t\t\t\tthis.appDef.srcRef = srcRef;\n\t\t\t\t\tthis.dispatchEvent(new CustomEvent('c-appdef-change', {bubbles: true, detail: {revertable}}));\n\t\t\t\t}\n\t\t\t\tthis._refreshTitle(shortDesc ? ITEM.getSrcMainName(this.reg, shortDesc, this.wsp.wspMetaUi) : null);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.initializedAsync.then(() => this.onInfo(info));\n\t\t}\n\t}\n\n\tbuildLastDatas(parentLastDatas: JLastDatas): void {\n\t\tLASTDATAS.buildLastDatas(parentLastDatas, this.workbench, true);\n\t}\n\n\t/** Ouverture en corbeille des items supprimés. */\n\tprotected async fallbackOpenSrcRef(this: IItemViewer, srcRef: srcRef, longdesc: JSrcFields, silent?: boolean): Promise<true | null> {\n\t\tif (longdesc.srcSt < 0) {\n\t\t\tOpenWspTrash.openTrashDialog(this.reg.env.uiRoot, {reg: this.reg, showMainView: true, selectLiveSrcUri: longdesc.srcLiveUri || longdesc.srcUri});\n\t\t\treturn true;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/** Init des extPoints du registre de l'app. */\n\tprotected async initRegExtPoints() {\n\t\tconst app = this;\n\t\tconst reg = this.reg;\n\t\tconst wsp = reg.env.wsp;\n\n\t\t(reg.env as IHistoEditEnv).histoEditMgr = new HistoEditPointsMgr();\n\n\t\t//#### Actions transversales sur les IShortDescCtx.\n\t\tfunction addShortDescAction(action: IAction<IShortDescCtx>, accelKey?: string, sortKey?: number) {\n\t\t\treg.addToList(\"actions:wsp:shortDesc\", action.getId(), 1, action, sortKey);\n\t\t\tif (accelKey) reg.addToList(\"accelkeys:wsp:shortDesc\", accelKey, 1, action);\n\t\t}\n\n\t\taddShortDescAction(new FocusItemOrSpace(), \"F3\");\n\t\taddShortDescAction(ShortDescCopy.SINGLETON, \"c-accel\");//sortKey -1 ?\n\t\taddShortDescAction(new RenameSrc(), \"F2\");\n\t\taddShortDescAction(new DeleteSrc());\n\t\taddShortDescAction(new ExportScar());\n\t\taddShortDescAction(new ShowNetItems(), \"e-accel-shift\");\n\n\t\tthis.addWspActionsMain(\"actions:wspApp:main\", \"actions:wspApp\");\n\t\tthis.addGlobalAction(\"actions:wspApp:main\", new WorkbenchTools(), 60);\n\t\tthis.addGlobalAction(\"actions:wspApp:main\", new OpenWspDocApp(), 70, \"F8\");\n\n\t\t//Config\n\t\tthis.addWspActionsConfig(\"actions:wspApp:config\");\n\n\t\t//Content\n\t\tthis.addWspActionsContent(\"actions:wspApp:content\");\n\n\t\t//Layers\n\t\tthis.addWspActionsLayers(\"actions:wspApp:layers\");\n\n\t\tthis.addGlobalAction(\"actions:wspApp:more\", new OpenFastFindItem(), 10, \"<-accel\");\n\t\tthis.addGlobalAction(\"actions:wspApp:more\", new OpenSearchItems(), 20, \"f-accel+shift\", true);\n\n\t\t//#### ScProtocol\n\t\tregisterWspProtocolsActions(reg);\n\n\t\t//#### Views du workbench\n\t\treg.addToList(\"wspApp:tools:lt\", \"explorer\", 1, new ExplorerArea()\n\t\t\t\t.setHideItemFolderContent(true)\n\t\t\t\t.setActionsLists([\"actions:wspApp:explorer\", \"actions:wsp:shortDesc\"])\n\t\t\t\t.setAccelKeysLists([\"accelkeys:wspApp:explorer\", \"accelkeys:wsp:shortDesc\"])\n\t\t\t, 1);\n\n\t\treg.addToList(\"wspApp:tools:bl\", \"gen\", 1, new GeneratorTabsArea(), 1);\n\n\t\treg.addToList(\"wspApp:tools:br\", \"itemSearches\", 1, new SearchesArea('itemSearches', 'item')\n\t\t\t\t.setActionsLists([\"actions:wspApp:shortDesc:search:item\", \"actions:wsp:shortDesc\"])\n\t\t\t\t.setAccelKeysLists([\"accelkeys:wspApp:shortDesc:search:item\", \"accelkeys:wsp:shortDesc\"])\n\t\t\t, 2);\n\n\t\t//Fournisseur de requête par défaut.\n\t\treg.registerSvc('searchStore.item', 1, {\n\t\t\tasync persistSearch(search: ISearchPersist): Promise<void> {\n\t\t\t\t//console.log(\"persistSearch:::::\", search);\n\t\t\t\tconst view = await app.workbench.showView('itemSearches') as Searches;\n\t\t\t\tif (view) return view.persistSearch(search);\n\t\t\t}\n\t\t} as ISearchStore);\n\n\t\treg.registerSvc('searchStore.task', 1, {\n\t\t\tasync persistSearch(search: ISearchPersist): Promise<void> {\n\t\t\t\t//console.log(\"persistSearch:::::\", search);\n\t\t\t\tconst view = await app.workbench.showView('taskSearches') as Searches;\n\t\t\t\tif (view) return view.persistSearch(search);\n\t\t\t}\n\t\t} as ISearchStore);\n\n\t\treg.addToList(\"wspApp:tools:rt\", \"bookmarks\", 1, new BookmarksArea()\n\t\t\t\t.setActionsLists([\"actions:wspApp:bookmarks\", \"actions:wsp:shortDesc\"])\n\t\t\t\t.setAccelKeysLists([\"accelkeys:wspApp:bookmarks\", \"accelkeys:wsp:shortDesc\"])\n\t\t\t, 1);\n\n\t\treg.addToList(\"wspApp:tools:lb\", \"toc\", 1, new TocArea(), 1);\n\t\treg.addToList(\"wspApp:tools:lb\", \"netItems\", 1, new NetItemsArea()\n\t\t\t\t.setConfsList([\"netItems:confs\"])\n\t\t\t\t.setActionsLists([\"actions:wspApp:netItems\", \"actions:wsp:shortDesc\"])\n\t\t\t\t.setAccelKeysLists([\"accelkeys:wspApp:netItems\", \"accelkeys:wsp:shortDesc\"])\n\t\t\t, 1);\n\n\t\t//#### Actions du SpaceTree\n\t\t// TODO PERF isoler la déclaration des actions du SpaceTree en dépendance async de ExplorerArea...\n\t\t// (si SpaceTree ne devient plus systématiquement utilisé / majeur dans un workbench d'un wsp)\n\n\t\tfunction addSpaceTreeAction(action: IAction<IShortDescCtx>, accel?: string, sortKey?: number) {\n\t\t\treg.addToList(\"actions:wspApp:explorer\", action.getId(), 1, action, sortKey);\n\t\t\tif (accel) reg.addToList(\"accelkeys:wspApp:explorer\", accel, 1, action);\n\t\t}\n\n\t\taddSpaceTreeAction(new SpaceTreeFocusItem(), \"F3\");\n\t\taddSpaceTreeAction(new SpaceTreeCollapseAllAction());\n\n\t\tconst pasteCtrl = new SpaceTreePaste();\n\t\taddSpaceTreeAction(pasteCtrl, \"v-accel\");\n\t\taddSpaceTreeAction(new SpaceTreePasteMove(pasteCtrl));\n\n\t\taddSpaceTreeAction(new SpaceTreeCreateItem(), \"i-accel\");\n\t\taddSpaceTreeAction(new SpaceTreeCreateSpace());\n\t\taddSpaceTreeAction(new SpaceTreeRename(), \"F2\");\n\t\taddSpaceTreeAction(new SpaceTreeMoveTo());\n\t\taddSpaceTreeAction(new DeleteSrc(), \"Delete\");\n\n\t\taddSpaceTreeAction(new OpenSearchItems(), \"f-accel-shift\");\n\n\t\taddSpaceTreeAction(new SpaceTreeDuplicate());\n\t\taddSpaceTreeAction(new SpaceTreeCopyTo());\n\n\t\taddSpaceTreeAction(new SetPermsSpace().requireSrcVisiblePerm([\"ui.apps.set.perms.space\", \"admin.node.configRoles.byAdmin\"]));\n\n\t\taddSpaceTreeAction(ImportRes.SINGLETON());\n\t\taddSpaceTreeAction(ImportFolder.SINGLETON());\n\t\taddSpaceTreeAction(new ImportFiles());\n\t\taddSpaceTreeAction(new ImportScar());\n\n\t\taddSpaceTreeAction(ExportRes.SINGLETON());\n\t\t//addSpaceTreeAction(new ExportScar()); //ajouté dans addShortDescAction\n\t\taddSpaceTreeAction(new ExportScwsp());\n\n\t\t//#### Colonnes des taches\n\t\tfunction addColTask(colDef: GridColDef, sortKey: number, registerCodefAsSvcCode?: string) {\n\t\t\tif (registerCodefAsSvcCode) {\n\t\t\t\treg.registerSvc(registerCodefAsSvcCode, 1, colDef);\n\t\t\t\treg.addSvcToList(\"columns:wspApp:searches:task\", colDef.id, 1, registerCodefAsSvcCode, sortKey);\n\t\t\t} else {\n\t\t\t\treg.addToList(\"columns:wspApp:searches:task\", colDef.id, 1, colDef, sortKey);\n\t\t\t}\n\t\t}\n\n\t\tfunction addColTaskExport(colDef: SearchExportColumn<IRegPointer<IWspUiEnv>>, sortKey?: number) {\n\t\t\treg.addToList(\"columns:wspApp:searches-export:task\", colDef.getId(), 1, colDef, sortKey);\n\t\t}\n\n\t\t//#### Colonnes des items\n\t\tfunction addCol(colDef: GridColDef, sortKey: number) {\n\t\t\treg.addToList(\"columns:wspApp:searches:item\", colDef.id, 1, colDef, sortKey);\n\t\t}\n\n\t\tfunction addColExport(colDef: SearchExportColumn<IRegPointer<IWspUiEnv>>, sortKey?: number) {\n\t\t\treg.addToList(\"columns:wspApp:searches-export:item\", colDef.getId(), 1, colDef, sortKey);\n\t\t}\n\n\t\t// srcCode\n\t\taddCol(new GridColDef('srcCode').setLabel(\"Item\").setSortable(true)\n\t\t\t.setFlex('20%', 1, 1).setMinWidth('5em')\n\t\t\t.setCellBuilder(new CellBuilderSrcIconCode(this.reg, this.wsp.wspMetaUi, true, this.wsp.srcUriItemsSortFn)), 0);\n\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('srcCode').setColDef(new SearchFuncUri2LeafName(\"srcUri\")).setLabel(\"Code\"), 0);\n\n\t\taddCol(new GridColDef('title').setMinWidth('3em')\n\t\t\t.setLabel(\"Titre\").setSortable(true)\n\t\t\t.setFlex('30%', 2, 2)\n\t\t\t.setCellBuilder(new CellBuilderString('itTi')), 10);\n\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('title').setColDef(new SearchFuncProps(\"itTi\")).setLabel(\"Titre\"), 30);\n\n\t\taddCol(new GridColDef('type').setMinWidth('3em')\n\t\t\t.setLabel(\"Type d'item\").setSortable(true)\n\t\t\t.setFlex('20%', 2, 2)\n\t\t\t.setCellBuilder(new CellBuilderItModel(this.reg, this.wsp.wspMetaUi)), 20);\n\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('type').setColDef(\n\t\t\tnew SearchFuncTranslateStr(\"itModel\").setDict(() => {\n\t\t\t\tconst it = this.wsp.wspMetaUi.getItemTypes();\n\t\t\t\tconst dict: { [key: string]: string } = {};\n\t\t\t\tit.forEach(entry => {if (!entry.isFamily(EItemTypeFamily.task)) dict[entry.getModel()] = entry.getTitle()});\n\t\t\t\treturn dict;\n\t\t\t})\n\t\t).setExportStatus(ESearchExportColumnStatus.exportable).setLabel(\"Type d'item\"));\n\n\t\t// space\n\t\taddCol(new GridColDef('space')\n\t\t\t.setLabel(\"Espace\").setSortable(true)\n\t\t\t.setFlex('25%', 2, 2).setMinWidth('2em')\n\t\t\t.setCellBuilder(new CellBuilderSpace()), 20);\n\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('space').setColDef(new SearchFuncUri2Space(\"srcUri\")).setLabel(\"Espace\"), 20);\n\n\t\t// date\n\t\taddCol(new GridColDef('dt')\n\t\t\t.setLabel(\"Modif.\").setDescription(\"Date de dernière modification\").setSortable(true)\n\t\t\t.setFlex('6em', 1, 1).setMinWidth('2em')\n\t\t\t.setCellBuilder(new CellBuilderDate('srcDt')), 30);\n\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('dt').setColDef(new SearchFuncLong2Date(\"srcDt\")).setLabel(\"Date modification\").setDescription(\"Date de la dernière modification\").setExportStatus(ESearchExportColumnStatus.exportable));\n\n\t\tif (reg.env.universe.config.backEnd !== 'fs') {\n\t\t\taddCol(new GridColDef('by')\n\t\t\t\t.setLabel(\"Par\").setSortable(true).setMinWidth('2em')\n\t\t\t\t.setFlex('6em', 1, 1)\n\t\t\t\t.setCellBuilder(new CellBuilderAccount(this.reg, 'srcUser')), 31);\n\t\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('by').setColDef(\n\t\t\t\tnew SearchFuncAccountProp(\"srcUser\")\n\t\t\t).setLabel(\"Dernier contributeur\").setExportStatus(ESearchExportColumnStatus.exportable));\n\n\t\t}\n\n\t\tconst wspDefProps = wsp.wspDefProps;\n\t\tif (wspDefProps.drfRefWsp) (await import(\"back/wsp/areas/drfOverrides.js\")).initDrfReg(reg);\n\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\t\tif (wspDefProps.drvAxis) (await import(\"back/wsp/areas/drvOverrides.js\")).initDrvReg(reg);\n\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\n\t\tif (wsp.hasFeature(\"git\")) {\n\t\t\tconst gitSt = (wsp.infoWsp.srcFields as JGitSrcFields).gitSt;\n\t\t\tif (gitSt != null && gitSt !== (-1 as EGitState.none)) {\n\t\t\t\t(await import(\"back/wsp/areas/gitOverrides.js\")).initGitReg(reg);\n\t\t\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\t\t\t}\n\t\t}\n\n\t\tif (wsp.hasFeature(\"liveCycle\") && wsp.wspMetaUi.getLcTransitions() !== null) {\n\t\t\treg.addToList(\"ribbon:item\", \"lc\", 1, RibbonLc, 20);\n\n\t\t\tconst listTr = new (await import(\"back/wsp/actions/lcTaskActions.js\")).ItemListTransition() as ItemListTransition<IShortDescCtx>;\n\t\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\t\t\tconst lcName = this.wsp.wspMetaUi.getLcName();\n\t\t\taddShortDescAction(listTr, null, -10);\n\n\t\t\taddCol(new GridColDef(\"lc\")\n\t\t\t\t\t.setFlex('25%', 2, 2).setMinWidth('2em')\n\t\t\t\t\t.setCellBuilder(new CellBuilderLc(this.wsp.wspMetaUi))\n\t\t\t\t\t.setLabel(lcName),\n\t\t\t\t15\n\t\t\t);\n\t\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('lcSt').setColDef(\n\t\t\t\tnew SearchFuncTranslateStr(\"lcSt\").setDict(() => {\n\t\t\t\t\tconst map: { [key: string]: string } = {};\n\t\t\t\t\tconst lcStates = this.wsp.wspMetaUi.getLcStates();\n\t\t\t\t\tfor (const st of lcStates.values()) {\n\t\t\t\t\t\tmap[st.code] = st.name;\n\t\t\t\t\t}\n\t\t\t\t\treturn map;\n\t\t\t\t})\n\t\t\t).setLabel(lcName).setExportStatus(ESearchExportColumnStatus.exportable));\n\t\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('lcDt').setColDef(\n\t\t\t\tnew SearchFuncLong2Date(\"lcDt\")\n\t\t\t).setLabel(`${lcName} - date d'affectation`).setDescription(`${lcName} : date de la dernière modification`).setExportStatus(ESearchExportColumnStatus.exportable));\n\t\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('lcBy').setColDef(\n\t\t\t\tnew SearchFuncAccountProp(\"lcBy\")\n\t\t\t).setLabel(`${lcName} - affecté par`).setExportStatus(ESearchExportColumnStatus.exportable));\n\n\n\t\t\tconst gridColLc = new GridColDef(\"lc\")\n\t\t\t\t.setFlex(\"1rem\", 0, 0)\n\t\t\t\t.setCellBuilder(new CellBuilderLcFlag(this.wsp.wspMetaUi).setIconClass(\"lcState\"))\n\t\t\t\t.setSkin(\"wsp-explorer/grid/lc\")\n\t\t\t\t.setLabel(lcName);\n\t\t\treg.addToList('columns:wspExplorer:secondaryCols', 'lc', 1, gridColLc, 5);\n\t\t\treg.addToList('columns:netItems:secondaryCols', 'lc', 1, gridColLc, 5);\n\n\t\t\treg.registerSkin(\"wsp-explorer/grid/lc\", 1, /* language=CSS */ `\n\t\t  .lcState {\n\t\t\t  background-repeat: no-repeat;\n\t\t\t  background-position: center;\n\t\t\t  background-size: contain;\n\t\t\t  filter: var(--filter);\n\t\t  }\n\n\t\t  .lc {\n\t\t\t  border: none !important;\n\t\t  }\n\t\t\t`);\n\n\t\t}\n\n\t\tif (wsp.hasFeature(\"resp\") && wsp.wspMetaUi.hasResps) {\n\t\t\t// - Items\n\t\t\tconst listRespsItems = wsp.wspMetaUi.listResps('item');\n\t\t\tif (listRespsItems) {\n\t\t\t\tlistRespsItems.forEach((entry) => {\n\t\t\t\t\taddCol(new GridColDef('resp.' + entry.code)\n\t\t\t\t\t\t.setLabel(entry.name)\n\t\t\t\t\t\t.setDescription(entry.desc)\n\t\t\t\t\t\t.setSortable(true)\n\t\t\t\t\t\t.setMinWidth('4em')\n\t\t\t\t\t\t.setFlex('2em', 1, 1)\n\t\t\t\t\t\t.setCellBuilder(\n\t\t\t\t\t\t\tentry.userCard === 'single' ?\n\t\t\t\t\t\t\t\tnew CellBuilderResp(entry.code, reg, 'rspUsrs', false) :\n\t\t\t\t\t\t\t\tnew CellBuilderResps(entry.code, reg, 'rspUsrs', false)\n\t\t\t\t\t\t), 100);\n\n\t\t\t\t\taddColExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('resp.' + entry.code).setColDef(\n\t\t\t\t\t\tnew SearchFuncAccountProp(new SearchFuncResponsibles(entry.code))\n\t\t\t\t\t).setLabel(entry.name).setExportStatus(ESearchExportColumnStatus.exportable));\n\n\t\t\t\t})\n\t\t\t}\n\t\t\treg.addToList(\"ribbon:item\", \"resp\", 1, RibbonResp, 20);\n\t\t\tconst setResp = new (await import(\"back/wsp/actions/itemActions.js\")).ItemsSetResonsabilities() as ItemsSetResonsabilities<IShortDescCtx>;\n\t\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\t\t\taddSpaceTreeAction(setResp, null, -10);\n\t\t\treg.addToList(\"actions:item:burger\", setResp.getId(), 1, setResp, -10);\n\t\t\t// - Tasks\n\t\t\tif (wsp.hasFeature(\"tasks\")) {\n\t\t\t\tconst listRespsTasks = wsp.wspMetaUi.listResps('task');\n\t\t\t\tif (listRespsTasks) {\n\t\t\t\t\tlistRespsTasks.forEach((entry) => {\n\t\t\t\t\t\taddColTask(new GridColDef(`resp.${entry.code}`)\n\t\t\t\t\t\t\t\t.setLabel(entry.name)\n\t\t\t\t\t\t\t\t.setDescription(entry.desc)\n\t\t\t\t\t\t\t\t.setSortable(true)\n\t\t\t\t\t\t\t\t.setMinWidth('4em')\n\t\t\t\t\t\t\t\t.setFlex('2em', 1, 1)\n\t\t\t\t\t\t\t\t.setCellBuilder(\n\t\t\t\t\t\t\t\t\tentry.userCard === 'single' ?\n\t\t\t\t\t\t\t\t\t\tnew CellBuilderResp(entry.code, reg, 'rspUsrs', false) :\n\t\t\t\t\t\t\t\t\t\tnew CellBuilderResps(entry.code, reg, 'rspUsrs', false)\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t100,\n\t\t\t\t\t\t\t`wsp-columns-resp-${entry.code}`);\n\t\t\t\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('resp.' + entry.code).setColDef(\n\t\t\t\t\t\t\tnew SearchFuncAccountProp(new SearchFuncResponsibles(entry.code))\n\t\t\t\t\t\t).setLabel(entry.name).setExportStatus(ESearchExportColumnStatus.exportable));\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tif (wsp.hasFeature(\"tasks\") && wsp.wspMetaUi.hasTasks) {\n\t\t\tawait import(\"back/wsp/actions/taskActions.js\");\n\t\t\tif (this._lastWspMetaUi !== this.wsp.wspMetaUi) return; //raceCond\n\t\t\tconst tasksIt: ItemTypeTask[] = wsp.wspMetaUi.getItemTypes().filter((entry) => entry.isFamily(EItemTypeFamily.task)) as ItemTypeTask[];\n\t\t\treg.addToList(\"wspApp:tools:rb\", \"tasks\", 1, new TasksArea(), 1);\n\t\t\treg.addToList(\"ribbon:item\", \"tasks\", 1, RibbonTasks, 30);\n\n\t\t\treg.addToList(\"wspApp:tools:br\", \"taskSearches\", 1, new SearchesArea('taskSearches', 'task')\n\t\t\t\t\t.setActionsLists([\"actions:wspApp:shortDesc:search:task\", \"actions:wsp:shortDesc:task\"])\n\t\t\t\t\t.setAccelKeysLists([\"accelkeys:wspApp:shortDesc:search:task\", \"accelkeys:wsp:shortDesc:task\"])\n\t\t\t\t, 1);\n\n\t\t\t// - itTi\n\t\t\taddColTask(new GridColDef('itTi')\n\t\t\t\t.setLabel(\"Libellé\").setSortable(true)\n\t\t\t\t.setFlex('6em', 1, 1).setMinWidth('3em')\n\t\t\t\t.setCellBuilder(new CellBuilderString('itTi').override('fillSearchColumns', (map: Map<string, string | ISearchFunc>) => {\n\t\t\t\t\tmap.set('itTi', null);\n\t\t\t\t\tmap.set('actStage', null);// besoin pour mise en forme conditionnelle\n\t\t\t\t})), 30);\n\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('title').setColDef(new SearchFuncProps(\"itTi\")).setLabel(\"Libellé\"), 30);\n\n\t\t\t// - deadline\n\t\t\tif (tasksIt.find(entry => entry.hasFeature(ETaskFeatures.deadline))) {\n\t\t\t\taddColTask(new GridColDef('deadline')\n\t\t\t\t\t.setLabel(\"Date limite\").setSortable(true)\n\t\t\t\t\t.setFlex('2em', 1, 1).setMinWidth('2em')\n\t\t\t\t\t.setCellBuilder(new CellBuilderTkDeadline()), 30);\n\t\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('deadline').setColDef(\n\t\t\t\t\tnew SearchFuncLong2Date(\"tkDeadline\").setFormat(ELong2DateStyles.short, null)\n\t\t\t\t).setLabel(\"Date limite\"), 100);\n\t\t\t}\n\n\t\t\t// - scheduling\n\t\t\tif (tasksIt.find(entry => entry.hasFeature(ETaskFeatures.scheduling))) {\n\t\t\t\taddColTask(new GridColDef('scheduling')\n\t\t\t\t\t.setLabel(\"Planification\").setDescription(\"Date de planification\").setSortable(true)\n\t\t\t\t\t.setFlex('2em', 1, 1).setMinWidth('2em')\n\t\t\t\t\t.setCellBuilder(new CellBuilderTkScheduledD()), 40);\n\t\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('scheduling').setColDef(\n\t\t\t\t\tnew SearchFuncLong2Date(\"tkScheduledDt\").setFormat(ELong2DateStyles.short, null)\n\t\t\t\t).setLabel(\"Planification\"), 100);\n\t\t\t}\n\n\t\t\t// -completedDt\n\t\t\taddColTask(new GridColDef('completedDt')\n\t\t\t\t.setLabel(\"Date de clôture\").setSortable(true)\n\t\t\t\t.setFlex('2em', 1, 1).setMinWidth('2em')\n\t\t\t\t.setCellBuilder(new CellBuilderDate('tkCompletedDt')), 200);\n\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('completedDt').setColDef(\n\t\t\t\tnew SearchFuncLong2Date(\"tkCompletedDt\").setFormat(ELong2DateStyles.short, null)\n\t\t\t).setLabel(\"Date de clôture\"), 110);\n\n\t\t\t// date modif\n\t\t\taddColTask(new GridColDef('dt')\n\t\t\t\t.setLabel(\"Modif.\").setDescription(\"Date de dernière modification\").setSortable(true)\n\t\t\t\t.setFlex('6em', 1, 1).setMinWidth('2em')\n\t\t\t\t.setCellBuilder(new CellBuilderDate('srcDt')), 300);\n\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('dt').setColDef(\n\t\t\t\tnew SearchFuncLong2Date(\"srcDt\")\n\t\t\t).setLabel(\"Date modification\").setDescription(\"Date de la dernière modification\").setExportStatus(ESearchExportColumnStatus.exportable));\n\n\t\t\t// - type\n\t\t\t/**addColTask(new GridColDef('type').setMinWidth('3em')\n\t\t\t\t.setLabel(\"Type\").setSortable(true)\n\t\t\t\t.setFlex('3em', 2, 2)\n\t\t\t\t.setCellBuilder(new CellBuilderItModel(this.reg, this.wsp.wspMetaUi)), 0);**/\n\t\t\taddColTask(new GridColDef('type').setLabel(\"\")\n\t\t\t\t\t.setMinWidth('1.5em').setMaxWidth('1.5em').setSortable(true)\n\t\t\t\t\t.setCellBuilder(new CellBuilderItModelFlagIcon(this.reg, this.wsp.wspMetaUi))\n\t\t\t\t, 0);\n\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('type').setColDef(\n\t\t\t\tnew SearchFuncTranslateStr(\"itModel\").setDict(() => {\n\t\t\t\t\tconst dict: { [key: string]: string } = {};\n\t\t\t\t\ttasksIt.forEach(entry => dict[entry.getModel()] = entry.getTitle());\n\t\t\t\t\treturn dict;\n\t\t\t\t})\n\t\t\t).setExportStatus(ESearchExportColumnStatus.exportable).setLabel(\"Type\"));\n\n\t\t\t// - LC (un LC potentiellement par type de task)\n\t\t\tif (tasksIt.find(entry => entry.getLcStates()?.size)) {\n\t\t\t\tconst lcName = LC_DEFAULT_NAME;\n\t\t\t\taddColTask(new GridColDef(\"lcSt\")\n\t\t\t\t\t\t.setFlex('3em', 2, 2)\n\t\t\t\t\t\t.setCellBuilder(new CellBuilderLc(this.wsp.wspMetaUi))\n\t\t\t\t\t\t.setLabel(lcName),\n\t\t\t\t\t50);\n\t\t\t\t// Par approximation, on estime que pour un code donné, le label sera unique quelque soit le lcTask\n\t\t\t\t// FIXME : coder une SearchFunc dédiée pour améliorer celà\n\t\t\t\tconst lcStates: Map<string, string> = new Map();\n\t\t\t\ttasksIt.forEach((entry) => {\n\t\t\t\t\tif (entry.getLcName()) {\n\t\t\t\t\t\tconst states = entry.getLcStates();\n\t\t\t\t\t\tstates?.forEach(entry => lcStates.set(entry.code, entry.name));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('lcSt-unified').setColDef(\n\t\t\t\t\tnew SearchFuncTranslateStr(\"lcSt\").setDict(() => {\n\t\t\t\t\t\tconst map: { [key: string]: string } = {};\n\t\t\t\t\t\tlcStates.forEach((value, key) => map[key] = value);\n\t\t\t\t\t\treturn map;\n\t\t\t\t\t})\n\t\t\t\t).setLabel(lcName).setExportStatus(ESearchExportColumnStatus.exportable));\n\n\t\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('lcDt').setColDef(\n\t\t\t\t\tnew SearchFuncLong2Date(\"lcDt\")\n\t\t\t\t).setLabel(`${lcName} - date d'affectation`).setDescription(`${lcName} : date de la dernière modification`).setExportStatus(ESearchExportColumnStatus.exportable));\n\t\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('lcBy').setColDef(\n\t\t\t\t\tnew SearchFuncAccountProp(\"lcBy\")\n\t\t\t\t).setLabel(`${lcName} - affecté par`).setExportStatus(ESearchExportColumnStatus.exportable));\n\n\t\t\t}\n\n\t\t\t/*\n\t\t\t// - LC : une col par LC (associé aux **tasks**)\n\t\t\tit.forEach((entry: ItemTypeTask) => {\n\t\t\t\tif (entry.isFamily(EItemTypeFamily.task) && entry.getLcName()) {\n\t\t\t\t\tconst entryLc = entry.getLcStates();\n\t\t\t\t\tif (entryLc && entryLc.size) {\n\t\t\t\t\t\taddColTaskExport(new SearchExportColumn<IRegPointer<IWspUiEnv>>('lcSt-' + entry.getModel()).setColDef(\n\t\t\t\t\tnew SearchFuncTranslateStr(\"lcSt\").setDict(() => {\n\t\t\t\t\t\t\t\tconst map: { [key: string]: string } = {};\n\t\t\t\t\t\t\t\tfor (const st of entryLc.values()) {\n\t\t\t\t\t\t\t\t\tmap[st.code] = st.name;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn map;\n\t\t\t\t\t\t\t})\n\t\t\t\t).setLabel(entry.getLcName()).setExportStatus(ESearchExportColumnStatus.exportable));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t*/\n\n\t\t\tfunction addShortDescTaskAction(action: IAction<IShortDescCtx> | string, accelKey?: string) {\n\t\t\t\tif (typeof action === 'object') {\n\t\t\t\t\treg.addToList(\"actions:wsp:shortDesc:task\", action.getId(), 1, action);\n\t\t\t\t\tif (accelKey) reg.addToList(\"accelkeys:wsp:shortDesc:task\", accelKey, 1, action);\n\t\t\t\t} else {\n\t\t\t\t\treg.addSvcToList(\"actions:wsp:shortDesc:task\", action, 1, action);\n\t\t\t\t\tif (accelKey) reg.addSvcToList(\"accelkeys:wsp:shortDesc:task\", accelKey, 1, action);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\taddShortDescTaskAction(\"tasks/focusTaskAction\");\n\t\t\taddShortDescTaskAction(ShortDescCopy.SINGLETON, \"c-accel\");\n\t\t\taddShortDescTaskAction(\"tasks/deleteTaskAction\", \"Delete\");\n\t\t}\n\t}\n}\n\nREG.reg.registerSkin('wsp-app', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t\tpadding-top: 2px;\n\t}\n\n\theader {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-width: 0;\n\t\tmin-height: 0;\n\t\tmax-height: 5em;\n\t\toverflow: hidden;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tuser-select: none;\n\t}\n\n\timg {\n\t\theight: 1.3em;\n\t}\n\n\th1 {\n\t\tmargin: .1em .5em;\n\t\tfont-size: 1em;\n\t\tletter-spacing: 0.1em;\n\t\ttext-align: center;\n\t}\n\n\thr {\n\t\tdisplay: none;\n\t}\n\n\tmain {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-width: 0;\n\t\tmin-height: 0;\n\t\tflex-direction: column;\n\t}\n`);\n\nREG.reg.registerSkin('wsp-app/c-workbench', 1, /* language=CSS */ ``);\n\ncustomElements.define('wsp-app', WspApp);\n\n\nclass WorkbenchTools extends ActionMenu<WspApp> {\n\n\tconstructor() {\n\t\tsuper(\"tools\");\n\t\tthis._label = \"Volets\";\n\t\tthis._description = \"Affichage des volets latéraux\";\n\t\t//this._icon = \"/@skin@/wsp/apps/wspApp/views.svg\"\n\t}\n\n\tgetActions(ctx: WspApp): IAction<WspApp>[] {\n\t\tif (!this._actions) {\n\t\t\tthis._actions = ctx.workbench.getAreaTools().map((a) => new ShowTool(a));\n\t\t\tthis._actions.push(new ActionSeparator());\n\t\t\tthis._actions.push(new ShowFlapTabs());\n\t\t}\n\t\treturn this._actions as IAction<WspApp>[];\n\t}\n}\n\nclass ShowTool extends ActionSignboardWrapper<WspApp> {\n\tconstructor(toolArea: IArea<WspApp>) {\n\t\tsuper(toolArea.getId());\n\t\tthis._wrapped = toolArea;\n\t}\n\n\tisToggle(ctx: WspApp): this is IActionToggle<WspApp> {return true}\n\n\tgetDatas(api: \"toggle\", ctx: WspApp): any {return ctx.workbench.getTab(this._wrapped.getId())?.selected || false}\n\n\texecute(ctx: WspApp, ev?: Event): any | \"noPreventDefault\" {\n\t\tctx.workbench.toggleAreaTool(this._wrapped.getId());\n\t}\n}\n\nclass ShowFlapTabs extends Action<WspApp> implements IActionToggle<WspApp> {\n\tconstructor() {\n\t\tsuper(\"showFlapTabs\");\n\t\tthis._label = \"Afficher les onglets\";\n\t}\n\n\tisToggle(ctx: WspApp): this is IActionToggle<WspApp> {return true}\n\n\tgetDatas(api: \"toggle\", ctx: WspApp): any {\n\t\treturn !ctx.workbench.classList.contains(\"hideFlapTabs\");\n\t}\n\n\texecute(ctx: WspApp, ev?: Event): any | \"noPreventDefault\" {\n\t\tconst showFlapTabs = !ctx.workbench.classList.toggle(\"hideFlapTabs\");\n\t\tconst persistUS = ctx.reg.getPersistUserStates();\n\t\tif (persistUS) persistUS.setUserDatas({showFlapTabs});\n\t}\n}\n\n\nclass OpenWspDocApp extends Action<WspApp> {\n\tconstructor() {\n\t\tsuper('openWspDoc');\n\t\tthis._label = \"Mode plan\";\n\t\tthis._icon = \"/@skin@/wsp/views/toc/toc.svg\";\n\t\tthis._group = \"other\";\n\t\tthis._visPerms = \"ui.wspDocApp\";\n\t}\n\n\tisVisible(ctx: WspApp): boolean {\n\t\t//XXX à remplacer en 5.1 par un deny sur role ~default de la perm ui.wspDocApp avec levelAuth max ?\n\t\tif (!ctx.reg.getPref<boolean>(\"wspDocApp.enabled\", false)) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\texecute(ctx: WspApp, ev?: Event): any | \"noPreventDefault\" {\n\t\tconst curr = new InfoReqCurrentItem();\n\t\tctx.infoBroker.dispatchInfo(curr, ctx);\n\t\tif (curr.shortDesc && ctx.reg.env.wsp.wspMetaUi.getItemType(curr.shortDesc.itModel).datas.asDoc) {\n\t\t\t(desk as AppFrameDeskFeat).findAndOpenApp({u: ctx.universe.getId(), wspDoc: ctx.wsp.code, doc: SRC.srcRef(curr.shortDesc)} as JWspDocAppDef, ev);\n\t\t} else {\n\t\t\t(desk as AppFrameDeskFeat).findAndOpenApp({u: ctx.universe.getId(), wspDoc: ctx.wsp.code} as JWspDocAppDef, ev);\n\t\t}\n\t}\n}\n\n"]}