{"version":3,"sources":["/@back@/commons/widgets/resizer.tsx"],"names":["EventsMgr","DOM","DOMSH","REG","BaseElement","Resizer","listeners","this","_listeners","findUpTo","parseInt","getAttribute","levels","setAttribute","toString","disabled","hasAttribute","v","setAttrBool","[object Object]","init","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","appendChild","document","createElement","onpointerdown","onPointerDown","ev","stopImmediatePropagation","preventDefault","parent","getParentElt","parentStyles","window","getComputedStyle","display","_horizontal","flexDirection","startsWith","emit","_prevResizables","_nextResizables","from","isRtl","direction","prevs","nexts","endsWith","prev","findFlatPrevSibling","isResizable","push","ResizeNodeH","ResizeNodeV","initOriginalSizes","next","findFlatNextSibling","initWriteMinSize","initReadMinSize","initRevertToOriginal","_startOffset","clientX","clientY","_onDrag","onDrag","bind","_onDragend","onDragend","documentElement","addEventListener","buttons","offset","delta","resize","tryResize","classList","add","removeEventListener","remove","elt","originalSize","offsetWidth","originalFlex","flex","style","minSize","maxSize","flexBasis","newSize","setStyle","offsetHeight","n","HTMLElement","hidden","reg","registerSkin","customElements","define","Collapser","panelPos","orient","panel","_a","parentElement","previousElementSibling","_b","nextElementSibling","closed","onclick","onClick","setHidden","refresh","show","hide","styles","reverse","left","top"],"mappings":"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","sourcesContent":["import {EventsMgr} from \"lib/commons/events\";\nimport {DOM} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {REG} from \"lib/commons/registry\";\nimport {BaseElement, OSkinableInit} from \"back/commons/basis\";\n\n/**\n * Widget pour retailler les box flex adjacents.\n * Le parent DOIT être display:flex.\n * Les box adjacents qui peuvent être retaillés DOIVENT posséder un attribut c-resizable=''.\n *\n * Par défaut l'implémentation gère automatiquement et dynamiquement l'orientation.\n * Pour améliorer l'affichage (débord dans le cross-axis), il est possible d'ajouter un\n * attribut c-orient=\"column\" c-orient=\"row\" qui fixe à priori l'orientation lorsqu'elle est connue.\n *\n * Le resizer peut rechercher des noeuds c-resizable='' parmi les oncles du resizer en spécifiant\n *  un attribut find-upto positif coorespondnat au nombre d'ancêtres à remonter.\n */\nexport class Resizer extends BaseElement {\n\n\tprotected _listeners: EventsMgr<IResizerEvents>;\n\n\tget listeners(): EventsMgr<IResizerEvents> {return this._listeners || (this._listeners = new EventsMgr())}\n\n\tget findUpTo(): number {return parseInt(this.getAttribute('find-upto'), 10) || 0}\n\n\tset findUpTo(levels: number) {this.setAttribute('find-upto', levels.toString())}\n\n\tget disabled() {return this.hasAttribute(\"disabled\")}\n\n\tset disabled(v: boolean) {DOM.setAttrBool(this, 'disabled', v)}\n\n\tprotected _initialize(init: OSkinableInit) {\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tsr.appendChild(document.createElement('slot'));\n\t\tthis.onpointerdown = this.onPointerDown;\n\t}\n\n\tprotected _horizontal: boolean;\n\tprotected _startOffset: number;\n\tprotected _prevResizables: (ResizeNodeH | ResizeNodeV)[];\n\tprotected _nextResizables: (ResizeNodeH | ResizeNodeV)[];\n\n\t/**\n\t * Pour étendre la zone de captation du resizing, cette méthode peut aussi être appelée par la\n\t * détection de l'event \"pointerdown\" sur d'autres éléments qui lui transfèrent simplement l'evt :\n\t *\n\t * otherElt.onpointerdown = function (this: HTMLElement, ev: PointerEvent) {\n\t * \t\tconst resizer = this.previousElementSibling as Resizer;\n\t *\t\tresizer.onPointerDown(ev);\n\t *\t}\n\t */\n\tonPointerDown(ev: PointerEvent) {\n\t\t//console.log(\"onDragstart:::\", ev);\n\t\tif (this.disabled) return;\n\t\tev.stopImmediatePropagation();\n\t\tev.preventDefault();\n\t\tlet parent = DOMSH.getParentElt(this);\n\t\tlet parentStyles = window.getComputedStyle(parent);\n\t\twhile (parentStyles.display !== 'flex') { //on saute les display:contents en particulier (slot...)\n\t\t\tparent = DOMSH.getParentElt(parent);\n\t\t\tif (!parent) return;\n\t\t\tparentStyles = window.getComputedStyle(parent);\n\t\t}\n\t\tthis._horizontal = parentStyles.flexDirection.startsWith('row');\n\t\tif (this._listeners) this._listeners.emit('resizeStart');\n\t\tthis._prevResizables = [];\n\t\tthis._nextResizables = [];\n\t\tlet findUpTo = this.findUpTo;\n\t\tlet from = this as Node;\n\t\tconst isRtl = window.getComputedStyle(this).direction === 'rtl';\n\t\twhile (findUpTo >= 0) {\n\t\t\tlet prevs: (ResizeNodeH | ResizeNodeV)[];\n\t\t\tlet nexts: (ResizeNodeH | ResizeNodeV)[];\n\t\t\tif (parentStyles.flexDirection.endsWith('reverse')) {\n\t\t\t\tprevs = (isRtl && this._horizontal) ? this._prevResizables : this._nextResizables;\n\t\t\t\tnexts = (isRtl && this._horizontal) ? this._nextResizables : this._prevResizables;\n\t\t\t} else {\n\t\t\t\tprevs = (isRtl && this._horizontal) ? this._nextResizables : this._prevResizables;\n\t\t\t\tnexts = (isRtl && this._horizontal) ? this._prevResizables : this._nextResizables;\n\t\t\t}\n\t\t\tfor (let prev = DOMSH.findFlatPrevSibling(from, isResizable); prev; prev = DOMSH.findFlatPrevSibling(prev, isResizable)) {\n\t\t\t\tprevs.push((this._horizontal ? new ResizeNodeH(prev) : new ResizeNodeV(prev)).initOriginalSizes());\n\t\t\t}\n\t\t\tfor (let next = DOMSH.findFlatNextSibling(from, isResizable); next; next = DOMSH.findFlatNextSibling(next, isResizable)) {\n\t\t\t\tnexts.push((this._horizontal ? new ResizeNodeH(next) : new ResizeNodeV(next)).initOriginalSizes());\n\t\t\t}\n\t\t\tdo {\n\t\t\t\tfrom = parent;\n\t\t\t\tparent = DOMSH.getParentElt(from);\n\t\t\t\tparentStyles = window.getComputedStyle(parent);\n\t\t\t\tfindUpTo--;\n\t\t\t} while (parent && findUpTo >= 0 && !parentStyles.flexDirection.startsWith(this._horizontal ? 'row' : 'column'));\n\t\t}\n\t\tfor (const prev of this._prevResizables) prev.initWriteMinSize();\n\t\tfor (const next of this._nextResizables) next.initWriteMinSize();\n\t\tfor (const prev of this._prevResizables) prev.initReadMinSize();\n\t\tfor (const next of this._nextResizables) next.initReadMinSize();\n\t\t//Pas de calcul des MAX-size car si un container contient un scroll sa position est alors perdue.\n\t\t//XXX A rendre configurable si besoin d'évaluer ce max-size via @c-resizable='toMax' par exemple.\n\t\t// for (const prev of this._prevResizables) prev.initWriteMaxSize();\n\t\t// for (const next of this._nextResizables) next.initWriteMaxSize();\n\t\t// for (const prev of this._prevResizables) prev.initReadMaxSize();\n\t\t// for (const next of this._nextResizables) next.initReadMaxSize();\n\t\tfor (const prev of this._prevResizables) prev.initRevertToOriginal();\n\t\tfor (const next of this._nextResizables) next.initRevertToOriginal();\n\t\tthis._startOffset = this._horizontal ? ev.clientX : ev.clientY;\n\n\t\tif (!this._onDrag) this._onDrag = this.onDrag.bind(this);\n\t\tif (!this._onDragend) this._onDragend = this.onDragend.bind(this);\n\t\tdocument.documentElement.addEventListener('pointermove', this._onDrag, true);\n\t\tdocument.documentElement.addEventListener('pointerup', this._onDragend, true);\n\t\tif (this._listeners) this._listeners.emit('resizing');\n\t}\n\n\tprotected _onDrag: (ev: PointerEvent) => boolean;\n\tprotected _onDragend: (ev: PointerEvent) => boolean;\n\n\tprotected onDrag(ev: PointerEvent) {\n\t\tif (ev.buttons === 0) {\n\t\t\t//Plus de buttons enfoncés, on sort.\n\t\t\tthis.onDragend(ev);\n\t\t\treturn;\n\t\t}\n\t\tif (!this._prevResizables) return;\n\t\tev.preventDefault();\n\t\tev.stopImmediatePropagation();\n\t\tconst offset = this._horizontal ? ev.clientX : ev.clientY;\n\t\tif (offset === 0) return;//bug chrome63 : au drop un event 'drag' avec tout à 0 est dispatché.\n\t\tlet delta = offset - this._startOffset;\n\t\tif (delta < 0) {\n\t\t\t//on commence par les précendents qui sont réduits\n\t\t\tfor (const resize of this._prevResizables) delta = resize.tryResize(delta);\n\t\t\tdelta = this._startOffset - offset /* on abondonne ce qu'on n'a pas réussit à réduire. */ + delta;\n\t\t\tfor (const resize of this._nextResizables) delta = resize.tryResize(delta);\n\t\t\tif (delta !== 0) {\n\t\t\t\t//Le maxSize a bloqué, on abondonne ce qu'on n'a pas réussit à augmenter.\n\t\t\t\tdelta = offset - this._startOffset + delta;\n\t\t\t\tfor (const resize of this._prevResizables) delta = resize.tryResize(delta);\n\t\t\t}\n\t\t} else {\n\t\t\t//on commence par les suivants qui sont réduits\n\t\t\tdelta = -delta;\n\t\t\tfor (const resize of this._nextResizables) delta = resize.tryResize(delta);\n\t\t\tdelta = offset - this._startOffset /* on abondonne ce qu'on n'a pas réussit à réduire. */ + delta;\n\t\t\tfor (const resize of this._prevResizables) delta = resize.tryResize(delta);\n\t\t\tif (delta !== 0) {\n\t\t\t\t//Le maxSize a bloqué, on abondonne ce qu'on n'a pas réussit à augmenter.\n\t\t\t\tdelta = this._startOffset - offset + delta;\n\t\t\t\tfor (const resize of this._nextResizables) delta = resize.tryResize(delta);\n\t\t\t}\n\t\t}\n\t\tthis.classList.add(\"resizing\");\n\t\tif (this._listeners) this._listeners.emit('resizing');\n\t}\n\n\tprotected onDragend(ev: PointerEvent) {\n\t\t//console.log(\"onDragend:::\", ev);\n\t\tdocument.documentElement.removeEventListener('pointermove', this._onDrag, true);\n\t\tdocument.documentElement.removeEventListener('pointerup', this._onDragend, true);\n\t\tif (!this._prevResizables) return;\n\t\tev.preventDefault();\n\t\tev.stopImmediatePropagation();\n\t\tthis._prevResizables = null;\n\t\tthis._nextResizables = null;\n\t\tthis.classList.remove(\"resizing\");\n\t\tif (this._listeners) this._listeners.emit('resizeEnd');\n\t}\n\n}\n\n/** Events émis par c-resizer. */\nexport type IResizerEvents = {\n\tresizeStart: () => void\n\tresizing: () => void\n\tresizeEnd: () => void\n}\n\nclass ResizeNodeH {\n\n\toriginalFlex: string;\n\toriginalSize: number;\n\tminSize: number;\n\tmaxSize: number;\n\n\tconstructor(public elt: HTMLElement) {}\n\n\tinitOriginalSizes() {\n\t\tthis.originalSize = this.elt.offsetWidth;\n\t\tthis.originalFlex = window.getComputedStyle(this.elt).flex;\n\t\treturn this;\n\t}\n\n\tinitWriteMinSize() {\n\t\tthis.elt.style.flex = \"0 0 0\";\n\t}\n\n\tinitReadMinSize() {\n\t\tthis.minSize = this.elt.offsetWidth;\n\t}\n\n\tinitWriteMaxSize() {\n\t\tthis.elt.style.flex = \"0 0 10000px\";\n\t}\n\n\tinitReadMaxSize() {\n\t\tthis.maxSize = this.elt.offsetWidth;\n\t}\n\n\tinitRevertToOriginal() {\n\t\tthis.elt.style.flex = this.originalFlex || \"1 1 auto\";\n\t\tthis.elt.style.flexBasis = this.originalSize + 'px';\n\t}\n\n\t/**\n\t * Tente de modifier l'original size par ce delta.\n\t * Retourne le delta qui n'a pas été pris en compte.\n\t */\n\ttryResize(delta: number): number {\n\t\tconst newSize = this.originalSize + delta;\n\t\tif (newSize < this.minSize) {\n\t\t\tDOM.setStyle(this.elt, 'flex-basis', this.minSize + 'px');\n\t\t\treturn newSize - this.minSize;\n\t\t}\n\t\tif (newSize > this.maxSize) {\n\t\t\tDOM.setStyle(this.elt, 'flex-basis', this.maxSize + 'px');\n\t\t\treturn newSize - this.maxSize;\n\t\t}\n\t\tDOM.setStyle(this.elt, 'flex-basis', newSize + 'px');\n\t\treturn 0;\n\t}\n}\n\nclass ResizeNodeV extends ResizeNodeH {\n\n\tinitOriginalSizes() {\n\t\tthis.originalSize = this.elt.offsetHeight;\n\t\tthis.originalFlex = window.getComputedStyle(this.elt).flex;\n\t\treturn this;\n\t}\n\n\tinitReadMinSize() {\n\t\tthis.minSize = this.elt.offsetHeight;\n\t}\n\n\tinitReadMaxSize() {\n\t\tthis.maxSize = this.elt.offsetHeight;\n\t}\n}\n\nfunction isResizable(n: Node): n is HTMLElement {return (n instanceof HTMLElement) && n.hasAttribute('c-resizable') && !n.hidden}\n\nREG.reg.registerSkin('c-resizer', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: none;\n\t\tdisplay: flex;\n\t\tmargin: -2px;\n\t\tpadding: 2px;\n\t\tz-index: 1;\n\t\tbackground: var(--resizer-bgcolor, var(--border-color));\n\t\tbackground-clip: content-box;\n\t\ttouch-action: none;\n\t}\n\n\t:host([c-orient=\"row\"]) {\n\t\tmargin-top: 0 !important;\n\t\tmargin-bottom: 0 !important;\n\t\tpadding-top: 0 !important;\n\t\tpadding-bottom: 0 !important;\n\t\tflex-direction: row;\n\t}\n\n\t:host([c-orient=\"row\"]:not([disabled])) {\n\t\tcursor: e-resize;\n\t}\n\n\t:host([c-orient=\"column\"]) {\n\t\tmargin-inline-start: 0 !important;\n\t\tmargin-inline-end: 0 !important;\n\t\tpadding-inline-start: 0 !important;\n\t\tpadding-inline-end: 0 !important;\n\t\tflex-direction: column;\n\t}\n\n\t:host([c-orient=\"column\"]:not([disabled])) {\n\t\tcursor: n-resize;\n\t}\n\n\t:host(:hover:not([disabled])) {\n\t\tbackground-clip: border-box;\n\t\tbackground-color: var(--resizer-hover-bgcolor, #204b8877);\n\t}\n\n\t:host(.resizing) {\n\t\tbackground-clip: content-box !important;\n\t\tmargin: -100px;\n\t\tpadding: 100px;\n\t}\n\n\t/* évite l'affichage de scrollbars si resizers au bord (margin négatif) */\n\t:host([disabled]) {\n\t\tmargin: 0;\n\t\tpadding: 0;\n\t}\n`);\n\ncustomElements.define('c-resizer', Resizer);\n\n\nexport class Collapser extends BaseElement {\n\n\tget panelPos(): 'prev' | 'next' {return this.getAttribute('panel-pos') as any}\n\n\tget orient(): 'row' | 'column' {return this.getAttribute('c-orient') as any}\n\n\tget panel(): Element {\n\t\tswitch (this.panelPos) {\n\t\tcase \"prev\":\n\t\t\treturn this.parentElement?.previousElementSibling;\n\t\tcase \"next\":\n\t\t\treturn this.parentElement?.nextElementSibling;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget closed(): boolean {return this.panel?.hasAttribute(\"hidden\") || false}\n\n\tprotected _initialize(init: OSkinableInit) {\n\t\tthis.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tthis.onclick = this.onClick;\n\t}\n\n\tshow() {\n\t\tconst panel = this.panel;\n\t\tif (panel && DOM.setHidden(panel, false)) {\n\t\t\tif (this.parentElement instanceof Resizer) this.parentElement.disabled = false;\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\thide() {\n\t\tconst panel = this.panel;\n\t\tif (panel && DOM.setHidden(panel, true)) {\n\t\t\tif (this.parentElement instanceof Resizer) this.parentElement.disabled = true;\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tonClick() {\n\t\tconst panel = this.panel;\n\t\tif (panel) {\n\t\t\tif (panel.hasAttribute(\"hidden\")) this.show();\n\t\t\telse this.hide();\n\t\t}\n\t}\n\n\tprotected _refresh() {\n\t\tconst styles = window.getComputedStyle(this);\n\t\tconst reverse = styles.flexDirection.endsWith(\"-reverse\");\n\t\tif (this.orient === \"row\") {\n\t\t\tconst left = (styles.direction === 'ltr') === (this.panelPos === \"prev\");\n\t\t\tthis.setAttribute(\"c-state\", (left !== reverse ? 'left' : 'right') + (this.closed ? \"Closed\" : \"Opened\"));\n\t\t} else {\n\t\t\tconst top = (this.panelPos === \"prev\");\n\t\t\tthis.setAttribute(\"c-state\", (top !== reverse ? 'top' : 'bottom') + (this.closed ? \"Closed\" : \"Opened\"));\n\t\t}\n\t}\n}\n\n/** Stylage adapté à des resizer d'au moins 6px d'épaisseur. */\nREG.reg.registerSkin('c-collapser', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tcursor: pointer;\n\t\tbackground-size: 6px;\n\t\tbackground-position: center;\n\t}\n\n\t:host([c-orient=\"row\"]) {\n\t\tbackground-repeat: repeat-y;\n\t\theight: 35px;\n\t\talign-self: center;\n\t}\n\n\t:host([c-orient=\"column\"]) {\n\t\tbackground-repeat: repeat-x;\n\t\theight: 35px;\n\t\tjustify-self: center;\n\t}\n\n\t:host(:hover) {\n\t\tbackground-color: var(--pressed-bgcolor);\n\t\toutline: 1px dotted var(--border-color);\n\t}\n\n\t:host([c-state=leftOpened]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 3 6\" fill=\"%23b89a62\"><path d=\"M 3,0 1.13,3 3,6 0,3 Z\"/></svg>');\n\t}\n\n\t:host([c-state=leftClosed]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 3 6\" fill=\"%23b89a62\"><path d=\"M 0,0 1.87,3 0,6 3,3 Z\"/></svg>');\n\t}\n\n\t:host([c-state=righttOpened]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 3 6\" fill=\"%23b89a62\"><path d=\"M 0,0 1.87,3 0,6 3,3 Z\"/></svg>');\n\t}\n\n\t:host([c-state=rightClosed]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 3 6\" fill=\"%23b89a62\"><path d=\"M 3,0 1.13,3 3,6 0,3 Z\"/></svg>');\n\t}\n\n\t:host([c-state=topOpened]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 3\" fill=\"%23b89a62\"><path d=\"M 0,3 3,1.13 6,3 3,0 Z\"/></svg>');\n\t}\n\n\t:host([c-state=topClosed]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 3\" fill=\"%23b89a62\"><path d=\"M 0,0 3,1.87 6,0 3,3 Z\"/></svg>');\n\t}\n\n\t:host([c-state=bottomOpened]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 3\" fill=\"%23b89a62\"><path d=\"M 0,0 3,1.87 6,0 3,3 Z\"/></svg>');\n\t}\n\n\t:host([c-state=bottomClosed]) {\n\t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 3\" fill=\"%23b89a62\"><path d=\"M 0,3 3,1.13 6,3 3,0 Z\"/></svg>');\n\t}\n`);\n\n// /** Stylage petit bouton qui déborde pour des resizers très étroits. */\n// REG.reg.registerSkin('c-collapser/smallbutton', 1, /* language=CSS */ `\n// \t:host {\n// \t\tdisplay: flex;\n// \t\tcursor: pointer;\n// \t\talign-self: start;\n// \t\tbackground-size: contain;\n// \t\tbackground-repeat: no-repeat;\n// \t\tbackground-position: center;\n// \t\tborder-radius: .3em;\n// \t}\n//\n// \t:host(:hover) {\n// \t\tbackground-color: var(--pressed-bgcolor);\n// \t\toutline: 1px dotted var(--border-color);\n// \t}\n//\n// \t:host([c-state=leftOpened]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 3,0 1.13,3 3,6 0,3 Z\"/><path d=\"M 6,0 4.13,3 6,6 3,3 Z\"/></svg>');\n// \t\tpadding: .6em .4em;\n// \t\tmargin: 0 -.4em;\n// \t}\n//\n// \t:host([c-state=leftClosed]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 0,0 1.87,3 0,6 3,3 Z\"/><path d=\"M 3,0 4.87,3 3,6 6,3 Z\"/></svg>');\n// \t\tpadding: .6em .4em;\n// \t\tmargin: 0 -.6em 0 -.2em;\n// \t}\n//\n// \t:host([c-state=righttOpened]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 0,0 1.87,3 0,6 3,3 Z\"/><path d=\"M 3,0 4.87,3 3,6 6,3 Z\"/></svg>');\n// \t\tpadding: .6em .4em;\n// \t\tmargin: 0 -.4em;\n// \t}\n//\n// \t:host([c-state=rightClosed]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 3,0 1.13,3 3,6 0,3 Z\"/><path d=\"M 6,0 4.13,3 6,6 3,3 Z\"/></svg>');\n// \t\tpadding: .6em .4em;\n// \t\tmargin: 0 -.2em 0 -.6em;\n// \t}\n//\n// \t:host([c-state=topOpened]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 0,3 3,1.13 6,3 3,0 Z\"/><path d=\"M 0,6 3,4.13 6,6 3,3 Z\"/></svg>');\n// \t\tpadding: .4em .6em;\n// \t\tmargin: -.4em 0;\n// \t}\n//\n// \t:host([c-state=topClosed]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 0,0 3,1.87 6,0 3,3 Z\"/><path d=\"M 0,3 3,4.87 6,3 3,6 Z\"/></svg>');\n// \t\tpadding: .4em .6em;\n// \t\tmargin: -.6em 0 -.2em 0;\n// \t}\n//\n// \t:host([c-state=bottomOpened]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 0,0 3,1.87 6,0 3,3 Z\"/><path d=\"M 0,3 3,4.87 6,3 3,6 Z\"/></svg>');\n// \t\tpadding: .4em .6em;\n// \t\tmargin: -.4em 0;\n// \t}\n//\n// \t:host([c-state=bottomClosed]) {\n// \t\tbackground-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 6 6\" fill=\"%23b89a62\"><path d=\"M 0,3 3,1.13 6,3 3,0 Z\"/><path d=\"M 0,6 3,4.13 6,6 3,3 Z\"/></svg>');\n// \t\tpadding: .4em .6em;\n// \t\tmargin: -.2em 0 -.6em 0;\n// \t}\n// `);\n\ncustomElements.define('c-collapser', Collapser);"]}