{"version":3,"sources":["/@back@/wsp/areas/gitOverrides.tsx"],"names":["CellBuilderFlagIcon","GridColDef","REG","DOM","JSX","WSP_GIT","DiffBarPanelAction","NavigatorArea","LANG","NavigatorFacetText","CellBuilderGitFlag","[object Object]","this","iconWidth","iconFilter","row","st","getSimpleState","super","_getValue","getGitStateLabel","reg","registerSkin","initGitReg","gitColDef","setFlex","setCellBuilder","setSkin","setLabel","setDescription","isAvailable","grid","_b","_a","env","wsp","infoWsp","srcFields","gitSt","addToList","GitHeadDiffAction","id","_label","ctx","ev","import","GitHeadDiffPanel","initPanel","setIcon","setEmptyTree","n","createElement","label","level","setBuildFacets","async","nav","fields","NavigatorFacetGitChanges","setActionsLists","setAccelKeysLists","lstnFocusWin","universe","httpFrames","web","fetchSvc","encodeURIComponent","code","window","addEventListener","onRegClose","add","removeEventListener","skin","lastDatas","initRoot","append","class","buildTextInput","navigatorBtns","exp","sharedXmlDoc","setAttribute","pushIfDefined","getTextCriterion"],"mappings":"OAAQA,wBAAoB;OACpBC,eAAgC;OAC1BC,QAAI;OAEVC,IAAKC,QAAI;OACMC,YAAQ;OACvBC,uBAAkE;OAClEC,kBAAc;OAEdC,SAAK;OACMC,uBAAmB;AAGtC,MAAMC,2BAA2BV,oBAAjCW;AAECC,KAAAC,UAAY;AAEZD,KAAAE,WAAa,gBAEHH,SAASI,KAClB,MAAMC,GAAKX,QAAQY,eAAeC,MAAMC,UAAUJ;AAClD,OAAOC,KAAO,WAAaA,KAAO,OAAS,SAAWA,GAAK,OAAS,GAG3DL,UAAUI,KACnB,OAAOV,QAAQe,iBAAiBf,QAAQY,eAAeC,MAAMC,UAAUJ,QAIzEb,IAAImB,IAAIC,aAAa,wBAAyB,EAAsB;OAkB9D,SAAUC,WAAWF,KAE1B,MAAMG,UAAY,IAAIvB,WAAW,OAC/BwB,QAAQ,OAAQ,EAAG,GACnBC,eAAe,IAAIhB,mBAAmB,UACtCiB,QAAQ,yBACRC,SAAS,IACTC,eAAe;AAGjBL,UAAUM,YAAc,SAAUC;AACjC,QAAOC,IAACC,GAAAZ,IAAIa,IAAIC,IAAIC,WAAO,MAAAH,UAAA,OAAA,EAAAA,GAAEI,aAA2B,MAAAL,UAAA,OAAA,EAAAA,GAAEM,QAAS;AAGpEjB,IAAIkB,UAAU,oCAAqC,MAAO,EAAGf,UAAW;AACxEH,IAAIkB,UAAU,iCAAkC,MAAO,EAAGf,UAAW;AACrEH,IAAIkB,UAAU,sCAAuC,MAAO,EAAGf,UAAW;AAE1EH,IAAIkB,UAAU,+BAAgC,MAAO,EAAGf;AAIxD,MAAMgB,0BAA0BlC,mBAE/BK,YAAY8B,IACXvB,MAAMuB,IAAM;AACZ7B,KAAK8B,OAAS,aAGf/B,iBAAiBgC,IAAkBC,IAClC,OAAO,WAAWC,OAAM,6CAA2CC,mBAAmBC,UAAUnC,KAAM+B,MAIxGtB,IAAIkB,UAAU,sBAAuB,UAAW,EAAG,IAAIC;AAEvDnB,IAAIkB,UAAU,kBAAmB,aAAc,EAAG,IAAIhC,cAAc,cACjEqB,SAAS,SAASC,eAAe,4BACjCmB,QAAQ,8CACRC,aAAcC,GAAM9C,IAAA+C,cAAA,QAAA,CAAOC,MAAM,6BAA6BC,MAAM,UACpEC,eAAeC,MAAOC,IAAKC,SAAW,IAAIC,yBAAyBD,SACnEE,gBAAgB,CAAC,2BAA4B,0BAC7CC,kBAAkB,CAAC,6BAA8B,4BACjD;AAGH,MAAMC,aAAe,KACpBxC,IAAIa,IAAI4B,SAASC,WAAWC,IAAIC,SAAS,WAAY,sBAAuB,SAAWC,mBAAmB7C,IAAIa,IAAIC,IAAIgC;AAEvHC,OAAOC,iBAAiB,QAASR;AACjCxC,IAAIiD,WAAWC,IAAI,KAClBH,OAAOI,oBAAoB,QAASX,uBAQhC,MAAOH,iCAAiCjD,mBAEnCE,WACTC,KAAK6D,KAAO,CAAC,2BAGd9D,cAAc6C,IAAgBkB,WAC7B9D,KAAK+D,SAASnB,KAAKoB,OAClBxE,IAAA+C,cAAA,MAAA,CAAK0B,MAAM,KAAKjE,KAAKkE,eAAetB,IAAKkB,WAAYlB,IAAIuB,gBAIjDpE,gBACT,MAAMqE,IAAM7E,IAAI8E,eAAe9B,cAAc;AAC7C6B,IAAIE,aAAa,OAAQ;AACzBF,IAAIE,aAAa,YAAa;AAC9BF,IAAIE,aAAa,OAAQ;AACzBF,IAAIE,aAAa,UAAW;AAC5B,OAAO1E,KAAK2E,cAAc,CAACH,KAAMpE,KAAKwE","sourcesContent":["import {CellBuilderFlagIcon} from \"back/commons/widgets/grid-libs\";\nimport {GridColDef, IGrid, IGridDataRow} from \"back/commons/widgets/grid-core\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IWspUiEnv} from \"lib/wsp/wsp\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {JGitSrcFields, WSP_GIT} from \"lib/wsp/git\";\nimport {DiffBarPanelAction, IDiffBarPanel, IWedDiffBar, JWedDiffBarParams} from \"back/edit/wed/features/diffBar\";\nimport {NavigatorArea} from \"back/wsp/areas/wspWorkbench\";\nimport {JLastDatas} from \"lib/commons/lastDatas\";\nimport {LANG} from \"lib/commons/lang\";\nimport {Navigator, NavigatorFacetText} from \"back/wsp/views/navigator\";\n\n\nclass CellBuilderGitFlag extends CellBuilderFlagIcon {\n\n\ticonWidth = \".8rem\";\n\n\ticonFilter = \"var(--filter)\";\n\n\tprotected _getIcon(row: IGridDataRow): string {\n\t\tconst st = WSP_GIT.getSimpleState(super._getValue(row));\n\t\treturn st !== \"insynch\" && st !== \"none\" ? \"--git-\" + st + \"-url\" : \"\";\n\t}\n\n\tprotected _getValue(row: IGridDataRow): any {\n\t\treturn WSP_GIT.getGitStateLabel(WSP_GIT.getSimpleState(super._getValue(row)));\n\t}\n}\n\nREG.reg.registerSkin(\"wsp-explorer/grid/git\", 1, /* language=CSS */ `\n\t:host {\n\t\t--git-untracked-url: url(/@skin@/wsp/objects/gitState/untracked.svg);\n\t\t--git-ignored-url: url(/@skin@/wsp/objects/gitState/ignored.svg);\n\t\t--git-adding-url: url(/@skin@/wsp/objects/gitState/adding.svg);\n\t\t--git-updating-url: url(/@skin@/wsp/objects/gitState/updating.svg);\n\t\t--git-deleting-url: url(/@skin@/wsp/objects/gitState/deleting.svg);\n\t\t--git-conflict-url: url(/@skin@/wsp/objects/gitState/conflict.svg);\n\t}\n\n\t.git {\n\t\tborder: none !important;\n\t}\n`);\n\n/**\n * Init du registre spécifique à un atelier pouvant gérer une couche GIT.\n */\nexport function initGitReg(reg: IReg<IWspUiEnv>) {\n\n\tconst gitColDef = new GridColDef(\"git\")\n\t\t.setFlex(\"1rem\", 0, 0)\n\t\t.setCellBuilder(new CellBuilderGitFlag(\"gitSt\"))\n\t\t.setSkin(\"wsp-explorer/grid/git\")\n\t\t.setLabel(\"\")\n\t\t.setDescription(\"Statut Git\");\n\n\t/** Désactivation colonne GIT à l'init => rechargement widget nécessaire si détecteion GIT ultérieure. */\n\tgitColDef.isAvailable = function (grid: IGrid): boolean {\n\t\treturn (reg.env.wsp.infoWsp?.srcFields as JGitSrcFields)?.gitSt != null;\n\t}\n\n\treg.addToList(\"columns:wspExplorer:secondaryCols\", 'git', 1, gitColDef, 10);\n\treg.addToList(\"columns:netItems:secondaryCols\", 'git', 1, gitColDef, 10);\n\treg.addToList(\"columns:itemFoderTree:secondaryCols\", 'git', 1, gitColDef, 10);\n\n\treg.addToList(\"columns:wspApp:searches:item\", \"git\", 1, gitColDef);\n\n\n\t/** */\n\tclass GitHeadDiffAction extends DiffBarPanelAction {\n\n\t\tconstructor(id?: string) {\n\t\t\tsuper(id || 'gitHead');\n\t\t\tthis._label = \"Git head\";\n\t\t}\n\n\t\tasync buildPanel(ctx: IWedDiffBar, ev?: Event): Promise<IDiffBarPanel> {\n\t\t\treturn new (await import(\"back/wsp/widgets/wed/wspGitDiffBar.js\")).GitHeadDiffPanel().initPanel(this, ctx);\n\t\t}\n\t}\n\n\treg.addToList(\"wed.diffBar.actions\", \"gitHead\", 1, new GitHeadDiffAction());\n\n\treg.addToList(\"wspApp:tools:rb\", \"gitChanges\", 1, new NavigatorArea(\"gitChanges\")\n\t\t\t.setLabel(\"Git\").setDescription(\"Changements locaux Git\")\n\t\t\t.setIcon(\"/@skin@/wsp/views/navigator/gitChanges.svg\")\n\t\t\t.setEmptyTree((n) => <c-msg label=\"Aucune différence locale\" level=\"info\"/>)\n\t\t\t.setBuildFacets(async (nav, fields) => new NavigatorFacetGitChanges(fields))\n\t\t\t.setActionsLists([\"actions:wspApp:navigator\", \"actions:wsp:shortDesc\"])\n\t\t\t.setAccelKeysLists([\"accelkeys:wspApp:navigator\", \"accelkeys:wsp:shortDesc\"])\n\t\t, 10);\n\n\n\tconst lstnFocusWin = () => {\n\t\treg.env.universe.httpFrames.web.fetchSvc(\"u/srcGit\", \"RefreshWspIndexDiff\", \"param=\" + encodeURIComponent(reg.env.wsp.code));\n\t}\n\twindow.addEventListener(\"focus\", lstnFocusWin);\n\treg.onRegClose.add(() => {\n\t\twindow.removeEventListener(\"focus\", lstnFocusWin);\n\t});\n}\n\nexport interface JGitHeadWedDiffBarParams extends JWedDiffBarParams {\n}\n\n\nexport class NavigatorFacetGitChanges extends NavigatorFacetText {\n\n\tprotected initSkin() {\n\t\tthis.skin = [\"wsp-navigator/facetText\"]; //, \"wsp-navigator/facetGitChanges\"];\n\t}\n\n\tbuildUiFacets(nav: Navigator, lastDatas: JLastDatas | null) {\n\t\tthis.initRoot(nav).append(\n\t\t\t<div class=\"h\">{this.buildTextInput(nav, lastDatas)}{nav.navigatorBtns}</div>\n\t\t);\n\t}\n\n\tprotected getCriterions(): Element | Element[] | undefined {\n\t\tconst exp = DOM.sharedXmlDoc().createElement(\"exp\");\n\t\texp.setAttribute(\"type\", \"GitState\");\n\t\texp.setAttribute(\"gitStates\", \"dirty\");\n\t\texp.setAttribute(\"deep\", \"true\");\n\t\texp.setAttribute(\"refresh\", \"true\");\n\t\treturn LANG.pushIfDefined([exp], this.getTextCriterion());\n\t}\n}\n\n\n//REG.reg.registerSkin('wsp-navigator/facetGitChanges', 1, /* language=CSS */ ``);"]}