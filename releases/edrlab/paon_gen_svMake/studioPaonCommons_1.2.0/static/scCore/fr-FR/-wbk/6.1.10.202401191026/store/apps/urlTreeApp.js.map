{"version":3,"sources":["/@back@/store/apps/urlTreeApp.tsx"],"names":["BaseElementAsync","JSX","REG","DOMSH","FontSizeDeskFeat","UiThemeDeskFeat","UrlTreeApp","path","val","startsWith","substring","this","appDef","utPath","dispatchEvent","CustomEvent","bubbles","[object Object]","init","reg","findReg","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","setAttribute","env","universe","getName","frame","shadowRoot","appendChild","createElement","addEventListener","onPathChange","depotUrl","urlTree","url","toString","src","currentUrl","contentDocument","location","href","win","contentWindow","length","initParentFrame","def","isIn","desk","injectThemeInSubFrame","injectFontSizeInSubFrame","perm","libPath","findScPermLibPath","resolver","import","resolvePath","hasPerm","registerSkin","customElements","define"],"mappings":"OAAQA,qBAAgC;OAEhCC,QAAI;OACEC,QAAI;OACVC,UAAM;OAINC,iBAAkBC,oBAAgB;OAMpC,MAAOC,mBAAmBN,iBAY/BO,SAASC,KACR,GAAIA,KAAOA,IAAIC,WAAW,KAAMD,IAAMA,IAAIE,UAAU;AACpD,GAAIC,KAAKC,OAAOC,SAAWL,IAAK,CAC/BG,KAAKC,OAAOC,OAASL;AACrBG,KAAKG,cAAc,IAAIC,YAAY,kBAAmB,CAACC,QAAS,SAIlET,WACC,OAAOI,KAAKC,OAAOC,OAGVI,kBAAkBC,MAC3BP,KAAKQ,IAAMR,KAAKS,QAAQF;AACxBP,KAAKC,OAASM,KAAKN;AACnBD,KAAKU,aAAalB,MAAMmB;AACxBX,KAAKY,oBAAoBZ,KAAKa,UAAWN;AACzCP,KAAKc,aAAa,QAASP,KAAKC,IAAIO,IAAIC,SAASC;AACjDjB,KAAKkB,MAAQlB,KAAKmB,WAAWC,YAAY9B,IAAA+B,cAAA,SAAA;AACzCrB,KAAKkB,MAAMI,iBAAiB,OAAQ,KACnCtB,KAAKuB;AAEN,MAAMC,SAAWxB,KAAKQ,IAAIO,IAAIC,SAASS,QAAQC,IAAIC;AACnD3B,KAAKJ,KAAOI,KAAKC,OAAOC,QAAU;AAClCF,KAAKkB,MAAMU,IAAMJ,SAAWxB,KAAKJ,KAGlCU,eACC,MAAMkB,SAAWxB,KAAKQ,IAAIO,IAAIC,SAASS,QAAQC,IAAIC;AACnD,MAAME,WAAa7B,KAAKkB,MAAMY,gBAAgBC,SAASC;AACvD,MAAMC,IAAMjC,KAAKkB,MAAMgB;AACvB,GAAIL,WAAW/B,WAAW0B,UACzBxB,KAAKJ,KAAOiC,WAAW9B,UAAUyB,SAASW;AAG3C,GAAIF,IAAIG,gBAAiBH,IAAIG,gBAAgBpC,MAM9CM,aAAa+B,KACZ,OAAO,MAGR/B,cACC,GAAIN,KAAKkB,OAASxB,gBAAgB4C,KAAKC,MAAOA,KAAKC,sBAAsBxC,KAAKkB;AAC9E,GAAIlB,KAAKkB,OAASzB,iBAAiB6C,KAAKC,MAAOA,KAAKE,yBAAyBzC,KAAKkB,OAGnFZ,cAAcoC,MACb,MAAMC,cAAgBpD,IAAIqD,kBAAkBF;AAC5C,GAAI1C,KAAKQ,IAAIO,IAAI8B,UAAYF,cACtBG,OAAO9C,KAAKQ,IAAIO,IAAI8B,SAASE,YAAYJ;AAChD,OAAO3C,KAAKQ,IAAIwC,QAAQN,OAI1BnD,IAAIiB,IAAIyC,aAAa,oBAAqB,EAAsB;AAchEC,eAAeC,OAAO,oBAAqBxD","sourcesContent":["import {BaseElementAsync, OSkinableInit} from \"back/commons/basis\";\nimport {IApp, IAppCtx} from \"back/core/appFrame\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {IDepotEnv} from \"lib/store/depot\";\nimport {JUrlTreeAppAppDef} from \"back/store/plugins/depotPlg\";\nimport {IFrameAppParentFrame, IWindowFrameApp} from \"back/core/apps/frameApp\";\nimport {FontSizeDeskFeat, UiThemeDeskFeat} from \"back/core/plugins/optionsPlg\";\n\nexport interface UrlTreeApp extends BaseElementAsync, IFrameAppParentFrame {\n\tinitialize(init: IAppCtx<IDepotEnv> & OSkinableInit): this;\n}\n\nexport class UrlTreeApp extends BaseElementAsync implements IApp<IDepotEnv>, IApp<IDepotEnv>, IFrameAppParentFrame {\n\n\treg: IReg<IDepotEnv>;\n\n\tappDef: JUrlTreeAppAppDef;\n\n\tframe: HTMLIFrameElement;\n\n\t/**\n\t * Path absolu de la ressource dépot actuellement affichée\n\t * ne commence pas par un \"/\"\n\t */\n\tset path(val: string) {\n\t\tif (val && val.startsWith(\"/\")) val = val.substring(1);\n\t\tif (this.appDef.utPath !== val) {\n\t\t\tthis.appDef.utPath = val;\n\t\t\tthis.dispatchEvent(new CustomEvent('c-appdef-change', {bubbles: true}));\n\t\t}\n\t}\n\n\tget path(): string {\n\t\treturn this.appDef.utPath;\n\t}\n\n\tprotected async _initialize(init: IAppCtx<IDepotEnv> & OSkinableInit) {\n\t\tthis.reg = this.findReg(init);\n\t\tthis.appDef = init.appDef as JUrlTreeAppAppDef;\n\t\tthis.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tthis.setAttribute(\"label\", init.reg.env.universe.getName());\n\t\tthis.frame = this.shadowRoot.appendChild(<iframe/>) as HTMLIFrameElement;\n\t\tthis.frame.addEventListener(\"load\", () => {\n\t\t\tthis.onPathChange();\n\t\t});\n\t\tconst depotUrl = this.reg.env.universe.urlTree.url.toString();\n\t\tthis.path = this.appDef.utPath || \"\";// Affectation initiale pour normalisation\n\t\tthis.frame.src = depotUrl + this.path;\n\t}\n\n\tonPathChange(): void {\n\t\tconst depotUrl = this.reg.env.universe.urlTree.url.toString();\n\t\tconst currentUrl = this.frame.contentDocument.location.href;\n\t\tconst win = this.frame.contentWindow as IWindowFrameApp;\n\t\tif (currentUrl.startsWith(depotUrl))\n\t\t\tthis.path = currentUrl.substring(depotUrl.length);\n\n\t\t//déclaration du contexte parent.\n\t\tif (win.initParentFrame) win.initParentFrame(this);\n\n\t\t//A activer si utile\n\t\t// captureScenariProtocol(this, frameApp.reg);\n\t}\n\n\tupdateAppDef(def: JUrlTreeAppAppDef): boolean {\n\t\treturn false;\n\t}\n\n\tinjectTheme(): void {\n\t\tif (this.frame && UiThemeDeskFeat.isIn(desk)) desk.injectThemeInSubFrame(this.frame);\n\t\tif (this.frame && FontSizeDeskFeat.isIn(desk)) desk.injectFontSizeInSubFrame(this.frame);\n\t}\n\n\tasync hasPerm(perm: string): Promise<boolean> {\n\t\tconst libPath = await REG.findScPermLibPath(perm);\n\t\tif (this.reg.env.resolver && libPath)\n\t\t\tawait import(this.reg.env.resolver.resolvePath(libPath));\n\t\treturn this.reg.hasPerm(perm);\n\t}\n}\n\nREG.reg.registerSkin('store-urltree-app', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t}\n\n\tiframe {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tborder: none;\n\t}\n`);\ncustomElements.define('store-urltree-app', UrlTreeApp);\n"]}