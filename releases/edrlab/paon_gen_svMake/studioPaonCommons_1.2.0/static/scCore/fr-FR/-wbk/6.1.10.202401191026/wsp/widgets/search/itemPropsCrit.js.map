{"version":3,"sources":["/@back@/wsp/widgets/search/itemPropsCrit.tsx"],"names":["UiCritArea","UiCritBase","SearchItemLinks","SearchItemPropsDate","SearchItemPropsNumber","SearchItemPropsRegexp","JSX","LANG","InputPeriod","REG","SrcPointerFastSelect","SrcPointerInline","ITEM","ItemPropsCritBase","[object Object]","init","super","_initialize","this","critArea","getId","UiPropsCritStringArea","id","params","libs","setCritSgn","setReplacePattern","xml","ctx","options","txt","getAttribute","opts","createElement","class","getLabel","indexOf","undefined","elt","ItemPropsCritString","param","sr","shadowRoot","icon","getIcon","reg","img","src","head","appendChild","type","oninput","onChange","placeholder","insertAlternativesBtn","_text","querySelector","initHeadFromArea","optsRoot","_ignoreCase","onclick","firstElementChild","_wholeWord","crit","buildUiXmlCrit","setAttribute","value","checked","v","regExp","buildRegExp","ignoreCase","wholeWord","strPattern","fuzzy","escape4Regexp","escape4RegexpFuzzy","RegExp","propName","multivalued","customElements","define","UiPropsCritFixedRegExpArea","ItemPropsCritFixedRegExp","UiPropsCritEnumArea","keys","split","labels","forEach","key","dataEntry","enums","push","label","valTag","join","ItemPropsCritEnum","_selectElt","name","onchange","multiple","appendSubs","parent","data","option","description","title","selectedOptions","o","currentValue","opt","selected","includes","length","entry","pos","array","registerSkin","UiPropsCritNumberArea","operator","OP","ItemPropsCritNumber","gt","gt=","lt","lt=","=","_opElt","_opValueElt","min","step","hasAttribute","Number","parseInt","isInteger","UiPropsCritDateArea","ItemPropsCritDate","modes","format","buildDefaultModes_futurAndPast","buildDefaultModes_futur","_dateElt","initialize","defaultLabel","addEventListener","isSpecified","currentMode","date1","valueAsNumber","toString","date2","reset","buildFromInputPeriod","UiPropsCritRefArea","path","val","result","srcPointer","î","Promise","resolve","setSrcRef","then","innerText","criterions","searchId","findRef","ItemPropsCritRef","sngs","env","wsp","wspMetaUi","whiteList","it","getItemType","itModel","getSgn","itemPtr","defaultAction","SINGLETON","sgnPattern","onSrcRefChange","add","shortDesc","getSrcUriType","srcUri","openFastSelect","srcRef","whiteElt","find","exp","setPath","lnkTraits","setLinkTraitFilter"],"mappings":"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","sourcesContent":["import {IUiCritArea, OUiCritInit, OUiCritWithInputInit, UiCritArea, UiCritBase} from \"back/wsp/widgets/search/uiCrit\";\nimport {EItemPropsMultiValued, EOperatorsSimple, ISearchCrit, SearchItemLinks, SearchItemPropsDate, SearchItemPropsNumber, SearchItemPropsRegexp} from \"lib/wsp/search\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {LANG} from \"lib/commons/lang\";\nimport {IEndPoint} from \"lib/commons/io/io\";\nimport {InputPeriod} from \"back/core/widgets/inputPeriod\";\nimport {REG} from \"lib/commons/registry\";\nimport {OItemPointerInit, SrcPointerFastSelect, SrcPointerInline} from \"back/wsp/widgets/srcDrawer\";\nimport {JItemWedSearchBarParams} from \"back/wsp/widgets/wed/wspSearchBar\";\nimport {ITEM} from \"lib/wsp/item\";\n\n\nexport interface OPropsCrit extends OUiCritInit {\n\t/** Nom de la propriété */\n\tpropName: string\n\t/** Par défaut : area.label */\n\tlabel?: string\n\t/** */\n\tmultivalued?: EItemPropsMultiValued\n}\n\nabstract class ItemPropsCritBase extends UiCritBase {\n\tprotected param: OPropsCrit;\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t}\n\n\tprotected getUiCritXmlAtt(): string {\n\t\treturn this.critArea.getId();\n\t}\n}\n\n/**\n * Recherche full text\n */\n\n/** Recherche full text d'une props : paramètres d'initialisation */\nexport interface OPropsCritString extends OPropsCrit {\n\t/** Recherche approchée (accents, ...). True par défaut */\n\tfuzzy?: boolean\n\t/** Création libre de la regExp de recherche */\n\tbuildRegExp?: (searchTxt: string | string[], options?: {}) => RegExp\n}\n\n/** Recherche full text d'une props : area */\nexport class UiPropsCritStringArea extends UiCritArea {\n\tconstructor(id: string, protected params: OPropsCritString, libs?: IEndPoint | IEndPoint[]) {\n\t\tsuper(id, libs);\n\t\tthis.setCritSgn(\"string\").setReplacePattern(/\\bstring\\b/);\n\t}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\tconst txt = xml.getAttribute(\"uiTextSearch\") || \"\";\n\t\tconst opts = xml.getAttribute(\"uiOptions\") || \"\";\n\t\treturn <span class=\"crit\"><span class=\"critTitle\">{this.getLabel(ctx)}</span> contient '<span\n\t\t\tclass=\"critVal\">{txt}</span>'{opts.indexOf(';w;') >= 0 ? ', mot entier' : undefined}{opts.indexOf(';c;') >= 0 ? ', casse respectée' : undefined}</span>;\n\t}\n\n\tbuildBody(ctx: OUiCritInit): ItemPropsCritString {\n\t\tlet elt = new ItemPropsCritString(this.params);\n\t\telt.critArea = this;\n\t\treturn elt;\n\t}\n}\n\n/** Recherche full text d'une props : crit */\nexport class ItemPropsCritString extends ItemPropsCritBase {\n\tprotected _text: HTMLInputElement;\n\tprotected _ignoreCase: HTMLInputElement;\n\tprotected _wholeWord: HTMLInputElement;\n\n\tconstructor(protected param: OPropsCritString) {super();}\n\n\tprotected _initialize(init: OUiCritInit & OUiCritWithInputInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tconst icon = this.critArea ? this.critArea.getIcon({reg: this.reg}) : null;\n\t\tconst img = icon ? <img src={icon}/> : null;\n\t\tconst head = sr.appendChild(<div class=\"critHead\">\n\t\t\t{img}\n\t\t\t<span class=\"critTitle\">{this.critArea ? this.critArea.getLabel({reg: this.reg}) : \"\"}</span>\n\t\t\t<input type=\"search\" oninput={this.onChange} placeholder={init.placeholder}/>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tthis._text = head.querySelector(\"input\");\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\n\t\tconst optsRoot = sr.appendChild(<div class=\"h\"/>);\n\t\tthis._ignoreCase = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" onclick={this.onChange}/>Respect de la casse</label>).firstElementChild as HTMLInputElement;\n\t\tthis._wholeWord = optsRoot.appendChild(<label class=\"opt\"><input type=\"checkbox\" onclick={this.onChange}/>Mot entier</label>).firstElementChild as HTMLInputElement;\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tif (crit) {\n\t\t\tcrit.setAttribute(\"uiTextSearch\", this._text.value);\n\t\t\tlet opts: string;\n\t\t\tif (this._ignoreCase.checked) {\n\t\t\t\topts = this._wholeWord.checked ? \";c;w;\" : \";c;\";\n\t\t\t} else if (this._wholeWord.checked) {\n\t\t\t\topts = \";w;\";\n\t\t\t}\n\t\t\tif (this._ignoreCase.checked) opts += opts;\n\t\t\tcrit.setAttribute(\"uiOptions\", opts);\n\t\t}\n\t\treturn crit;\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tthis._text.value = xml.getAttribute('uiTextSearch') || \"\";\n\t\tconst opts = xml.getAttribute('uiOptions') || \"\";\n\t\tthis._ignoreCase.checked = opts.indexOf(';c;') >= 0;\n\t\tthis._wholeWord.checked = opts.indexOf(';w;') >= 0;\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst v = this._text.value;\n\t\tlet regExp: RegExp;\n\n\t\tif (this.param.buildRegExp)\n\t\t\tregExp = this.param.buildRegExp(v, {ignoreCase: this._ignoreCase.checked, wholeWord: this._wholeWord.checked});\n\t\telse if (v) {\n\t\t\tlet strPattern = this.param.fuzzy === false ? LANG.escape4Regexp(v) : LANG.escape4RegexpFuzzy(v);\n\t\t\tregExp = new RegExp(this._wholeWord.checked ? strPattern : '.*' + strPattern + '.*', this._ignoreCase.checked ? \"i\" : \"\")\n\t\t}\n\t\treturn regExp ? new SearchItemPropsRegexp(this.param.propName || this.critArea.getId(), regExp, this.param.multivalued) : undefined;\n\t}\n}\n\ncustomElements.define(\"wsp-itemcrit-props-string\", ItemPropsCritString);\n\n\n/**\n * Recherche via une regExp prédéfinie (et non éditale)\n */\nexport interface OPropsCritFixedRegExp extends OPropsCrit {\n\t/** RegExp de recherche */\n\tregExp: RegExp\n}\n\nexport class UiPropsCritFixedRegExpArea extends UiCritArea {\n\tconstructor(id: string, protected params: OPropsCritFixedRegExp, libs?: IEndPoint | IEndPoint[]) {\n\t\tsuper(id, libs);\n\t\tthis.setCritSgn(\"fixedRegexp\").setReplacePattern(/\\bfixed\\b/);\n\t}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\treturn <span class=\"crit\"><span class=\"critTitle\">{this.getLabel(ctx)}</span></span>;\n\t}\n\n\tbuildBody(ctx: OUiCritInit): ItemPropsCritFixedRegExp {\n\t\tlet elt = new ItemPropsCritFixedRegExp(this.params);\n\t\telt.critArea = this;\n\t\treturn elt;\n\t}\n}\n\nexport class ItemPropsCritFixedRegExp extends ItemPropsCritBase {\n\n\tconstructor(protected param: OPropsCritFixedRegExp) {super();}\n\n\tprotected _initialize(init: OUiCritInit & OUiCritWithInputInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tconst icon = this.critArea ? this.critArea.getIcon({reg: this.reg}) : null;\n\t\tconst img = icon ? <img src={icon}/> : null;\n\t\tconst head = sr.appendChild(<div class=\"critHead\">\n\t\t\t{img}\n\t\t\t<span class=\"critTitle\">{this.critArea ? this.critArea.getLabel({reg: this.reg}) : \"\"}</span>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tconst optsRoot = sr.appendChild(<div class=\"h\"/>);\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\treturn new SearchItemPropsRegexp(this.param.propName || this.critArea.getId(), this.param.regExp, this.param.multivalued);\n\t}\n\n}\n\ncustomElements.define(\"wsp-itemcrit-props-fixed-regexp\", ItemPropsCritFixedRegExp);\n\n\n/**\n * Recherche enum\n */\n\ninterface OPropsCritEnumEntry {\n\ttype?: 'sub'\n\tlabel: string,\n\ticon?: string,\n\tdescription?: string,\n\tenums: Dict<OPropsCritEnumEntry>\n}\n\n/** Recherche enum d'une props : paramètres d'initialisation */\nexport interface OPropsCritEnum extends OPropsCrit {\n\tenums: Dict<OPropsCritEnumEntry>;\n\t/** false par défaut */\n\tmultiple?: boolean;\n\t/** Recherche approchée (accents, ...). True par défaut */\n\tfuzzy?: boolean\n\t/** Création libre de la regExp de recherche */\n\tbuildRegExp?: (searchTxt: string | string[], options?: {}) => RegExp\n}\n\n/** Recherche enum d'une props : area */\nexport class UiPropsCritEnumArea extends UiCritArea {\n\n\tconstructor(id: string, protected params: OPropsCritEnum, libs?: IEndPoint | IEndPoint[]) {\n\t\tsuper(id, libs);\n\t\tthis.setCritSgn(\"enum\").setReplacePattern(/\\benum\\b/);\n\t}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\tconst keys = xml ? (xml.getAttribute('uiTextSearch') || \"\").split(\"|\") : [];\n\t\tconst opts = xml.getAttribute(\"uiOptions\") || \"\";\n\t\tconst labels: string[] = [];\n\t\tkeys.forEach((key) => {\n\t\t\tconst dataEntry = this.params.enums && this.params.enums[key] ? this.params.enums[key] : null;\n\t\t\tlabels.push(dataEntry ? dataEntry.label : key)\n\t\t});\n\t\tlet valTag = <span class=\"critVal\">{labels.join(\", \")}</span>;\n\t\treturn <span class=\"crit\"><span class=\"critTitle\">{this.getLabel(ctx)}</span> contient '{valTag}'</span>;\n\t}\n\n\tbuildBody(ctx: OUiCritInit): ItemPropsCritEnum {\n\t\tlet elt = new ItemPropsCritEnum(this.params);\n\t\telt.critArea = this;\n\t\treturn elt;\n\t}\n}\n\n/** Recherche enum d'une props : crit */\nexport class ItemPropsCritEnum extends ItemPropsCritBase {\n\tprivate _selectElt: HTMLSelectElement;\n\n\tconstructor(protected param: OPropsCritEnum) {super();}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\n\t\tthis._selectElt = <select name={name} onchange={this.onChange}/> as HTMLSelectElement;\n\t\tthis._selectElt.multiple = this.param.multiple ? true : false;\n\n\t\tfunction appendSubs(parent: Element, enums: Dict<OPropsCritEnumEntry>): void {\n\t\t\tfor (const key in enums) {\n\t\t\t\tconst data = enums[key];\n\t\t\t\tconst option = data.type === 'sub' ?\n\t\t\t\t\tparent.appendChild(<optgroup label={data.label}/>) :\n\t\t\t\t\tparent.appendChild(<option value={key}>{data.label}</option>);\n\t\t\t\tif (data.description) option.title = data.description;\n\t\t\t\tif (data.type === 'sub')\n\t\t\t\t\tappendSubs(option, data.enums);\n\t\t\t}\n\t\t}\n\n\t\tappendSubs(this._selectElt, this.param.enums);\n\t\tconst icon = this.critArea ? this.critArea.getIcon({reg: this.reg}) : null;\n\t\tconst img = icon ? <img src={icon}/> : null;\n\t\tconst head = sr.appendChild(<div class=\"critHead\">\n\t\t\t{img}\n\t\t\t<span class=\"critTitle\">{this.critArea ? this.critArea.getLabel({reg: this.reg}) : \"\"}</span>\n\t\t\t{this._selectElt}\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tif (crit) {\n\t\t\tlet v: string[] = [];\n\t\t\tif (this._selectElt.selectedOptions) {\n\t\t\t\tfor (const o of this._selectElt.selectedOptions)\n\t\t\t\t\tv.push(o.value)\n\t\t\t}\n\t\t\tcrit.setAttribute(\"uiTextSearch\", v.join(\"|\"));\n\t\t}\n\t\treturn crit;\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tlet currentValue = xml ? (xml.getAttribute('uiTextSearch') || \"\").split(\"|\") : [];\n\t\tfor (const opt of this._selectElt.options) {\n\t\t\topt.selected = currentValue.includes(opt.value) ? true : false;\n\t\t}\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst v: string[] = [];\n\t\tif (this._selectElt.selectedOptions) {\n\t\t\tfor (const o of this._selectElt.selectedOptions)\n\t\t\t\tv.push(o.value)\n\t\t}\n\t\tlet regExp: RegExp;\n\n\t\tif (this.param.buildRegExp)\n\t\t\tregExp = this.param.buildRegExp(v, {ignoreCase: false, wholeWord: true});\n\t\telse if (v.length > 0) {\n\t\t\tv.forEach((entry, pos, array) =>\n\t\t\t\tarray[pos] = this.param.fuzzy === false ? LANG.escape4Regexp(entry) : LANG.escape4RegexpFuzzy(entry)\n\t\t\t);\n\t\t\tregExp = new RegExp(v.join(\"|\"))\n\t\t}\n\t\treturn regExp ? new SearchItemPropsRegexp(this.param.propName || this.critArea.getId(), regExp, this.param.multivalued) : undefined;\n\t}\n}\n\ncustomElements.define(\"wsp-itemcrit-props-enum\", ItemPropsCritEnum);\nREG.reg.registerSkin(\"wsp-itemcrit-props-enum\", 1, /* language=CSS */ `\n\toption {\n\t\tmargin-inline-start: 1em;\n\t}\n\n\tselect {\n\t\tmin-width: 1.5em;\n\t\tflex: 1;\n\t\tdisplay: inline-block;\n\t\ttext-overflow: ellipsis;\n\t\tfont-size: inherit;\n\t}\n`);\n\n\n/**\n * Recherche number\n */\n\n/** Recherche number d'une props : paramètres d'initialisation */\nexport interface OPropsCritNumber extends OPropsCrit {\n}\n\n/** Recherche number d'une props : area */\nexport class UiPropsCritNumberArea extends UiCritArea {\n\n\tstatic OP: { [index: string]: any } = {\n\t\t//\"value\" : [longLabel, shortLabel]\n\t\t\"gt\": [\"Valeur supérieure à\", \">\"],\n\t\t\"gt=\": [\"Valeur supérieure ou égale à\", \">=\"],\n\t\t\"lt\": [\"Valeur inférieure à\", \"<\"],\n\t\t\"lt=\": [\"Valeur inférieure ou égale à\", \"<=\"],\n\t\t\"=\": [\"Valeur égale à\", \"=\"],\n\t};\n\n\tconstructor(id: string, protected params: OPropsCritNumber, libs?: IEndPoint | IEndPoint[]) {\n\t\tsuper(id, libs);\n\t\tthis.setCritSgn(\"number\").setReplacePattern(/\\bnumber\\b/);\n\t}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\tconst operator = <span class=\"critVal\">{UiPropsCritNumberArea.OP[xml.getAttribute(\"op\")][1]}</span>;\n\t\tconst value = <span class=\"critVal\">{xml.getAttribute(\"value\")}</span>;\n\t\treturn <span class=\"crit\"><span class=\"critTitle\">{this.getLabel(ctx)}</span> {operator} {value}</span>;\n\t}\n\n\tbuildBody(ctx: OUiCritInit): ItemPropsCritNumber {\n\t\tlet elt = new ItemPropsCritNumber(this.params)\n\t\telt.critArea = this;\n\t\treturn elt;\n\t}\n}\n\n/** Recherche number d'une props : crit */\nexport class ItemPropsCritNumber extends ItemPropsCritBase {\n\tprivate _opElt: HTMLSelectElement;\n\tprivate _opValueElt: HTMLInputElement;\n\n\tconstructor(protected param: OPropsCritNumber) {super();}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tthis._opElt = <select onchange={this.onChange}>\n\t\t\t<option value=\"gt\" selected>{UiPropsCritNumberArea.OP[\"gt\"][0]}</option>\n\t\t\t<option value=\"gt=\">{UiPropsCritNumberArea.OP[\"gt=\"][0]}</option>\n\t\t\t<option value=\"lt\">{UiPropsCritNumberArea.OP[\"lt\"][0]}</option>\n\t\t\t<option value=\"lt=\">{UiPropsCritNumberArea.OP[\"lt=\"][0]}</option>\n\t\t\t<option value=\"=\">{UiPropsCritNumberArea.OP[\"=\"][0]}</option>\n\t\t</select> as HTMLSelectElement;\n\t\tthis._opValueElt = <input value=\"0\" type=\"number\" min=\"0\" step=\"1\" oninput={this.onChange} onchange={this.onChange}/> as HTMLInputElement;\n\t\tconst icon = this.critArea ? this.critArea.getIcon({reg: this.reg}) : null;\n\t\tconst img = icon ? <img src={icon}/> : null;\n\t\tconst head = sr.appendChild(<div class=\"critHead\">\n\t\t\t{img}\n\t\t\t<span class=\"critTitle\">{this.critArea ? this.critArea.getLabel({reg: this.reg}) : \"\"}</span>\n\t\t\t<div class=\"h\">\n\t\t\t\t{this._opElt}\n\t\t\t\t{this._opValueElt}\n\t\t\t</div>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tif (xml && xml.hasAttribute(\"op\")) this._opElt.value = xml.getAttribute(\"op\");\n\t\tif (xml && xml.hasAttribute(\"value\")) this._opValueElt.value = xml.getAttribute(\"value\");\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst v = Number.parseInt(this._opValueElt.value);\n\t\tif (Number.isInteger(v))\n\t\t\treturn new SearchItemPropsNumber(this.param.propName || this.critArea.getId(), this._opElt.value as EOperatorsSimple, v, this.param.multivalued);\n\t\treturn undefined;\n\t}\n}\n\ncustomElements.define(\"wsp-itemcrit-props-number\", ItemPropsCritNumber);\nREG.reg.registerSkin(\"wsp-itemcrit-props-number\", 1, /* language=CSS */ `\n\toption {\n\t\tmargin-inline-start: 1em;\n\t}\n\n\tselect {\n\t\tmin-width: 1.5em;\n\t\tflex: 1;\n\t\tdisplay: inline-block;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\tinput {\n\t\tdisplay: inline-block;\n\t\tmin-width: 1.5em;\n\t\tflex: 1;\n\t}\n`);\n\n/**\n * Recherche date\n */\n\n/** Recherche date d'une props : paramètres d'initialisation */\nexport interface OPropsCritDate extends OPropsCrit {\n\t// 'past' par défaut\n\tformat?: 'future,past' | 'past' | 'future'\n}\n\n/** Recherche date d'une props : area */\nexport class UiPropsCritDateArea extends UiCritArea {\n\tconstructor(id: string, protected params: OPropsCritDate, libs?: IEndPoint | IEndPoint[]) {\n\t\tsuper(id, libs);\n\t\tthis.setCritSgn(\"date\").setReplacePattern(/\\bdate\\b/);\n\t}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\t//FIXME : afficher une forme lisible de la date spécifiée\n\t\treturn <span class=\"crit\"><span class=\"critTitle\">{this.getLabel(ctx)}</span></span>;\n\t}\n\n\tbuildBody(ctx: OUiCritInit): ItemPropsCritDate {\n\t\tlet elt = new ItemPropsCritDate(this.params);\n\t\telt.critArea = this;\n\t\treturn elt;\n\t}\n}\n\n/** Recherche date d'une props : crit */\nexport class ItemPropsCritDate extends ItemPropsCritBase {\n\tprotected _dateElt: InputPeriod;\n\n\tconstructor(protected param: OPropsCritDate) {super();}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tlet modes;\n\t\tswitch (this.param.format) {\n\t\tcase \"future,past\" :\n\t\t\tmodes = InputPeriod.buildDefaultModes_futurAndPast();\n\t\t\tbreak;\n\t\tcase \"future\" :\n\t\t\tmodes = InputPeriod.buildDefaultModes_futur();\n\t\t\tbreak;\n\t\t}\n\t\tthis._dateElt = new InputPeriod().initialize({defaultLabel: \"Choisir une valeur...\", modes});\n\t\tthis._dateElt.addEventListener(\"change\", this.onChange);\n\t\tthis._dateElt.addEventListener(\"input\", this.onChange);\n\t\tconst icon = this.critArea ? this.critArea.getIcon({reg: this.reg}) : null;\n\t\tconst img = icon ? <img src={icon}/> : null;\n\t\tconst head = sr.appendChild(<div class=\"critHead\">\n\t\t\t{img}\n\t\t\t<span class=\"critTitle\">{this.critArea ? this.critArea.getLabel({reg: this.reg}) : \"\"}</span>\n\t\t\t{this._dateElt}\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\t}\n\n\tbuildUiXmlCrit(): Element | undefined {\n\t\tconst crit: Element = super.buildUiXmlCrit();\n\t\tif (crit) {\n\t\t\tif (crit && this._dateElt.isSpecified()) {\n\t\t\t\tcrit.setAttribute(\"uiCurrentMode\", this._dateElt.currentMode.getId());\n\t\t\t\t// Valeurs brutes (sans les regles d'exclusion/normalisation qui sont fournies par le \"currentMode\")\n\t\t\t\tif (this._dateElt.date1.valueAsNumber) crit.setAttribute(\"uiCurrentLess\", this._dateElt.date1.valueAsNumber.toString());\n\t\t\t\tif (this._dateElt.date2.valueAsNumber) crit.setAttribute(\"uiCurrentMore\", this._dateElt.date2.valueAsNumber.toString());\n\t\t\t}\n\t\t}\n\t\treturn crit;\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tthis._dateElt.reset(xml.getAttribute(\"uiCurrentMode\"), xml.hasAttribute(\"uiCurrentLess\") ? Number.parseInt(xml.getAttribute(\"uiCurrentLess\")) : null, xml.hasAttribute(\"uiCurrentMore\") ? Number.parseInt(xml.getAttribute(\"uiCurrentMore\")) : null);\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tif (this._dateElt.isSpecified())\n\t\t\treturn SearchItemPropsDate.buildFromInputPeriod(this._dateElt, this.param.propName || this.critArea.getId(), this.param.multivalued);\n\t\treturn undefined;\n\t}\n}\n\ncustomElements.define(\"wsp-itemcrit-props-date\", ItemPropsCritDate);\n\n/**\n * Recherche ref item\n */\n\n/** Recherche ref item d'une props : paramètres d'initialisation */\nexport interface OPropsCritRef {\n\t/** Par défaut : area.label */\n\tlabel?: string\n\twhiteList: {\n\t\titModel: string,\n\t\tlnkTraits?: string[]\n\t}[]\n}\n\n/** Recherche ref item d'une props : area */\nexport class UiPropsCritRefArea extends UiCritArea {\n\tconstructor(id: string, protected params: OPropsCritRef, libs?: IEndPoint | IEndPoint[]) {\n\t\tsuper(id, libs);\n\t\tthis.setCritSgn(\"ref\");\n\t}\n\n\tbuildAbstract(xml: Element, ctx: OUiCritInit, options?: any): HTMLElement | undefined {\n\t\tconst path = xml.getAttribute('path') || \"\";\n\t\tconst val = <span class=\"critVal\">{path ? path : 'indéfini'}</span>;\n\t\tconst result = <span class=\"crit\"><span class=\"critTitle\">{this.getLabel(ctx)}</span> contient '{val}'</span>;\n\t\tif (path) {\n\t\t\tlet srcPointer: SrcPointerInline = <SrcPointerInline î={{\n\t\t\t\treg: ctx.reg,\n\t\t\t} as OItemPointerInit}/> as SrcPointerInline;\n\t\t\tPromise.resolve(srcPointer.setSrcRef(path)).then(() => {\n\t\t\t\tval.innerText = \"\";\n\t\t\t\tval.appendChild(srcPointer);\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\tbuildWedSearch(xml: Element, criterions: Dict<IUiCritArea>): JItemWedSearchBarParams | undefined {\n\t\treturn {\n\t\t\tsearchId: \"item\",\n\t\t\tfindRef: xml.getAttribute('path')\n\t\t}\n\t}\n\n\tbuildBody(ctx: OUiCritInit): ItemPropsCritRef {\n\t\tlet elt = new ItemPropsCritRef(this.params);\n\t\telt.critArea = this;\n\t\treturn elt;\n\t}\n}\n\n/** Recherche ref item (parents) */\nexport class ItemPropsCritRef extends UiCritBase {\n\tprotected itemPtr: SrcPointerInline;\n\n\tconstructor(protected param: OPropsCritRef) {super();}\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\t\tconst sngs: string[] = [];\n\n\t\tif (this.reg.env.wsp.wspMetaUi) {\n\t\t\tthis.param.whiteList.forEach((entry) => {\n\t\t\t\tconst it = this.reg.env.wsp.wspMetaUi.getItemType(entry.itModel);\n\t\t\t\tif (it) sngs.push(LANG.escape4Regexp(it.getSgn()))\n\t\t\t});\n\t\t}\n\t\tthis.itemPtr = <SrcPointerInline î={{\n\t\t\treg: this.reg,\n\t\t\tdefaultAction: SrcPointerFastSelect.SINGLETON,\n\t\t\tsgnPattern: new RegExp(\"(\" + sngs.join('|') + \")\")\n\t\t} as OItemPointerInit}/> as SrcPointerInline;\n\t\tconst icon = this.critArea ? this.critArea.getIcon({reg: this.reg}) : null;\n\t\tconst img = icon ? <img src={icon}/> : null;\n\t\tconst head = sr.appendChild(<div class=\"critHead\">\n\t\t\t{img}\n\t\t\t<span class=\"critTitle\">{this.critArea ? this.critArea.getLabel({reg: this.reg}) : \"\"}</span>\n\t\t\t{this.itemPtr}\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\t\tUiCritBase.initHeadFromArea(this.critArea, {reg: this.reg}, head);\n\t\tthis.itemPtr.onSrcRefChange.add(this.onChange);\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tconst path = xml.getAttribute('path');\n\t\tif (path) {\n\t\t\tawait this.itemPtr.setSrcRef(path);\n\t\t\tif (!this.itemPtr.shortDesc || ITEM.getSrcUriType(this.itemPtr.shortDesc.srcUri) != \"item\")\n\t\t\t\tthis.itemPtr.setSrcRef(null);\n\t\t}\n\t\treturn this;\n\t}\n\n\tasync initFromInsAction(xml?: Element): Promise<this> {\n\t\tconst path = xml ? xml.getAttribute('path') : null;\n\t\tif (path) {\n\t\t\tawait this.itemPtr.setSrcRef(path);\n\t\t\tif (!this.itemPtr.shortDesc || ITEM.getSrcUriType(this.itemPtr.shortDesc.srcUri) != \"item\") {\n\t\t\t\tthis.itemPtr.setSrcRef(null);\n\t\t\t\tawait this.itemPtr.openFastSelect();\n\t\t\t}\n\t\t} else if (!this.itemPtr.srcRef) {\n\t\t\tawait this.itemPtr.openFastSelect();\n\t\t}\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tif (this.itemPtr.shortDesc) {\n\t\t\tconst whiteElt = this.param.whiteList.find((entry) => entry.itModel === this.itemPtr.shortDesc.itModel)\n\t\t\tconst exp = new SearchItemLinks(\"LinkParents\").setPath(this.itemPtr.srcRef);\n\t\t\tif (whiteElt && whiteElt.lnkTraits)\n\t\t\t\texp.setLinkTraitFilter(whiteElt.lnkTraits.join('|'))\n\t\t\treturn exp;\n\t\t}\n\t}\n\n\tprotected getUiCritXmlAtt(): string {\n\t\treturn this.critArea.getId();\n\t}\n}\n\ncustomElements.define(\"wsp-itemcrit-props-ref\", ItemPropsCritRef);"]}