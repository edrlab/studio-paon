{"version":3,"sources":["/@back@/wsp/areas/drvOverrides.tsx"],"names":["CellBuilderFlagIcon","GridColDef","REG","Button","ButtonToggle","JSX","UiCritArea","UiCritBase","ESearchExportColumnStatus","SearchDrvStates","SearchExportColumn","SearchFuncTranslateStr","DOMSH","RibbonBase","renderAppend","xhtml","SrcAction","POPUP","BarActions","WSP_DRV","CellBuilderDrvFlag","[object Object]","this","iconWidth","iconFilter","row","st","super","_getValue","getDrvStateLabel","reg","registerSkin","DeleteDrvOvr","_group","_icon","atLeastOne","isNotRemoved","_enableSrcPerms","ctx","shortDescs","length","some","sd","drvState","startsWith","isEnabled","ev","wsp","env","confirm","srcDeleteOverride","emitter","count","okLbl","SINGLETON","registerSvc","MarkDrvDone","_label","endsWith","srcMarkDrvDone","RibbonDrv","init","_initialize","longDescChange","add","refresh","bind","setTooltip","_tooltip","rib","longDesc","getDrvStateLayer","getDrvStateDone","tooltip","createElement","id","class","î","actions","getSvc","actionContext","shortDescCtx","uiContext","disableFullOverlay","hidden","template","shadowRoot","customElements","define","ItemCritDrvState","notOverriden","_notOverridenBtn","toggleOn","state","notOverridenDone","_notOverridenDoneBtn","notOverridenDirty","_notOverridenDirtyBtn","overridenNew","_overridenNewBtn","overridenDone","_overridenDoneBtn","overridenDirty","_overridenDirtyBtn","createdNew","_createdNewBtn","createdDone","_createdDoneBtn","createdDirty","_createdDirtyBtn","sr","critHead","appendChild","insertAlternativesBtn","gridContainer","onclick","toggleColumn","icon","data-column","title","ui-context","toggleRow","label","data-row","toggleButton","aria-pressed","append","xml","states","hasAttribute","getAttribute","split","indexOf","push","me","findHost","onChange","isSelected","column","AREA","setLabel","setGroup","setBuildAbstract","statesCodesList","statesLabelsList","statesList","returnElt","join","initDrvReg","drvColDef","setFlex","setCellBuilder","setSkin","setDescription","addToList","setColDef","setDict","erased","createdNotComputed","notComputed","setExportStatus","exportable","addSrcSvcAction","svc","sortKey","addSvcToList"],"mappings":"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","sourcesContent":["import {CellBuilderFlagIcon} from \"back/commons/widgets/grid-libs\";\nimport {GridColDef, IGridDataRow} from \"back/commons/widgets/grid-core\";\nimport {IReg, IRegPointer, REG} from \"lib/commons/registry\";\nimport {Button, ButtonToggle} from \"back/commons/widgets/buttons\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {EDrvState} from \"lib/wsp/src\";\nimport {IWspUiEnv} from \"lib/wsp/wsp\";\nimport {OUiCritInit, UiCritArea, UiCritBase} from \"back/wsp/widgets/search/uiCrit\";\nimport {ESearchExportColumnStatus, ISearchCrit, SearchDrvStates, SearchExportColumn, SearchFuncTranslateStr} from \"lib/wsp/search\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {RibbonBase} from \"back/wsp/widgets/ribbon/ribbon\";\nimport {TemplateResult} from \"res/litHtml/lib/template-result\";\nimport {renderAppend, xhtml} from \"lib/commons/utils/htmlLit\";\nimport {SrcAction} from \"back/wsp/actions/srcActions\";\nimport {IShortDescCtx} from \"lib/wsp/item\";\nimport {POPUP, PopupTooltip} from \"back/commons/widgets/popups\";\nimport {IView} from \"lib/commons/views\";\nimport {BarActions, OBarActionsInit} from \"back/commons/widgets/bars\";\nimport {WSP_DRV} from \"lib/wsp/drv\";\n\nexport class CellBuilderDrvFlag extends CellBuilderFlagIcon {\n\n\ticonWidth = \".8rem\";\n\n\ticonFilter = \"var(--filter)\";\n\n\tprotected _getIcon(row: IGridDataRow): string {\n\t\tconst st = super._getValue(row);\n\t\treturn st ? \"--drv-\" + st + \"-url\" : \"\";\n\t}\n\n\tprotected _getValue(row: IGridDataRow): any {\n\t\tconst st = super._getValue(row);\n\t\treturn st ? WSP_DRV.getDrvStateLabel(st as EDrvState) : \"\";\n\t}\n}\n\nREG.reg.registerSkin(\"wsp-explorer/grid/drv\", 1, /* language=CSS */ `\n\t:host {\n\t\t--drv-notOverriden-url: url(\"/@skin@/wsp/objects/drvState/notOverriden.svg\");\n\t\t--drv-notOverridenDone-url: url(\"/@skin@/wsp/objects/drvState/notOverridenDone.svg\");\n\t\t--drv-notOverridenDirty-url: url(\"/@skin@/wsp/objects/drvState/notOverridenDirty.svg\");\n\t\t--drv-overridenNew-url: url(\"/@skin@/wsp/objects/drvState/overridenNew.svg\");\n\t\t--drv-overridenDone-url: url(\"/@skin@/wsp/objects/drvState/overridenDone.svg\");\n\t\t--drv-overridenDirty-url: url(\"/@skin@/wsp/objects/drvState/overridenDirty.svg\");\n\t\t--drv-createdNew-url: url(\"/@skin@/wsp/objects/drvState/createdNew.svg\");\n\t\t--drv-createdDone-url: url(\"/@skin@/wsp/objects/drvState/createdDone.svg\");\n\t\t--drv-createdDirty-url: url(\"/@skin@/wsp/objects/drvState/createdDirty.svg\");\n\t}\n\n\t.drv {\n\t\tborder: none !important;\n\t}\n`);\n\n\n/**\n *\n */\nexport class DeleteDrvOvr extends SrcAction<IShortDescCtx> {\n\tstatic SINGLETON = new DeleteDrvOvr();\n\n\tconstructor() {\n\t\tsuper('deleteDrvOvr');\n\t\tthis._group = \"edit\";\n\t\tthis._icon = \"/@skin@/wsp/actions/drvDeleteOvr.svg\";\n\t\tthis.atLeastOne = true;\n\t\tthis.isNotRemoved = false;\n\t\tthis._enableSrcPerms = [\"action.drv#deleteOvr\"];\n\t}\n\n\tgetLabel(ctx: IShortDescCtx): string {\n\t\tif (ctx.shortDescs.length === 0) return \"Supprimer toutes les surcharges\";\n\t\treturn \"Supprimer les surcharges\";\n\t}\n\n\tisEnabled(ctx: IShortDescCtx): boolean {\n\t\tif (ctx.shortDescs.some((sd) => !sd.drvState.startsWith(\"overriden\"))) return false;\n\t\treturn super.isEnabled(ctx);\n\t}\n\n\tasync execute(ctx: IShortDescCtx, ev?: Event) {\n\t\tconst wsp = ctx.reg.env.wsp;\n\t\tif (await this.confirm(ctx, ev)) {\n\t\t\tawait WSP_DRV.srcDeleteOverride(ctx.reg.env.wsp, ctx.emitter, ctx.shortDescs);\n\t\t}\n\t}\n\n\tconfirm(ctx: IShortDescCtx, ev?: Event): Promise<boolean> {\n\t\tconst count = ctx.shortDescs.length;\n\t\tif (count === 0) return POPUP.confirm(\"Confirmez la suppression de toutes les surcharges de l'atelier. Les contenus originaux seront restaurés.\", ctx.emitter, {okLbl: \"Supprimer les surcharges\"});\n\t\treturn POPUP.confirm(`Confirmez la suppression des surcharges. Les contenus originaux seront restaurés.`, ctx.emitter, {okLbl: \"Supprimer les surcharges\"});\n\t}\n}\n\nREG.reg.registerSvc('drv/deleteDrvOvrAction', 1, DeleteDrvOvr.SINGLETON);\n\n/**\n *\n */\nexport class MarkDrvDone extends SrcAction<IShortDescCtx> {\n\tstatic SINGLETON = new MarkDrvDone();\n\n\tconstructor() {\n\t\tsuper('markDrvDone');\n\t\tthis._label = \"Marquer la dérivation achevée\";\n\t\tthis._group = \"edit\";\n\t\tthis._icon = \"/@skin@/wsp/actions/drvDone.svg\";\n\t\tthis.atLeastOne = true;\n\t\tthis.isNotRemoved = false;\n\t\tthis._enableSrcPerms = [\"action.drv#markDone\"];\n\t}\n\n\tisEnabled(ctx: IShortDescCtx): boolean {\n\t\tif (ctx.shortDescs.some((sd) => sd.drvState.endsWith(\"Done\"))) return false;\n\t\treturn super.isEnabled(ctx);\n\t}\n\n\tasync execute(ctx: IShortDescCtx, ev?: Event) {\n\t\tconst wsp = ctx.reg.env.wsp;\n\t\tif (await this.confirm(ctx, ev)) {\n\t\t\tawait WSP_DRV.srcMarkDrvDone(ctx.reg.env.wsp, ctx.emitter, ctx.shortDescs);\n\t\t}\n\t}\n\n\tconfirm(ctx: IShortDescCtx, ev?: Event): Promise<boolean> {\n\t\treturn POPUP.confirm(\"Confirmez le marquage \\\"achevé\\\" de la dérivation.\", ctx.emitter, {okLbl: \"Marquer \\\"achevé\\\"\"});\n\t}\n}\n\nREG.reg.registerSvc('drv/markDrvDoneAction', 1, MarkDrvDone.SINGLETON);\n\n/**\n *\n */\nexport class RibbonDrv extends RibbonBase {\n\n\tprotected _initialize(init: any): void {\n\t\tsuper._initialize(init);\n\t\tthis.reg.env.longDescChange.add(this.refresh.bind(this));\n\t\tthis.setTooltip(this._tooltip, true);\n\t}\n\n\ttemplate(rib: RibbonDrv): TemplateResult {\n\t\treturn xhtml`<div class=\"smallTi\">Calque de dérivation</div><div id=\"st\" data-drv-state=\"${rib.reg.env.longDesc.drvState}\"><img id=\"ico\"/><div class=\"layer\">${WSP_DRV.getDrvStateLayer(rib.reg.env.longDesc.drvState)}</div><div class=\"done\">${WSP_DRV.getDrvStateDone(rib.reg.env.longDesc.drvState)}</div></div>`;\n\t}\n\n\t_tooltip(this: void, rib: RibbonDrv, tooltip: PopupTooltip): IView | null {\n\t\treturn <div id=\"ttRoot\">\n\t\t\t<BarActions class=\"vertical\" î={{\n\t\t\t\treg: rib.reg,\n\t\t\t\tactions: [rib.reg.getSvc('drv/markDrvDoneAction'), rib.reg.getSvc('drv/deleteDrvOvrAction')],\n\t\t\t\tactionContext: rib.shortDescCtx,\n\t\t\t\tuiContext: \"dialog\",\n\t\t\t\tdisableFullOverlay: true\n\t\t\t} as OBarActionsInit<IShortDescCtx>}/>\n\t\t</div>;\n\t}\n\n\tprotected _refresh() {\n\t\tif (!this.hidden) renderAppend(this.template(this), this.shadowRoot);\n\t}\n}\n\nREG.reg.registerSkin('wsp-rib-drv', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 0 1 auto;\n\t\tmargin: 0 .2em;\n\t\t--drv-notOverriden-url: url(/@skin@/wsp/objects/drvState/notOverriden.svg);\n\t\t--drv-notOverridenDone-url: url(/@skin@/wsp/objects/drvState/notOverridenDone.svg);\n\t\t--drv-notOverridenDirty-url: url(/@skin@/wsp/objects/drvState/notOverridenDirty.svg);\n\t\t--drv-overridenNew-url: url(/@skin@/wsp/objects/drvState/overridenNew.svg);\n\t\t--drv-overridenDone-url: url(/@skin@/wsp/objects/drvState/overridenDone.svg);\n\t\t--drv-overridenDirty-url: url(/@skin@/wsp/objects/drvState/overridenDirty.svg);\n\t\t--drv-createdNew-url: url(/@skin@/wsp/objects/drvState/createdNew.svg);\n\t\t--drv-createdDone-url: url(/@skin@/wsp/objects/drvState/createdDone.svg);\n\t\t--drv-createdDirty-url: url(/@skin@/wsp/objects/drvState/createdDirty.svg);\n\t}\n\n\n\t#st {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: min-content 1fr;\n\t\tgrid-template-rows: min-content min-content;\n\t\tgap: 0px 0px;\n\t\tgrid-template-areas:\n    \"ico layer\"\n    \"ico done\";\n\t}\n\n\t#layer, #done {\n\t\tflex: 1 0 auto;\n\t\tcolor: var(--alt1-color);\n\t\tfont-weight: bold;\n\t}\n\n\t#layer {\n\t\tgrid-area: layer;\n\t}\n\n\t#done {\n\t\tgrid-area: done;\n\t}\n\n\t#ico {\n\t\tgrid-area: ico;\n\t\talign-self: center;\n\t\twidth: 1em;\n\t\theight: 1em;\n\t\tmargin-inline-end: 0.2em;\n\t}\n\n\t#st[data-drv-state='notOverriden'] > #ico {\n\t\tcontent: var(--drv-notOverriden-url);\n\t}\n\n\t#st[data-drv-state='notOverridenDone'] > #ico {\n\t\tcontent: var(--drv-notOverridenDone-url);\n\t}\n\n\t#st[data-drv-state='notOverridenDirty'] > #ico {\n\t\tcontent: var(--drv-notOverridenDirty-url);\n\t}\n\n\t#st[data-drv-state='overridenNew'] > #ico {\n\t\tcontent: var(--drv-overridenNew-url);\n\t}\n\n\t#st[data-drv-state='overridenDone'] > #ico {\n\t\tcontent: var(--drv-overridenDone-url);\n\t}\n\n\t#st[data-drv-state='overridenDirty'] > #ico {\n\t\tcontent: var(--drv-overridenDirty-url);\n\t}\n\n\t#st[data-drv-state='createdNew'] > #ico {\n\t\tcontent: var(--drv-createdNew-url);\n\t}\n\n\t#st[data-drv-state='createdDone'] > #ico {\n\t\tcontent: var(--drv-createdDone-url);\n\t}\n\n\t#st[data-drv-state='createdDirty'] > #ico {\n\t\tcontent: var(--drv-createdDirty-url);\n\t}\n\n\n`);\n\ncustomElements.define('wsp-rib-drv', RibbonDrv);\n\n/**\n * Critère de recherche DRV : ItemCritDrvState\n *    <wsp-itemcrit-drv-state/>\n */\nexport class ItemCritDrvState extends UiCritBase {\n\n\tstatic AREA = new UiCritArea(\"wsp-itemcrit-drv-state\").setLabel(\"Propriété de dérivation\").setGroup(\"item\")\n\t\t.setBuildAbstract((xml: Element, ctx: OUiCritInit): HTMLElement => {\n\t\t\tconst statesCodesList = xml.hasAttribute(\"drvStates\") ? xml.getAttribute(\"drvStates\").split(\" \") : [];\n\t\t\tconst statesLabelsList = [];\n\t\t\tif (statesCodesList.indexOf(\"notOverriden\") > -1) statesLabelsList.push(\"non surchargé, non achevé\");\n\t\t\tif (statesCodesList.indexOf(\"notOverridenDone\") > -1) statesLabelsList.push(\"non surchargé, achevé\");\n\t\t\tif (statesCodesList.indexOf(\"notOverridenDirty\") > -1) statesLabelsList.push(\"non surchargé, à contrôler\");\n\t\t\tif (statesCodesList.indexOf(\"overridenNew\") > -1) statesLabelsList.push(\"surchargé, non achevé\");\n\t\t\tif (statesCodesList.indexOf(\"overridenDone\") > -1) statesLabelsList.push(\"surchargé, achevé\");\n\t\t\tif (statesCodesList.indexOf(\"overridenDirty\") > -1) statesLabelsList.push(\"surchargé, à contrôler\");\n\t\t\tif (statesCodesList.indexOf(\"notOverriden\") > -1) statesLabelsList.push(\"non surchargé\");\n\t\t\tif (statesCodesList.indexOf(\"createdNew\") > -1) statesLabelsList.push(\"local, non achevé\");\n\t\t\tif (statesCodesList.indexOf(\"createdDone\") > -1) statesLabelsList.push(\"local, achevé\");\n\t\t\tif (statesCodesList.indexOf(\"createdDirty\") > -1) statesLabelsList.push(\"local, à contrôler\");\n\n\t\t\tif (statesLabelsList.length > 0) {\n\t\t\t\tif (statesLabelsList.length == 1) {\n\t\t\t\t\tconst statesList = <span class=\"critVal\">{statesLabelsList[0]}</span>;\n\t\t\t\t\treturn <span class=\"crit\">Propriété de dérivation {statesList}</span>;\n\t\t\t\t} else {\n\t\t\t\t\tconst returnElt = <span class=\"crit\">Propriétés de dérivation</span>;\n\t\t\t\t\treturnElt.title = \"'\" + statesLabelsList.join(\"', ou '\") + \"'\";\n\t\t\t\t\treturn returnElt;\n\t\t\t\t}\n\t\t\t\t/*\n\t\t\t\tlet statesList = <div/>;\n\t\t\t\tstatesLabelsList.forEach((entry, index) => {\n\t\t\t\t\tif(index > 0)\n\t\t\t\t\t\tstatesList.appendChild(<span> ou </span>);\n\t\t\t\t\tstatesList.appendChild(<span class=\"critVal\">{entry}</span>);\n\t\t\t\t});\n\t\t\t\treturn <span class=\"crit\">Propriété de dérivation {statesList}</span>;\n\t\t\t\t*/\n\t\t\t}\n\t\t});\n\n\tprotected _notOverridenBtn: ButtonToggle;\n\n\tprotected _notOverridenDoneBtn: ButtonToggle;\n\n\tprotected _notOverridenDirtyBtn: ButtonToggle;\n\n\tprotected _overridenNewBtn: ButtonToggle;\n\n\tprotected _overridenDoneBtn: ButtonToggle;\n\n\tprotected _overridenDirtyBtn: ButtonToggle;\n\n\tprotected _createdNewBtn: ButtonToggle;\n\n\tprotected _createdDoneBtn: ButtonToggle;\n\n\tprotected _createdDirtyBtn: ButtonToggle;\n\n\tget notOverriden(): boolean {return this._notOverridenBtn.toggleOn}\n\n\tset notOverriden(state: boolean) {this._notOverridenBtn.toggleOn = state}\n\n\tget notOverridenDone(): boolean {return this._notOverridenDoneBtn.toggleOn}\n\n\tset notOverridenDone(state: boolean) {this._notOverridenDoneBtn.toggleOn = state}\n\n\tget notOverridenDirty(): boolean {return this._notOverridenDirtyBtn.toggleOn}\n\n\tset notOverridenDirty(state: boolean) {this._notOverridenDirtyBtn.toggleOn = state}\n\n\tget overridenNew(): boolean {return this._overridenNewBtn.toggleOn}\n\n\tset overridenNew(state: boolean) {this._overridenNewBtn.toggleOn = state}\n\n\tget overridenDone(): boolean {return this._overridenDoneBtn.toggleOn}\n\n\tset overridenDone(state: boolean) {this._overridenDoneBtn.toggleOn = state}\n\n\tget overridenDirty(): boolean {return this._overridenDirtyBtn.toggleOn}\n\n\tset overridenDirty(state: boolean) {this._overridenDirtyBtn.toggleOn = state}\n\n\tget createdNew(): boolean {return this._createdNewBtn.toggleOn}\n\n\tset createdNew(state: boolean) {this._createdNewBtn.toggleOn = state}\n\n\tget createdDone(): boolean {return this._createdDoneBtn.toggleOn}\n\n\tset createdDone(state: boolean) {this._createdDoneBtn.toggleOn = state}\n\n\tget createdDirty(): boolean {return this._createdDirtyBtn.toggleOn}\n\n\tset createdDirty(state: boolean) {this._createdDirtyBtn.toggleOn = state}\n\n\n\tprotected _initialize(init: OUiCritInit): void {\n\t\tsuper._initialize(init);\n\t\tconst sr = this.shadowRoot;\n\n\t\tconst critHead = sr.appendChild(<div class=\"critHead\">\n\t\t\t<span class=\"critTitle\">Propriété de dérivation</span>\n\t\t\t{this.insertAlternativesBtn(init)}\n\t\t</div>);\n\n\t\tconst gridContainer = sr.appendChild(<div class=\"gridContainer\"/>);\n\n\t\t// Ligne d'entête\n\t\tgridContainer.appendChild(<div/>);\n\t\tgridContainer.appendChild(<Button onclick={this.toggleColumn} icon=\"/@skin@/wsp/objects/drvState/new.svg\" data-column=\"new\" title=\"Items jamais marqués 'achevés'\" ui-context=\"bar\"/>);\n\t\tgridContainer.appendChild(<Button onclick={this.toggleColumn} icon=\"/@skin@/wsp/objects/drvState/done.svg\" data-column=\"done\" title=\"Items marqués 'achevés'\" ui-context=\"bar\"/>);\n\t\tgridContainer.appendChild(<Button onclick={this.toggleColumn} icon=\"/@skin@/wsp/objects/drvState/dirty.svg\" data-column=\"dirty\" title=\"Items à (re)contrôler\" ui-context=\"bar\"/>);\n\n\t\t// Ligne 'notOverriden'\n\t\tgridContainer.appendChild(<Button onclick={this.toggleRow} label=\"Non surchargés\" data-row=\"notOverriden\" title=\"Items originaux non surchargés dans cette dérivation\" ui-context=\"bar\"/>);\n\t\tthis._notOverridenBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/notOverriden.svg\" class=\"notOverriden\" title=\"Items non surchargés, jamais marqués 'achevés'\"/> as ButtonToggle;\n\t\tthis._notOverridenDoneBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/notOverridenDone.svg\" class=\"notOverridenDone\" title=\"Items non surchargés, marqués 'achevés'\"/> as ButtonToggle;\n\t\tthis._notOverridenDirtyBtn =\n\t\t\t<ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/notOverridenDirty.svg\" class=\"notOverridenDirty\" title=\"Items non surchargés, à contrôler\" aria-pressed=\"true\"/> as ButtonToggle;\n\t\tgridContainer.append(<div class=\"bg\">{this._notOverridenBtn}</div>, <div class=\"bg\">{this._notOverridenDoneBtn}</div>, <div class=\"bg\">{this._notOverridenDirtyBtn}</div>);\n\n\t\t// Ligne 'overriden'\n\t\tgridContainer.appendChild(<Button onclick={this.toggleRow} label=\"Surchargés\" data-row=\"overriden\" title=\"Items surchargés dans cette dérivation\" ui-context=\"bar\"/>);\n\t\tthis._overridenNewBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/overridenNew.svg\" class=\"overridenNew\" title=\"Items surchargés, jamais marqués 'achevés'\"/> as ButtonToggle;\n\t\tthis._overridenDoneBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/overridenDone.svg\" class=\"overridenDone\" title=\"Items surchargés, marqués 'achevés'\"/> as ButtonToggle;\n\t\tthis._overridenDirtyBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/overridenDirty.svg\" class=\"overridenDirty\" title=\"Items surchargés, à contrôler\" aria-pressed=\"true\"/> as ButtonToggle;\n\t\tgridContainer.append(<div class=\"bg\">{this._overridenNewBtn}</div>, <div class=\"bg\">{this._overridenDoneBtn}</div>, <div class=\"bg\">{this._overridenDirtyBtn}</div>);\n\n\t\t// Ligne 'notOverriden'\n\t\tgridContainer.appendChild(<Button onclick={this.toggleRow} label=\"Spécifiques\" data-row=\"created\" title=\"Items créés spécifiquement dans cette dérivation\" ui-context=\"bar\"/>);\n\t\tthis._createdNewBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/createdNew.svg\" class=\"created\" title=\"Items spécifiques à cet atelier, jamais marqués 'achevés'\"/> as ButtonToggle;\n\t\tthis._createdDoneBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/createdDone.svg\" class=\"createdDone\" title=\"Items spécifiques à cet atelier, marqués 'achevés'\"/> as ButtonToggle;\n\t\tthis._createdDirtyBtn = <ButtonToggle onclick={this.toggleButton} icon=\"/@skin@/wsp/objects/drvState/createdDirty.svg\" class=\"createdDirty\" title=\"Items spécifiques à cet atelier, à contrôler\" aria-pressed=\"true\"/> as ButtonToggle;\n\t\tgridContainer.append(<div class=\"bg\">{this._createdNewBtn}</div>, <div class=\"bg\">{this._createdDoneBtn}</div>, <div class=\"bg\">{this._createdDirtyBtn}</div>);\n\n\t}\n\n\tasync initFromXmlCrit(xml: Element): Promise<this> {\n\t\tconst states = xml.hasAttribute(\"drvStates\") ? xml.getAttribute(\"drvStates\").split(\" \") : [];\n\t\tthis.notOverriden = states.indexOf(\"notOverriden\") > -1;\n\t\tthis.notOverridenDone = states.indexOf(\"notOverridenDone\") > -1;\n\t\tthis.notOverridenDirty = states.indexOf(\"notOverridenDirty\") > -1;\n\t\tthis.overridenNew = states.indexOf(\"overridenNew\") > -1;\n\t\tthis.overridenDone = states.indexOf(\"overridenDone\") > -1;\n\t\tthis.overridenDirty = states.indexOf(\"overridenDirty\") > -1;\n\t\tthis.createdNew = states.indexOf(\"createdNew\") > -1;\n\t\tthis.createdDone = states.indexOf(\"createdDone\") > -1;\n\t\tthis.createdDirty = states.indexOf(\"createdDirty\") > -1;\n\t\treturn this;\n\t}\n\n\tbuildCrit(): ISearchCrit | undefined {\n\t\tconst states: EDrvState[] = [];\n\t\tif (this.notOverriden) states.push(\"notOverriden\");\n\t\tif (this.notOverridenDone) states.push(\"notOverridenDone\");\n\t\tif (this.notOverridenDirty) states.push(\"notOverridenDirty\");\n\t\tif (this.overridenNew) states.push(\"overridenNew\");\n\t\tif (this.overridenDone) states.push(\"overridenDone\");\n\t\tif (this.overridenDirty) states.push(\"overridenDirty\");\n\t\tif (this.createdNew) states.push(\"createdNew\");\n\t\tif (this.createdDone) states.push(\"createdDone\");\n\t\tif (this.createdDirty) states.push(\"createdDirty\");\n\t\treturn new SearchDrvStates(states);\n\t}\n\n\tprivate toggleButton(this: ButtonToggle, ev?: Event): void {\n\t\tconst me = DOMSH.findHost(this) as ItemCritDrvState;\n\t\tthis.toggleOn = !this.toggleOn;\n\t\tme.onChange();\n\t}\n\n\tprivate toggleRow(this: Button): void {\n\t\tconst me = DOMSH.findHost(this) as ItemCritDrvState;\n\t\tconst row = this.getAttribute(\"data-row\");\n\t\tif (row == \"notOverriden\") {\n\t\t\tconst isSelected = me.notOverriden || me.notOverridenDone || me.notOverridenDirty;\n\t\t\tme.notOverriden = me.notOverridenDone = me.notOverridenDirty = !isSelected;\n\t\t} else if (row == \"overriden\") {\n\t\t\tconst isSelected = me.overridenNew || me.overridenDone || me.overridenDirty;\n\t\t\tme.overridenNew = me.overridenDone = me.overridenDirty = !isSelected;\n\t\t} else if (row == \"created\") {\n\t\t\tconst isSelected = me.createdNew || me.createdDone || me.createdDirty;\n\t\t\tme.createdNew = me.createdDone = me.createdDirty = !isSelected;\n\t\t}\n\t\tme.onChange();\n\t}\n\n\tprivate toggleColumn(this: Button): void {\n\t\tconst me = DOMSH.findHost(this) as ItemCritDrvState;\n\t\tconst column = this.getAttribute(\"data-column\");\n\t\tif (column == \"new\") {\n\t\t\tconst isSelected = me.notOverriden || me.overridenNew || me.createdNew;\n\t\t\tme.notOverriden = me.overridenNew = me.createdNew = !isSelected;\n\t\t} else if (column == \"done\") {\n\t\t\tconst isSelected = me.notOverridenDone || me.overridenDone || me.createdDone;\n\t\t\tme.notOverridenDone = me.overridenDone = me.createdDone = !isSelected;\n\t\t} else if (column == \"dirty\") {\n\t\t\tconst isSelected = me.notOverridenDirty || me.overridenDirty || me.createdDirty;\n\t\t\tme.notOverridenDirty = me.overridenDirty = me.createdDirty = !isSelected;\n\t\t}\n\t\tme.onChange();\n\t}\n}\n\nREG.reg.registerSkin('wsp-itemcrit-drv-state', 1, /* language=CSS */ `\n\t.gridContainer {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 9em repeat(3, 2.5em);\n\t\tgrid-template-rows: auto;\n\t}\n\n\t.bg {\n\t\tpadding: .2em;\n\t\tbackground-color: var(--form-bgcolor);\n\t\t--pressed-bgcolor: rgba(255, 255, 0, 0.2);\n\t}\n`);\n\ncustomElements.define(\"wsp-itemcrit-drv-state\", ItemCritDrvState);\n\n\n/**\n * Init du registre spécifique à un atelier de type DRF.\n * \t\tinit du registre **ui** (par app)\n */\nexport function initDrvReg(reg: IReg<IWspUiEnv>) {\n\tconst drvColDef = new GridColDef(\"drv\")\n\t\t.setFlex(\"1em\", 0, 0)\n\t\t.setCellBuilder(new CellBuilderDrvFlag(\"drvState\"))\n\t\t.setSkin(\"wsp-explorer/grid/drv\")\n\t\t.setLabel(\"\")\n\t\t.setDescription(\"État du calque de dérivation\");\n\n\treg.addToList('columns:wspExplorer:secondaryCols', 'drv', 1, drvColDef, 10);\n\treg.addToList(\"columns:netItems:secondaryCols\", 'drv', 1, drvColDef, 10);\n\n\treg.addToList(\"columns:wspApp:searches:item\", \"drv\", 1, drvColDef);\n\n\treg.addToList(\"columns:wspApp:searches-export:item\", \"drv\", 1, new SearchExportColumn<IRegPointer<IWspUiEnv>>('drv').setColDef(\n\t\tnew SearchFuncTranslateStr(\"drvState\").setDict(() => {\n\t\t\tconst states: { [key in EDrvState]: string } = {\n\t\t\t\terased: WSP_DRV.getDrvStateLabel(\"erased\"),\n\t\t\t\tnotOverriden: WSP_DRV.getDrvStateLabel(\"notOverriden\"),\n\t\t\t\tnotOverridenDone: WSP_DRV.getDrvStateLabel(\"notOverridenDone\"),\n\t\t\t\tcreatedDone: WSP_DRV.getDrvStateLabel(\"createdDone\"),\n\t\t\t\toverridenDone: WSP_DRV.getDrvStateLabel(\"overridenDone\"),\n\t\t\t\tcreatedNew: WSP_DRV.getDrvStateLabel(\"createdNew\"),\n\t\t\t\toverridenNew: WSP_DRV.getDrvStateLabel(\"overridenNew\"),\n\t\t\t\tnotOverridenDirty: WSP_DRV.getDrvStateLabel(\"notOverridenDirty\"),\n\t\t\t\tcreatedDirty: WSP_DRV.getDrvStateLabel(\"createdDirty\"),\n\t\t\t\toverridenDirty: WSP_DRV.getDrvStateLabel(\"overridenDirty\"),\n\t\t\t\tcreatedNotComputed: WSP_DRV.getDrvStateLabel(\"createdNotComputed\"),\n\t\t\t\tnotComputed: WSP_DRV.getDrvStateLabel(\"notComputed\"),\n\t\t\t};\n\t\t\treturn states;\n\t\t})).setLabel(\"Calque de dérivation : état\").setExportStatus(ESearchExportColumnStatus.exportable));\n\n\tfunction addSrcSvcAction(reg: IReg<IWspUiEnv>, svc: string, sortKey?: number) {\n\t\treg.addSvcToList(\"actions:wsp:shortDesc\", svc, 1, svc, sortKey);\n\t\t// reg.addToList(\"actions:wspApp:explorer\", act.getId(), 1, act, sortKey);\n\t\t// reg.addToList(\"actions:item:burger\", act.getId(), 1, act, sortKey);\n\t\t// reg.addToList(\"actions:searchItem:shortDesc:item\", act.getId(), 1, act, sortKey);\n\t}\n\n\taddSrcSvcAction(reg, 'drv/deleteDrvOvrAction', -2);\n\taddSrcSvcAction(reg, 'drv/markDrvDoneAction', -1);\n\n\treg.addToList(\"ribbon:item\", \"drv\", 1, RibbonDrv, 20);\n\n\tREG.reg.registerSvc(\"wsp-itemcrit-drv-state\", 1, ItemCritDrvState.AREA);\n\treg.addSvcToList(\"wsp.crit.items\", \"wsp-itemcrit-drv-state\", 1, \"wsp-itemcrit-drv-state\");\n}"]}