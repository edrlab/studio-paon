{"version":3,"sources":["/@back@/wsp/actions/taskActions.tsx"],"names":["FocusItem","SrcAction","ITEM","POPUP","ERROR","TASK","REG","FocusTask","[object Object]","super","this","_label","_icon","_group","exactOne","isNotRemoved","families","SINGLETON","reg","registerSvc","DeleteTask","atLeastOne","_enableSrcPerms","ctx","ev","ok","shortDescs","length","uri","srcUri","name","getSrcMainName","env","wsp","wspMetaUi","confirm","emitter","deleteTask","map","entry","srcId","e","report"],"mappings":"OAEQA,UAAWC,cAAU;OACNC,SAAK;OACpBC,UAAM;OACNC,UAAM;OACNC,SAAK;OACLC,QAAI;OAKN,MAAOC,kBAAkBP,UAG9BQ,cACCC,MAAM;AACNC,KAAKC,OAAS;AACdD,KAAKE,MAAQ;AACbF,KAAKG,OAAS;AACdH,KAAKI,SAAW;AAChBJ,KAAKK,aAAe;AACpBL,KAAKM,SAAW,CAAC,SATXT,UAAAU,UAAY,IAAIV;AAaxBD,IAAIY,IAAIC,YAAY,wBAAyB,EAAGZ,UAAUU;OAKpD,MAAOG,mBAAmBnB,UAI/BO,cACCC,MAAM;AACNC,KAAKC,OAAS;AACdD,KAAKG,OAAS;AACdH,KAAKW,WAAa;AAClBX,KAAKY,gBAAkB,CAAC;AACxBZ,KAAKM,SAAW,CAAC,QAGlBR,cAAce,IAAoBC,IACjC,IAAIC;AACJ,GAAIF,IAAIG,WAAWC,SAAW,EAAG,CAChC,MAAMC,IAAML,IAAIG,WAAW,GAAGG;AAC9B,MAAMC,KAAO5B,KAAK6B,eAAeR,IAAIL,IAAKK,IAAIG,WAAW,GAAIH,IAAIL,IAAIc,IAAIC,IAAIC;AAC7ET,SAAWtB,MAAMgC,QAAQ,0CAA0CL,WAAYP,IAAIa,aAC7E,CACN,MAAMT,OAASJ,IAAIG,WAAWC;AAC9BF,SAAWtB,MAAMgC,QAAQ,iCAAiCR,mBAAoBJ,IAAIa,SAEnF,GAAIX,GAAI,CACP,UACOpB,KAAKgC,WAAWd,IAAIL,IAAIc,IAAIC,IAAKV,IAAIa,QAASb,IAAIG,WAAWY,IAAKC,OAAUA,MAAMC,QACvF,MAAOC,SACFrC,MAAMsC,OAAO,oDAAqDD,EAAGlB,QAzBvEH,WAAAH,UAAY,IAAIG;AA+BxBd,IAAIY,IAAIC,YAAY,yBAA0B,EAAGC,WAAWH","sourcesContent":["import {JSX} from \"lib/commons/xml/dom\";\nimport {EItemTypeFamily} from \"lib/wsp/wspMetaUi\";\nimport {FocusItem, SrcAction} from \"back/wsp/actions/srcActions\";\nimport {IShortDescCtx, ITEM} from \"lib/wsp/item\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {ERROR} from \"lib/core/errorReport\";\nimport {TASK} from \"lib/wsp/lcTask\";\nimport {REG} from \"lib/commons/registry\";\n\n/**\n * Action qui affiche et focus une tâche\n */\nexport class FocusTask extends FocusItem {\n\tstatic SINGLETON = new FocusTask();\n\n\tconstructor() {\n\t\tsuper('focusTask');\n\t\tthis._label = \"Afficher cette tâche\";\n\t\tthis._icon = \"/@skin@/wsp/actions/showItem.svg\";\n\t\tthis._group = \"open\";\n\t\tthis.exactOne = true;\n\t\tthis.isNotRemoved = false;\n\t\tthis.families = ['task' as EItemTypeFamily.task];\n\t}\n}\n\nREG.reg.registerSvc('tasks/focusTaskAction', 1, FocusTask.SINGLETON);\n\n/**\n * Suppression de taches\n */\nexport class DeleteTask extends SrcAction<IShortDescCtx> {\n\n\tstatic SINGLETON = new DeleteTask();\n\n\tconstructor() {\n\t\tsuper('delSrc');\n\t\tthis._label = \"Supprimer\";\n\t\tthis._group = \"edit\";\n\t\tthis.atLeastOne = true;\n\t\tthis._enableSrcPerms = [\"write.task.delete\"];\n\t\tthis.families = ['task' as EItemTypeFamily.task];\n\t}\n\n\tasync execute(ctx: IShortDescCtx, ev?: Event) {\n\t\tlet ok: boolean;\n\t\tif (ctx.shortDescs.length === 1) {\n\t\t\tconst uri = ctx.shortDescs[0].srcUri;\n\t\t\tconst name = ITEM.getSrcMainName(ctx.reg, ctx.shortDescs[0], ctx.reg.env.wsp.wspMetaUi);\n\t\t\tok = await POPUP.confirm(`Supprimer DÉFINITIVEMENT cette tâche \"${name}\" ?`, ctx.emitter);\n\t\t} else {\n\t\t\tconst length = ctx.shortDescs.length;\n\t\t\tok = await POPUP.confirm(`Supprimer DÉFINITIVEMENT ces ${length} tâches ?`, ctx.emitter);\n\t\t}\n\t\tif (ok) {\n\t\t\ttry {\n\t\t\t\tawait TASK.deleteTask(ctx.reg.env.wsp, ctx.emitter, ctx.shortDescs.map((entry) => entry.srcId))\n\t\t\t} catch (e) {\n\t\t\t\tawait ERROR.report(\"Une erreur est survenue lors de la suppression.\", e, ctx);\n\t\t\t}\n\t\t}\n\t}\n}\n\nREG.reg.registerSvc('tasks/deleteTaskAction', 1, DeleteTask.SINGLETON);"]}