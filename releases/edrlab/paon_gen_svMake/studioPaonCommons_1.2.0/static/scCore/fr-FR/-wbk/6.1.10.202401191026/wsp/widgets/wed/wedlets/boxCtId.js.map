{"version":3,"sources":["/@back@/wsp/widgets/wed/wedlets/boxCtId.tsx"],"names":["REG","AgEltBoxSelection","Action","EWedletEditMode","isEditableWedlet","POPUP","BoxId","IO","ITEM","BoxCtId","[object Object]","this","setAttribute","fragmentId","selMode","actionsLists","groupOrder","reg","registerSkin","window","customElements","define","addToList","setLabel","setGroup","setIcon","setVisible","ctx","wedlet","isVirtual","editMode","write","setEnabled","wedMgr","hasPerm","setExecute","async","confirm","focusedElt","okLbl","kind","wsp","env","id","wspServer","config","wspSvcUrl","resolve","code","fetchText","qs","extractItemCode","longDesc","srcUri","method","docHolder","newBatch","setAttr","wedAnchor","doBatch"],"mappings":"OAAcA,QAAI;OAIVC,sBAAkB;OAClBC,WAAO;OACPC,gBAAiBC,qBAAmC;OACpDC,UAAM;OAENC,UAAM;OACNC,OAAG;OACHC,SAAK;OAEP,MAAOC,gBAAgBH,MAElBI,sBACTC,KAAKC,aAAa,QAAS,mBAAqBD,KAAKE,aAIvDZ,kBAAkBQ,QAAS,CAACK,QAAS,MAAOC,aAAc,CAAC,uBAAwB,sBAAuBC,WAAY;AAEtHhB,IAAIiB,IAAIC,aAAa,eAAgB,EAAsB;AAsB3DC,OAAOC,eAAeC,OAAO,eAAgBZ;AAE7CT,IAAIiB,IAAIK,UAAU,uBAAwB,WAAY,EAAG,IAAIpB,OAAyB,YACpFqB,SAAS,2BACTC,SAAS,QACTC,QAAQ,qCACRC,WAAYC,MAA2BA,IAAIC,OAAOC,aAAezB,iBAAiBuB,IAAIC,SAAWD,IAAIC,OAAOE,WAAa3B,gBAAgB4B,OACzIC,WAAYL,KAA0BA,IAAIC,OAAOK,OAAOhB,IAAIiB,QAAQ,+BAEpEC,WAAWC,MAAOT,MAClB,SAAUtB,MAAMgC,QAAQ,oGACvBV,IAAIW,WAAY,CAACC,MAAO,0BAA2BC,KAAM,YAAa,CACtE,MAAMP,OAASN,IAAIC,OAAOK;AAC1B,MAAMhB,IAAMgB,OAAOhB;AACnB,MAAMwB,IAAMxB,IAAIyB,IAAID;AACpB,MAAME,SAAWF,IAAIG,UAAUC,OAAOC,UAAUC,QAAQN,IAAIO,KAAO,SAASC,UAAU1C,GAAG2C,GAAG,QAAS1C,KAAK2C,gBAAgBlC,IAAIyB,IAAIU,SAASC,SAAU,CAACC,OAAQ;AAC9J3B,IAAIC,OAAOK,OAAOsB,UAAUC,WAAWC,QAAQ9B,IAAIC,OAAO8B,UAAWf,IAAIgB","sourcesContent":["import {IReg, REG} from \"lib/commons/registry\";\nimport {IItemUiEnv} from \"back/wsp/views/itemMain\";\nimport {IJmlNode, IJmlSubSet} from \"lib/commons/xml/jml\";\nimport {IXmlMsg} from \"lib/edit/ot/xmlHouse\";\nimport {AgEltBoxSelection} from \"back/edit/wed/features/boxSel\";\nimport {Action} from \"lib/commons/actions\";\nimport {EWedletEditMode, isEditableWedlet, IWedletActionCtx} from \"back/edit/wed/wedlets/wedlet\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {BoxId} from \"back/edit/wed/wedlets/box/boxId\";\nimport {IO} from \"lib/commons/io/io\";\nimport {ITEM} from \"lib/wsp/item\";\n\nexport class BoxCtId extends BoxId {\n\t//reg: IReg<IItemUiEnv>;\n\tprotected onFragmentIdChanged() {\n\t\tthis.setAttribute(\"title\", \"Identifiant : \" + this.fragmentId);\n\t}\n}\n\nAgEltBoxSelection(BoxCtId, {selMode: 'box', actionsLists: ['actions:wed:box-ctid', 'actions:wed:box-id'], groupOrder: '* edit'});\n\nREG.reg.registerSkin(\"wsp-box-ctid\", 1, /* language=CSS */ `\n\t:host {\n\t\ttab-index: 0;\n\t\tz-index: 2;\n\t\tcursor: default;\n\t\tuser-select: none;\n\t  color: var(--fade-color);\n\t  font-style: italic;\n\t\tborder: 1px solid var(--border-color);\n\t\tborder-radius: 0.75rem;\n\t\theight: 1.5em;\n\t\twidth: 1.5em;\n\t  align-self: end;\n\t\ttext-align: center;\n\t\tmargin: 0.5em 0.5em -2em;\n\t}\n\n\t:host(:focus) {\n\t\toutline: var(--focus-outline);\n\t}\n`);\n\nwindow.customElements.define(\"wsp-box-ctid\", BoxCtId);\n\nREG.reg.addToList(\"actions:wed:box-ctid\", \"changeId\", 1, new Action<IWedletActionCtx>(\"changeId\")\n\t.setLabel(\"Changer d'identifiant\")\n\t.setGroup(\"edit\")\n\t.setIcon(\"/@skin@/edit/wed/box/changeId.svg\")\n\t.setVisible((ctx: IWedletActionCtx) => !ctx.wedlet.isVirtual() && isEditableWedlet(ctx.wedlet) && ctx.wedlet.editMode === EWedletEditMode.write)\n\t.setEnabled((ctx: IWedletActionCtx) => ctx.wedlet.wedMgr.reg.hasPerm(\"action.wed#change.box-ctid\"))\n\t//.requireEnabledPerm(\"action.wed#change.box-id\") FIXME6 : manque le reg dans IWedletActionCtx pour faire fonctionner checkObjectRootPerm\n\t.setExecute(async (ctx: IWedletActionCtx) => {\n\t\tif (await POPUP.confirm(\"Attention : Changer d'identifiant aura pour effet de casser les liens Ã©tablis vers ce fragment.\",\n\t\t\tctx.focusedElt, {okLbl: \"Changer d'identifiant\", kind: \"warning\"})) {\n\t\t\tconst wedMgr = ctx.wedlet.wedMgr;\n\t\t\tconst reg = wedMgr.reg as IReg<IItemUiEnv>;\n\t\t\tconst wsp = reg.env.wsp;\n\t\t\tconst id = await wsp.wspServer.config.wspSvcUrl.resolve(wsp.code + \"/ctId\").fetchText(IO.qs(\"param\", ITEM.extractItemCode(reg.env.longDesc.srcUri)), {method: \"POST\"});\n\t\t\tctx.wedlet.wedMgr.docHolder.newBatch().setAttr(ctx.wedlet.wedAnchor, id).doBatch();\n\t\t}\n\t})\n);"]}