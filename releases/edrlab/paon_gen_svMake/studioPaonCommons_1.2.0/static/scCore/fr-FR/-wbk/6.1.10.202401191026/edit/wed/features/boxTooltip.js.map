{"version":3,"sources":["/@back@/edit/wed/features/boxTooltip.ts"],"names":["POPUP","REG","DOM","DOMSH","BASIS","LANG","ACTION","AgEltBoxTooltip","cls","opts","options","Object","assign","findFocusableOnShown","withTitle","factory","proto","prototype","connectedCallback","call","this","reg","wedlet","wedMgr","sh","shadowRoot","installSkin","removeAttribute","title","promiseTooltip","owner","tooltip","addEventListener","focusbale","findFlatNext","firstElementChild","IS_focusable","focus","hoverAllowed","skin","skinOver","AgEltBoxFloating","display","disconnectedCallback","openFct","focusOnClose","showFloating","popup","_boxTtPopupFloating","closeOnBlur","indexOf","makeClickable","setAttribute","onclick","mouseOverRetarderCaller","ev","in","key","isAnyControlPressed","stopImmediatePropagation","preventDefault","_a","close","registerSkin"],"mappings":"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","sourcesContent":["import {POPUP, PopupFloating, PopupTooltip} from \"back/commons/widgets/popups\";\nimport {REG} from 'lib/commons/registry';\nimport {DOM} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {IBoxElement} from \"back/edit/wed/wedlets/box/boxTags\";\nimport {BASIS} from \"back/commons/basis\";\nimport {IView} from \"lib/commons/views\";\nimport {LANG} from \"lib/commons/lang\";\nimport {ACTION} from \"lib/commons/actions\";\n\n\ninterface OBoxTooltipOptions {\n\tfactory?: (owner: HTMLElement, tooltip: PopupTooltip) => IView | null,\n\tfindFocusableOnShown?: boolean,\n\t/** Comportement à adopter avec l'attribut title :\n\t * <ul>\n\t *\t\t<li>replaceTitle [comportement par défaut] : le tooltip <b>remplace</b> le title, qui ne sera donc pas affiché\n\t *\t\t<li>showOnlyIfNoTitle : le tooltip est affiché <b>SSi</b> la box ne possède pas de title\n\t *\t\t<li>showAll : le tooltip <b>et</b> le title sont affichés\n\t * </ul>\n\t */\n\twithTitle?: 'replaceTitle' | 'showOnlyIfNoTitle' | 'showAll',\n}\n\ninterface OBoxFloatingOptions {\n\t/** click par défaut */\n\tdisplay?: ('click' | 'over')[]\n\tfactory?: (owner: HTMLElement, tooltip: PopupFloating) => IView | null,\n\tfindFocusableOnShown?: boolean,\n}\n\n/**\n * Agregation pour les IElementWedlet : Affichage d'un tooltip (sur le mouseover)\n */\nexport function AgEltBoxTooltip(cls: any, opts: OBoxTooltipOptions): any {\n\tconst options = Object.assign({\n\t\tfindFocusableOnShown: false,\n\t\twithTitle: 'replaceTitle',\n\t}, opts);\n\tif (!options.factory) return;\n\n\tconst proto = cls.prototype as IBoxElement;\n\n\tconst connectedCallback = proto.connectedCallback;\n\n\tproto.connectedCallback = function (this: IBoxElement) {\n\t\tif (connectedCallback) connectedCallback.call(this);\n\t\tconst reg = this.wedlet.wedMgr.reg;\n\t\tconst sh = this.shadowRoot;\n\t\tif (sh) reg.installSkin(\"box-tt\", sh);\n\t\tif (options.withTitle === 'replaceTitle')\n\t\t\tthis.removeAttribute(\"title\");\n\n\t\tif (options.withTitle !== 'showOnlyIfNoTitle' || !this.title) {\n\t\t\tPOPUP.promiseTooltip(this, options.findFocusableOnShown ?\n\t\t\t\t(owner: HTMLElement, tooltip: PopupTooltip): IView | null => {\n\t\t\t\t\ttooltip.addEventListener('c-shown', () => {\n\t\t\t\t\t\tconst focusbale = DOMSH.findFlatNext(tooltip.firstElementChild, tooltip, DOM.IS_focusable);\n\t\t\t\t\t\tif (focusbale) focusbale.focus();\n\t\t\t\t\t});\n\t\t\t\t\treturn options.factory(owner, tooltip);\n\t\t\t\t} : options.factory,\n\t\t\t\t{hoverAllowed: true, skin: \"c-popup-tooltip\", skinOver: \"box-tt/popup\"});\n\t\t}\n\t};\n\treturn cls;\n}\n\n/**\n * Agregation pour les IElementWedlet : Affichage d'un floating\n */\nexport function AgEltBoxFloating(cls: any, opts: OBoxFloatingOptions): any {\n\tconst options: OBoxFloatingOptions = Object.assign({\n\t\tdisplay: ['click'],\n\t\tfindFocusableOnShown: false,\n\t}, opts);\n\tif (!options.factory) return;\n\tconst proto = cls.prototype as IBoxElement;\n\tconst connectedCallback = proto.connectedCallback;\n\tconst disconnectedCallback = proto.disconnectedCallback;\n\tproto.connectedCallback = function (this: IBoxElement) {\n\t\tif (connectedCallback) connectedCallback.call(this);\n\t\tconst reg = this.wedlet.wedMgr.reg;\n\t\tconst sh = this.shadowRoot;\n\t\tif (sh) reg.installSkin(\"box-tt\", sh);\n\t\tif (options.factory) {\n\t\t\tconst openFct = (focusOnClose?: boolean) => {\n\t\t\t\tPOPUP.showFloating((popup: PopupFloating) => {\n\t\t\t\t\tif (options.findFocusableOnShown) {\n\t\t\t\t\t\tpopup.addEventListener('c-shown', () => {\n\t\t\t\t\t\t\tconst focusbale = DOMSH.findFlatNext(popup.firstElementChild, popup, DOM.IS_focusable);\n\t\t\t\t\t\t\tif (focusbale) focusbale.focus();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t(this as any)._boxTtPopupFloating = popup;\n\t\t\t\t\tpopup.addEventListener('c-close', () => {\n\t\t\t\t\t\t(this as any)._boxTtPopupFloating = null;\n\t\t\t\t\t\tif (focusOnClose && DOM.IS_focusable(this)) this.focus();\n\t\t\t\t\t});\n\t\t\t\t\treturn options.factory(this, popup);\n\t\t\t\t}, this, this, {closeOnBlur: true, skin: \"c-popup-floating\", skinOver: \"box-tt/floating\"});\n\t\t\t};\n\n\t\t\tif (options.display.indexOf('click') > -1) {\n\t\t\t\tBASIS.makeClickable(this);\n\t\t\t\tthis.setAttribute(\"role\", \"button\");\n\t\t\t\tthis.onclick = () => openFct(true);\n\t\t\t}\n\t\t\tif (options.display.indexOf('over') > -1) {\n\t\t\t\tPOPUP.mouseOverRetarderCaller(this, false, openFct);\n\t\t\t\tthis.addEventListener('keypress', function (ev: KeyboardEvent) {\n\t\t\t\t\tif (LANG.in(ev.key, 'Enter', ' ') && !ACTION.isAnyControlPressed(ev)) {\n\t\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t\topenFct(true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tproto.disconnectedCallback = function (this: IBoxElement) {\n\t\t\t\tif (disconnectedCallback) disconnectedCallback.call(this);\n\t\t\t\t(this as any)._boxTtPopupFloating?.close();\n\t\t\t}\n\t\t}\n\t\treturn cls;\n\t}\n}\n\n\nREG.reg.registerSkin(\"box-tt\", 1, /* language=CSS */ `\n\t:host([role=button]) {\n\t\tcursor: pointer\n\t}\n`);\n\nREG.reg.registerSkin(\"box-tt/popup\", 1, /* language=CSS */ `\n\n`);"]}