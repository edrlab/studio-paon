{"version":3,"sources":["/@back@/wsp/actions/wspActions.tsx"],"names":["IO","MsgLabel","MsgOver","POPUP","Action","JSX","CDM","Desk","REG","EUserAspects","ERROR","WSP","Wsp","WSPTYPE","WSP_DRV","WSP_DRF","ChainAction","WspAction","[object Object]","ctx","_a","reg","env","wsp","super","isVisible","WspsAction","this","onlyOnWsps","regs","forEach","entry","push","length","checkCompatKey","checkCompat","isEnabled","getWspRegs","isBackendDb","findIndex","backEnd","isBackendFs","getDescription","perms","and","_visPerms","hasPerm","securityCtx","_enablePerms","ScanFsUpdatesAction","_icon","_label","_description","universe","config","ev","progress","showProgress","uiRoot","wspServer","adminWspFsUrl","fetchVoid","qs","code","finally","close","ExportWspAction","id","_group","name","getValidFileName","wspTitle","url","wsps","exportUrl","resolve","a","createElement","href","download","click","OpenPropsWspAction","setIcon","requireEnabledPerm","WspEditProps","import","showDialog","initialize","titleBar","barLabel","label","closeButton","resizer","initWidth","initHeight","onNextClose","SINGLETON","OpenPropsWspsAction","WspsEditModelProps","composedPath","viewPortX","viewPortY","AutoMigrWspAction","migrating","infoWsp","_b","_c","infoWspError","isMigrationNeeded","msg","confirm","okLbl","cancelLbl","wspMetaEditorDom","getUpdateEditor","vUnknownModels","wspTypeInst","wspOptions","wspTypeDef","querySelector","wspType","key","getAttribute","lang","version","title","uri","wspOptionsDef","querySelectorAll","wspOptionDef","unknown","unknownList","join","showNotifError","updateWspType","noCloseBtn","e","report","OpenPermsWspAction","setVisible","adminUsers","hasAspect","rolable","ObjRolesMapEdit","uiContext","rolesUiLayerSng","preSelectAccounts","objThis","objEditRolesMap","rolesMap","srcSetRoles","objEditRolesMapPerms","objFetchRolesMap","srcGetRoles","objFetchRolesMapForAccounts","pAccounts","srcGetRolesForAccounts","DeleteWspAction","WspRemoveProps","fixSize","DeleteWspsAction","WspsRemoveProps","DeletePermanentlyWspsAction","setLabel","count","WspsRemovePermanentlyProps","registerSkin","RestoreWspsAction","wspTitleErrosArray","dialog","sortWspsByDeep","mandatWspsTitles","find","props","drvMasterWsp","drfRefWsp","Promise","all","map","async","parentWspCd","parentWsp","waitForLoad","isDeleted","list","show","window","document","WspsMonitoring","wspsMonitoring","î","defaultStateKey","states","level","skinOver","errorsArray","updateWspStatus","restore","setTimeout","RemoveCacheWspAction","setCustomMsg","showMsgOver","documentElement","waitFor","removeCache","ReloadWspAction","reloadWsp","CreateWspFromWspAction","WspCreateProps","openWspAfterCreate","CreateDrfWspAction","requireVisiblePerm","hasFeature","WspCreatDrfProps","result","CreateDrvWspAction","isDrv","isDrf","WspCreatDrvProps","registerSvc","wspCd","srcRef","open","stringify","u","getId"],"mappings":"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","sourcesContent":["import {IO} from \"lib/commons/io/io\";\nimport {MsgLabel, MsgOver} from \"back/commons/basis\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {Action} from \"lib/commons/actions\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {CDM} from \"lib/commons/utils/cdm\";\nimport {IPopupable} from \"back/commons/widgets/popupable\";\nimport {Desk} from \"lib/commons/desk\";\nimport {IReg, IRegPointer, IRegsPointer, REG} from \"lib/commons/registry\";\nimport {ISecurityCtxPointer} from \"lib/commons/security\";\n\nimport {EUserAspects} from \"lib/core/user\";\nimport {ERROR} from \"lib/core/errorReport\";\n\nimport \"back/wsp/actions/actions_Perms\";\n\nimport {IWspEnv, IWspUiEnv, JWspType, JWspTypeInst, WSP, Wsp, wspCd} from \"lib/wsp/wsp\";\nimport {WSPTYPE} from \"lib/wsp/wspType\";\nimport {WSP_DRV} from \"lib/wsp/drv\";\nimport {WSP_DRF} from \"lib/wsp/drf\";\nimport {IChainEnv} from \"lib/wsp/chain\";\nimport {srcRef} from \"lib/wsp/src\";\n\nimport {ChainAction} from \"back/wsp/actions/chainActions\";\nimport type {WspRemoveProps, WspsRemovePermanentlyProps} from \"back/wsp/dialogs/wspProps\";\nimport type {JWspAppDef} from \"back/wsp/plugins/wspsPlg\";\nimport type {OObjRolesMapInit} from \"back/core/dialogs/objRolesMap\";\nimport type {OWspsMonitoringInit, WspsMonitoring} from \"back/wsp/widgets/wsp/wspsMonitoring\";\n\n/**\n * Contexte des actions associées à un atelier\n */\nexport interface IWspActionCtx extends IRegPointer<IWspUiEnv> {}\n\nexport interface ICreateWspCtx {\n\t/* True si undefined  */\n\topenWspAfterCreate?: boolean\n}\n\n/** Actions au niveau d'un atelier. */\nexport abstract class WspAction<E extends IWspActionCtx = IRegPointer<IWspUiEnv>> extends ChainAction<E> {\n\tisVisible(ctx: E): boolean {\n\t\tif (!ctx.reg?.env.wsp) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n}\n\n/**\n * Contexte des actions associées à plusieurs atelier\n */\nexport interface IWspsActionCtx extends IRegsPointer<IWspUiEnv> {}\n\nexport abstract class WspsAction<E extends IWspsActionCtx | IWspActionCtx> extends Action<E> {\n\t/** action affichée QUE dans les contextes ODB **/\n\tisBackendDb: boolean;\n\t/** action affichée QUE dans les contextes FS **/\n\tisBackendFs: boolean;\n\t/** */\n\tcheckCompatKey: string | null;\n\t/** L'action n'est visible QUE dans le contexte IWspsActionCtx */\n\tonlyOnWsps: boolean = true;\n\n\t/** Liste des ateliers à traiter\n\t * \t@return null si aucun atelier à traiter */\n\tpublic getWspRegs(ctx: E): IReg<IWspUiEnv>[] {\n\t\tlet regs: IReg<IWspUiEnv>[] = [];\n\t\tif ((ctx as IWspsActionCtx).regs)\n\t\t\t(ctx as IWspsActionCtx).regs.forEach((entry) => {if (entry.env.wsp) regs.push(entry)});\n\t\telse if (!this.onlyOnWsps && (ctx as IWspActionCtx).reg && (ctx as IWspActionCtx).reg.env.wsp)\n\t\t\tregs.push((ctx as IWspActionCtx).reg)\n\t\treturn regs.length > 0 ? regs : null;\n\t}\n\n\tisEnabled(ctx: E): boolean {\n\t\tif (this.checkCompatKey && !Desk.checkCompat(this.checkCompatKey)) return false;\n\t\treturn super.isEnabled(ctx);\n\t}\n\n\tisVisible(ctx: E): boolean {\n\t\tlet regs = this.getWspRegs(ctx);\n\t\tif (!regs) return false;\n\t\tif (this.isBackendDb && regs.findIndex((reg) => reg.env.wsp.backEnd === \"fs\") == -1) return false;\n\t\tif (this.isBackendFs && regs.findIndex((reg) => reg.env.wsp.backEnd === \"odb\") == -1) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\tgetDescription(ctx: E): string {\n\t\tif (this.checkCompatKey && !Desk.checkCompat(this.checkCompatKey))\n\t\t\treturn \"Ce navigateur n'est pas compatible avec cette fonction\";\n\t\treturn super.getDescription(ctx);\n\t}\n\n\tcheckObjectRootVisiblePerm(ctx: E, perms?: string | string[], and?: boolean): boolean {\n\t\tif (!perms) perms = this._visPerms;\n\t\tlet regs = this.getWspRegs(ctx);\n\t\tif (perms && regs && regs.findIndex((reg) => !reg.hasPerm(perms, (reg as ISecurityCtxPointer).securityCtx), and) > -1) return false;\n\t\treturn true;\n\t}\n\n\tcheckObjectRootPerm(ctx: E, perms?: string | string[], and?: boolean): boolean {\n\t\tif (!perms) perms = this._enablePerms;\n\t\tlet regs = this.getWspRegs(ctx);\n\t\tif (perms && regs && regs.findIndex((reg) => !reg.hasPerm(perms, (reg as ISecurityCtxPointer).securityCtx), and) > -1) return false;\n\t\treturn true;\n\t}\n\n}\n\n/** FS only. */\nexport class ScanFsUpdatesAction extends WspAction {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._icon = \"/@skin@/commons/icons/refresh.svg\";\n\t\tthis._label = \"Rafraîchir l'atelier\";\n\t\tthis._description = \"Détecte les changements de l'atelier réalisés directement dans le système de fichier.\";\n\t}\n\n\tisInstantiable(ctx: IRegPointer<IWspUiEnv>): boolean {\n\t\treturn ctx.reg.env.universe.config.backEnd === \"fs\";\n\t}\n\n\texecute(ctx: IRegPointer<IWspUiEnv>, ev?: Event): Promise<void> {\n\t\tconst progress = POPUP.showProgress(ctx.reg.env.uiRoot, \"Recherche des changements...\");\n\t\treturn ctx.reg.env.universe.wspServer.config.adminWspFsUrl.fetchVoid(IO.qs(\"cdaction\", \"ScanFsUpdates\", \"param\", ctx.reg.env.wsp.code)).finally(() => progress.close());\n\t}\n}\n\n/**\n * Export d'un atelier (.scwsp)\n */\nexport class ExportWspAction<E extends IWspActionCtx = IRegPointer<IWspUiEnv>> extends WspAction<E> {\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"exportWsp\");\n\t\tthis._label = \"Exporter une archive de l'atelier (.scwsp)\";\n\t\tthis._group = \"importExport\";\n\t\tthis._enablePerms = \"read.node.export\";\n\t}\n\n\texecute(ctx: E, ev?: Event): any | \"noPreventDefault\" | \"noStopPropag\" | \"noStopPropag-noPreventDefault\" {\n\t\tconst wsp = ctx.reg.env.wsp;\n\t\tconst name = IO.getValidFileName(wsp.wspTitle, \".scwsp\", 'dateTime');\n\t\tconst url = ctx.reg.env.universe.config.wsps.exportUrl.resolve(IO.qs(\"cdaction\", \"Export\", \"param\", wsp.code, \"format\", \"jar\", \"scope\", \"node\", \"mode\", \"wspTree\", \"refUris\", \"\", \"downloadFileName\", name)).url\n\t\tconst a = <a href={url} download={name}/> as HTMLAnchorElement;\n\t\ta.click();\n\t}\n}\n\n/** Propriétés d'un atelier : lecture et/ou écriture */\nexport class OpenPropsWspAction extends WspAction {\n\n\tstatic SINGLETON = new OpenPropsWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"openWspProps\");\n\t\tthis.checkCompatKey = \"formElt\";\n\t\tthis._label = \"Propriétés de l'atelier...\";\n\t\tthis._description = \"Afficher les propriétés de l'atelier\";\n\t\tthis._group = \"wsp\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspProps.svg\");\n\t\tthis.requireEnabledPerm(\"action.wsp#read.props\");\n\t}\n\n\tasync execute(ctx: IWspActionCtx, ev?: Event): Promise<void> {\n\t\tconst reg = ctx.reg;\n\t\tconst {WspEditProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\tconst wspTitle = reg.env.wsp.wspTitle;\n\t\tawait POPUP.showDialog(new WspEditProps().initialize({\n\t\t\treg: ctx.reg,\n\t\t}), ctx.reg.env.uiRoot, {\n\t\t\ttitleBar: {barLabel: {label: wspTitle ? `Atelier '${wspTitle}'` : `Propriétés`}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tinitWidth: \"min(90vw,60em)\",\n\t\t\tinitHeight: \"90vh\"\n\t\t}).onNextClose();\n\t}\n\n}\n\n/** Edition du modèle de plusieurs ateliers. */\nexport class OpenPropsWspsAction extends WspsAction<IWspsActionCtx> {\n\tstatic SINGLETON = new OpenPropsWspsAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"openPropsWspsModel\");\n\t\tthis.checkCompatKey = \"formElt\";\n\t\tthis._label = \"Éditer les propriétés des ateliers...\";\n\t\tthis._description = \"Éditer les propriétés des ateliers\";\n\t\tthis._group = \"wsp\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspEditModel.svg\");\n\t\tthis.requireEnabledPerm(\"action.wsp#update.wsptype\");\n\t}\n\n\tasync execute(ctx: IWspsActionCtx, ev?: Event): Promise<void> {\n\t\tconst {WspsEditModelProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\tawait POPUP.showDialog(new WspsEditModelProps().initialize(ctx), ev.composedPath()[0] as HTMLElement, {\n\t\t\ttitleBar: {barLabel: {label: \"Édition des propriétés des ateliers\"}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tinitWidth: \"50vw\",\n\t\t\tinitHeight: \"60vh\"\n\t\t}).onNextClose();\n\t}\n\n}\n\n/** Migration automatique d'un atelier */\nexport class AutoMigrWspAction extends WspAction {\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"AautoMigrWsp\");\n\t\tthis._label = \"Migrer l'atelier...\";\n\t\tthis._description = \"Migrer les contenus de l'atelier\";\n\t\tthis._group = \"wsp\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspMigr.svg\");\n\t\tthis.requireEnabledPerm(\"action.wsp#migrate\");\n\t}\n\n\tisVisible(ctx: IWspActionCtx): boolean {\n\t\tif (ctx.reg.env.wsp?.migrating) return false;\n\t\tlet infoWsp = ctx.reg.env.wsp?.infoWsp || ctx.reg.env.wsp?.infoWspError;\n\t\tif (!infoWsp?.isMigrationNeeded) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\tasync execute(ctx: IWspActionCtx, ev?: Event): Promise<void> {\n\t\tconst reg = ctx.reg;\n\t\tconst wspTitle = reg.env.wsp.wspTitle;\n\t\tconst msg = `Voulez-vous exécuter la migration des contenus de l'atelier '${wspTitle}' ?`;\n\t\tif (await POPUP.confirm(<div>\n\t\t\t<div>{msg}</div>\n\t\t\t<div><b>Vous ne pourrez pas annuler cette action.</b></div>\n\t\t</div>, reg.env.uiRoot, {okLbl: \"Migrer les contenus\", cancelLbl: \"Annuler\"})) {\n\t\t\ttry {\n\t\t\t\tlet wspMetaEditorDom: Document = await WSPTYPE.getUpdateEditor(ctx.reg.env.universe.wspServer, ctx.reg.env.wsp.code);\n\t\t\t\tlet vUnknownModels: string[] = [];\n\t\t\t\t// Construction du wspTypeInst cible (on ne conserve que les noeuds sélectionnés non obsolètes, ou \"newest\")\n\t\t\t\tlet wspTypeInst: JWspTypeInst = {wspOptions: []} as JWspTypeInst;\n\t\t\t\tlet wspTypeDef = wspMetaEditorDom.querySelector(\"wspTypeDef[newest], wspTypeDef[selected]:not([obsolete])\");\n\t\t\t\tif (wspTypeDef) {\n\t\t\t\t\twspTypeInst.wspType = {\n\t\t\t\t\t\tkey: wspTypeDef.getAttribute(\"key\"),\n\t\t\t\t\t\tlang: wspTypeDef.getAttribute(\"lang\"),\n\t\t\t\t\t\tversion: wspTypeDef.getAttribute(\"version\"),\n\t\t\t\t\t\ttitle: wspTypeDef.getAttribute(\"title\"),\n\t\t\t\t\t\turi: wspTypeDef.getAttribute(\"uri\")\n\t\t\t\t\t} as JWspType;\n\t\t\t\t\tif (wspTypeDef.getAttribute(\"unknown\"))\n\t\t\t\t\t\tvUnknownModels.push(wspTypeInst.wspType.title)\n\t\t\t\t\tlet wspOptionsDef = wspMetaEditorDom.querySelectorAll(\"wspOptionDef[newest], wspOptionDef[selected]:not([obsolete])\");\n\t\t\t\t\twspOptionsDef.forEach((wspOptionDef) => {\n\t\t\t\t\t\twspTypeInst.wspOptions.push({\n\t\t\t\t\t\t\tkey: wspOptionDef.getAttribute(\"key\"),\n\t\t\t\t\t\t\tlang: wspOptionDef.getAttribute(\"lang\"),\n\t\t\t\t\t\t\tversion: wspOptionDef.getAttribute(\"version\"),\n\t\t\t\t\t\t\ttitle: wspOptionDef.getAttribute(\"title\"),\n\t\t\t\t\t\t\turi: wspOptionDef.getAttribute(\"uri\"),\n\t\t\t\t\t\t\tunknown: wspOptionDef.getAttribute(\"unknown\")\n\t\t\t\t\t\t} as JWspType);\n\t\t\t\t\t\tif (wspOptionDef.getAttribute(\"unknown\"))\n\t\t\t\t\t\t\tvUnknownModels.push(wspOptionDef.getAttribute(\"title\"))\n\t\t\t\t\t});\n\n\t\t\t\t\tif (vUnknownModels.length) {\n\t\t\t\t\t\t// Refus de migration dont la cible est auto-déduite si la cible contient des modeles/exts inconnues : migr manuelle explicite par l'auteur\n\t\t\t\t\t\tconst unknownList = vUnknownModels.join(\", \");\n\t\t\t\t\t\tPOPUP.showNotifError(`La migration de l'atelier '${wspTitle}' ne peut avoir lieu car certaines extensions sont actuellement inconnues : \"${unknownList}\".\\nVeuillez choisir le modèle cible et ses extensions.`, reg.env.uiRoot)\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// - Exécution de la migration\n\t\t\t\t\t\tawait reg.env.wsp.updateWspType(wspTypeInst, true);\n\t\t\t\t\t\t//POPUP.showNotifInfo(`La migration de l'atelier '${wspTitle}' a été menée jusqu'à son terme.`, reg.env.uiRoot, {noCloseBtn: true, autoHide: 5000}) FAUX : action asynchrone => en attente des remontées ws de fin de migration\n\t\t\t\t\t}\n\t\t\t\t} else\n\t\t\t\t\tawait POPUP.showNotifError(\"La cible de migration n'a pas pu être déterminée. Veuillez ajuster le modèle documentaire de l'atelier via la fenêtre d'édition des propriétés.\", reg.env.uiRoot, {noCloseBtn: true});\n\t\t\t} catch (e) {\n\t\t\t\tawait ERROR.report(`La migration de l'atelier '${wspTitle}' n'a pas pu aboutir. Veuillez réessayer ultérieurement.`, e);\n\t\t\t}\n\t\t}\n\n\t}\n\n}\n\n/** Permissions affectées sur un atelier */\nexport class OpenPermsWspAction extends WspAction {\n\n\tstatic SINGLETON = new OpenPermsWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"openPermsWsp\");\n\t\tthis.checkCompatKey = \"formElt\";\n\t\tthis._label = \"Permissions sur l'atelier...\";\n\t\tthis._description = \"Définir les permissions de cet atelier\";\n\t\tthis._group = \"wsp\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspPerms.svg\");\n\t\tthis.requireEnabledPerm([\"action.wsp#set.perms\", \"admin.node.configRoles.byAdmin\"]);\n\t\tthis.setVisible((ctx) => ctx.reg.env.universe.adminUsers?.hasAspect(EUserAspects.rolable) ? true : false);\n\t}\n\n\tasync execute(ctx: IOpenPermsWspActionCtx, ev?: Event): Promise<void> {\n\t\tconst reg = ctx.reg;\n\t\tconst {ObjRolesMapEdit} = await import(\"back/core/dialogs/objRolesMap.js\");\n\t\tconst wspTitle = reg.env.wsp.wspTitle;\n\t\tawait POPUP.showDialog(new ObjRolesMapEdit<IWspActionCtx, IWspUiEnv>().initialize({\n\t\t\treg: ctx.reg,\n\t\t\tuiContext: \"popup\",\n\t\t\trolesUiLayerSng: \"wsp\",\n\t\t\tpreSelectAccounts: ctx.preSelectAccounts,\n\t\t\tobjThis: ctx,\n\t\t\tobjEditRolesMap: (objThis, rolesMap) => {return WSP.srcSetRoles(ctx.reg.env.wsp, ctx.reg.env.uiRoot, \"\", rolesMap)},\n\t\t\tobjEditRolesMapPerms: [\"action.wsp#set.perms\", \"admin.node.configRoles.byAdmin\"],\n\t\t\tobjFetchRolesMap: (objThis) => {return WSP.srcGetRoles(ctx.reg.env.wsp, ctx.reg.env.uiRoot, \"\")},\n\t\t\tobjFetchRolesMapForAccounts: (objThis, pAccounts: string[]) => {return WSP.srcGetRolesForAccounts(ctx.reg.env.wsp, ctx.reg.env.uiRoot, \"\", pAccounts)},\n\t\t} as OObjRolesMapInit<IWspActionCtx, IWspUiEnv>), ctx.reg.env.uiRoot, {\n\t\t\ttitleBar: {barLabel: {label: wspTitle ? `Permissions définies sur l'atelier '${wspTitle}'` : `Permissions définies sur l'atelier`}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tinitWidth: \"40em\",\n\t\t\tinitHeight: \"40em\"\n\t\t}).onNextClose();\n\t}\n\n}\n\nexport interface IOpenPermsWspActionCtx extends IWspActionCtx {\n\tpreSelectAccounts?: string[]\n}\n\n/** Suppression d'un atelier. */\nexport class DeleteWspAction extends WspAction {\n\tstatic SINGLETON = new DeleteWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"deleteWsp\");\n\t\tthis._label = \"Supprimer l'atelier...\";\n\t\tthis._description = \"Supprimer l'atelier\";\n\t\tthis._group = \"del\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspDelete.svg\");\n\t\tthis.requireEnabledPerm(\"action.wsp#delete\");\n\t}\n\n\tasync execute(ctx: IWspActionCtx, ev?: Event): Promise<boolean> {\n\t\tconst {WspRemoveProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\treturn await POPUP.showDialog<boolean>(new WspRemoveProps().initialize(ctx), ctx.reg.env.uiRoot, {\n\t\t\ttitleBar: {barLabel: {label: \"Suppression d'un atelier\"}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tfixSize: false\n\t\t}).onNextClose();\n\t}\n}\n\n\n/** Suppression de plusieurs ateliers. */\nexport class DeleteWspsAction extends WspsAction<IWspsActionCtx> {\n\tstatic SINGLETON = new DeleteWspsAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"deleteWsp\");\n\t\tthis._label = \"Supprimer les ateliers...\";\n\t\tthis._description = \"Supprimer les ateliers\";\n\t\tthis._group = \"del\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspDelete.svg\");\n\t\tthis.requireEnabledPerm(\"action.wsp#delete\");\n\t}\n\n\tasync execute(ctx: IWspsActionCtx, ev?: Event): Promise<void> {\n\t\tconst {WspsRemoveProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\tawait POPUP.showDialog(new WspsRemoveProps().initialize(ctx), ev.composedPath()[0] as HTMLElement, {\n\t\t\ttitleBar: {barLabel: {label: \"Suppression d'ateliers\"}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tinitWidth: \"50vw\",\n\t\t\tinitHeight: \"60vh\"\n\t\t}).onNextClose();\n\t}\n\n}\n\n/** Trashed : suppression */\nexport class DeletePermanentlyWspsAction extends WspsAction<(IWspsActionCtx | IWspActionCtx) & IRegPointer<IChainEnv>> {\n\tstatic SINGLETON = new DeletePermanentlyWspsAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"deletePermanentlyWsps\");\n\t\tthis.setLabel((ctx: (IWspsActionCtx | IWspActionCtx) & IRegPointer<IChainEnv>) => {\n\t\t\tlet count = (ctx as IWspsActionCtx).regs ? (ctx as IWspsActionCtx).regs.length : ((ctx as IWspActionCtx).reg ? 1 : 0);\n\t\t\treturn count > 1 ? `Supprimer définitivement les ${count} ateliers` : \"Supprimer définitivement l'atelier\";\n\t\t});\n\t\tthis._group = \"adminWsp\";\n\t\tthis.onlyOnWsps = false;\n\t\tthis.requireEnabledPerm(\"action.wsp#deletePermanently\");\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspDeletePermanently.svg\");\n\t}\n\n\tasync execute(ctx: (IWspsActionCtx | IWspActionCtx) & IRegPointer<IChainEnv>, ev?: Event): Promise<void> {\n\t\tconst {WspsRemovePermanentlyProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\tawait POPUP.showDialog(new WspsRemovePermanentlyProps().initialize({regs: this.getWspRegs(ctx), reg: ctx.reg}), ev.composedPath()[0] as HTMLElement, {\n\t\t\ttitleBar: {barLabel: {label: \"Suppression définitive d'ateliers\"}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tinitWidth: \"50vw\",\n\t\t\tinitHeight: \"60vh\"\n\t\t}).onNextClose();\n\t}\n\n}\n\nREG.reg.registerSkin('c-wsps-action', 1, /* language=CSS */ `\n\twsps-monitoring {\n\t\tmargin: 0 2em;\n\t\tmax-height: 15em;\n\t\toverflow: auto;\n\t}\n`);\n\n/** Trashed : restauration */\nexport class RestoreWspsAction extends WspsAction<(IWspsActionCtx | IWspActionCtx) & IRegPointer<IChainEnv>> {\n\tstatic SINGLETON = new RestoreWspsAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"restoreWsps\");\n\t\tthis.setLabel((ctx: (IWspsActionCtx | IWspActionCtx) & IRegPointer<IChainEnv>) => {\n\t\t\tlet count = (ctx as IWspsActionCtx).regs ? (ctx as IWspsActionCtx).regs.length : ((ctx as IWspActionCtx).reg ? 1 : 0);\n\t\t\treturn count > 1 ? `Restaurer les ${count} ateliers` : \"Restaurer l'atelier\";\n\t\t});\n\t\tthis._group = \"adminWsp\";\n\t\tthis.onlyOnWsps = false;\n\t\tthis.requireEnabledPerm(\"action.wsp#restore\");\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspRestore.svg\");\n\t}\n\n\t/**\n\t * @return : false si aucune restauration n'a eu lieu\n\t * @param ctx\n\t * @param ev\n\t */\n\tasync execute(ctx: (IWspsActionCtx | IWspActionCtx) & IRegPointer<IChainEnv>, ev?: Event): Promise<boolean> {\n\t\tlet wspTitleErrosArray: string[] = [];\n\t\tlet dialog: IPopupable;\n\t\ttry {\n\t\t\tlet regs = this.getWspRegs(ctx);\n\n\t\t\tlet wsps: Wsp[] = [];\n\t\t\tregs.forEach((entry) => {wsps.push(entry.env.wsp)});\n\t\t\twsps = WSP.sortWspsByDeep(wsps);\n\t\t\tlet count = wsps.length;\n\n\t\t\t// Controle : si drv/drf, le drfRefWsp ou drvMasterWsp ne doit pas être en corbeille\n\t\t\t//(await WSP.listWsps(this.reg.env.universe.wspServer, {inTrash: true, fields: [\"srcDt\", \"srcRoles\", \"srcRi\"]})).wsps\n\t\t\tlet mandatWspsTitles: string[] = [];\n\t\t\tif (wsps.find((wsp) => (wsp.infoWsp || wsp.infoWspError).props.drvMasterWsp || (wsp.infoWsp || wsp.infoWspError).props.drfRefWsp ? true : false)) {\n\t\t\t\tawait Promise.all(wsps.map(async (wsp) => {\n\t\t\t\t\tlet parentWspCd = (wsp.infoWsp || wsp.infoWspError).props.drvMasterWsp || (wsp.infoWsp || wsp.infoWspError).props.drfRefWsp;\n\t\t\t\t\tif (parentWspCd) {\n\t\t\t\t\t\tlet parentWsp = new Wsp(ctx.reg.env.universe.wspServer, parentWspCd);\n\t\t\t\t\t\tawait parentWsp.waitForLoad();\n\t\t\t\t\t\tif (parentWsp.isDeleted && !wsps.find((wsp) => wsp.code === parentWspCd))\n\t\t\t\t\t\t\tmandatWspsTitles.push(parentWsp.wspTitle)\n\t\t\t\t\t}\n\t\t\t\t}))\n\t\t\t}\n\t\t\tif (mandatWspsTitles.length > 0) {\n\t\t\t\tlet list = mandatWspsTitles.join(\", \");\n\t\t\t\tawait ERROR.show(`Les ateliers suivants doivent être restaurés au préalable : '${list}'.`);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (await POPUP.confirm(count > 1 ? `Voulez-vous vraiment restaurer les '${count}' ateliers ?` : \"Voulez-vous vraiment restaurer l'atelier ?\", window.document, {cancelLbl: \"Annuler\", okLbl: \"Restaurer\"})) {\n\t\t\t\tconst {WspsMonitoring} = await import(\"back/wsp/widgets/wsp/wspsMonitoring.js\");\n\t\t\t\tconst wspsMonitoring = <WspsMonitoring î={{\n\t\t\t\t\twsps: wsps,\n\t\t\t\t\tdefaultStateKey: \"notStart\",\n\t\t\t\t\tstates: [\n\t\t\t\t\t\t{key: \"notStart\", level: \"disabled\", label: \"En attente\"},\n\t\t\t\t\t\t{key: \"toRemove\", level: \"disabled\", label: \"À restaurer\"},\n\t\t\t\t\t\t{key: \"pending\", level: \"pending\", label: \"En cours...\"},\n\t\t\t\t\t\t{key: \"restored\", level: \"success\", label: \"Restauré\"},\n\t\t\t\t\t\t{key: \"failed\", level: \"error\", label: \"Échec\"}\n\t\t\t\t\t]\n\t\t\t\t} as OWspsMonitoringInit}/> as WspsMonitoring;\n\n\t\t\t\tdialog = POPUP.showDialog(<div>\n\t\t\t\t\t<MsgLabel label=\"Restauration en cours...\"/>\n\t\t\t\t\t{wspsMonitoring}\n\t\t\t\t</div>, window.document, {\n\t\t\t\t\tskinOver: \"c-wsps-action\",\n\t\t\t\t\tfixSize: false,\n\t\t\t\t\ttitleBar: null,\n\t\t\t\t\tinitWidth: '50%',\n\t\t\t\t});\n\t\t\t\tlet errorsArray: any[] = [];\n\t\t\t\tfor (const entry in wsps) {\n\t\t\t\t\tlet wsp = wsps[entry];\n\t\t\t\t\twspsMonitoring.updateWspStatus(wsp.code, \"pending\");\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait wsp.restore();\n\t\t\t\t\t\twspsMonitoring.updateWspStatus(wsp.code, \"restored\");\n\t\t\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\twspsMonitoring.updateWspStatus(wsp.code, \"failed\");\n\t\t\t\t\t\twspTitleErrosArray.push(wsp.wspTitle);\n\t\t\t\t\t\terrorsArray.push(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, errorsArray.length > 0 ? 3000 : 1000));\n\t\t\t\tif (errorsArray.length > 0) throw errorsArray;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlet list = wspTitleErrosArray.join(\", \");\n\t\t\tawait ERROR.report(list ? \"Restauration des ateliers en échec.\" : `Restauration des ateliers ${list} en échec.`, e);\n\t\t\treturn true;\n\t\t} finally {\n\t\t\tif (dialog) dialog.close();\n\t\t}\n\t}\n\n}\n\n/** Remove cache */\nexport class RemoveCacheWspAction extends WspAction {\n\tstatic SINGLETON = new RemoveCacheWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"removeCacheWsp\");\n\t\tthis._label = \"Vider le cache de l'atelier\";\n\t\tthis._description = \"Cache des transformations de ressources...\";\n\t\tthis._group = \"adminWsp\";\n\t\tthis.requireEnabledPerm(\"action.wsp#removeCache\");\n\t}\n\n\tasync execute(ctx: IRegPointer<IWspUiEnv | IWspEnv>, ev?: Event): Promise<void> {\n\t\ttry {\n\t\t\tnew MsgOver().setCustomMsg(\"Suppression du cache de l'atelier en cours...\").showMsgOver((ctx.reg.env as IWspUiEnv).uiRoot || window.document.documentElement).waitFor(\n\t\t\t\tWSP.removeCache(ctx.reg.env.wsp)\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tawait ERROR.report(`La suppression du cache n'a pas pu aboutir. Veuillez réessayer ultérieurement.`, e);\n\t\t}\n\t}\n\n}\n\n/** reload wsp */\nexport class ReloadWspAction extends WspAction {\n\tstatic SINGLETON = new ReloadWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"reloadWsp\");\n\t\tthis._label = \"Recharger l'atelier\";\n\t\tthis._group = \"adminWsp\";\n\t\tthis.requireEnabledPerm(\"action.wsp#reload\");\n\t}\n\n\tasync execute(ctx: IRegPointer<IWspUiEnv | IWspEnv>, ev?: Event): Promise<void> {\n\t\ttry {\n\t\t\tnew MsgOver().setCustomMsg(\"Rechargement de l'atelier en cours...\").showMsgOver((ctx.reg.env as IWspUiEnv).uiRoot || window.document.documentElement).waitFor(\n\t\t\t\tWSP.reloadWsp(ctx.reg.env.wsp)\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tawait ERROR.report(`Le chargement de l'atelier n'a pas pu aboutir. Veuillez réessayer ultérieurement.`, e);\n\t\t}\n\t}\n\n}\n\n\n/** Création d'un atelier à partir d'un autre\n *\t\tIRegPointer<IWspUiEnv> permet de créer un atelier en se basant sur les propriétés existantes d'un autre atelier\n * */\nexport class CreateWspFromWspAction extends WspAction {\n\tstatic SINGLETON = new CreateWspFromWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"createWspFromWsp\");\n\t\tthis.checkCompatKey = \"formElt\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspCreateFromWsp.svg\");\n\t\tthis.requireEnabledPerm(\"action.chain#create.wsp\");\n\t}\n\n\tgetLabel(ctx: IRegPointer<IWspUiEnv>): string {\n\t\tlet wspTitle = ctx.reg.env.wsp.wspTitle;\n\t\treturn `Dupliquer la configuration de l'atelier '${wspTitle}'...`;\n\t}\n\n\tgetDescription(ctx: IRegPointer<IWspUiEnv>): string {\n\t\tlet wspTitle = ctx.reg.env.wsp.wspTitle;\n\t\treturn `Créer un atelier à partir de la configuration de l'atelier ${wspTitle}'...`;\n\t}\n\n\tasync execute(ctx: IRegPointer<IWspUiEnv> & ICreateWspCtx, ev?: Event): Promise<Wsp | null> {\n\t\tconst reg = ctx.reg;\n\t\tconst {WspCreateProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\tconst wsp = await POPUP.showDialog<Wsp | null>(new WspCreateProps().initialize({\n\t\t\treg: reg,\n\t\t}), ctx.reg.env.uiRoot, {\n\t\t\ttitleBar: {barLabel: {label: \"Création d'un atelier\"}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tinitWidth: '45em',\n\t\t\tinitHeight: '70vh',\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\"\n\t\t}).onNextClose();\n\t\tthis.openWspAfterCreate(ctx, wsp);\n\t\treturn wsp;\n\t}\n}\n\n/** Création d'un atelier DRF */\nexport class CreateDrfWspAction extends WspAction {\n\tstatic SINGLETON = new CreateDrfWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"createDrfWsp\");\n\t\tthis.checkCompatKey = \"formElt\";\n\t\tthis._label = \"Créer un atelier calque de travail...\";\n\t\tthis._description = \"Créer un atelier calque de travail\";\n\t\tthis._group = \"add\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspCreate.svg\");\n\t\tthis.requireVisiblePerm(\"action.wsp#create.wsp.drf\");\n\t}\n\n\tisVisible(ctx: IRegPointer<IWspUiEnv>): boolean {\n\t\tif (!ctx.reg.env.wsp || !ctx.reg.env.wsp.hasFeature('drf')) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\tasync execute(ctx: IWspActionCtx & ICreateWspCtx, ev?: Event): Promise<Wsp | null> {\n\t\tconst reg = ctx.reg;\n\t\tconst wspTitle = ctx.reg.env.wsp.wspTitle;\n\t\tconst {WspCreatDrfProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\tconst result = await POPUP.showDialog<Wsp | undefined>(new WspCreatDrfProps().initialize({\n\t\t\treg: ctx.reg,\n\t\t}), ctx.reg.env.uiRoot, {\n\t\t\ttitleBar: {barLabel: {label: `Création d'un atelier calque de travail de '${wspTitle}'`}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tfixSize: false\n\t\t}).onNextClose();\n\t\tthis.openWspAfterCreate(ctx, result);\n\t\treturn result;\n\t}\n\n}\n\n/** Création d'un atelier DRV */\nexport class CreateDrvWspAction extends WspAction {\n\tstatic SINGLETON = new CreateDrvWspAction();\n\n\tconstructor(id?: string) {\n\t\tsuper(id || \"createDrvWsp\");\n\t\tthis.checkCompatKey = \"formElt\";\n\t\tthis._label = \"Créer un atelier calque de dérivation...\";\n\t\tthis._description = \"Créer un atelier calque de dérivation\";\n\t\tthis._group = \"add\";\n\t\tthis.setIcon(\"/@skin@/wsp/actions/wspCreate.svg\");\n\t\tthis.requireVisiblePerm(\"action.wsp#create.wsp.drv\");\n\t}\n\n\tisVisible(ctx: IWspActionCtx): boolean {\n\t\t// Pas de dérivation de dérivation, pas de dérivation sur les ateliers draft\n\t\tconst wsp = ctx.reg.env.wsp;\n\t\tif (!wsp || !wsp.hasFeature('drv')) return false;\n\t\tconst infoWsp = wsp.infoWsp || wsp.infoWspError;\n\t\tif (!infoWsp || WSP_DRV.isDrv(infoWsp.props)) return false;\n\t\tif (!infoWsp || WSP_DRF.isDrf(infoWsp.props)) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\tasync execute(ctx: IWspActionCtx & ICreateWspCtx, ev?: Event): Promise<Wsp | null> {\n\t\tconst reg = ctx.reg;\n\t\tconst wspTitle = ctx.reg.env.wsp.wspTitle;\n\t\tconst {WspCreatDrvProps} = await import(\"back/wsp/dialogs/wspProps.js\");\n\t\tconst result = await POPUP.showDialog<Wsp>(new WspCreatDrvProps().initialize({\n\t\t\treg: ctx.reg,\n\t\t}), ctx.reg.env.uiRoot, {\n\t\t\ttitleBar: {barLabel: {label: `Création d'un atelier calque de dérivation de '${wspTitle}'`}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tfixSize: false\n\t\t}).onNextClose();\n\t\tthis.openWspAfterCreate(ctx, result);\n\t\treturn result;\n\t}\n\n}\n\n\n/** Svc d'accès à item étranger dans le contexte de son propre atelier. */\nexport type IOpenForeignItemSvc = (reg: IReg<IChainEnv>, wspCd: wspCd, srcRef: srcRef) => Promise<void>\n\n/** IOpenForeignItemSvc: Impl par défaut dans un browser : ouverture dans un nouvel onglet. */\nREG.reg.registerSvc(\"openForeignItem\", 1, function (reg: IReg<IChainEnv>, wspCd: wspCd, srcRef: srcRef) {\n\twindow.open(`#${CDM.stringify({u: reg.env.universe.getId(), wsp: wspCd, srcRef: srcRef} as JWspAppDef)}`, \"_blank\");\n} as IOpenForeignItemSvc);"]}