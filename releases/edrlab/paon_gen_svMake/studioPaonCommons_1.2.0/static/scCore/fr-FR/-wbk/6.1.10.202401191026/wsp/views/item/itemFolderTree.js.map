{"version":3,"sources":["/@back@/wsp/views/item/itemFolderTree.tsx"],"names":["BaseElement","REG","JSX","SpaceTree","SpaceTreeDuplicate","SpaceTreePaste","SpaceTreePasteMove","SpaceTreeRename","DeleteSrc","ShortDescCopy","AccelKeyMgr","Action","ITEM","ESrcSt","SRC","POPUP","WSP","ItemFolderTree","[object Object]","init","this","reg","findReg","style","display","flex","uriRoot","env","longDesc","srcUri","hideSearch","actions","getList","accelKeyMgr","initFromMapActions","getListAsMap","secondaryCols","tree","appendChild","createElement","î","customElements","define","addAction","action","accel","addToList","getId","SINGLETON","pasteCtrl","FolderTreeCreateFolder","super","_label","_group","ctx","shortDescs","length","isVisible","ev","SrcNewCode","import","parentUri","srcSt","folder","extractUriParent","parentSrcLabel","extractSrcLabel","ti","ct","initialize","parentFolder","targetSrcUriType","newCode","showDialog","emitter","titleBar","barLabel","label","onNextClose","focus","shortDesc","createSpaceOrFolder","wsp","addLeafToUri","selectSrcUri","grid","defaultAction","executeIfAvailable","e"],"mappings":"OAAQA,gBAAY;OAENC,QAAI;OAEVC,QAAI;OACYC,UAAWC,mBAAoBC,eAAgBC,mBAAoBC,oBAAgB;OACnGC,UAAWC,kBAAc;OACzBC,YAAaC,WAAO;OACLC,SAAK;OACpBC,OAAoBC,QAAI;OAExBC,UAAM;OACNC,QAAI;OAeN,MAAOC,uBAAuBjB,YAInCkB,YAAYC,MACXC,KAAKC,IAAMD,KAAKE,QAAQH;AACxBC,KAAKG,MAAMC,QAAU;AACrBJ,KAAKG,MAAME,KAAO;AAIlBN,KAAKO,QAAUN,KAAKC,IAAIM,IAAIC,SAASC;AACrC,KAAM,eAAgBV,MAAOA,KAAKW,WAAa;AAC/C,KAAM,YAAaX,MAAOA,KAAKY,QAAUX,KAAKC,IAAIW,QAAQ;AAC1D,KAAM,gBAAiBb,MAAOA,KAAKc,aAAc,IAAIvB,aAA6BwB,mBAAmBd,KAAKC,IAAIc,aAAa;AAC3H,KAAM,kBAAmBhB,MAAOA,KAAKiB,cAAgBhB,KAAKC,IAAIW,QAAQ;AAEtEZ,KAAKiB,KAAOjB,KAAKkB,YAAYpC,IAAAqC,cAACpC,UAAS,CAACoB,MAAM,SAAQiB,IAAIrB,SAK5DsB,eAAeC,OAAO,uBAAwBzB;AAG9C,SAAS0B,UAAUC,OAA+BC,OACjD5C,IAAIoB,IAAIyB,UAAU,+BAAgCF,OAAOG,QAAS,EAAGH;AACrE,GAAIC,MAAO5C,IAAIoB,IAAIyB,UAAU,iCAAkCD,MAAO,EAAGD,QAI1ED,UAAUlC,cAAcuC,UAAW;AAEnC,MAAMC,UAAY,IAAI5C;AACtBsC,UAAUM,UAAW;AACrBN,UAAU,IAAIrC,mBAAmB2C;AAEjCN,UAAU,IAAIpC,gBAAmB;AAEjCoC,UAAU,IAAInC,UAAa;AAE3BmC,UAAU,IAAIvC;OAGR,MAAO8C,+BAA+BvC,OAE3CO,cACCiC,MAAM;AACN/B,KAAKgC,OAAS;AACdhC,KAAKiC,OAAS,SAGfnC,UAAUoC,KACT,GAAIA,IAAIC,WAAWC,OAAS,EAAG,OAAO;AACtC,OAAOL,MAAMM,UAAUH,KAGxBpC,cAAcoC,IAAgBI,IAE7B,MAAMC,WAACA,kBAAoBC,OAAM;AACjC,MAAMC,UAAYP,IAAIC,WAAWC,SAAW,EAAIF,IAAI5B,QACnD4B,IAAIC,WAAW,GAAGO,QAAUjD,OAAOkD,OAAST,IAAIC,WAAW,GAAG1B,OAASf,IAAIkD,iBAAiBV,IAAIC,WAAW,GAAG1B;AAC/G,MAAMoC,eAAiBrD,KAAKsD,gBAAgBL,UAAW;AACvD,MAAMM,GAAK,iCAAiCF;AAC5C,MAAMG,IAAK,IAAIT,YAAaU,WAAW,CACtChD,IAAKiC,IAAIjC,IACTiD,aAAcT,UACdU,iBAAkB;AAEnB,MAAMC,cAAgBzD,MAAM0D,WAA0BL,GAAId,IAAIoB,QAAS,CAACC,SAAU,CAACC,SAAU,CAACC,MAAOV,OAAOW;AAC5GxB,IAAIoB,QAAQK;AACZ,GAAIP,QAAS,CACZ,IACC,MAAMQ,gBAAkBhE,IAAIiE,oBAAoB3B,IAAIjC,IAAIM,IAAIuD,IAAK,KAAM5B,IAAIoB,QAAS5D,IAAIqE,aAAatB,UAAWW;AAChH,GAAIQ,iBAAmB1B,IAAI8B,aAAaJ,UAAUnD,SAAWyB,IAAI+B,KAAKC,cAAehC,IAAI+B,KAAKC,cAAcC,mBAAmBjC;AAC/H,OAAO0B,UACN,MAAOQ,GAER,MAAMA,KAMV7C,UAAU,IAAIO","sourcesContent":["import {BaseElement} from \"back/commons/basis\";\nimport {IItemUiEnv} from \"back/wsp/views/itemMain\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IView} from \"lib/commons/views\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {OSpaceTreeInit, SpaceTree, SpaceTreeDuplicate, SpaceTreePaste, SpaceTreePasteMove, SpaceTreeRename} from \"back/wsp/views/spaceTree\";\nimport {DeleteSrc, ShortDescCopy} from \"back/wsp/actions/srcActions\";\nimport {AccelKeyMgr, Action} from \"lib/commons/actions\";\nimport {IShortDescCtx, ITEM} from \"lib/wsp/item\";\nimport {ESrcSt, JSrcFields, SRC} from \"lib/wsp/src\";\nimport {SrcNewCode} from \"back/wsp/dialogs/srcNewCode\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {WSP} from \"lib/wsp/wsp\";\n\n/**\n * View d'une de l'arbre des fichiers d'un item de type folder.\n *\n * Config attributes:\n */\nexport interface ItemFolderTree extends BaseElement {\n\tinitialize(init: OItemFolderTreeInit): this;\n}\n\nexport interface OItemFolderTreeInit extends OSpaceTreeInit {\n\treg?: IReg<IItemUiEnv>\n}\n\nexport class ItemFolderTree extends BaseElement implements IView {\n\treg: IReg<IItemUiEnv>;\n\ttree: SpaceTree;\n\n\t_initialize(init: OItemFolderTreeInit) {\n\t\tthis.reg = this.findReg(init);\n\t\tthis.style.display = \"flex\";\n\t\tthis.style.flex = \"1\";\n\t\t//let sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\t//this._initAndInstallSkin(this.localName, init);\n\n\t\tinit.uriRoot = this.reg.env.longDesc.srcUri;\n\t\tif (!('hideSearch' in init)) init.hideSearch = true;\n\t\tif (!('actions' in init)) init.actions = this.reg.getList(\"actions:itemFolder:shortDesc\");\n\t\tif (!('accelKeyMgr' in init)) init.accelKeyMgr = new AccelKeyMgr<IShortDescCtx>().initFromMapActions(this.reg.getListAsMap(\"accelkeys:itemFolder:shortDesc\"));\n\t\tif (!('secondaryCols' in init)) init.secondaryCols = this.reg.getList(\"columns:itemFoderTree:secondaryCols\")\n\n\t\tthis.tree = this.appendChild(<SpaceTree style=\"flex:1\" î={init}/>) as SpaceTree;\n\n\t}\n}\n\ncustomElements.define(\"wsp-item-folder-tree\", ItemFolderTree);\n\n\nfunction addAction(action: Action<IShortDescCtx>, accel?: string) {\n\tREG.reg.addToList(\"actions:itemFolder:shortDesc\", action.getId(), 1, action);\n\tif (accel) REG.reg.addToList(\"accelkeys:itemFolder:shortDesc\", accel, 1, action);\n}\n\n\naddAction(ShortDescCopy.SINGLETON, \"c-accel\");\n\nconst pasteCtrl = new SpaceTreePaste();\naddAction(pasteCtrl, \"v-accel\");\naddAction(new SpaceTreePasteMove(pasteCtrl));\n\naddAction(new SpaceTreeRename(), \"F2\");\n//addAction(new SpaceTreeMoveTo()); //cible folder (et non space) à revoir.\naddAction(new DeleteSrc(), \"Delete\");\n//addAction(new SpaceTreeCopyTo()); //cible folder (et non space) à revoir.\naddAction(new SpaceTreeDuplicate());\n\n\nexport class FolderTreeCreateFolder extends Action<SpaceTree> {\n\n\tconstructor() {\n\t\tsuper('createFolder');\n\t\tthis._label = \"Créer un dossier...\";\n\t\tthis._group = \"create\";\n\t}\n\n\tisVisible(ctx: SpaceTree): boolean {\n\t\tif (ctx.shortDescs.length > 1) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\tasync execute(ctx: SpaceTree, ev?: Event): Promise<JSrcFields> {\n\t\t//Chargement asynch\n\t\tconst {SrcNewCode} = await import(\"back/wsp/dialogs/srcNewCode.js\");\n\t\tconst parentUri = ctx.shortDescs.length === 0 ? ctx.uriRoot :\n\t\t\tctx.shortDescs[0].srcSt === ESrcSt.folder ? ctx.shortDescs[0].srcUri : SRC.extractUriParent(ctx.shortDescs[0].srcUri);\n\t\tconst parentSrcLabel = ITEM.extractSrcLabel(parentUri, \"\");\n\t\tconst ti = `Créer un dossier en fils de '${parentSrcLabel}'`;\n\t\tconst ct = new SrcNewCode().initialize({\n\t\t\treg: ctx.reg,\n\t\t\tparentFolder: parentUri,\n\t\t\ttargetSrcUriType: \"res\"\n\t\t});\n\t\tconst newCode = await POPUP.showDialog<string | null>(ct, ctx.emitter, {titleBar: {barLabel: {label: ti}}}).onNextClose();\n\t\tctx.emitter.focus();\n\t\tif (newCode) {\n\t\t\ttry {\n\t\t\t\tconst shortDesc = await WSP.createSpaceOrFolder(ctx.reg.env.wsp, null, ctx.emitter, SRC.addLeafToUri(parentUri, newCode));\n\t\t\t\tif (shortDesc && await ctx.selectSrcUri(shortDesc.srcUri) && ctx.grid.defaultAction) ctx.grid.defaultAction.executeIfAvailable(ctx);\n\t\t\t\treturn shortDesc;\n\t\t\t} catch (e) {\n\t\t\t\t//FIXME POPUP.showError()\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}\n}\n\naddAction(new FolderTreeCreateFolder());\n"]}