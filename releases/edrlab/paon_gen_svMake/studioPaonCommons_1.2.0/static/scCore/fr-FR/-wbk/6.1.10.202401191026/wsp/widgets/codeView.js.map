{"version":3,"sources":["/@back@/wsp/widgets/codeView.tsx"],"names":["BaseElement","MsgLabel","WSP","DOMSH","DOM","JSX","REG","CodeView","wsp","this","_wsp","findReg","config","env","v","_fields","refresh","fields","longDesc","transform","_transform","[object Object]","init","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","_pending","appendChild","createElement","_rootCode","class","uiClass","classList","add","setStandardMsg","setHidden","itemType","wspMetaUi","getItemType","itModel","innerHTML","txt","fetchStreamText","getMainStreamSrcUri","reg","registerSkin","customElements","define","DEBUG"],"mappings":"OAAQA,YAAaC,aAAwB;OACrCC,QAAS;OAETC,UAAM;OACNC,IAAKC,QAAI;OACTC,QAAI;OAMN,MAAOC,iBAAiBP,YAc7BQ,UAAgB,OAAOC,KAAKC,MAAQD,KAAKE,QAAQF,KAAKG,QAAQC,IAAIL,IAElEA,QAAQM,GACPL,KAAKC,KAAOI;AACZL,KAAKM,QAAU;AACfN,KAAKO,UAGNC,aAA0B,OAAOR,KAAKM,SAAWN,KAAKE,QAAQF,KAAKG,QAAQC,IAAIK,SAE/ED,WAAWH,GACVL,KAAKM,QAAUD;AACfL,KAAKO,UAGNG,gBAAyB,OAAOV,KAAKW,WAErCD,cAAcL,GACbL,KAAKW,WAAaN;AAClBL,KAAKO,UAGIK,kBAAkBC,MAC3Bb,KAAKG,OAASU;AACd,MAAMC,GAAKd,KAAKe,aAAarB,MAAMsB;AACnChB,KAAKiB,oBAAoBjB,KAAKkB,UAAWL;AAEzCb,KAAKmB,SAAWL,GAAGM,YAAYxB,IAAAyB,cAAC7B,SAAQ;AACxCQ,KAAKsB,UAAYR,GAAGM,YAAYxB,IAAAyB,cAAA,MAAA,CAAKE,MAAM;AAC3C,GAAIV,KAAKW,QAASxB,KAAKsB,UAAUG,UAAUC,IAAIb,KAAKW,SAG3CZ,iBACTZ,KAAKmB,SAASQ,eAAe;AAC7BhC,IAAIiC,UAAU5B,KAAKsB,UAAW;AAE9B,MAAMO,eAAiB7B,KAAKD,IAAI+B,UAAUC,YAAY/B,KAAKQ,OAAOwB;AAClEhC,KAAKsB,UAAUW,UAAY;AAE3B,MAAMC,UAAYzC,IAAI0C,gBAAgBnC,KAAKD,IAAK,KAAM8B,SAASO,oBAAoBpC,KAAKQ,QAASR,KAAKU;AACtG,GAAIwB,IAAK,CACRlC,KAAKsB,UAAUW,UAAYC;AAC3BlC,KAAKsB,UAAUF,YAAYxB,IAAAyB,cAAA,MAAA,CAAKE,MAAM,aAEvC5B,IAAIiC,UAAU5B,KAAKmB,SAAU;AAC7BxB,IAAIiC,UAAU5B,KAAKsB,UAAW,QAMhCzB,IAAIwC,IAAIC,aAAa,gBAAiB,EAAsB;AA6L5DC,eAAeC,OAAO,gBAAiB1C;AAEvC,MAAM2C,MAAQ","sourcesContent":["import {BaseElement, MsgLabel, OSkinableInit} from \"back/commons/basis\";\nimport {WSP, Wsp} from \"lib/wsp/wsp\";\nimport {JSrcFields} from \"lib/wsp/src\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {REG} from \"lib/commons/registry\";\n\nexport interface OCodeViewInit extends OSkinableInit {\n\tuiClass?: \"partial\"\n}\n\nexport class CodeView extends BaseElement {\n\n\tprotected config: OCodeViewInit;\n\n\tprotected _wsp: Wsp;\n\n\tprotected _fields: JSrcFields;\n\n\tprotected _transform: string;\n\n\tprotected _pending: MsgLabel;\n\n\tprotected _rootCode: HTMLDivElement;\n\n\tget wsp(): Wsp {return this._wsp || this.findReg(this.config).env.wsp}\n\n\tset wsp(v: Wsp) {\n\t\tthis._wsp = v;\n\t\tthis._fields = null;\n\t\tthis.refresh();\n\t}\n\n\tget fields(): JSrcFields {return this._fields || this.findReg(this.config).env.longDesc}\n\n\tset fields(v: JSrcFields) {\n\t\tthis._fields = v;\n\t\tthis.refresh();\n\t}\n\n\tget transform(): string {return this._transform}\n\n\tset transform(v: string) {\n\t\tthis._transform = v;\n\t\tthis.refresh();\n\t}\n\n\tprotected async _initialize(init: OCodeViewInit) {\n\t\tthis.config = init;\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\n\t\tthis._pending = sr.appendChild(<MsgLabel/>) as MsgLabel;\n\t\tthis._rootCode = sr.appendChild(<div class=\"itemPreview\"/>) as HTMLDivElement;\n\t\tif (init.uiClass) this._rootCode.classList.add(init.uiClass);\n\t}\n\n\tprotected async _refresh() {\n\t\tthis._pending.setStandardMsg(\"loading\");\n\t\tDOM.setHidden(this._rootCode, true);\n\t\t// URL fournissant le fragment XHTML de code\n\t\tconst itemType = await this.wsp.wspMetaUi.getItemType(this.fields.itModel);\n\t\tthis._rootCode.innerHTML = \"\";\n\t\t// Flux xhtml associ√©\n\t\tconst txt = await WSP.fetchStreamText(this.wsp, null, itemType.getMainStreamSrcUri(this.fields), this.transform);\n\t\tif (txt) {\n\t\t\tthis._rootCode.innerHTML = txt;\n\t\t\tthis._rootCode.appendChild(<div class=\"fadeOut\"/>);\n\t\t}\n\t\tDOM.setHidden(this._pending, true);\n\t\tDOM.setHidden(this._rootCode, false);\n\t}\n\n\n}\n\nREG.reg.registerSkin('wsp-code-view', 1, /* language=CSS */ `\n\t:host {\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\ttext-align: center;\n\t\tvertical-align: middle;\n\t\toverflow: auto;\n\t}\n\n\t.partial {\n\t\tborder: 1px solid #E1E1D7;\n\t\tposition: relative;\n\t\toverflow: hidden !important;\n\t\tpadding: 1px 2px;\n\t}\n\n\t.itemPreview {\n\t\toverflow-y: auto;\n\t\tbackground-color: white;\n\t\tfont-size: 80%;\n\t\tcursor: pointer;\n\t}\n\n\t.fadeOut {\n\t\tdisplay: none;\n\t\tz-index: 2;\n\t}\n\n\t.partial > .fadeOut {\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\theight: 8em;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground: -moz-linear-gradient(top, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0) 75%, rgba(255, 255, 255, 1) 100%);\n\t\tbackground: linear-gradient(to bottom, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0) 75%, rgba(255, 255, 255, 1) 100%);\n\t}\n\n\t/* === CodeMirror =========================================================== */\n\t.CodeMirror-static {\n\t}\n\n\t.CodeMirror-static pre {\n\t\t/* Reset some styles that the rest of the page might have set */\n\t\tborder-radius: 0;\n\t\tborder-width: 0;\n\t\tbackground: transparent;\n\t  font-family: inherit;\n\t  font-size: inherit;\n\t  margin: 0;\n\t  white-space: pre-wrap;\n\t  word-wrap: normal;\n\t  line-height: inherit;\n\t  color: inherit;\n\t  z-index: 2;\n\t  position: relative;\n\t  overflow: visible;\n\t  border-inline-end: 30px solid transparent;\n\t  width: -moz-fit-content;\n\t  width: fit-content;\n\t  font-family: var(--font-mono);\n\t  tab-size: 2;\n\t  -moz-tab-size: 2;\n  }\n\n  .CodeMirror-line {\n\t  position: relative;\n  }\n\n\t.cm-keyword {\n\t\tcolor: #708;\n\t}\n\n\t.cm-atom {\n\t\tcolor: #219;\n\t}\n\n\t.cm-number {\n\t\tcolor: #164;\n\t}\n\n\t.cm-def {\n\t\tcolor: #00f;\n\t}\n\n\t.cm-variable {\n\t\tcolor: black;\n\t}\n\n\t.cm-variable-2 {\n\t\tcolor: #05a;\n\t}\n\n\t.cm-variable-3 {\n\t\tcolor: #085;\n\t}\n\n\t.cm-property {\n\t\tcolor: black;\n\t}\n\n\t.cm-operator {\n\t\tcolor: black;\n\t}\n\n\t.cm-comment {\n\t\tcolor: #a50;\n\t}\n\n\t.cm-string {\n\t\tcolor: #a11;\n\t}\n\n\t.cm-string-2 {\n\t\tcolor: #f50;\n\t}\n\n\t.cm-meta {\n\t\tcolor: #555;\n\t}\n\n\t.cm-error {\n\t\tcolor: #f00;\n\t}\n\n\t.cm-qualifier {\n\t\tcolor: #555;\n\t}\n\n\t.cm-builtin {\n\t\tcolor: #30a;\n\t}\n\n\t.cm-bracket {\n\t\tcolor: #997;\n\t}\n\n\t.cm-tag {\n\t\tcolor: #170;\n\t}\n\n\t.cm-attribute {\n\t\tcolor: #00c;\n\t}\n\n\t.cm-header {\n\t\tcolor: blue;\n\t}\n\n\t.cm-quote {\n\t\tcolor: #090;\n\t}\n\n\t.cm-hr {\n\t\tcolor: #999;\n\t}\n\n\t.cm-link {\n\t\tcolor: #00c;\n\t}\n\n\t.cm-negative {\n\t\tcolor: #d44;\n\t}\n\n\t.cm-positive {\n\t\tcolor: #292;\n\t}\n\n\t.cm-header, .cm-strong {\n\t\tfont-weight: bold;\n\t}\n\n\t.cm-em {\n\t\tfont-style: italic;\n\t}\n\n\t.cm-link {\n\t\ttext-decoration: underline;\n\t}\n\n\t.cm-invalidchar {\n\t\tcolor: #f00;\n\t}\n\n\t/* === STOP - CodeMirror ==================================================== */\n`);\n\ncustomElements.define('wsp-code-view', CodeView);\n\nconst DEBUG = true;\n"]}