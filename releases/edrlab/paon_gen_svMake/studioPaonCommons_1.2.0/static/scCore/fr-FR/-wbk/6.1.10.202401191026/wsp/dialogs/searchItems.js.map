{"version":3,"sources":["/@back@/wsp/dialogs/searchItems.tsx"],"names":["BaseElementAsync","BASIS","MsgLabel","REG","DOM","JSX","DOMSH","SearchAnd","SearchRequest","StreamedSearch","SrcGrid","buildCritAreaFromXml","IS_UiCritWidget","UiCritBool","ItemCritFullText","ItemCritFullWsp","ItemCritInSpace","ItemCritLinks","Button","AppHeader","InfoBrokerBasic","ItemViewerSingle","InfoFocusItem","ITEM","SRC","POPUP","LANG","WedSearchCoordinator","ERROR","Action","ExportResultCsv_item","ExportResultCsv_task","ExportResultItems","FORMS","SearchItems","[object Object]","this","firstMax","fullMax","wsp","reg","env","readonly","_conf","max","_searchColumns","Map","grid","fillSearchColumns","req","_lastReq","setMax","where","buildWhere","_a","toDom","hasChildNodes","_b","countDisplay","setCustomMsg","srcGridDatas","setDatas","setWhere","_startReqPending","currentMax","_c","streamedSearch","search","then","catch","e","log","_d","critRoot","ch","findFirstChild","findNextSibling","pushIfDefined","buildCrit","searchWhereWrapper","asXml","root","createElement","sub","buildUiXmlCrit","appendChild","whereCrit","searchId","searchLabel","searchDescription","initCrits","undefined","init","callerReg","findReg","showMainView","createSubReg","infoBroker","wedSearchCoord","criterions","getListAsMap","rows","done","gridDatas","updateDatas","countRows","hideShowMore","count","msgs","resultsMore","_f","_e","resultsEmpty","_g","_j","_h","resultsOne","_k","_m","_l","resultsCount","searchMoreBtn","hidden","sr","attachShadow","SHADOWDOM_INIT","installSkin","_initAndInstallSkin","localName","editor","id","c-resizable","addClass","critAbstract","setHidden","c-orient","parentMainView","buildResults","lastElementChild","mainView","initViewer","addEventListener","onGridSelect","append","initHeader","newInit","Object","assign","focusListening","actionContext","mainActions","mergeLists","APPBAR_MAIN_ACTIONS","mainBar","groupOrder","appHeader","insertBefore","initialize","findFirstFocusable","focus","doSearch","bind","initGrid","srcGrid","hideHeaders","skinScroll","itemHandlingReact","setAttribute","results","showResultBar","resultBar","ui-context","label","onclick","title","onRelaunch","push","searchStore","initSearchRequest","searchStoreBar","canEditTitle","titleElt","value","readOnly","icon","onSave","definedWhereCrit","getInitWhereCrit","innerText","firstElementChild","nextElementSibling","critArea","crit","loadBody","initFromXmlCrit","fromSrcUri","getSrcUriType","AREA","buildBody","spaceUri","AREA_DESC","itemPtr","setSrcRef","rootFilters","AREA_AND_ROOT","fullTextByDefault","insertCrit","textContent","desc","buildAbstract","initReq","Element","ev","showTimer","clearTimeout","countSelectedRows","setTimeout","sd","shortDescs","setParamsOnce","buildWedSearch","buildWhereXml","dispatchInfo","srcRef","me","findHost","create","inputTi","shadowRoot","getElementById","persistSearch","findPopupableParent","close","onViewShown","closed","onViewHidden","registerSkin","customElements","define","ResetRequest","super","_label","_icon","_group","ctx","isVisible","SINGLETON","addToList","CopyRequest","_description","navigator","clipboard","writeText","serializer","serializeToString","showNotifForbidden","PasteRequest","ct","readText","parseDomValid","documentElement","nodeName","showNotifInfo","requireVisiblePerm","setLabel","override","buttonNode","_hideLabel"],"mappings":"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","sourcesContent":["import {BaseElementAsync, BASIS, MsgLabel, OSkinableInit} from \"back/commons/basis\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IView} from \"lib/commons/views\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {IWspUiEnv, Wsp} from \"lib/wsp/wsp\";\nimport {ISearchCrit, ISearchFunc, ISearchPersist, ISearchStore, ISearchViewResult, SearchAnd, SearchRequest, StreamedSearch} from \"lib/wsp/search\";\nimport {OSrcGridInit, SrcGrid} from \"back/wsp/widgets/srcGrid\";\nimport {buildCritAreaFromXml, IS_UiCritWidget, IUiCritArea, UiCritBool} from \"back/wsp/widgets/search/uiCrit\";\nimport {ItemCritFullText, ItemCritFullWsp, ItemCritInSpace, ItemCritLinks} from \"back/wsp/widgets/search/itemCrit\";\nimport {ActionBtn, Button} from \"back/commons/widgets/buttons\";\nimport {AppHeader, OAppHeaderInit} from \"back/core/widgets/appHeader\";\nimport {InfoBrokerBasic} from \"lib/commons/infos\";\nimport {ItemViewerSingle} from \"back/wsp/views/itemViewerSingle\";\nimport {IItemViewer} from \"back/wsp/views/itemMain\";\nimport {InfoFocusItem, ITEM} from \"lib/wsp/item\";\nimport {SRC, srcUri} from \"lib/wsp/src\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {LANG} from \"lib/commons/lang\";\nimport {IWedSearchCoordinatorPointer, WedSearchCoordinator} from \"back/edit/wed/features/searchBar\";\nimport {ERROR} from \"lib/core/errorReport\";\nimport {Action} from \"lib/commons/actions\";\nimport {ExportResultCsv_item, ExportResultCsv_task, ExportResultItems} from \"back/wsp/actions/searchesActions\";\nimport \"back/wsp/dialogs/dialogs_Perms\";\nimport {JSearchResultL10nMsgs} from \"back/wsp/views/searches\";\nimport {FORMS} from \"lib/commons/forms\";\n\n\nexport interface OSearchItemsInit extends OSkinableInit {\n\treg?: IReg<IWspUiEnv>\n\n\t/** Critères disponibles */\n\tcriterions?: Dict<IUiCritArea>;\n\n\t/** Requête courante à éditer */\n\tinitSearchRequest?: ISearchPersist | Element\n\n\t/** Mode readonly : les critères de recherche ne peuvent pas être édités\n\t * \t\tFIXME : affichage de l'abstract en attendant de faire évoluer l'API crtérions pour prendre en conmpte le caractère \"readonly\"\n\t * */\n\treadonly?: boolean\n\n\t/** Capacité d'édition du titre de la requête\n\t * \tSi false, le champ est masqué. True par défaut\n\t **/\n\tcanEditTitle?: boolean\n\n\t/** Si initSearchRequest est null, construction à partir d'un item ou d'un espace de départ. */\n\tfromSrcUri?: srcUri\n\n\t/** Si initSearchRequest est null et fullTextByDefault=true, ajoute un 1er critère de recherche de type \"fullText\". */\n\tfullTextByDefault?: boolean\n\n\t/** Si initSearchRequest, fromSrcUri et fullTextByDefault sont null, construction personnalisée des critères affichées par défaut. */\n\tbuildCrit?: (searchItems: SearchItems) => void\n\n\t/** Fonction de modification de la requête avant exécution (ex : ajout de critères forcés non visibles coté UI, ...) */\n\tsearchWhereWrapper?: (where: Array<ISearchCrit>, reg: IReg<IWspUiEnv>) => Promise<void>\n\n\t/** Nombre d'items maximum recherchés initialement */\n\tfirstMax?: number\n\n\t/** Nombre d'items maximum recherchés aprés avoir demandé \"tout afficher\" */\n\tfullMax?: number;\n\n\t/** Affiche le panel de la mainView. */\n\tshowMainView?: boolean\n\n\t/** Affiche l'état de la recherche et les actions de raffraichissement (true par défaut) */\n\tshowResultBar?: boolean\n\n\t/** Init de la liste des résultats. */\n\tsrcGrid?: OSrcGridInit\n\n\t/** Init du appHeader. */\n\tappHeader?: OAppHeaderInit<SearchItems>\n\n\t/**\n\t * Système de stockage des requêtes associé à initSearchRequest. Si spécifié, ajoute un bouton :\n\t * - d'enregistrement si initSearchRequest.id est renseigné.\n\t * - création de requête sinon.\n\t */\n\tsearchStore?: ISearchStore\n\n\t/* Permet de contextualiser les messages UI */\n\tmsgs?: JSearchResultL10nMsgs\n}\n\nexport interface SearchItems extends BaseElementAsync, IView, ISearchViewResult {\n\tinitialize(init: OSearchItemsInit): this\n}\n\nexport class SearchItems extends BaseElementAsync implements IView, ISearchViewResult {\n\n\treg: IReg<IWspUiEnv>;\n\n\tcriterions: Dict<IUiCritArea>;\n\n\t/** Fonction de modification de la requête avant exécution (ex : ajout de critères forcés non visibles coté UI, ...) */\n\tsearchWhereWrapper: (searchCrits: ISearchCrit[], reg: IReg<IWspUiEnv>) => Promise<void>;\n\n\tfirstMax = 30;\n\n\tfullMax = 2000;\n\n\tcurrentMax: number;\n\n\tsearchStore?: ISearchStore;\n\n\tinitSearchRequest?: ISearchPersist;\n\n\tget wsp(): Wsp {return this.reg.env.wsp};\n\n\t/** Eléments UI */\n\tgrid: SrcGrid;\n\tcritRoot: HTMLElement;\n\tcritAbstract: HTMLDivElement;\n\tmainView: IItemViewer;\n\tcountDisplay: MsgLabel;\n\tsearchMoreBtn: Button;\n\n\tstreamedSearch: StreamedSearch;\n\n\tprotected _conf: OSearchItemsInit;\n\n\tprotected _searchColumns: Map<string, string | ISearchFunc>;\n\n\tprotected _startReqPending: Promise<void>;\n\n\tprotected _lastReq: SearchRequest;\n\n\tpublic static APPBAR_MAIN_ACTIONS = \"actions:searchItems:bar\";\n\n\tget readonly(): boolean {return this._conf.readonly || false}\n\n\tasync doSearch(max: number) {\n\t\tif (!this._searchColumns) {\n\t\t\tthis._searchColumns = new Map();\n\t\t\tthis.grid.fillSearchColumns(this._searchColumns);\n\t\t}\n\t\tconst req = this._lastReq = new SearchRequest(this._searchColumns).setMax(max + 1);\n\t\tconst where = await this.buildWhere();\n\t\tif (!where?.toDom()?.hasChildNodes()) {\n\t\t\tthis.countDisplay?.setCustomMsg(\"Veuillez préciser la recherche\", \"info\");\n\t\t\tthis.grid.srcGridDatas.setDatas([]);\n\t\t\treturn;\n\t\t}\n\t\treq.setWhere(where);\n\n\t\ttry {\n\t\t\twhile (this._startReqPending) await this._startReqPending; //raceCond : 2 appels très proches avant que le 1er this.streamedSearch.search(req) réponde.\n\t\t} finally {\n\t\t\tthis._startReqPending = null;\n\t\t}\n\t\tif (this._lastReq !== req) return;// raceCond optimisation: une autre requête a été lancée on abandonne\n\t\tthis.currentMax = max;\n\t\tthis.grid.srcGridDatas.setDatas([]);\n\t\tthis.countDisplay?.setCustomMsg(\"En cours...\");\n\t\ttry {\n\t\t\t//console.log(\"SearchItems.doSearch::::\", req.toDom());\n\t\t\tthis._startReqPending = this.streamedSearch.search(req)\n\t\t\t\t.then(() => {this._startReqPending = null})\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tERROR.log(e);\n\t\t\t\t\tthis.countDisplay?.setCustomMsg(\"Requête en échec\", \"error\");\n\t\t\t\t\tthis._startReqPending = null;\n\t\t\t\t});\n\t\t} catch (e) {\n\t\t\tERROR.log(e);\n\t\t\tthis.countDisplay?.setCustomMsg(\"Requête en échec\", \"error\");\n\t\t}\n\t}\n\n\tasync buildWhere(): Promise<ISearchCrit> {\n\t\tconst where = new SearchAnd();\n\t\tif (!this.critRoot) return where;\n\t\tfor (let ch = DOM.findFirstChild(this.critRoot, IS_UiCritWidget); ch; ch = DOM.findNextSibling(ch, IS_UiCritWidget)) {\n\t\t\tLANG.pushIfDefined(where, ch.buildCrit());\n\t\t}\n\t\tif (this.searchWhereWrapper)\n\t\t\tawait this.searchWhereWrapper(where, this.reg);\n\t\treturn where;\n\t}\n\n\tbuildWhereXml(): Element {\n\t\treturn JSX.asXml(() => {\n\t\t\tconst root = <where/>;\n\t\t\tif (!this.critRoot) return root;\n\t\t\tfor (let ch = DOM.findFirstChild(this.critRoot, IS_UiCritWidget); ch; ch = DOM.findNextSibling(ch, IS_UiCritWidget)) {\n\t\t\t\tconst sub = ch.buildUiXmlCrit();\n\t\t\t\tif (sub) root.appendChild(sub);\n\t\t\t}\n\t\t\treturn root;\n\t\t});\n\t}\n\n\tasync viewSearch(whereCrit: Element, searchId: string | null, searchLabel?: string, searchDescription?: string): Promise<string> {\n\t\tawait this.initCrits(whereCrit, true);\n\t\treturn undefined;\n\t}\n\n\tprotected async _initialize(init: OSearchItemsInit): Promise<void> {\n\t\tthis._conf = init;\n\t\tconst callerReg = this.findReg(init);\n\t\tthis.searchWhereWrapper = init.searchWhereWrapper;\n\t\tif (\"firstMax\" in init) this.firstMax = init.firstMax;\n\t\tif (\"fullMax\" in init) this.fullMax = init.fullMax;\n\n\t\tif (init.showMainView) {\n\t\t\t//Besoin d'un sous-reg pour un infoBroker dédié\n\t\t\tthis.reg = REG.createSubReg(callerReg);\n\t\t\tthis.reg.env.infoBroker = new InfoBrokerBasic(); //InfoBroker local à la fenetre de dialogue.\n\t\t\t(this.reg.env as IWedSearchCoordinatorPointer).wedSearchCoord = new WedSearchCoordinator(); //cordinateur local de recherche wed\n\t\t} else {\n\t\t\tthis.reg = callerReg;\n\t\t}\n\t\tthis.criterions = (\"criterions\" in init) ? init.criterions : this.reg.getListAsMap(\"wsp.crit.items\");\n\t\tthis.streamedSearch = new StreamedSearch(this.wsp, (rows: Dict<any>[], done: boolean) => {\n\t\t\tconst gridDatas = this.grid.srcGridDatas;\n\t\t\tgridDatas.updateDatas(gridDatas.countRows(), 0, ...rows);\n\t\t\tif (done) {\n\t\t\t\tlet hideShowMore = true;\n\t\t\t\tconst count = gridDatas.countRows();\n\t\t\t\tconst max = this.currentMax;\n\t\t\t\tif (count > max) {\n\t\t\t\t\tthis.countDisplay?.setCustomMsg(this._conf?.msgs?.resultsMore ? this._conf.msgs.resultsMore(max) : `Plus de ${max} items trouvés`);\n\t\t\t\t\tif (this.currentMax === this.firstMax) hideShowMore = false;\n\t\t\t\t} else if (count === 0) {\n\t\t\t\t\tthis.countDisplay?.setCustomMsg(this._conf?.msgs?.resultsEmpty ? this._conf.msgs.resultsEmpty : \"Aucun item trouvé\");\n\t\t\t\t} else if (count === 1) {\n\t\t\t\t\tthis.countDisplay?.setCustomMsg(this._conf?.msgs?.resultsOne ? this._conf.msgs.resultsOne : \"1 item trouvé\");\n\t\t\t\t} else {\n\t\t\t\t\tthis.countDisplay?.setCustomMsg(this._conf?.msgs?.resultsCount ? this._conf.msgs.resultsCount(count) : `${count} items trouvés`);\n\t\t\t\t}\n\t\t\t\tif (this.searchMoreBtn) this.searchMoreBtn.hidden = hideShowMore;\n\t\t\t}\n\t\t});\n\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis.reg.installSkin(\"webzone:panel\", sr);\n\t\tthis.reg.installSkin(\"scroll/small\", sr);\n\t\tthis.reg.installSkin(\"form-control-areas\", sr);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tconst editor = sr.appendChild(<div id=\"critEditor\" c-resizable=\"\"/>);\n\t\tthis.critRoot = editor.appendChild(<div id=\"critRoot\"/>);\n\t\tif (this.readonly) {\n\t\t\tDOM.addClass(editor, \"abstract\");\n\t\t\tthis.critAbstract = editor.appendChild(<div id=\"critAbstract\"/>) as HTMLDivElement;\n\t\t\tDOM.setHidden(this.critRoot, true);\n\t\t}\n\n\t\tsr.appendChild(<c-resizer c-orient=\"column\"/>);\n\t\tif (init.showMainView) {\n\t\t\tconst parentMainView = sr.appendChild(<div id=\"results\" c-resizable=\"\">\n\t\t\t\t<div id=\"gridCtn\" c-resizable=\"\">\n\t\t\t\t\t{this.buildResults(init)}\n\t\t\t\t</div>\n\t\t\t\t<c-resizer c-orient=\"row\"/>\n\t\t\t\t<div id=\"mainView\" c-resizable=\"\"/>\n\t\t\t</div>).lastElementChild as HTMLElement;\n\t\t\tthis.mainView = new ItemViewerSingle();\n\t\t\tawait this.mainView.initViewer(this.reg, parentMainView, null, null);\n\t\t\tthis.addEventListener('grid-select', this.onGridSelect);\n\t\t} else {\n\t\t\tsr.append(...this.buildResults(init));\n\t\t}\n\n\t\tconst initHeader: OAppHeaderInit<SearchItems> = BASIS.newInit(Object.assign({\n\t\t\treg: this.reg,\n\t\t\tfocusListening: this.grid,\n\t\t\tactionContext: this,\n\t\t\tmainActions: this.reg.mergeLists(SearchItems.APPBAR_MAIN_ACTIONS),\n\t\t\tmainBar: {\n\t\t\t\tgroupOrder: 'edit raz lib io *'\n\t\t\t},\n\t\t} as OAppHeaderInit<SearchItems>, init.appHeader), this.reg);\n\t\tsr.insertBefore(new AppHeader().initialize(initHeader), editor);\n\n\t\tawait this.initCrits();\n\t\tFORMS.findFirstFocusable(this.critRoot)?.focus();\n\n\t\t//intit ok, activation des écoutes de changement des critères\n\t\tif (this.critRoot) this.critRoot.addEventListener('wsp-uicrit-change', this.doSearch.bind(this, this.firstMax));\n\t\tthis.doSearch(this.firstMax);\n\t}\n\n\tprotected buildResults(init: OSearchItemsInit) {\n\t\tconst initGrid = BASIS.newInit(init.srcGrid, this.reg);\n\t\tinitGrid.hideHeaders = true;\n\t\tif (initGrid.skinScroll === undefined) initGrid.skinScroll = 'scroll/small';\n\t\tif (init.showMainView) initGrid.itemHandlingReact = this.reg.env.infoBroker;\n\t\tthis.grid = new SrcGrid().initialize(initGrid);\n\t\tthis.grid.setAttribute(\"c-resizable\", \"\");\n\n\t\tconst results = [];\n\t\tif (init.showResultBar !== false) {\n\t\t\tconst resultBar = <div id=\"resultBar\"/>;\n\t\t\tthis.countDisplay = resultBar.appendChild(<MsgLabel id=\"count\"/>) as MsgLabel;\n\t\t\tif (this.fullMax > this.firstMax) this.searchMoreBtn = resultBar.appendChild(<Button id=\"searchMore\" ui-context=\"dialog\" hidden=\"\" label=\"Voir plus\" onclick={this.doSearch.bind(this, this.fullMax)}/> as Button);\n\t\t\tresultBar.appendChild(<Button id=\"relaunch\" ui-context=\"dialog\" label=\"Relancer\" title=\"Relancer la recherche\" onclick={this.onRelaunch}/>);\n\t\t\tresults.push(resultBar);\n\t\t}\n\n\t\tresults.push(this.grid);\n\n\t\tif (init.searchStore) {\n\t\t\t//ihm d'enregistrement de la requête.\n\t\t\tthis.searchStore = init.searchStore;\n\t\t\tthis.initSearchRequest = init.initSearchRequest;\n\t\t\tconst searchStoreBar = <div id=\"searchStore\"/>;\n\t\t\tif (init.canEditTitle !== false) {\n\t\t\t\tconst titleElt = <input title=\"Nom de la requête\" id=\"titleReq\" value={this.initSearchRequest?.title || \"\"}/> as HTMLInputElement;\n\t\t\t\tif (this.readonly) titleElt.readOnly = true;\n\t\t\t\tsearchStoreBar.append(<span id=\"titleReqCtn\"><h3>Nom de la requête</h3>{titleElt}</span>,);\n\t\t\t}\n\t\t\tif (!this.readonly) searchStoreBar.appendChild(<Button id=\"saveReq\" ui-context=\"dialog\" label=\"Enregistrer\" title=\"Enregistrer cette requête\" icon=\"/@skin@/wsp/views/searches/searchesBtn.svg\" onclick={this.onSave}/>);\n\t\t\tresults.push(searchStoreBar);\n\t\t}\n\t\treturn results;\n\t}\n\n\t/** (re)Initialisation de la zone de recherche\n\t * @param definedWhereCrit : critère définis à afficher (on bypasse alors la conf initiale)\n\t */\n\tpublic async initCrits(definedWhereCrit?: Element, doSearch = false) {\n\t\tlet whereCrit: Element = definedWhereCrit || this.getInitWhereCrit();\n\t\tif (this.critRoot) this.critRoot.innerText = \"\";\n\t\tif (this.critRoot && whereCrit) {\n\t\t\tfor (let ch = whereCrit.firstElementChild; ch; ch = ch.nextElementSibling) {\n\t\t\t\tconst critArea = buildCritAreaFromXml(ch, this.criterions);\n\t\t\t\tif (critArea) {\n\t\t\t\t\tconst crit = await critArea.loadBody(this);\n\t\t\t\t\tif (crit) this.critRoot.appendChild(await crit.initialize(this).initFromXmlCrit(ch));\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this._conf.buildCrit) {\n\t\t\tthis._conf.buildCrit(this);\n\t\t} else if (this.critRoot) {\n\t\t\tthis.critRoot.appendChild(<h3>Portée</h3>);\n\t\t\tif (this._conf.fromSrcUri) {\n\t\t\t\tif (ITEM.getSrcUriType(this._conf.fromSrcUri) === 'space') {\n\t\t\t\t\tconst crit = this.critRoot.appendChild(ItemCritInSpace.AREA.buildBody(this)) as ItemCritInSpace;\n\t\t\t\t\tcrit.spaceUri = this._conf.fromSrcUri;\n\t\t\t\t} else {\n\t\t\t\t\tconst crit = this.critRoot.appendChild(ItemCritLinks.AREA_DESC.buildBody(this)) as ItemCritLinks;\n\t\t\t\t\tcrit.itemPtr.setSrcRef(this._conf.fromSrcUri);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.critRoot.appendChild(ItemCritFullWsp.AREA.buildBody(this));\n\t\t\t}\n\t\t\tthis.critRoot.appendChild(<h3>Critères</h3>);\n\t\t\tconst rootFilters = this.critRoot.appendChild(UiCritBool.AREA_AND_ROOT.buildBody(this)) as UiCritBool;\n\t\t\tif (this._conf.fullTextByDefault) rootFilters.insertCrit(ItemCritFullText.AREA.buildBody(this));\n\t\t}\n\t\tif (this.critAbstract && whereCrit) {\n\t\t\tthis.critAbstract.textContent = \"\";\n\t\t\tconst desc = UiCritBool.AREA_AND_ROOT.buildAbstract(whereCrit, this);\n\t\t\tif (desc) this.critAbstract.appendChild(desc);\n\t\t}\n\t\tif (doSearch) await this.doSearch(this.currentMax);\n\t}\n\n\tprotected getInitWhereCrit(): Element | null {\n\t\tconst initReq = this._conf.initSearchRequest;\n\t\tif (!initReq) return null\n\t\tif (initReq instanceof Element) return initReq;\n\t\tif (initReq.whereCrit) return initReq.whereCrit instanceof Element ? initReq.whereCrit : initReq.whereCrit(this);\n\t\treturn null\n\t}\n\n\tprotected showTimer: any;\n\n\tprotected onGridSelect(ev: Event) {\n\t\tif (this.showTimer) clearTimeout(this.showTimer);\n\t\tif (this.grid.countSelectedRows() === 1) {\n\t\t\tthis.showTimer = setTimeout(() => {\n\t\t\t\tconst sd = this.grid.shortDescs[0];\n\t\t\t\tif (sd) {\n\t\t\t\t\t(this.reg.env as IWedSearchCoordinatorPointer).wedSearchCoord.setParamsOnce(UiCritBool.AREA_AND_ROOT.buildWedSearch(this.buildWhereXml(), this.criterions));\n\t\t\t\t\tthis.reg.env.infoBroker.dispatchInfo(new InfoFocusItem(SRC.srcRef(sd), sd), this);\n\t\t\t\t}\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\tprotected onRelaunch(this: Button, ev: Event) {\n\t\tconst me = DOMSH.findHost<SearchItems>(this);\n\t\tme.doSearch(me.firstMax);\n\t}\n\n\tprotected onSave(this: Button, ev: Event) {\n\t\tconst me = DOMSH.findHost<SearchItems>(this);\n\t\tconst search = Object.create(me.initSearchRequest || null) as ISearchPersist;\n\t\tconst inputTi = me.shadowRoot.getElementById('titleReq') as HTMLInputElement;\n\t\tsearch.title = inputTi ? inputTi.value : undefined;\n\t\tsearch.whereCrit = me.buildWhereXml();\n\t\tme.searchStore.persistSearch(search);\n\t\tPOPUP.findPopupableParent(me).close();\n\t}\n\n\tprotected onClose(this: Button, ev: Event) {\n\t\tconst me = DOMSH.findHost<SearchItems>(this);\n\t\tPOPUP.findPopupableParent(me).close();\n\t}\n\n\tonViewShown(): void {\n\t\tthis.mainView?.onViewShown();\n\t}\n\n\tonViewHidden(closed?: boolean): void {\n\t\tif (closed) {\n\t\t\tif (this.showTimer) clearTimeout(this.showTimer);\n\t\t\tthis.streamedSearch?.close();\n\t\t}\n\t\tthis.mainView?.onViewHidden(closed);\n\t}\n}\n\nREG.reg.registerSkin('wsp-search-item', 1, /* language=CSS */ `\n\t:host {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t}\n\n\tc-appheader {\n\t\tborder-bottom: 1px solid var(--border-color);\n\t}\n\n\t#critEditor {\n\t\tflex: .8 .2 5em;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tpadding: 2px;\n\t}\n\n\t#critEditor.abstract {\n\t\tflex: 0.2;\n\t\ttext-align: center;\n\t\talign-items: center;\n\t}\n\n\t#critAbstract {\n\t\tflex: auto;\n\t\tfont-size: var(--label-size);\n\t}\n\n\t.boolOp, .boolBracket {\n\t\tcolor: var(--alt1-color);\n\t}\n\n\t.critVal {\n\t\tfont-weight: bold;\n\t}\n\n\t#mainView {\n\t\tflex: 1 1 50%;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t}\n\n\tc-resizer[c-orient=row] {\n\t\twidth: 1px;\n\t}\n\n\tc-resizer[c-orient=column] {\n\t\theight: 2px;\n\t}\n\n\t#critRoot {\n\t\tflex: 1;\n\t\toverflow: auto;\n\t\tpadding-inline-start: .6em;\n\t}\n\n\th3 {\n\t\tfont-style: italic;\n\t\tfont-size: 1em;\n\t\tcolor: var(--alt1-color);\n\t\tmargin: 0;\n\t\tmargin-inline-start: -.4em;\n\t\tuser-select: none;\n\t}\n\n\t#results {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex: 1 1 20em;\n\t}\n\n\t#gridCtn {\n\t\tflex: 1 1 20em;\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex-direction: column;\n\t}\n\n\twsp-src-grid {\n\t\tflex: 1 1 20em;\n\t\tborder-inline: none;\n\t}\n\n\t#resultBar {\n\t\tdisplay: flex;\n\t\tmin-height: fit-content;\n\t\tmin-width: 0;\n\t\tmargin: 2px;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tflex-wrap: wrap;\n\t}\n\t\n\t#titleReqCtn {\n\t\tflex: 1;\n\t  display: flex;\n\t  min-height: fit-content;\n\t  min-width: 0;\n\t  flex-direction: column;\n\t  margin-inline-start: .6em;\n\t  margin-block-end: .5em;\n  }\n\n\t#titleReq {\n\t\tflex: 1;\n\t\tmargin-inline-start: 2px;\n\t}\n\n\t#searchStore {\n\t\tdisplay: flex;\n\t\talign-items: flex-end;\n\t  justify-content: flex-end;\n\t}\n\n\t#count {\n\t\tflex: 0 1 auto;\n\t\tfont-style: italic;\n\t\tmargin: 2px;\n\t\tjustify-content: start;\n\t}\n`);\n\ncustomElements.define(\"wsp-search-item\", SearchItems);\n\n/** Réinitialisation de la requête dans son état initial lors de l'ouverture de la fenêtre */\nclass ResetRequest extends Action<SearchItems> {\n\n\tstatic SINGLETON = new ResetRequest();\n\n\tconstructor() {\n\t\tsuper(\"resetRequest\");\n\t\tthis._label = \"Réinitialiser le formulaire de recherche\";\n\t\tthis._icon = \"/@skin@/commons/icons/reset.svg\";\n\t\tthis._group = 'raz';\n\t}\n\n\tisVisible(ctx: SearchItems): boolean {\n\t\tif (ctx?.readonly) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\tasync execute(ctx: SearchItems, ev?: Event) {\n\t\treturn ctx.initCrits();\n\t}\n\n}\n\nREG.reg.addToList(\"actions:searchItems:bar\", \"resetRequest\", 1, ResetRequest.SINGLETON);\n\n/** Copie d'une requête dans le presse papier */\nclass CopyRequest extends Action<SearchItems> {\n\tstatic SINGLETON = new CopyRequest();\n\n\tconstructor() {\n\t\tsuper(\"copyRequest\");\n\t\tthis._label = \"Copier la requête\";\n\t\tthis._description = \"Copier la requête dans le presse-papier\";\n\t\tthis._icon = \"/@skin@/commons/icons/copy.svg\";\n\t\tthis._group = 'edit';\n\t}\n\n\t/* Tjs enabled avec les critères cachés...\n\tisEnabled(ctx: SearchItems): boolean {\n\t\tconst where = ctx.buildWhereXml();\n\t\tif(!where?.hasChildNodes()) return false;\n\t\treturn super.isEnabled(ctx);\n\t}\n\t*/\n\n\tasync execute(ctx: SearchItems, ev?: Event) {\n\t\ttry {\n\t\t\tconst where = ctx.buildWhereXml();\n\t\t\tawait navigator.clipboard.writeText(DOM.serializer().serializeToString(where));\n\t\t} catch (e) {\n\t\t\tPOPUP.showNotifForbidden(\"Copie dans le presse-papier impossible. Vérifiez dans votre navigateur que vous avez autorisé ce site à accéder au presse-papier.\", ctx);\n\t\t}\n\t}\n\n}\n\nREG.reg.addToList(\"actions:searchItems:bar\", \"copyRequest\", 1, CopyRequest.SINGLETON);\n\n/** Colle une requête depuis le presse papier */\nclass PasteRequest extends Action<SearchItems> {\n\tstatic SINGLETON = new PasteRequest();\n\n\tconstructor() {\n\t\tsuper(\"pasteRequest\");\n\t\tthis._label = \"Coller la requête\";\n\t\tthis._description = \"Coller la requête issue du presse-papier\";\n\t\tthis._icon = \"/@skin@/commons/icons/paste.svg\";\n\t\tthis._group = 'edit';\n\t}\n\n\tisVisible(ctx: SearchItems): boolean {\n\t\tif (ctx?.readonly) return false;\n\t\treturn super.isVisible(ctx);\n\t}\n\n\tasync execute(ctx: SearchItems, ev?: Event) {\n\t\tlet ct: string;\n\t\ttry {\n\t\t\tct = await navigator.clipboard.readText();\n\t\t} catch (e) {\n\t\t\tPOPUP.showNotifForbidden(\"Impossible de lire dans le presse-papier. Vérifiez dans votre navigateur que vous avez autorisé ce site à accéder au presse-papier.\", ctx);\n\t\t\treturn;\n\t\t}\n\n\t\tconst where = ct ? DOM.parseDomValid(`${ct}`, null, \"text/xml\") : null;\n\t\tif (where?.documentElement?.nodeName === 'where')\n\t\t\treturn ctx.initCrits(where.documentElement, true);\n\t\telse\n\t\t\tPOPUP.showNotifInfo(\"Aucune requête n'a pu être reconnue\", ctx);\n\t}\n\n}\n\nREG.reg.addToList(\"actions:searchItems:bar\", \"pasteRequest\", 1, PasteRequest.SINGLETON);\n\n\n// Actions spécifiques \"items\"\nREG.reg.addToList(\"actions:searchItems:bar:item\", \"exportResultCsv\", 1, new ExportResultCsv_item()\n\t.requireVisiblePerm(\"ui.searchItems.export.props\")\n\t.setLabel(\"csv\")\n\t.override('initButtonNode', (buttonNode: ActionBtn<any>, ctx: any) => {\n\t\tbuttonNode._hideLabel = false;\n\t})\n);\nREG.reg.addToList(\"actions:searchItems:bar:item\", \"exportResultItems\", 1, new ExportResultItems()\n\t.requireVisiblePerm(\"ui.searchItems.export.items\")\n\t.setLabel(\"scwsp\")\n\t.override('initButtonNode', (buttonNode: ActionBtn<any>, ctx: any) => {\n\t\tbuttonNode._hideLabel = false;\n\t})\n);\n\n// Actions spécifiques \"taches\"\nREG.reg.addToList(\"actions:searchItems:bar:task\", \"exportResultCsv\", 1, new ExportResultCsv_task()\n\t.requireVisiblePerm(\"ui.searchItems.export.props\")\n\t.setLabel(\"csv\")\n\t.override('initButtonNode', (buttonNode: ActionBtn<any>, ctx: any) => {\n\t\tbuttonNode._hideLabel = false;\n\t})\n);"]}