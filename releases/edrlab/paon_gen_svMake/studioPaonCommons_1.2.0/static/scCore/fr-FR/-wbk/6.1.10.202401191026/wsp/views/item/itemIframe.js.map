{"version":3,"sources":["/@back@/wsp/views/item/itemIframe.tsx"],"names":["BaseElement","BASIS","installSrcViewFileDrop","REG","JSX","DOMSH","WSP","ImgSize","SRC","ItemIframe","[object Object]","init","this","reg","findReg","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","env","iframe","createElement","src","getStreamUrl","transform","size","appendChild","î","newInit","place","eventsMgr","on","msg","srcRef","longDesc","contentWindow","location","reload","getStreamStampedUrl","wsp","itemType","getMainStreamSrcUri","srcDt","registerSkin","customElements","define"],"mappings":"OAAQA,YAAaC,UAAqB;OACtBC,2BAAuB;OAC7BC,QAAI;OAEVC,QAAI;OACJC,UAAM;OACYC,QAAI;OACtBC,YAAwB;OACxBC,QAAI;OAiBN,MAAOC,mBAAmBT,YAG/BU,YAAYC,MACXC,KAAKC,IAAMD,KAAKE,QAAQH;AACxB,MAAMI,GAAKH,KAAKI,aAAaX,MAAMY;AACnCL,KAAKM,oBAAoBN,KAAKO,UAAWR;AACzCT,uBAAuBU,KAAKC,IAAKD;AACjC,MAAMQ,IAAEA,KAAQR,KAAKC;AACrB,MAAMQ,OAASjB,IAAAkB,cAAA,SAAA,CAAQC,IAAKX,KAAKY,aAAaZ,KAAKC,IAAIO,IAAKT,KAAKc;AACjE,GAAId,KAAKe,KAAMX,GAAGY,YAAYvB,IAAAkB,cAACf,QAAO,CAAAqB,IAAI3B,MAAM4B,QAAQlB,KAAKe,KAAMd,KAAKC,MAAOQ;KAC1EN,GAAGY,YAAYN;AAGpBD,IAAIU,MAAMC,UAAUC,GAAG,eAAiBC,MACvC,GAAIzB,IAAI0B,OAAOd,IAAIe,YAAc3B,IAAI0B,OAAOD,KAAM,CACjDZ,OAAOe,cAAcC,SAASC,YAKjC5B,aAAaU,IAAiBK,WAC7B,OAAOnB,IAAIiC,oBAAoBnB,IAAIoB,IAAKpB,IAAIqB,SAASC,oBAAoBtB,IAAIe,UAAWf,IAAIe,SAASQ,MAAOlB,YAI9GtB,IAAIU,IAAI+B,aAAa,kBAAmB,EAAsB;AAyB9DC,eAAeC,OAAO,kBAAmBrC","sourcesContent":["import {BaseElement, BASIS, OSkinableInit} from \"back/commons/basis\";\nimport {IItemUiEnv, installSrcViewFileDrop} from \"back/wsp/views/itemMain\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IView} from \"lib/commons/views\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {JWspUriChangeMsg, WSP} from \"lib/wsp/wsp\";\nimport {ImgSize, OImgSizeConfig} from \"back/wsp/widgets/imgSize\";\nimport {SRC} from \"lib/wsp/src\";\n\n/**\n * View du contenu d'un item via une iframe (pdf...).\n *\n * Config attributes:\n */\nexport interface OItemIframeInit extends OSkinableInit {\n\treg?: IReg<IItemUiEnv>\n\ttransform?: string,\n\tsize: OImgSizeConfig\n}\n\nexport interface ItemIframe extends BaseElement {\n\tinitialize(init: OItemIframeInit): this;\n}\n\nexport class ItemIframe extends BaseElement implements IView {\n\treg: IReg<IItemUiEnv>;\n\n\t_initialize(init: OItemIframeInit) {\n\t\tthis.reg = this.findReg(init);\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tinstallSrcViewFileDrop(this.reg, this);\n\t\tconst { env } = this.reg;\n\t\tconst iframe = <iframe src={this.getStreamUrl(this.reg.env, init.transform)}/>;\n\t\tif (init.size) sr.appendChild(<ImgSize î={BASIS.newInit(init.size, this.reg)}>{iframe}</ImgSize>);\n\t\telse sr.appendChild(iframe);\n\n\t\t// Listener sur les changements de la ressource\n\t\tenv.place.eventsMgr.on(\"wspUriChange\", (msg: JWspUriChangeMsg) => {\n\t\t\tif (SRC.srcRef(env.longDesc) === SRC.srcRef(msg)) {\n\t\t\t\tiframe.contentWindow.location.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetStreamUrl(env: IItemUiEnv, transform: string) {\n\t\treturn WSP.getStreamStampedUrl(env.wsp, env.itemType.getMainStreamSrcUri(env.longDesc), env.longDesc.srcDt, transform)\n\t}\n}\n\nREG.reg.registerSkin(\"wsp-item-iframe\", 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex: 1;\n\t\tflex-direction: column;\n\t\tpadding: 1px;\n\t}\n\n\t:host > iframe {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t\n\tiframe {\n\t\tborder: none;\n\t}\n\n\twsp-imgsize {\n\t\tflex: 1;\n\t}\n`);\n\n\ncustomElements.define(\"wsp-item-iframe\", ItemIframe);\n"]}