{"version":3,"sources":["/@back@/edit/wed/wedlets/box/boxEnumLarge.tsx"],"names":["BoxInputEnum","EPopupType","MxPopupable","BaseElement","GridColTreeDef","GridDataHolderJsonTree","MxGridTreeUntouchedDatas","Grid","ActionSeparator","CellBuilderLabel","DOM","JSX","REG","WEDLET","BoxInputEnumLarge","[object Object]","popup","PopupEnumTree","initialize","reg","findReg","this","actionContext","resizer","onNextClose","then","key","isSelected","replaceValue","wedlet","ev","contains","target","actions","provider","getActions","show","viewPortY","fixSize","initWidth","window","customElements","define","menu","_actionContext","init","super","_initialize","restoreFocus","dataHolder","DataHolderActions","installSkin","colDefs","setFlex","setMinWidth","setCellBuilder","CellBuilderAction","searchLabel","appendChild","createElement","id","search","type","spellcheck","placeholder","oninput","onSearchInput","onkeydown","onKeyPress","grid","selType","columnDefs","lineDrawer","hideHeaders","skinScroll","skinOver","uiEvents","on","row","rowDatas","isToggle","localName","close","getId","addEventListener","me","parentElement","getRow","getSelectedRow","preventDefault","focus","redrawDatas","tree","countRows","undefined","setSelectedRows","line","d","setAttrBool","isEnabled","setAttr","getDatas","anchor","uiContainer","logicalParent","filter","value","setDefaultOpenState","defaultOpened","setDatas","defaultClosed","registerSkin","parent","isMenu","ch","setActions","ctx","root","classList","toggle","setTextContent","redrawCell","getLabel","getDescription"],"mappings":"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","sourcesContent":["import {BoxInputEnum, IBoxEnumEltWedlet} from \"back/edit/wed/wedlets/box/boxTags\";\nimport {EPopupType, IPopupable, MxPopupable, OPopupAnchor} from \"back/commons/widgets/popupable\";\nimport {IActionableList} from \"back/commons/actionables\";\nimport {OPopupMenuInit} from \"back/commons/widgets/popups\";\nimport {BaseElement} from \"back/commons/basis\";\nimport {GridColTreeDef, GridDataHolderJsonTree, MxGridTreeUntouchedDatas} from \"back/commons/widgets/tree\";\nimport {Grid} from \"back/commons/widgets/grid-tags\";\nimport {ActionMenu, ActionSeparator, IAction} from \"lib/commons/actions\";\nimport {CellBuilderLabel, GridDataRowJson} from \"back/commons/widgets/grid-libs\";\nimport {DOM, JSX} from \"lib/commons/xml/dom\";\nimport {REG} from \"lib/commons/registry\";\nimport {WEDLET} from \"back/edit/wed/wedlets/wedlet\";\nimport {IGridLineDrawer} from \"back/commons/widgets/grid-core\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\n\nclass BoxInputEnumLarge extends BoxInputEnum {\n\n\tprotected _createPopup(): IPopupable & IActionableList<IBoxEnumEltWedlet> {\n\t\tconst popup = new PopupEnumTree().initialize({\n\t\t\treg: REG.findReg(this),\n\t\t\tactionContext: this,\n\t\t\tresizer: {}\n\t\t});\n\t\tpopup.onNextClose().then((key: string) => {\n\t\t\tif (key != null && !this.isSelected(key)) WEDLET.replaceValue(this.wedlet, this.key, key);\n\t\t});\n\t\treturn popup;\n\t}\n\n\tasync onClick(this: BoxInputEnum, ev: MouseEvent) {\n\t\tconst popup = this.popup;\n\t\tif (popup && !popup.contains(ev.target as Node)) {\n\t\t\tif (!popup.actions) popup.actions = await this.provider.getActions(this);\n\t\t\tpopup.show({\n\t\t\t\tviewPortY: \"middle\",\n\t\t\t\tfixSize: true,\n\t\t\t\tinitWidth: \"60em\"\n\t\t\t}, this);\n\t\t}\n\t}\n}\n\nwindow.customElements.define(\"box-input-enumlarge\", BoxInputEnumLarge);\n\n\nexport interface PopupEnumTree {\n\tinitialize(init?: OPopupEnumTreeInit): this;\n}\n\nexport interface OPopupEnumTreeInit extends OPopupMenuInit {\n\tactionContext: BoxInputEnumLarge;\n}\n\nexport class PopupEnumTree extends MxPopupable(BaseElement, EPopupType.menu) implements IGridLineDrawer, IPopupable<string>, IActionableList<BoxInputEnumLarge> {\n\n\tactions: IAction<IBoxEnumEltWedlet>[];\n\n\t_actionContext: BoxInputEnumLarge;\n\tget actionContext(): BoxInputEnumLarge {return this._actionContext};\n\n\tdataHolder: GridDataHolderJsonTree<IAction<IBoxEnumEltWedlet>>;\n\n\tgrid: Grid;\n\tsearch: HTMLInputElement;\n\n\tprotected _initialize(init: OPopupEnumTreeInit) {\n\t\tsuper._initialize(init);\n\t\tif ('restoreFocus' in init) this.restoreFocus = init.restoreFocus;\n\t\tthis._actionContext = init.actionContext;\n\t\tthis.dataHolder = new DataHolderActions(this.actionContext);\n\t\tREG.reg.installSkin(\"box-input-enumlarge\");\n\n\t\tconst colDefs = [new GridColTreeDef('tree')\n\t\t\t.setFlex('10rem', 1, 1).setMinWidth('55px')\n\t\t\t.setCellBuilder(new CellBuilderAction(this.actionContext))];\n\n\t\tconst searchLabel = this.appendChild(<label id=\"search\"/>)\n\t\tthis.search = searchLabel.appendChild(<input type=\"search\" spellcheck=\"false\" placeholder=\"Filtrer...\" oninput={this.onSearchInput} onkeydown={this.onKeyPress}/>) as HTMLInputElement;\n\t\tthis.grid = this.appendChild(new Grid().initialize({\n\t\t\tselType: \"monoOver\",\n\t\t\tcolumnDefs: colDefs,\n\t\t\tdataHolder: this.dataHolder,\n\t\t\tlineDrawer: this,\n\t\t\thideHeaders: true,\n\t\t\tskinScroll: \"scroll/small\",\n\t\t\tskinOver: \"box-input-enumlarge-popup/grid\"\n\t\t}));\n\n\t\tthis.grid.uiEvents.on('rowClick', (row: GridDataRowJson<IAction<IBoxEnumEltWedlet>> | null, ev: MouseEvent) => {\n\t\t\tif (row?.rowDatas.isToggle(this.actionContext) && (ev.target as Element).localName === \"span\") {\n\t\t\t\tthis.close(row.rowDatas.getId());\n\t\t\t}\n\t\t});\n\t\tthis.grid.addEventListener('keypress', function (this: Grid, ev: KeyboardEvent) {\n\t\t\tconst me = this.parentElement as PopupEnumTree;\n\t\t\tif (ev.key === ' ' || ev.key === 'Enter') {\n\t\t\t\tconst row = this.dataHolder.getRow(this.getSelectedRow()) as GridDataRowJson<IAction<IBoxEnumEltWedlet>>;\n\t\t\t\tif (row?.rowDatas.isToggle(me.actionContext)) me.close(row.rowDatas.getId());\n\t\t\t\tev.preventDefault();\n\t\t\t} else me.search.focus();\n\t\t});\n\t}\n\n\tprotected onSearchInput(this: HTMLInputElement, ev: InputEvent) {\n\t\t(this.parentElement.parentElement as PopupEnumTree).redrawDatas();\n\t}\n\n\tprotected onKeyPress(this: HTMLInputElement, ev: KeyboardEvent) {\n\t\tif (ev.key === 'ArrowDown') {\n\t\t\tconst tree = this.parentElement as PopupEnumTree;\n\t\t\tif (tree.grid.dataHolder.countRows() > 0) {\n\t\t\t\tif (tree.grid.getSelectedRow() === undefined) tree.grid.setSelectedRows(0);\n\t\t\t\ttree.grid.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\t/** */\n\tredrawLine(row: GridDataRowJson<IAction<IBoxEnumEltWedlet>>, line: HTMLElement): void {\n\t\tconst d = row.rowDatas;\n\t\tDOM.setAttrBool(line, \"data-user-disabled\", !d.isEnabled(this._actionContext));\n\t\tDOM.setAttr(line, \"selected\", d.isToggle(this._actionContext) ? d.getDatas(\"toggle\", this._actionContext) as any as 'true' | 'false' | 'null' : \"null\");\n\t}\n\n\tshow(anchor?: OPopupAnchor, uiContainer?: Node, logicalParent?: Element): boolean {\n\t\tthis.redrawDatas();\n\t\treturn super.show(anchor, uiContainer, logicalParent);\n\t}\n\n\tprotected async redrawDatas() {\n\t\tconst filter = this.search.value;\n\t\tif (filter) {\n\t\t\tthis.dataHolder.setDefaultOpenState(GridDataHolderJsonTree.defaultOpened as any);\n\t\t\tthis.dataHolder.setDatas(await this.actionContext.provider.getActions(this.actionContext, filter));\n\t\t} else {\n\t\t\tthis.dataHolder.setDefaultOpenState(GridDataHolderJsonTree.defaultClosed as any);\n\t\t\tthis.dataHolder.setDatas(this.actions);\n\t\t}\n\t}\n}\n\nREG.reg.registerSkin('box-input-enumlarge', 1, /* language=CSS */ `\n\t#search {\n\t\tbackground: .1em / 1em no-repeat url(/@skin@/commons/icons/filter.svg) var(--form-search-bgcolor);\n\t\tpadding-inline-start: 1.2em;\n\t}\n\n\tinput {\n\t\tpadding: 2px;\n\t\tbackground: var(--form-search-bgcolor);\n\t\tcolor: var(--form-color);\n\t\tborder: none;\n\t\twidth: 100%;\n\t\tfont-size: inherit;\n\t}\n\tinput:placeholder-shown{\n\t\tfont-style: italic;\n\t}\n`);\n\nREG.reg.registerSkin('box-input-enumlarge-popup', 1, /* language=CSS */ `\n\t:host([opened]) {\n\t\tpointer-events: auto;\n\t}\n\n\t#content {\n\t\tbackground-color: var(--row-bgcolor);\n\t\tborder: solid 1px var(--border-color);\n\t\tborder-radius: 3px;\n\t\tbox-shadow: 1px 1px 6px var(--fade-color);\n\t\tmin-width: 30em;\n\t\tmin-height: 20em;\n\t}\n\n\t::slotted(c-grid) {\n\t\tflex: 1;\n\t}\n`);\n\nREG.reg.registerSkin('box-input-enumlarge-popup/grid', 1, /* language=CSS */ `\n\t.line:before{\n\t\tcontent: \" \";\n\t\tmin-width: 1rem;\n\t}\n\t.line[selected=\"true\"]:before{\n\t\tcontent: \"✓\";\n\t}\n\t.cell {\n\t\tdisplay: flex;\n\t}\n\n\t.line[selected=\"null\"] > .cell {\n\t\tfont-style: italic;\n\t}\n\t.line[selected=\"true\"] > .cell,\n\t.line[selected=\"false\"] > .cell {\n\t\tcursor: pointer;\n\t}\n\n\tspan {\n\t\tflex: 1;\n\t  white-space: normal;\n  }\n\n  .sep {\n\t  display: flex;\n  }\n\n  *[data-user-disabled] {\n\t  opacity: .5;\n\t  pointer-events: none;\n  }\n\n  .sep > span {\n\t  border-bottom: solid 1px var(--border-color);\n\t  flex: 1;\n\t  height: 1px;\n  }\n`);\n\nwindow.customElements.define(\"box-input-enumlarge-popup\", PopupEnumTree);\n\nclass DataHolderActions extends MxGridTreeUntouchedDatas(GridDataHolderJsonTree)<IAction<IBoxEnumEltWedlet>> {\n\tactionContext: IBoxEnumEltWedlet;\n\n\tconstructor(actionContext: IBoxEnumEltWedlet) {\n\t\tsuper();\n\t\tthis.actionContext = actionContext;\n\t}\n\n\tch(parent: IAction<IBoxEnumEltWedlet>): IAction<IBoxEnumEltWedlet>[] | undefined | null {\n\t\tif (!parent.isMenu(this.actionContext)) return undefined;\n\t\treturn (parent.getDatas(\"menu\", this.actionContext) || []) as IAction<IBoxEnumEltWedlet>[];\n\t}\n\n\tsetCh(parent: IAction<IBoxEnumEltWedlet>, ch: IAction<IBoxEnumEltWedlet>[] | null): IAction<IBoxEnumEltWedlet>[] | null {\n\t\t(parent as ActionMenu<IBoxEnumEltWedlet>).setActions(ch);\n\t\treturn ch;\n\t}\n}\n\nclass CellBuilderAction<C> extends CellBuilderLabel /*CellBuilderIconLabel*/ {\n\tctx: C;\n\n\tconstructor(actionContext: C) {\n\t\tsuper('');\n\t\tthis.ctx = actionContext;\n\t}\n\n\tredrawCell(row: GridDataRowJson<IAction<C>>, root: HTMLElement) {\n\t\tif (row.rowDatas instanceof ActionSeparator) {\n\t\t\troot.parentElement.classList.toggle(\"sep\", true);\n\t\t\tDOM.setTextContent(root, null);\n\t\t\tDOM.setAttr(root, \"title\", null);\n\t\t} else {\n\t\t\troot.parentElement.classList.toggle(\"sep\", false);\n\t\t\tsuper.redrawCell(row, root);\n\t\t}\n\t}\n\n\tprotected _getValue(row: GridDataRowJson<IAction<C>>): any {\n\t\treturn row.rowDatas.getLabel(this.ctx);\n\t}\n\n\t// protected _getIcon(row: GridDataRowJson<IAction<C>>): string {\n\t// \treturn row.rowDatas.getIcon(this.ctx);\n\t// }\n\n\tprotected _getDescription(row: GridDataRowJson<IAction<C>>): any {\n\t\treturn row.rowDatas.getDescription(this.ctx);\n\t}\n\n}"]}