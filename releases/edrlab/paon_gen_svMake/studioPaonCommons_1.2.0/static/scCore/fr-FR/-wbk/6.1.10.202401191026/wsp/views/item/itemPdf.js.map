{"version":3,"sources":["/@back@/wsp/views/item/itemPdf.tsx"],"names":["BaseElement","BASIS","installSrcViewFileDrop","REG","JSX","DOMSH","WSP","ImgSize","SRC","VIEWER_HASH","ItemPdf","[object Object]","init","this","reg","findReg","sr","attachShadow","SHADOWDOM_INIT","_initAndInstallSkin","localName","env","iframe","createElement","src","getStreamUrl","transform","size","appendChild","î","newInit","place","eventsMgr","on","msg","srcRef","longDesc","_a","contentWindow","location","reload","getStreamStampedUrl","wsp","itemType","getMainStreamSrcUri","srcDt","registerSkin","customElements","define"],"mappings":"OAAQA,YAAaC,UAAqB;OACtBC,2BAAuB;OAC7BC,QAAI;OAEVC,QAAI;OACJC,UAAM;OACYC,QAAI;OACtBC,YAAwB;OACxBC,QAAI;AAiBZ,MAAMC,YAAc;OACd,MAAOC,gBAAgBV,YAG5BW,YAAYC,MACXC,KAAKC,IAAMD,KAAKE,QAAQH;AACxB,MAAMI,GAAKH,KAAKI,aAAaZ,MAAMa;AACnCL,KAAKM,oBAAoBN,KAAKO,UAAWR;AACzCV,uBAAuBW,KAAKC,IAAKD;AACjC,MAAMQ,IAAEA,KAAQR,KAAKC;AAErB,MAAMQ,OAASlB,IAAAmB,cAAA,SAAA,CAAQC,IAAKX,KAAKY,aAAaJ,IAAKT,KAAKc;AACxD,GAAId,KAAKe,KAAMX,GAAGY,YAAYxB,IAAAmB,cAAChB,QAAO,CAAAsB,IAAI5B,MAAM6B,QAAQlB,KAAKe,KAAMd,KAAKC,MAAOQ;KAC1EN,GAAGY,YAAYN;AAGpBD,IAAIU,MAAMC,UAAUC,GAAG,eAAiBC;AACvC,GAAI1B,IAAI2B,OAAOd,IAAIe,YAAc5B,IAAI2B,OAAOD,KAAM,EACjDG,GAAAf,OAAOgB,iBAAa,MAAAD,UAAA,OAAA,EAAAA,GAAEE,SAASC,YAKlC7B,aAAaU,IAAiBK,WAC7B,OAAOpB,IAAImC,oBAAoBpB,IAAIqB,IAAKrB,IAAIsB,SAASC,oBAAoBvB,IAAIe,UAAWf,IAAIe,SAASS,MAAOnB,WAAajB,aAS3HN,IAAIW,IAAIgC,aAAa,eAAgB,EAAsB;AAyB3DC,eAAeC,OAAO,eAAgBtC","sourcesContent":["import {BaseElement, BASIS, OSkinableInit} from \"back/commons/basis\";\nimport {IItemUiEnv, installSrcViewFileDrop} from \"back/wsp/views/itemMain\";\nimport {IReg, REG} from \"lib/commons/registry\";\nimport {IView} from \"lib/commons/views\";\nimport {JSX} from \"lib/commons/xml/dom\";\nimport {DOMSH} from \"lib/commons/xml/domsh\";\nimport {JWspUriChangeMsg, WSP} from \"lib/wsp/wsp\";\nimport {ImgSize, OImgSizeConfig} from \"back/wsp/widgets/imgSize\";\nimport {SRC} from \"lib/wsp/src\";\n\n/**\n * View du contenu d'un item via une iframe (pdf...).\n *\n * Config attributes:\n */\nexport interface OItemPdfInit extends OSkinableInit {\n\treg?: IReg<IItemUiEnv>\n\ttransform?: string,\n\tsize: OImgSizeConfig\n}\n\nexport interface ItemPdf extends BaseElement {\n\tinitialize(init: OItemPdfInit): this;\n}\n\nconst VIEWER_HASH = '#view=Fit&toolbar=0';\nexport class ItemPdf extends BaseElement implements IView {\n\treg: IReg<IItemUiEnv>;\n\n\t_initialize(init: OItemPdfInit) {\n\t\tthis.reg = this.findReg(init);\n\t\tconst sr = this.attachShadow(DOMSH.SHADOWDOM_INIT);\n\t\tthis._initAndInstallSkin(this.localName, init);\n\t\tinstallSrcViewFileDrop(this.reg, this);\n\t\tconst { env } = this.reg;\n\n\t\tconst iframe = <iframe src={this.getStreamUrl(env, init.transform)}/>;\n\t\tif (init.size) sr.appendChild(<ImgSize î={BASIS.newInit(init.size, this.reg)}>{iframe}</ImgSize>);\n\t\telse sr.appendChild(iframe);\n\n\t\t// Listener sur les changements de la ressource\n\t\tenv.place.eventsMgr.on(\"wspUriChange\", (msg: JWspUriChangeMsg) => {\n\t\t\tif (SRC.srcRef(env.longDesc) === SRC.srcRef(msg)) {\n\t\t\t\tiframe.contentWindow?.location.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetStreamUrl(env: IItemUiEnv, transform: string) {\n\t\treturn WSP.getStreamStampedUrl(env.wsp, env.itemType.getMainStreamSrcUri(env.longDesc), env.longDesc.srcDt, transform) + VIEWER_HASH;\n\t}\n\n\t// onFileEntryDrop(entry: WebKitEntry) {\n\t// \tif (!entry.isFile) return;\n\t// \tconsole.log(\"!!!\", entry);\n\t// }\n}\n\nREG.reg.registerSkin(\"wsp-item-pdf\", 1, /* language=CSS */ `\n\t:host {\n\t\tdisplay: flex;\n\t\tmin-height: 0;\n\t\tmin-width: 0;\n\t\tflex: 1;\n\t\tflex-direction: column;\n\t\tpadding: 1px;\n\t}\n\n\t:host > iframe {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t\n\tiframe {\n\t\tborder: none;\n\t}\n\n\twsp-imgsize {\n\t\tflex: 1;\n\t}\n`);\n\n\ncustomElements.define(\"wsp-item-pdf\", ItemPdf);\n"]}