{"version":3,"sources":["/@back@/wsp/plugins/packsPlg.tsx"],"names":["Action","ActionHackCtx","REG","POPUP","SkinPacksMgr","WspPacksMgr","initApp","reg","WrapReg","[object Object]","sub","super","this","ctx","buttonNode","initButtonNode","wrap","action","addToList","OpenPackMgr","requireVisiblePerm","OpenSkinMgr","_label","_group","ev","MOD","import","ct","initialize","universes","regUniversesList","showDialog","titleBar","barLabel","label","closeButton","resizer","viewPortX","viewPortY","initWidth","initHeight","onNextClose","isVisible","isAvailable","getList"],"mappings":"OAAQA,OAAQC,kBAAuB;OACZC,QAAI;;OAIvBC,UAAM;OACSC,aAAcC,gBAAY;OAU3C,SAAUC,QAAQC,IAA0BL,IAAIK,KAErD,MAAMC,gBAAgBP,cACrBQ,YAAYC,IAAyCH,KACpDI,MAAMD;AAD8CE,KAAAL,IAAAA,IAIrDE,QAAQI,KAAmC,OAAOD,KAAKL,IAEvDE,eAAeK,WAAqBD,KAElCC,WAAyCP,IAAMK,KAAKL;AACrDK,KAAKF,IAAIK,eAAeD,WAAYF,KAAKL,MAI3C,SAASS,KAAKC,QACb,OAAO,IAAIT,QAAQS,OAAQV,KAI5BL,IAAIK,IAAIW,UAAU,iCAAkC,WAAY,EAAGF,MAAK,IAAIG,aAAcC,mBAAmB,mBAAoB;AACjIlB,IAAIK,IAAIW,UAAU,iCAAkC,YAAa,EAAGF,MAAK,IAAIK,aAAcD,mBAAmB,oBAAqB,WAQ9H,MAAOD,oBAAoBnB,OAEhCS,cACCE,MAAM;AACNC,KAAKU,OAAS;AACdV,KAAKW,OAAS,QAGfd,cAAcI,IAAyBW,IACtC,MAAMC,UAAYC,OAAM;AACxB,MAAMC,IAAK,IAAIF,IAAIpB,aAAcuB,WAAW,CAC3CrB,IAAKM,IAAIN,IACTsB,UAAWC,iBAAiBjB,IAAIN;MAE3BJ,MAAM4B,WAAWJ,GAAI,KAAM,CAChCK,SAAU,CAACC,SAAU,CAACC,MAAO,2BAA4BC,YAAa,IACtEC,QAAS,GACTC,UAAW,SACXC,UAAW,SACXC,UAAW,kBACXC,WAAY,SACVC,cAGJhC,UAAUI,KACT,IAAKF,MAAM+B,UAAU7B,KAAM,OAAO;AAClC,OAAOR,YAAYsC,YAAYb,iBAAiBjB,IAAIN,cAOhD,MAAOc,oBAAoBrB,OAEhCS,cACCE,MAAM;AACNC,KAAKU,OAAS;AACdV,KAAKW,OAAS,QAGfd,cAAcI,IAAyBW,IACtC,MAAMC,UAAYC,OAAM;AACxB,MAAMC,IAAK,IAAIF,IAAIrB,cAAewB,WAAW,CAC5CrB,IAAKM,IAAIN,IACTsB,UAAWC,iBAAiBjB,IAAIN;MAE3BJ,MAAM4B,WAAWJ,GAAI,KAAM,CAChCK,SAAU,CAACC,SAAU,CAACC,MAAO,uCAAwCC,YAAa,IAClFC,QAAS,GACTC,UAAW,SACXC,UAAW,SACXC,UAAW,kBACXC,WAAY,SACVC,cAGJhC,UAAUI,KACT,IAAKF,MAAM+B,UAAU7B,KAAM,OAAO;AAClC,OAAOT,aAAauC,YAAYb,iBAAiBjB,IAAIN,OAQvD,SAASuB,iBAAiBvB,KACzB,OAAOA,IAAIqC,QAAQ","sourcesContent":["import {Action, ActionHackCtx, IAction} from \"lib/commons/actions\";\nimport {IReg, IRegPointer, REG} from 'lib/commons/registry';\nimport {JSX} from \"lib/commons/xml/dom\";\nimport \"back/wsp/plugins/plugins_Perms\";\nimport {CoreUniverse, IUniverseEnv} from \"lib/core/universe\";\nimport {POPUP} from \"back/commons/widgets/popups\";\nimport {OPacksMgrInit, SkinPacksMgr, WspPacksMgr} from \"back/wsp/dialogs/packsMgr\";\nimport {IPacksInUniverse} from \"lib/wsp/pack\";\n\n/**\n * Gestionnaire global de packs\n *\n * @param reg Registre à exploiter correspondant\n * @param contexte reg :\n * \t- liste des univers à traiter : \"plg:packs:universes\"\n */\nexport function initApp(reg: IReg<IUniverseEnv> = REG.reg) {\n\n\tclass WrapReg extends ActionHackCtx<Element, IReg<IUniverseEnv>> {\n\t\tconstructor(sub: IAction<IReg<IUniverseEnv>>, public reg: IReg<IUniverseEnv>) {\n\t\t\tsuper(sub);\n\t\t}\n\n\t\twrapCtx(ctx: Element): IReg<IUniverseEnv> {return this.reg}\n\n\t\tinitButtonNode(buttonNode: Element, ctx: Element) {\n\t\t\t//Affectation du bon registre dans le contexte graphique.\n\t\t\t(buttonNode as IRegPointer<IUniverseEnv>).reg = this.reg;\n\t\t\tthis.sub.initButtonNode(buttonNode, this.reg);\n\t\t}\n\t}\n\n\tfunction wrap(action: IAction<IReg<IUniverseEnv>>): IAction<Element> {\n\t\treturn new WrapReg(action, reg);\n\t}\n\n\t//Menu Options\n\tREG.reg.addToList(\"appframe:header:toolbar:params\", \"wsppacks\", 1, wrap(new OpenPackMgr().requireVisiblePerm(\"ui.wspPacksMgr\")), 10);\n\tREG.reg.addToList(\"appframe:header:toolbar:params\", \"skinpacks\", 1, wrap(new OpenSkinMgr().requireVisiblePerm(\"ui.skinPacksMgr\")), 11);\n\n}\n\n\n/**\n * Ouverture du gestionnaire de packs\n */\nexport class OpenPackMgr extends Action<IReg<IUniverseEnv>> {\n\n\tconstructor() {\n\t\tsuper(\"packMgr\");\n\t\tthis._label = \"Modèles documentaires...\";\n\t\tthis._group = 'packs';\n\t}\n\n\tasync execute(ctx: IReg<IUniverseEnv>, ev?: Event) {\n\t\tconst MOD = await import(\"back/wsp/dialogs/packsMgr.js\");\n\t\tconst ct = new MOD.WspPacksMgr().initialize({\n\t\t\treg: ctx.reg,\n\t\t\tuniverses: regUniversesList(ctx.reg),\n\t\t} as OPacksMgrInit);\n\t\tawait POPUP.showDialog(ct, null, {\n\t\t\ttitleBar: {barLabel: {label: \"Modèles documentaires\"}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tinitWidth: \"max(60em, 40vw)\",\n\t\t\tinitHeight: \"70vh\"\n\t\t}).onNextClose();\n\t}\n\n\tisVisible(ctx: IReg<IUniverseEnv>): boolean {\n\t\tif (!super.isVisible(ctx)) return false;\n\t\treturn WspPacksMgr.isAvailable(regUniversesList(ctx.reg));\n\t}\n}\n\n/**\n * Ouverture du gestionnaire de skins\n */\nexport class OpenSkinMgr extends Action<IReg<IUniverseEnv>> {\n\n\tconstructor() {\n\t\tsuper(\"skinMgr\");\n\t\tthis._label = \"Habillages graphiques des modèles...\";\n\t\tthis._group = 'packs';\n\t}\n\n\tasync execute(ctx: IReg<IUniverseEnv>, ev?: Event) {\n\t\tconst MOD = await import(\"back/wsp/dialogs/packsMgr.js\");\n\t\tconst ct = new MOD.SkinPacksMgr().initialize({\n\t\t\treg: ctx.reg,\n\t\t\tuniverses: regUniversesList(ctx.reg),\n\t\t} as OPacksMgrInit);\n\t\tawait POPUP.showDialog(ct, null, {\n\t\t\ttitleBar: {barLabel: {label: \"Habillages graphiques des modèles\"}, closeButton: {}},\n\t\t\tresizer: {},\n\t\t\tviewPortX: \"middle\",\n\t\t\tviewPortY: \"middle\",\n\t\t\tinitWidth: \"max(60em, 40vw)\",\n\t\t\tinitHeight: \"70vh\"\n\t\t}).onNextClose();\n\t}\n\n\tisVisible(ctx: IReg<IUniverseEnv>): boolean {\n\t\tif (!super.isVisible(ctx)) return false;\n\t\treturn SkinPacksMgr.isAvailable(regUniversesList(ctx.reg));\n\t}\n}\n\n/**\n *\n * @param reg\n */\nfunction regUniversesList(reg: IReg<IUniverseEnv>): (CoreUniverse & IPacksInUniverse)[] {\n\treturn reg.getList(\"plg:packs:universes\");\n}"]}