{"version":3,"sources":["/@lib@/wsp/drv.ts"],"names":["WSP","SRC","IO","WSP_DRV","getDrvStateLabel","st","getDrvStateDone","getDrvStateLayer","isDrv","props","undefined","drvAxis","async","createWspDrv","wspMaster","params","wspType","code","isLoaded","waitForLoad","createWsp","wspServer","deleteDrvOverride","wsp","srcUris","formData","FormData","append","Array","isArray","join","config","drvUrl","fetchVoid","method","body","srcDeleteOverride","uiContext","itemIdents","isAvailable","waitForAvailable","fd","map","srcRef","qs","srcMarkDrvDone","wspsLive","saveItems"],"mappings":"OAAoCA,QAAS;OACfC,QAAI;OAC1BC,OAAG;OAWL,IAAWC,SAAjB,SAAiBA,SAEhB,SAAgBC,iBAAiBC,IAChC,OAAQA,IACR,IAAK,cACL,IAAK,qBACJ,MAAO;AAER,IAAK,eACJ,MAAO;AACR,IAAK,mBACJ,MAAO;AACR,IAAK,oBACJ,MAAO;AAER,IAAK,eACJ,MAAO;AACR,IAAK,gBACJ,MAAO;AACR,IAAK,iBACJ,MAAO;AAER,IAAK,aACJ,MAAO;AACR,IAAK,cACJ,MAAO;AACR,IAAK,eACJ,MAAO;AAER,IAAK,SACJ,MAAO,aAER,OAAOA,GA9BQF,QAAAC,iBAAgBA;AAiChC,SAAgBE,gBAAgBD,IAC/B,OAAQA,IAER,IAAK,eACL,IAAK,eACL,IAAK,aACJ,MAAO;AACR,IAAK,mBACL,IAAK,gBACL,IAAK,cACJ,MAAO;AACR,IAAK,oBACL,IAAK,iBACL,IAAK,eACJ,MAAO;AACR,IAAK,SACL,IAAK,cACL,IAAK,qBACJ,MAAO,GAGR,OAAOA,GArBQF,QAAAG,gBAAeA;AAwB/B,SAAgBC,iBAAiBF,IAChC,OAAQA,IACR,IAAK,eACL,IAAK,mBACL,IAAK,oBACJ,MAAO;AACR,IAAK,eACL,IAAK,gBACL,IAAK,iBACJ,MAAO;AACR,IAAK,aACL,IAAK,cACL,IAAK,eACL,IAAK,qBACJ,MAAO;AACR,IAAK,SACJ,MAAO;AACR,IAAK,cACJ,MAAO,GAER,OAAOA,GApBQF,QAAAI,iBAAgBA;AAuBhC,SAAgBC,MAAMC,OACrB,IAAKA,MAAO,OAAOC;AACnB,OAAOD,MAAME,QAAU,KAAO,MAFfR,QAAAK,MAAKA;AAKdI,eAAeC,aAAaC,UAAgBC,OAA6BC,SAC9ED,OAAeD,UAAYA,UAAUG;AACtC,GAAID,SAAW,KAAM,CACpB,IAAKF,UAAUI,eAAgBJ,UAAUK;AACzCH,QAAUF,UAAUE,QAErB,OAAOhB,IAAIoB,UAAUN,UAAUO,UAAWN,OAAQC,SAN7Bb,QAAAU,aAAYA;AAS3BD,eAAeU,kBAAkBC,IAAUC,SACjD,MAAMC,SAAW,IAAIC;AACrBD,SAASE,OAAO,UAAWC,MAAMC,QAAQL,SAAWA,QAAQM,KAAK,MAAQN;AACzE,OAAOD,IAAIF,UAAUU,OAAOC,OAAOC,UAAU,qCAAuCV,IAAIN,KAAM,CAACiB,OAAQ,OAAQC,KAAMV,WAHhGtB,QAAAmB,kBAAiBA;AAOhCV,eAAewB,kBAAkBb,IAAUc,UAAwBC,YACzE,IAAKf,IAAIgB,kBAAmBhB,IAAIiB,iBAAiBH;AACjD,MAAMI,GAAK,IAAIf;AACfe,GAAGd,OAAO,UAAWW,WAAWI,IAAIzC,IAAI0C,QAAQb,KAAK;AACrD,OAAOP,IAAIF,UAAUU,OAAOC,OAAOC,UAAU/B,GAAG0C,GAAG,WAAY,oBAAqB,QAASrB,IAAIN,MAAO,CAACiB,OAAQ,OAAQC,KAAMM,KAJ1GtC,QAAAiC,kBAAiBA;AAOhCxB,eAAeiC,eAAetB,IAAUc,UAAwBC,YACtE,IAAKf,IAAIgB,kBAAmBhB,IAAIiB,iBAAiBH;MAC3Cd,IAAIF,UAAUyB,SAASC,UAAUxB,IAAIN,KAAMqB;AACjD,MAAMG,GAAK,IAAIf;AACfe,GAAGd,OAAO,UAAWW,WAAWI,IAAIzC,IAAI0C,QAAQb,KAAK;AACrD,OAAOP,IAAIF,UAAUU,OAAOC,OAAOC,UAAU/B,GAAG0C,GAAG,WAAY,mBAAoB,QAASrB,IAAIN,MAAO,CAACiB,OAAQ,OAAQC,KAAMM,KALzGtC,QAAA0C,eAAcA,gBA9GrC,CAAiB1C,UAAAA,QAAO","sourcesContent":["import {JWspDefProps, JWspTypeInst, WSP, Wsp} from \"lib/wsp/wsp\";\nimport {EDrvState, JSrcIdent, SRC} from \"lib/wsp/src\";\nimport {IO} from \"lib/commons/io/io\";\n\n\ninterface OWspDrvCreateParams {\n\tdrvAxis: string;\n\talias?: string;\n\tdesc?: string;\n\tdrvDefaultSrcFindPath?: string;\n}\n\n\nexport namespace WSP_DRV {\n\n\texport function getDrvStateLabel(st: EDrvState): string {\n\t\tswitch (st) {\n\t\tcase \"notComputed\":\n\t\tcase \"createdNotComputed\":\n\t\t\treturn \"\";\n\n\t\tcase \"notOverriden\":\n\t\t\treturn \"Non surchargé, non achevé\";\n\t\tcase \"notOverridenDone\":\n\t\t\treturn \"Non surchargé, marqué 'achevé'\";\n\t\tcase \"notOverridenDirty\":\n\t\t\treturn \"Non surchargé, à contrôler\";\n\n\t\tcase \"overridenNew\":\n\t\t\treturn \"Surchargé, non 'achevé'\";\n\t\tcase \"overridenDone\":\n\t\t\treturn \"Surchargé, marqué 'achevé'\";\n\t\tcase \"overridenDirty\":\n\t\t\treturn \"Surchargé, à contrôler\";\n\n\t\tcase \"createdNew\":\n\t\t\treturn \"Local, non 'achevé'\";\n\t\tcase \"createdDone\":\n\t\t\treturn \"Local, marqué 'achevé'\";\n\t\tcase \"createdDirty\":\n\t\t\treturn \"Local, à contrôler\";\n\n\t\tcase \"erased\":\n\t\t\treturn \"Supprimé\";\n\t\t}\n\t\treturn st;\n\t}\n\n\texport function getDrvStateDone(st: EDrvState): string {\n\t\tswitch (st) {\n\n\t\tcase \"notOverriden\":\n\t\tcase \"overridenNew\":\n\t\tcase \"createdNew\":\n\t\t\treturn \"Non 'achevé'\";\n\t\tcase \"notOverridenDone\":\n\t\tcase \"overridenDone\":\n\t\tcase \"createdDone\":\n\t\t\treturn \"Marqué 'achevé'\";\n\t\tcase \"notOverridenDirty\":\n\t\tcase \"overridenDirty\":\n\t\tcase \"createdDirty\":\n\t\t\treturn \"À contrôler\";\n\t\tcase \"erased\":\n\t\tcase \"notComputed\":\n\t\tcase \"createdNotComputed\":\n\t\t\treturn \"\";\n\n\t\t}\n\t\treturn st;\n\t}\n\n\texport function getDrvStateLayer(st: EDrvState): string {\n\t\tswitch (st) {\n\t\tcase \"notOverriden\":\n\t\tcase \"notOverridenDone\":\n\t\tcase \"notOverridenDirty\":\n\t\t\treturn \"Non surchargé\";\n\t\tcase \"overridenNew\":\n\t\tcase \"overridenDone\":\n\t\tcase \"overridenDirty\":\n\t\t\treturn \"Surchargé\";\n\t\tcase \"createdNew\":\n\t\tcase \"createdDone\":\n\t\tcase \"createdDirty\":\n\t\tcase \"createdNotComputed\":\n\t\t\treturn \"Local\";\n\t\tcase \"erased\":\n\t\t\treturn \"Supprimé\";\n\t\tcase \"notComputed\":\n\t\t\treturn \"\";\n\t\t}\n\t\treturn st;\n\t}\n\n\texport function isDrv(props: JWspDefProps): boolean | undefined {\n\t\tif (!props) return undefined;\n\t\treturn props.drvAxis ? true : false;\n\t}\n\n\texport async function createWspDrv(wspMaster: Wsp, params: OWspDrvCreateParams, wspType?: JWspTypeInst): Promise<Wsp> {\n\t\t(params as any).wspMaster = wspMaster.code;\n\t\tif (wspType == null) {\n\t\t\tif (!wspMaster.isLoaded) await wspMaster.waitForLoad();\n\t\t\twspType = wspMaster.wspType;\n\t\t}\n\t\treturn WSP.createWsp(wspMaster.wspServer, params, wspType);\n\t}\n\n\texport async function deleteDrvOverride(wsp: Wsp, srcUris: string | string[]): Promise<void> {\n\t\tconst formData = new FormData();\n\t\tformData.append(\"refUris\", Array.isArray(srcUris) ? srcUris.join('\\t') : srcUris);\n\t\treturn wsp.wspServer.config.drvUrl.fetchVoid(\"?cdaction=DeleteDrvOverride&param=\" + wsp.code, {method: \"POST\", body: formData});\n\t}\n\n\n\texport async function srcDeleteOverride(wsp: Wsp, uiContext: HTMLElement, itemIdents: JSrcIdent[]): Promise<void> {\n\t\tif (!wsp.isAvailable) await wsp.waitForAvailable(uiContext);\n\t\tconst fd = new FormData();\n\t\tfd.append(\"refUris\", itemIdents.map(SRC.srcRef).join('\\t'));\n\t\treturn wsp.wspServer.config.drvUrl.fetchVoid(IO.qs(\"cdaction\", \"DeleteDrvOverride\", \"param\", wsp.code), {method: \"POST\", body: fd});\n\t}\n\n\texport async function srcMarkDrvDone(wsp: Wsp, uiContext: HTMLElement, itemIdents: JSrcIdent[]): Promise<void> {\n\t\tif (!wsp.isAvailable) await wsp.waitForAvailable(uiContext);\n\t\tawait wsp.wspServer.wspsLive.saveItems(wsp.code, itemIdents);\n\t\tconst fd = new FormData();\n\t\tfd.append(\"refUris\", itemIdents.map(SRC.srcRef).join('\\t'));\n\t\treturn wsp.wspServer.config.drvUrl.fetchVoid(IO.qs(\"cdaction\", \"MarkOverrideDone\", \"param\", wsp.code), {method: \"POST\", body: fd});\n\t}\n}\n"]}