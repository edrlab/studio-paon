{"version":3,"sources":["/@lib@/wsp/drf.ts"],"names":["WSP","SRC","IO","WSP_DRF","getDrfStateLabel","st","isDrf","props","undefined","drfRefWsp","async","createWspDrf","wspRef","params","wspType","code","isLoaded","waitForLoad","createWsp","wspServer","srcRevert","wsp","uiContext","itemIdents","isAvailable","waitForAvailable","fd","FormData","append","map","srcRef","join","config","drfUrl","fetchVoid","qs","method","body","srcCommit","wspsLive","saveItems"],"mappings":"OAAoCA,QAAS;OACfC,QAAI;OAC1BC,OAAG;OASL,IAAWC,SAAjB,SAAiBA,SAEhB,SAAgBC,iBAAiBC,IAChC,OAAQA,IAER,IAAK,cACJ,MAAO;AACR,IAAK,eACJ,MAAO;AACR,IAAK,UACJ,MAAO;AACR,IAAK,iBACJ,MAAO;AACR,IAAK,YACJ,MAAO;AACR,IAAK,SACJ,MAAO,aAER,OAAOA,GAhBQF,QAAAC,iBAAgBA;AAmBhC,SAAgBE,MAAMC,OACrB,IAAKA,MAAO,OAAOC;AACnB,OAAOD,MAAME,UAAY,KAAO,MAFjBN,QAAAG,MAAKA;AAKdI,eAAeC,aAAaC,OAAaC,OAA6BC,SAC3ED,OAAeD,OAASA,OAAOG;AAChC,GAAID,SAAW,KAAM,CACpB,IAAKF,OAAOI,eAAgBJ,OAAOK;AACnCH,QAAUF,OAAOE,QAElB,OAAOd,IAAIkB,UAAUN,OAAOO,UAAWN,OAAQC,SAN1BX,QAAAQ,aAAYA;AAS3BD,eAAeU,UAAUC,IAAUC,UAA+BC,YACxE,IAAKF,IAAIG,kBAAmBH,IAAII,iBAAiBH;AACjD,MAAMI,GAAK,IAAIC;AACfD,GAAGE,OAAO,UAAWL,WAAWM,IAAI5B,IAAI6B,QAAQC,KAAK;AACrD,OAAOV,IAAIF,UAAUa,OAAOC,OAAOC,UAAUhC,GAAGiC,GAAG,WAAY,SAAU,QAASd,IAAIN,MAAO,CAACqB,OAAQ,OAAQC,KAAMX,KAJ/FvB,QAAAiB,UAASA;AAOxBV,eAAe4B,UAAUjB,IAAUC,UAA+BC,YACxE,IAAKF,IAAIG,kBAAmBH,IAAII,iBAAiBH;MAC3CD,IAAIF,UAAUoB,SAASC,UAAUnB,IAAIN,KAAMQ;AACjD,MAAMG,GAAK,IAAIC;AACfD,GAAGE,OAAO,UAAWL,WAAWM,IAAI5B,IAAI6B,QAAQC,KAAK;AACrD,OAAOV,IAAIF,UAAUa,OAAOC,OAAOC,UAAUhC,GAAGiC,GAAG,WAAY,SAAU,QAASd,IAAIN,MAAO,CAACqB,OAAQ,OAAQC,KAAMX,KAL/FvB,QAAAmC,UAASA,WA1ChC,CAAiBnC,UAAAA,QAAO","sourcesContent":["import {JWspDefProps, JWspTypeInst, WSP, Wsp} from \"lib/wsp/wsp\";\nimport {EDrfState, JSrcIdent, SRC} from \"lib/wsp/src\";\nimport {IO} from \"lib/commons/io/io\";\n\n\ntype OWspDrfCreateParams = {\n\tdraftTitle: string;\n\talias?: string;\n\tdesc?: string;\n}\n\nexport namespace WSP_DRF {\n\n\texport function getDrfStateLabel(st: EDrfState): any {\n\t\tswitch (st) {\n\t\t\t//erased, createdDeleted, notOverriden, created, overriden, notComputed\n\t\tcase \"notComputed\":\n\t\t\treturn \"\";\n\t\tcase \"notOverriden\":\n\t\t\treturn \"Inchangé\";\n\t\tcase \"created\":\n\t\t\treturn \"Nouveau\";\n\t\tcase \"createdDeleted\":\n\t\t\treturn \"Nouveau en corbeille\";\n\t\tcase \"overriden\":\n\t\t\treturn \"Modifié\";\n\t\tcase \"erased\":\n\t\t\treturn \"Supprimé\";\n\t\t}\n\t\treturn st;\n\t}\n\n\texport function isDrf(props: JWspDefProps): boolean | undefined {\n\t\tif (!props) return undefined;\n\t\treturn props.drfRefWsp ? true : false;\n\t}\n\n\texport async function createWspDrf(wspRef: Wsp, params: OWspDrfCreateParams, wspType?: JWspTypeInst): Promise<Wsp> {\n\t\t(params as any).wspRef = wspRef.code;\n\t\tif (wspType == null) {\n\t\t\tif (!wspRef.isLoaded) await wspRef.waitForLoad();\n\t\t\twspType = wspRef.wspType;\n\t\t}\n\t\treturn WSP.createWsp(wspRef.wspServer, params, wspType);\n\t}\n\n\texport async function srcRevert(wsp: Wsp, uiContext: HTMLElement | null, itemIdents: JSrcIdent[]): Promise<void> {\n\t\tif (!wsp.isAvailable) await wsp.waitForAvailable(uiContext);\n\t\tconst fd = new FormData();\n\t\tfd.append(\"refUris\", itemIdents.map(SRC.srcRef).join('\\t'));\n\t\treturn wsp.wspServer.config.drfUrl.fetchVoid(IO.qs(\"cdaction\", \"Revert\", \"param\", wsp.code), {method: \"POST\", body: fd});\n\t}\n\n\texport async function srcCommit(wsp: Wsp, uiContext: HTMLElement | null, itemIdents: JSrcIdent[]): Promise<void> {\n\t\tif (!wsp.isAvailable) await wsp.waitForAvailable(uiContext);\n\t\tawait wsp.wspServer.wspsLive.saveItems(wsp.code, itemIdents);\n\t\tconst fd = new FormData();\n\t\tfd.append(\"refUris\", itemIdents.map(SRC.srcRef).join('\\t'));\n\t\treturn wsp.wspServer.config.drfUrl.fetchVoid(IO.qs(\"cdaction\", \"Commit\", \"param\", wsp.code), {method: \"POST\", body: fd});\n\t}\n}\n"]}